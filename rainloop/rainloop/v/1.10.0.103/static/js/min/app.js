/* RainLoop Webmail (c) RainLoop Team | Licensed under AGPL v3 */
!function(e){function t(o){if(i[o])return i[o].exports;var s=i[o]={exports:{},id:o,loaded:!1};return e[o].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="rainloop/v/0.0.0/static/js/min/",t(0)}([function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var s=i(77),n=o(s),r=i(7),a=o(r);(0,n["default"])(a["default"])},function(e,t,i){!function(){"use strict";var t=null,o={},s=i(11),n=i(3),r=i(14),a=i(2),l=i(78),c=i(36),u=i(79),d=i(66),p=i(4),h=i(8);o.trim=r.trim,o.inArray=r.inArray,o.isArray=n.isArray,o.isObject=n.isObject,o.isFunc=n.isFunction,o.isUnd=n.isUndefined,o.isNull=n.isNull,o.emptyFunction=o.noop=function(){},o.silentTryCatch=function(e){try{e()}catch(t){}},o.isNormal=function(e){return!o.isUnd(e)&&!o.isNull(e)},o.windowResize=n.debounce(function(e){o.isUnd(e)?h.$win.resize():s.setTimeout(function(){h.$win.resize()},e)},50),o.windowResizeCallback=function(){o.windowResize()},o.isPosNumeric=function(e,t){return o.isNormal(e)?(o.isUnd(t)?0:!t)?/^[1-9]+[0-9]*$/.test(e.toString()):/^[0-9]*$/.test(e.toString()):!1},o.pInt=function(e,t){var i=o.isNormal(e)&&""!==e?s.parseInt(e,10):t||0;return s.isNaN(i)?t||0:i},o.pString=function(e){return o.isNormal(e)?""+e:""},o.pBool=function(e){return!!e},o.encodeURIComponent=function(e){return s.encodeURIComponent(e)},o.isNonEmptyArray=function(e){return o.isArray(e)&&0<e.length},o.simpleQueryParser=function(e){var t={},i=[],o=[],n=0,r=0;for(i=e.split("&"),n=0,r=i.length;r>n;n++)o=i[n].split("="),t[s.decodeURIComponent(o[0])]=s.decodeURIComponent(o[1]);return t},o.mailToHelper=function(e,t){if(e&&"mailto:"===e.toString().substr(0,7).toLowerCase()){if(!t)return!0;e=e.toString().substr(7);var r=[],a=null,l=null,c={},u=i(30),d=e.replace(/\?.+$/,""),h=e.replace(/^[^\?]*\?/,""),f=function(e){return e?n.compact(n.map(s.decodeURIComponent(e).split(/[,]/),function(e){var t=new u;return t.mailsoParse(e),""!==t.email?t:null})):null};return r=f(d),c=o.simpleQueryParser(h),o.isUnd(c.cc)||(a=f(s.decodeURIComponent(c.cc))),o.isUnd(c.bcc)||(l=f(s.decodeURIComponent(c.bcc))),i(5).showScreenPopup(t,[p.ComposeType.Empty,null,r,a,l,o.isUnd(c.subject)?null:o.pString(s.decodeURIComponent(c.subject)),o.isUnd(c.body)?null:o.plainToHtml(o.pString(s.decodeURIComponent(c.body)))]),!0}return!1},o.rsaObject=function(e){return u&&e&&(null===t||t&&t.__sPublicKey!==e)&&s.crypto&&s.crypto.getRandomValues?(t=new u,t.setPublicKey(e),t.__sPublicKey=e):t=!1,t},o.rsaEncode=function(e,t){if(s.crypto&&s.crypto.getRandomValues&&t){var i=!1,n=o.rsaObject(t);if(n&&(i=n.encrypt(o.fakeMd5()+":"+e+":"+o.fakeMd5()),!1!==i&&o.isNormal(i)))return"rsa:xxx:"+i}return e},o.rsaEncode.supported=(s.crypto&&s.crypto.getRandomValues,!1),o.encodeHtml=function(e){return o.isNormal(e)?n.escape(e.toString()):""},o.splitPlainText=function(e,t){var i="",s="",n=e,r=0,a=0;for(t=o.isUnd(t)?100:t;n.length>t;)s=n.substring(0,t),r=s.lastIndexOf(" "),a=s.lastIndexOf("\n"),-1!==a&&(r=a),-1===r&&(r=t),i+=s.substring(0,r)+"\n",n=n.substring(r+1);return i+n},o.timeOutAction=function(){var e={};return function(t,i,n){o.isUnd(e[t])&&(e[t]=0),s.clearTimeout(e[t]),e[t]=s.setTimeout(i,n)}}(),o.timeOutActionSecond=function(){var e={};return function(t,i,o){e[t]||(e[t]=s.setTimeout(function(){i(),e[t]=0},o))}}(),o.hos=function(e,t){return e&&s.Object&&s.Object.hasOwnProperty?s.Object.hasOwnProperty.call(e,t):!1},o.inFocus=function(){return s.document.activeElement?(o.isUnd(s.document.activeElement.__inFocusCache)&&(s.document.activeElement.__inFocusCache=r(s.document.activeElement).is("input,textarea,iframe,.cke_editable")),!!s.document.activeElement.__inFocusCache):!1},o.removeInFocus=function(e){if(s.document&&s.document.activeElement&&s.document.activeElement.blur){var t=r(s.document.activeElement);if(t.is("input,textarea"))s.document.activeElement.blur();else if(e)try{s.document.activeElement.blur()}catch(i){}}},o.removeSelection=function(){if(s&&s.getSelection){var e=s.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}else s.document&&s.document.selection&&s.document.selection.empty&&s.document.selection.empty()},o.replySubjectAdd=function(e,t){e=o.trim(e.toUpperCase()),t=o.trim(t.replace(/[\s]+/g," "));var i=!1,s=[],r="RE"===e,a="FWD"===e,l=!a;return""!==t&&n.each(t.split(":"),function(e){var t=o.trim(e);i||!/^(RE|FWD)$/i.test(t)&&!/^(RE|FWD)[\[\(][\d]+[\]\)]$/i.test(t)?(s.push(e),i=!0):(r||(r=!!/^RE/i.test(t)),a||(a=!!/^FWD/i.test(t)))}),l?r=!1:a=!1,o.trim((l?"Re: ":"Fwd: ")+(r?"Re: ":"")+(a?"Fwd: ":"")+o.trim(s.join(":")))},o.roundNumber=function(e,t){return s.Math.round(e*s.Math.pow(10,t))/s.Math.pow(10,t)},o.friendlySize=function(e){return e=o.pInt(e),e>=1073741824?o.roundNumber(e/1073741824,1)+"GB":e>=1048576?o.roundNumber(e/1048576,1)+"MB":e>=1024?o.roundNumber(e/1024,0)+"KB":e+"B"},o.log=function(e){s.console&&s.console.log&&s.console.log(e)},o.delegateRun=function(e,t,i,s){e&&e[t]&&(s=o.pInt(s),0>=s?e[t].apply(e,o.isArray(i)?i:[]):n.delay(function(){e[t].apply(e,o.isArray(i)?i:[])},s))},o.kill_CtrlA_CtrlS=function(e){if(e=e||s.event,e&&e.ctrlKey&&!e.shiftKey&&!e.altKey){var t=e.target||e.srcElement,i=e.keyCode||e.which;if(i===p.EventKeyCode.S)return void e.preventDefault();if(i===p.EventKeyCode.A){if(t&&("true"==""+t.contentEditable||t.tagName&&t.tagName.match(/INPUT|TEXTAREA/i)))return;s.getSelection?s.getSelection().removeAllRanges():s.document.selection&&s.document.selection.clear&&s.document.selection.clear(),e.preventDefault()}}},o.createCommand=function(e,t,i){var s=o.emptyFunction,n=function(){return s&&s.canExecute&&s.canExecute()&&t.apply(e,Array.prototype.slice.call(arguments)),!1};return s=t?n:o.emptyFunction,s.enabled=a.observable(!0),i=o.isUnd(i)?!0:i,o.isFunc(i)?s.canExecute=a.computed(function(){return s.enabled()&&i.call(e)}):s.canExecute=a.computed(function(){return s.enabled()&&!!i}),s},o.convertThemeName=n.memoize(function(e){return"@custom"===e.substr(-7)&&(e=o.trim(e.substring(0,e.length-7))),o.trim(e.replace(/[^a-zA-Z0-9]+/g," ").replace(/([A-Z])/g," $1").replace(/[\s]+/g," "))}),o.quoteName=function(e){return e.replace(/["]/g,'\\"')},o.microtime=function(){return(new s.Date).getTime()},o.timestamp=function(){return s.Math.round(o.microtime()/1e3)},o.convertLangName=function(e,t){return i(6).i18n("LANGS_NAMES"+(!0===t?"_EN":"")+"/LANG_"+e.toUpperCase().replace(/[^a-zA-Z0-9]+/g,"_"),null,e)},o.fakeMd5=function(e){var t="",i="0123456789abcdefghijklmnopqrstuvwxyz";for(e=o.isUnd(e)?32:o.pInt(e);t.length<e;)t+=i.substr(s.Math.round(s.Math.random()*i.length),1);return t},o.draggablePlace=function(){return r('<div class="draggablePlace"><span class="text"></span>&nbsp;<i class="icon-copy icon-white visible-on-ctrl"></i><i class="icon-mail icon-white hidden-on-ctrl"></i></div>').appendTo("#rl-hidden")},o.defautOptionsAfterRender=function(e,t){t&&!o.isUnd(t.disabled)&&e&&r(e).toggleClass("disabled",t.disabled).prop("disabled",t.disabled)},o.windowPopupKnockout=function(e,t,n,l){var c=null,u=s.open(""),d="__OpenerApplyBindingsUid"+o.fakeMd5()+"__",p=r("#"+t);s[d]=function(){if(u&&u.document.body&&p&&p[0]){var t=r(u.document.body);r("#rl-content",t).html(p.html()),r("html",u.document).addClass("external "+r("html").attr("class")),i(6).i18nToNodes(t),e&&r("#rl-content",t)[0]&&a.applyBindings(e,r("#rl-content",t)[0]),s[d]=null,l(u)}},u.document.open(),u.document.write('<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="user-scalable=no" /><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="robots" content="noindex, nofollow, noodp" /><title>'+o.encodeHtml(n)+'</title></head><body><div id="rl-content"></div></body></html>'),u.document.close(),c=u.document.createElement("script"),c.type="text/javascript",c.innerHTML="if(window&&window.opener&&window.opener['"+d+"']){window.opener['"+d+"']();window.opener['"+d+"']=null}",u.document.getElementsByTagName("head")[0].appendChild(c)},o.settingsSaveHelperFunction=function(e,t,i,s){return i=i||null,s=o.isUnd(s)?1e3:o.pInt(s),function(o,r,a,l,c){t.call(i,r&&r.Result?p.SaveSettingsStep.TrueResult:p.SaveSettingsStep.FalseResult),e&&e.call(i,o,r,a,l,c),n.delay(function(){t.call(i,p.SaveSettingsStep.Idle)},s)}},o.settingsSaveHelperSimpleFunction=function(e,t){return o.settingsSaveHelperFunction(null,e,t,1e3)},o.settingsSaveHelperSubscribeFunction=function(e,t,i,s){return function(n){if(e){switch(i){default:n=o.pString(n);break;case"bool":case"boolean":n=n?"1":"0";break;case"int":case"integer":case"number":n=o.pInt(n);break;case"trim":n=o.trim(n)}var r={};r[t]=n,e.saveAdminConfig?e.saveAdminConfig(s||null,r):e.saveSettings&&e.saveSettings(s||null,r)}}},o.htmlToPlain=function(e){var t=0,i=0,s=0,a=0,l=0,c="",u=function(e){return e=o.trim(e),e="> "+e.replace(/\n/gm,"\n> "),e.replace(/(^|\n)([> ]+)/gm,function(){return arguments&&2<arguments.length?arguments[1]+r.trim(arguments[2].replace(/[\s]/g,""))+" ":""})},d=function(){if(arguments&&1<arguments.length){var e=r.trim(arguments[1]);return 0<e.length&&(e=e.replace(/<div[^>]*>([\s\S\r\n]*)<\/div>/gim,d),e="\n"+r.trim(e)+"\n"),e}return""},p=function(){return arguments&&1<arguments.length?arguments[1].toString().replace(/[\n]/gm,"<br />").replace(/[\r]/gm,""):""},f=function(){return arguments&&1<arguments.length?""+arguments[1]+n.escape(arguments[2]):""},m=function(){return arguments&&1<arguments.length?r.trim(arguments[1]):""};for(c=e.replace(/\u0002([\s\S]*)\u0002/gm,"‌$1‌").replace(/<p[^>]*><\/p>/gi,"").replace(/<pre[^>]*>([\s\S\r\n\t]*)<\/pre>/gim,p).replace(/[\s]+/gm," ").replace(/((?:href|data)\s?=\s?)("[^"]+?"|'[^']+?')/gim,f).replace(/<br[^>]*>/gim,"\n").replace(/<\/h[\d]>/gi,"\n").replace(/<\/p>/gi,"\n\n").replace(/<ul[^>]*>/gim,"\n").replace(/<\/ul>/gi,"\n").replace(/<li[^>]*>/gim," * ").replace(/<\/li>/gi,"\n").replace(/<\/td>/gi,"\n").replace(/<\/tr>/gi,"\n").replace(/<hr[^>]*>/gim,"\n_______________________________\n\n").replace(/<div[^>]*>([\s\S\r\n]*)<\/div>/gim,d).replace(/<blockquote[^>]*>/gim,"\n__bq__start__\n").replace(/<\/blockquote>/gim,"\n__bq__end__\n").replace(/<a [^>]*>([\s\S\r\n]*?)<\/a>/gim,m).replace(/<\/div>/gi,"\n").replace(/&nbsp;/gi," ").replace(/&quot;/gi,'"').replace(/<[^>]*>/gm,""),c=h.$div.html(c).text(),c=c.replace(/\n[ \t]+/gm,"\n").replace(/[\n]{3,}/gm,"\n\n").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"),c=o.splitPlainText(o.trim(c)),t=0,l=800;l>0&&(l--,i=c.indexOf("__bq__start__",t),i>-1);)s=c.indexOf("__bq__start__",i+5),a=c.indexOf("__bq__end__",i+5),(-1===s||s>a)&&a>i?(c=c.substring(0,i)+u(c.substring(i+13,a))+c.substring(a+11),t=0):t=s>-1&&a>s?s-1:0;return c=c.replace(/__bq__start__/gm,"").replace(/__bq__end__/gm,"")},o.plainToHtml=function(e,t){e=e.toString().replace(/\r/g,""),t=o.isUnd(t)?!1:!!t;var i=!1,s=!0,n=!0,r=[],a="",l=0,c=e.split("\n");do{for(s=!1,r=[],l=0;l<c.length;l++)a=c[l],n=">"===a.substr(0,1),n&&!i?(s=!0,i=!0,r.push("~~~blockquote~~~"),r.push(a.substr(1))):!n&&i?""!==a?(i=!1,r.push("~~~/blockquote~~~"),r.push(a)):r.push(a):n&&i?r.push(a.substr(1)):r.push(a);i&&(i=!1,r.push("~~~/blockquote~~~")),c=r}while(s);return e=c.join("\n"),e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/~~~blockquote~~~[\s]*/g,"<blockquote>").replace(/[\s]*~~~\/blockquote~~~/g,"</blockquote>").replace(/\u200C([\s\S]*)\u200C/g,"$1").replace(/\n/g,"<br />"),t?o.findEmailAndLinks(e):e},s.rainloop_Utils_htmlToPlain=o.htmlToPlain,s.rainloop_Utils_plainToHtml=o.plainToHtml,o.findEmailAndLinks=function(e){return e=l.link(e,{newWindow:!0,stripPrefix:!1,urls:!0,email:!0,twitter:!1,replaceFn:function(e,t){return!(e&&t&&"url"===t.getType()&&t.matchedText&&0!==t.matchedText.indexOf("http"))}})},o.resizeAndCrop=function(e,t,i){var o=new s.Image;o.onload=function(){var e=[0,0],o=s.document.createElement("canvas"),n=o.getContext("2d");o.width=t,o.height=t,e=this.width>this.height?[this.width-this.height,0]:[0,this.height-this.width],n.fillStyle="#fff",n.fillRect(0,0,t,t),n.drawImage(this,e[0]/2,e[1]/2,this.width-e[0],this.height-e[1],0,0,t,t),i(o.toDataURL("image/jpeg"))},o.src=e},o.folderListOptionsBuilder=function(e,t,i,n,r,a,l,c,u,d){var h=null,f=!1,m=0,g=0,b="   ",y=[];for(d=o.isUnd(d)?!1:!!d,u=o.isNormal(u)?u:0<e.length,r=o.isNormal(r)?r:0,a=o.isNormal(a)?a:null,l=o.isNormal(l)?l:null,c=o.isNormal(c)?c:null,o.isArray(i)||(i=[]),o.isArray(n)||(n=[]),m=0,g=n.length;g>m;m++)y.push({id:n[m][0],name:n[m][1],system:!1,seporator:!1,disabled:!1});for(f=!0,m=0,g=e.length;g>m;m++)h=e[m],(l?l.call(null,h):!0)&&(f&&0<y.length&&y.push({id:"---",name:"---",system:!1,seporator:!0,disabled:!0}),f=!1,y.push({id:h.fullNameRaw,name:c?c.call(null,h):h.name(),system:!0,seporator:!1,disabled:!h.selectable||-1<o.inArray(h.fullNameRaw,i)||(a?a.call(null,h):!1)}));for(f=!0,m=0,g=t.length;g>m;m++)h=t[m],!h.subScribed()&&h.existen&&!d||!h.selectable&&!h.hasSubScribedSubfolders()||(l?l.call(null,h):!0)&&(p.FolderType.User!==h.type()&&u&&!h.hasSubScribedSubfolders()||(f&&0<y.length&&y.push({id:"---",name:"---",system:!1,seporator:!0,disabled:!0}),f=!1,y.push({id:h.fullNameRaw,name:new s.Array(h.deep+1-r).join(b)+(c?c.call(null,h):h.name()),system:!1,seporator:!1,disabled:!h.selectable||-1<o.inArray(h.fullNameRaw,i)||(a?a.call(null,h):!1)}))),h.subScribed()&&0<h.subFolders().length&&(y=y.concat(o.folderListOptionsBuilder([],h.subFolders(),i,[],r,a,l,c,u,d)));return y},o.computedPagenatorHelper=function(e,t){return function(){var i=0,n=0,r=2,a=[],l=e(),c=t(),u=function(e,t,i){var s={current:e===l,name:o.isUnd(i)?e.toString():i.toString(),custom:!o.isUnd(i),title:o.isUnd(i)?"":e.toString(),value:e.toString()};(o.isUnd(t)?0:!t)?a.unshift(s):a.push(s)};if(c>1||c>0&&l>c){for(l>c?(u(c),i=c,n=c):((3>=l||l>=c-2)&&(r+=2),u(l),i=l,n=l);r>0;)if(i-=1,n+=1,i>0&&(u(i,!1),r--),c>=n)u(n,!0),r--;else if(0>=i)break;3===i?u(2,!1):i>3&&u(s.Math.round((i-1)/2),!1,"..."),c-2===n?u(c-1,!0):c-2>n&&u(s.Math.round((c+n)/2),!0,"..."),i>1&&u(1,!1),c>n&&u(c,!0)}return a}},o.selectElement=function(e){var t,i;s.getSelection?(t=s.getSelection(),t.removeAllRanges(),i=s.document.createRange(),i.selectNodeContents(e),t.addRange(i)):s.document.selection&&(i=s.document.body.createTextRange(),i.moveToElementText(e),i.select())},o.detectDropdownVisibility=n.debounce(function(){h.dropdownVisibility(!!n.find(h.aBootstrapDropdowns,function(e){return e.hasClass("open")}))},50),o.triggerAutocompleteInputChange=function(e){var t=function(){r(".checkAutocomplete").trigger("change")};(o.isUnd(e)?1:!e)?t():n.delay(t,100)},o.setHeadViewport=function(e){var t=[];n.each(e,function(e,i){t.push(""+e+"="+i)}),r("#rl-head-viewport").attr("content",t.join(", "))},o.getFileExtension=function(e){e=o.trim(e).toLowerCase();var t=e.split(".").pop();return t===e?"":t},o.configurationScriptTagCache={},o.getConfigurationFromScriptTag=function(e){var t={};o.configurationScriptTagCache[e]||(o.configurationScriptTagCache[e]=r('script[type="application/json"][data-configuration="'+e+'"]'));try{t=c.parse(o.configurationScriptTagCache[e].text())}catch(i){}return t},o.mimeContentType=function(e){var t="",i="application/octet-stream";return e=o.trim(e).toLowerCase(),"winmail.dat"===e?"application/ms-tnef":(t=o.getFileExtension(e),t&&0<t.length&&!o.isUnd(d[t])&&(i=d[t]),i)},o.disposeOne=function(e,t){var i=t||e;i&&"function"==typeof i.dispose&&i.dispose()},o.disposeObject=function(e){e&&(o.isArray(e.disposables)&&n.each(e.disposables,o.disposeOne),a.utils.objectForEach(e,o.disposeOne))},o.delegateRunOnDestroy=function(e){e&&(o.isArray(e)?n.each(e,function(e){o.delegateRunOnDestroy(e)}):e&&e.onDestroy&&e.onDestroy())},o.__themeTimer=0,o.__themeAjax=null,o.changeTheme=function(e,t){var i=r("#rlThemeLink"),n=r("#rlThemeStyle"),a=i.attr("href");a||(a=n.attr("data-href")),a&&(a=a.toString().replace(/\/-\/[^\/]+\/\-\//,"/-/"+e+"/-/"),a=a.toString().replace(/\/Css\/[^\/]+\/User\//,"/Css/0/User/"),a=a.toString().replace(/\/Hash\/[^\/]+\//,"/Hash/-/"),"Json/"!==a.substring(a.length-5,a.length)&&(a+="Json/"),s.clearTimeout(o.__themeTimer),t(p.SaveSettingsStep.Animate),o.__themeAjax&&o.__themeAjax.abort&&o.__themeAjax.abort(),o.__themeAjax=r.ajax({url:a,dataType:"json"}).done(function(e){e&&o.isArray(e)&&2===e.length&&(!i||!i[0]||n&&n[0]||(n=r('<style id="rlThemeStyle"></style>'),i.after(n),i.remove()),n&&n[0]&&(n.attr("data-href",a).attr("data-theme",e[0]),n[0].styleSheet&&!o.isUnd(n[0].styleSheet.cssText)?n[0].styleSheet.cssText=e[1]:n.text(e[1])),t(p.SaveSettingsStep.TrueResult))}).always(function(){o.__themeTimer=s.setTimeout(function(){t(p.SaveSettingsStep.Idle)},1e3),o.__themeAjax=null}))},o.substr=s.String.substr,"b"!=="ab".substr(-1)&&(o.substr=function(e,t,i){return 0>t&&(t=e.length+t),e.substr(t,i)}),e.exports=o}()},function(e,t,i){!function(t){"use strict";var o=i(11),s=i(3),n=i(14),r=i(36),a=i(54),l=function(e){t.utils.domNodeDisposal.addDisposeCallback(e,function(){e&&e.__opentip&&e.__opentip.deactivate()})};t.bindingHandlers.updateWidth={init:function(e,i){var s=n(o),r=n(e),a=i(),l=function(){a(r.width()),o.setTimeout(function(){a(r.width())},500)};s.on("resize",l),l(),t.utils.domNodeDisposal.addDisposeCallback(e,function(){s.off("resize",l)})}},t.bindingHandlers.editor={init:function(e,o){var s=null,n=o(),r=function(){n&&n.__editor&&n.__editor.setHtmlOrPlain(n())},a=function(){n&&n.__editor&&n(n.__editor.getDataWithHtmlMark())},l=function(){n.__editor=s,r()},c=i(45);t.isObservable(n)&&c&&(s=new c(e,a,l,a),n.__fetchEditorValue=a,n.subscribe(r))}},t.bindingHandlers.json={init:function(e,i){n(e).text(r.stringify(t.unwrap(i())))},update:function(e,i){n(e).text(r.stringify(t.unwrap(i())))}},t.bindingHandlers.scrollerShadows={init:function(e){var i=8,r=n(e),a=n(o),l=r.find("[data-scroller-shadows-content]")[0]||null,c=s.throttle(function(){r.toggleClass("scroller-shadow-top",i<l.scrollTop).toggleClass("scroller-shadow-bottom",l.scrollTop+i<l.scrollHeight-l.clientHeight)},100);l&&(n(l).on("scroll resize",c),a.on("resize",c),t.utils.domNodeDisposal.addDisposeCallback(l,function(){n(l).off(),a.off("resize",c)}))}},t.bindingHandlers.tooltip={init:function(e,o){var r=!0,l="",c=null,u=n(e),d=o(),p="on"===(u.data("tooltip-mobile")||"off"),h=i(8);h.bMobileDevice&&!p||(r="on"===(u.data("tooltip-i18n")||"on"),l=!t.isObservable(d)&&s.isFunction(d)?d():t.unwrap(d),e.__opentip=new a(e,{style:"rainloopTip",element:e,tipJoint:u.data("tooltip-join")||"bottom"}),h.dropdownVisibility.subscribe(function(t){t&&e.__opentip.hide()}),""===l?(e.__opentip.hide(),e.__opentip.deactivate(),e.__opentip.setContent("")):e.__opentip.activate(),r?(c=i(6),e.__opentip.setContent(c.i18n(l)),c.trigger.subscribe(function(){e.__opentip.setContent(c.i18n(l))}),h.dropdownVisibility.subscribe(function(){e&&e.__opentip&&e.__opentip.setContent(i(6).i18n(l))})):e.__opentip.setContent(l))},update:function(e,o){var r=!0,a="",l=n(e),c=o(),u="on"===(l.data("tooltip-mobile")||"off"),d=i(8);d.bMobileDevice&&!u||!e.__opentip||(r="on"===(l.data("tooltip-i18n")||"on"),a=!t.isObservable(c)&&s.isFunction(c)?c():t.unwrap(c),a?(e.__opentip.setContent(r?i(6).i18n(a):a),e.__opentip.activate()):(e.__opentip.hide(),e.__opentip.deactivate(),e.__opentip.setContent("")))}},t.bindingHandlers.tooltipErrorTip={init:function(e){var t=n(e);e.__opentip=new a(e,{style:"rainloopErrorTip",hideOn:"mouseout click",element:e,tipJoint:t.data("tooltip-join")||"top"}),e.__opentip.deactivate(),n(o.document).on("click",function(){e&&e.__opentip&&e.__opentip.hide()}),l(e)},update:function(e,i){var o=n(e),r=i(),a=!t.isObservable(r)&&s.isFunction(r)?r():t.unwrap(r),l=e.__opentip;l&&(""===a?(l.hide(),l.deactivate(),l.setContent("")):s.delay(function(){o.is(":visible")?(l.setContent(a),l.activate(),l.show()):(l.hide(),l.deactivate(),l.setContent(""))},100))}},t.bindingHandlers.registrateBootstrapDropdown={init:function(e){var t=i(8);t&&t.aBootstrapDropdowns&&(t.aBootstrapDropdowns.push(n(e)),n(e).click(function(){i(1).detectDropdownVisibility()}))}},t.bindingHandlers.openDropdownTrigger={update:function(e,o){if(t.unwrap(o())){var s=n(e);s.hasClass("open")||s.find(".dropdown-toggle").dropdown("toggle"),s.find(".dropdown-toggle").focus(),i(1).detectDropdownVisibility(),o()(!1)}}},t.bindingHandlers.dropdownCloser={init:function(e){n(e).closest(".dropdown").on("click",".e-item",function(){n(e).dropdown("toggle")})}},t.bindingHandlers.popover={init:function(e,i){n(e).popover(t.unwrap(i())),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).popover("destroy")})}},t.bindingHandlers.csstext={init:function(e,i){e&&e.styleSheet&&void 0!==e.styleSheet.cssText?e.styleSheet.cssText=t.unwrap(i()):n(e).text(t.unwrap(i()))},update:function(e,i){e&&e.styleSheet&&void 0!==e.styleSheet.cssText?e.styleSheet.cssText=t.unwrap(i()):n(e).text(t.unwrap(i()))}},t.bindingHandlers.resizecrop={init:function(e){n(e).addClass("resizecrop").resizecrop({width:"100",height:"100",wrapperCSS:{"border-radius":"10px"}})},update:function(e,t){t()(),n(e).resizecrop({width:"100",height:"100"})}},t.bindingHandlers.onEnter={init:function(e,i,s,r){n(e).on("keypress.koOnEnter",function(t){t&&13===o.parseInt(t.keyCode,10)&&(n(e).trigger("change"),i().call(r))}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("keypress.koOnEnter")})}},t.bindingHandlers.onSpace={init:function(e,i,s,r){n(e).on("keyup.koOnSpace",function(e){e&&32===o.parseInt(e.keyCode,10)&&i().call(r,e)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("keyup.koOnSpace")})}},t.bindingHandlers.onTab={init:function(e,i,s,r){n(e).on("keydown.koOnTab",function(e){return e&&9===o.parseInt(e.keyCode,10)?i().call(r,!!e.shiftKey):void 0}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("keydown.koOnTab")})}},t.bindingHandlers.onEsc={init:function(e,i,s,r){n(e).on("keypress.koOnEsc",function(t){t&&27===o.parseInt(t.keyCode,10)&&(n(e).trigger("change"),i().call(r))}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("keypress.koOnEsc")})}},t.bindingHandlers.clickOnTrue={update:function(e,i){t.unwrap(i())&&n(e).click()}},t.bindingHandlers.modal={init:function(e,o){var s=i(8),r=i(1);n(e).toggleClass("fade",!s.bMobileDevice).modal({keyboard:!1,show:t.unwrap(o())}).on("shown.koModal",r.windowResizeCallback).find(".close").on("click.koModal",function(){o()(!1)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("shown.koModal").find(".close").off("click.koModal")})},update:function(e,o){var r=i(8);n(e).modal(t.unwrap(o())?"show":"hide"),r.$html.hasClass("rl-anim")&&(r.$html.addClass("rl-modal-animation"),s.delay(function(){r.$html.removeClass("rl-modal-animation")},400))}},t.bindingHandlers.moment={init:function(e,o){i(26).momentToNode(n(e).addClass("moment").data("moment-time",t.unwrap(o())))},update:function(e,o){i(26).momentToNode(n(e).data("moment-time",t.unwrap(o())))}},t.bindingHandlers.i18nInit={init:function(e){i(6).i18nToNodes(e)}},t.bindingHandlers.translatorInit={init:function(e){i(6).i18nToNodes(e)}},t.bindingHandlers.i18nUpdate={update:function(e,o){t.unwrap(o()),i(6).i18nToNodes(e)}},t.bindingHandlers.link={update:function(e,i){n(e).attr("href",t.unwrap(i()))}},t.bindingHandlers.title={update:function(e,i){n(e).attr("title",t.unwrap(i()))}},t.bindingHandlers.textF={init:function(e,i){n(e).text(t.unwrap(i()))}},t.bindingHandlers.initDom={init:function(e,t){t()(e)}},t.bindingHandlers.initFixedTrigger={init:function(e,i){var s=t.unwrap(i()),r=null,a=n(e),l=null,c=s[1]||0;r=n(s[0]||null),r=r[0]?r:null,r&&n(o).resize(function(){l=r.offset(),l&&l.top&&a.css("top",l.top+c)})}},t.bindingHandlers.initResizeTrigger={init:function(e,i){var o=t.unwrap(i());n(e).css({height:o[1],"min-height":o[1]})},update:function(e,o){var s=i(1),r=i(8),a=t.unwrap(o()),l=s.pInt(a[1]),c=0,u=n(e).offset().top;u>0&&(u+=s.pInt(a[2]),c=r.$win.height()-u,c>l&&(l=c),n(e).css({height:l,"min-height":l}))}},t.bindingHandlers.appendDom={update:function(e,i){n(e).hide().empty().append(t.unwrap(i())).show()}},t.bindingHandlers.draggable={init:function(e,s,r){var a=i(8),l=i(1);if(!a.bMobileDevice){var c=100,u=3,d=r(),p=d&&d.droppableSelector?d.droppableSelector:"",h={distance:20,handle:".dragHandle",cursorAt:{top:22,left:3},refreshPositions:!0,scroll:!0};p&&(h.drag=function(e){n(p).each(function(){var t=null,i=null,s=n(this),r=s.offset(),a=r.top+s.height();o.clearInterval(s.data("timerScroll")),s.data("timerScroll",!1),e.pageX>=r.left&&e.pageX<=r.left+s.width()&&(e.pageY>=a-c&&e.pageY<=a&&(t=function(){s.scrollTop(s.scrollTop()+u),l.windowResize()},s.data("timerScroll",o.setInterval(t,10)),t()),e.pageY>=r.top&&e.pageY<=r.top+c&&(i=function(){s.scrollTop(s.scrollTop()-u),l.windowResize()},s.data("timerScroll",o.setInterval(i,10)),i()))})},h.stop=function(){n(p).each(function(){o.clearInterval(n(this).data("timerScroll")),n(this).data("timerScroll",!1)})}),h.helper=function(e){return s()(e&&e.target?t.dataFor(e.target):null)},n(e).draggable(h).on("mousedown.koDraggable",function(){l.removeInFocus()}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).off("mousedown.koDraggable").draggable("destroy")})}}},t.bindingHandlers.droppable={init:function(e,o,s){var r=i(8);if(!r.bMobileDevice){var a=o(),l=s(),c=l&&l.droppableOver?l.droppableOver:null,u=l&&l.droppableOut?l.droppableOut:null,d={tolerance:"pointer",hoverClass:"droppableHover"};a&&(d.drop=function(e,t){a(e,t)},c&&(d.over=function(e,t){c(e,t)}),u&&(d.out=function(e,t){u(e,t)}),n(e).droppable(d),t.utils.domNodeDisposal.addDisposeCallback(e,function(){n(e).droppable("destroy")}))}}},t.bindingHandlers.nano={init:function(e){var t=i(8);t.bDisableNanoScroll||n(e).addClass("nano").nanoScroller({iOSNativeScrolling:!1,preventPageScrolling:!0})}},t.bindingHandlers.saveTrigger={init:function(e){var t=n(e);t.data("save-trigger-type",t.is("input[type=text],input[type=email],input[type=password],select,textarea")?"input":"custom"),"custom"===t.data("save-trigger-type")?t.append('&nbsp;&nbsp;<i class="icon-spinner animated"></i><i class="icon-remove error"></i><i class="icon-ok success"></i>').addClass("settings-saved-trigger"):t.addClass("settings-saved-trigger-input")},update:function(e,i){var o=t.unwrap(i()),s=n(e);if("custom"===s.data("save-trigger-type"))switch(o.toString()){case"1":s.find(".animated,.error").hide().removeClass("visible").end().find(".success").show().addClass("visible");break;case"0":s.find(".animated,.success").hide().removeClass("visible").end().find(".error").show().addClass("visible");break;case"-2":s.find(".error,.success").hide().removeClass("visible").end().find(".animated").show().addClass("visible");break;default:s.find(".animated").hide().end().find(".error,.success").removeClass("visible")}else switch(o.toString()){case"1":s.addClass("success").removeClass("error");break;case"0":s.addClass("error").removeClass("success");break;case"-2":break;default:s.removeClass("error success")}}},t.bindingHandlers.emailsTags={init:function(e,t,o){var r=i(1),a=i(30),l=n(e),c=t(),u=o(),d=u.autoCompleteSource||null,p=function(e){c&&c.focused&&c.focused(!!e)};l.inputosaurus({parseOnBlur:!0,allowDragAndDrop:!0,focusCallback:p,inputDelimiters:[",",";","\n"],autoCompleteSource:d,parseHook:function(e){return s.map(e,function(e){var t=r.trim(e),i=null;return""!==t?(i=new a,i.mailsoParse(t),[i.toLine(!1),i]):[t,null]})},change:s.bind(function(e){l.data("EmailsTagsValue",e.target.value),c(e.target.value)},this)}),c&&c.focused&&c.focused.subscribe&&c.focused.subscribe(function(e){l.inputosaurus(e?"focus":"blur")})},update:function(e,i){var o=n(e),s=i(),r=t.unwrap(s);o.data("EmailsTagsValue")!==r&&(o.val(r),o.data("EmailsTagsValue",r),o.inputosaurus("refresh"))}},t.bindingHandlers.command={init:function(e,i,o,s){var r=n(e),a=i();if(!a||!a.enabled||!a.canExecute)throw new Error("You are not using command function");r.addClass("command"),t.bindingHandlers[r.is("form")?"submit":"click"].init.apply(s,arguments)},update:function(e,t){var i=!0,o=n(e),s=t();i=s.enabled(),o.toggleClass("command-not-enabled",!i),i&&(i=s.canExecute(),o.toggleClass("command-can-not-be-execute",!i)),o.toggleClass("command-disabled disable disabled",!i).toggleClass("no-disabled",!!i),(o.is("input")||o.is("button"))&&o.prop("disabled",!i)}},t.extenders.trimmer=function(e){var o=i(1),s=t.computed({read:e,write:function(t){e(o.trim(t.toString()))},owner:this});return s(e()),s},t.extenders.posInterer=function(e,o){var s=i(1),n=t.computed({read:e,write:function(t){var i=s.pInt(t.toString(),o);0>=i&&(i=o),i===e()&&""+i!=""+t&&e(i+1),e(i)}});return n(e()),n},t.extenders.limitedList=function(e,o){var s=i(1),n=t.computed({read:e,write:function(i){var n=t.unwrap(e),r=t.unwrap(o);s.isNonEmptyArray(r)?-1<s.inArray(i,r)?e(i):-1<s.inArray(n,r)?(e(n+" "),e(n)):(e(r[0]+" "),e(r[0])):e("")}}).extend({notify:"always"});return n(e()),n.valueHasMutated||(n.valueHasMutated=function(){e.valueHasMutated()}),n},t.extenders.reversible=function(e){var t=e();return e.commit=function(){t=e()},e.reverse=function(){e(t)},e.commitedValue=function(){return t},e},t.extenders.toggleSubscribe=function(e,t){return e.subscribe(t[1],t[0],"beforeChange"),e.subscribe(t[2],t[0]),e},t.extenders.toggleSubscribeProperty=function(e,t){var i=t[1];return i&&(e.subscribe(function(e){e&&e[i]&&e[i](!1)},t[0],"beforeChange"),e.subscribe(function(e){e&&e[i]&&e[i](!0)},t[0])),e},t.extenders.falseTimeout=function(e,t){return e.iFalseTimeoutTimeout=0,e.subscribe(function(s){s&&(o.clearTimeout(e.iFalseTimeoutTimeout),e.iFalseTimeoutTimeout=o.setTimeout(function(){e(!1),e.iFalseTimeoutTimeout=0},i(1).pInt(t)))}),e},t.extenders.specialThrottle=function(e,s){return e.iSpecialThrottleTimeoutValue=i(1).pInt(s),0<e.iSpecialThrottleTimeoutValue?(e.iSpecialThrottleTimeout=0,e.valueForRead=t.observable(!!e()).extend({throttle:10}),t.computed({read:e.valueForRead,write:function(t){t?e.valueForRead(t):e.valueForRead()?(o.clearTimeout(e.iSpecialThrottleTimeout),e.iSpecialThrottleTimeout=o.setTimeout(function(){e.valueForRead(!1),e.iSpecialThrottleTimeout=0},e.iSpecialThrottleTimeoutValue)):e.valueForRead(t)}})):e},t.observable.fn.validateNone=function(){return this.hasError=t.observable(!1),this},t.observable.fn.validateEmail=function(){var e=i(1);return this.hasError=t.observable(!1),this.subscribe(function(t){t=e.trim(t),this.hasError(""!==t&&!/^[^@\s]+@[^@\s]+$/.test(t))},this),this.valueHasMutated(),this},t.observable.fn.validateSimpleEmail=function(){var e=i(1);return this.hasError=t.observable(!1),this.subscribe(function(t){t=e.trim(t),this.hasError(""!==t&&!/^.+@.+$/.test(t))},this),this.valueHasMutated(),this},t.observable.fn.deleteAccessHelper=function(){return this.extend({falseTimeout:3e3}).extend({toggleSubscribe:[null,function(e){e&&e.deleteAccess&&e.deleteAccess(!1)},function(e){e&&e.deleteAccess&&e.deleteAccess(!0)}]}),this},t.observable.fn.validateFunc=function(e){var o=i(1);return this.hasFuncError=t.observable(!1),o.isFunc(e)&&(this.subscribe(function(t){this.hasFuncError(!e(t))},this),this.valueHasMutated()),this},e.exports=t}(ko)},function(e,t){e.exports=window._},function(e,t){"use strict";t.__esModule=!0;t.FileType={Unknown:"unknown",Text:"text",Html:"html",Code:"code",Eml:"eml",WordText:"word-text",Pdf:"pdf",Image:"image",Audio:"audio",Video:"video",Sheet:"sheet",Presentation:"presentation",Certificate:"certificate",CertificateBin:"certificate-bin",Archive:"archive"},t.StorageResultType={Success:"success",Abort:"abort",Error:"error",Unload:"unload"},t.Focused={None:"none",MessageList:"message-list",MessageView:"message-view",FolderList:"folder-list"},t.State={Empty:10,Login:20,Auth:30},t.StateType={Webmail:0,Admin:1},t.Capa={TwoFactor:"TWO_FACTOR",TwoFactorForce:"TWO_FACTOR_FORCE",OpenPGP:"OPEN_PGP",Prefetch:"PREFETCH",Gravatar:"GRAVATAR",Folders:"FOLDERS",Composer:"COMPOSER",Contacts:"CONTACTS",Reload:"RELOAD",Search:"SEARCH",SearchAdv:"SEARCH_ADV",MessageActions:"MESSAGE_ACTIONS",MessageListActions:"MESSAGELIST_ACTIONS",AttachmentsActions:"ATTACHMENTS_ACTIONS",DangerousActions:"DANGEROUS_ACTIONS",Settings:"SETTINGS",Help:"HELP",
Themes:"THEMES",UserBackground:"USER_BACKGROUND",Sieve:"SIEVE",Filters:"FILTERS",AttachmentThumbnails:"ATTACHMENT_THUMBNAILS",Templates:"TEMPLATES",AutoLogout:"AUTOLOGOUT",AdditionalAccounts:"ADDITIONAL_ACCOUNTS",Identities:"IDENTITIES"},t.KeyState={All:"all",None:"none",ContactList:"contact-list",MessageList:"message-list",FolderList:"folder-list",MessageView:"message-view",Compose:"compose",Settings:"settings",Menu:"menu",PopupComposeOpenPGP:"compose-open-pgp",PopupMessageOpenPGP:"message-open-pgp",PopupViewOpenPGP:"view-open-pgp",PopupKeyboardShortcutsHelp:"popup-keyboard-shortcuts-help",PopupAsk:"popup-ask"},t.FolderType={Inbox:10,SentItems:11,Draft:12,Trash:13,Spam:14,Archive:15,NotSpam:80,User:99},t.ServerFolderType={USER:0,INBOX:1,SENT:2,DRAFTS:3,JUNK:4,TRASH:5,IMPORTANT:10,FLAGGED:11,ALL:12},t.LoginSignMeTypeAsString={DefaultOff:"defaultoff",DefaultOn:"defaulton",Unused:"unused"},t.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unused:2},t.ComposeType={Empty:"empty",Reply:"reply",ReplyAll:"replyall",Forward:"forward",ForwardAsAttachment:"forward-as-attachment",Draft:"draft",EditAsNew:"editasnew"},t.UploadErrorCode={Normal:0,FileIsTooBig:1,FilePartiallyUploaded:2,FileNoUploaded:3,MissingTempFolder:4,FileOnSaveingError:5,FileType:98,Unknown:99},t.SetSystemFoldersNotification={None:0,Sent:1,Draft:2,Spam:3,Trash:4,Archive:5},t.ClientSideKeyName={FoldersLashHash:0,MessagesInboxLastHash:1,MailBoxListSize:2,ExpandedFolders:3,FolderListSize:4,MessageListSize:5,LastReplyAction:6,LastSignMe:7,ComposeLastIdentityID:8},t.EventKeyCode={Backspace:8,Tab:9,Enter:13,Esc:27,PageUp:33,PageDown:34,Left:37,Right:39,Up:38,Down:40,End:35,Home:36,Space:32,Insert:45,Delete:46,A:65,S:83},t.MessageSetAction={SetSeen:0,UnsetSeen:1,SetFlag:2,UnsetFlag:3},t.MessageSelectAction={All:0,None:1,Invert:2,Unseen:3,Seen:4,Flagged:5,Unflagged:6},t.DesktopNotification={Allowed:0,NotAllowed:1,Denied:2,NotSupported:9},t.MessagePriority={Low:5,Normal:3,High:1},t.EditorDefaultType={Html:"Html",Plain:"Plain",HtmlForced:"HtmlForced",PlainForced:"PlainForced"},t.ServerSecure={None:0,SSL:1,TLS:2},t.SearchDateType={All:-1,Days3:3,Days7:7,Month:30},t.SaveSettingsStep={Animate:-2,Idle:-1,TrueResult:1,FalseResult:0},t.Layout={NoPreview:0,SidePreview:1,BottomPreview:2,Mobile:3},t.FilterConditionField={From:"From",Recipient:"Recipient",Subject:"Subject",Header:"Header",Size:"Size"},t.FilterConditionType={Contains:"Contains",NotContains:"NotContains",EqualTo:"EqualTo",NotEqualTo:"NotEqualTo",Over:"Over",Under:"Under"},t.FiltersAction={None:"None",MoveTo:"MoveTo",Discard:"Discard",Vacation:"Vacation",Reject:"Reject",Forward:"Forward"},t.FilterRulesType={All:"All",Any:"Any"},t.SignedVerifyStatus={UnknownPublicKeys:-4,UnknownPrivateKey:-3,Unverified:-2,Error:-1,None:0,Success:1},t.ContactPropertyType={Unknown:0,FullName:10,FirstName:15,LastName:16,MiddleName:16,Nick:18,NamePrefix:20,NameSuffix:21,Email:30,Phone:31,Web:32,Birthday:40,Facebook:90,Skype:91,GitHub:92,Note:110,Custom:250},t.Notification={InvalidToken:101,AuthError:102,AccessError:103,ConnectionError:104,CaptchaError:105,SocialFacebookLoginAccessDisable:106,SocialTwitterLoginAccessDisable:107,SocialGoogleLoginAccessDisable:108,DomainNotAllowed:109,AccountNotAllowed:110,AccountTwoFactorAuthRequired:120,AccountTwoFactorAuthError:121,CouldNotSaveNewPassword:130,CurrentPasswordIncorrect:131,NewPasswordShort:132,NewPasswordWeak:133,NewPasswordForbidden:134,ContactsSyncError:140,CantGetMessageList:201,CantGetMessage:202,CantDeleteMessage:203,CantMoveMessage:204,CantCopyMessage:205,CantSaveMessage:301,CantSendMessage:302,InvalidRecipients:303,CantSaveFilters:351,CantGetFilters:352,FiltersAreNotCorrect:355,CantCreateFolder:400,CantRenameFolder:401,CantDeleteFolder:402,CantSubscribeFolder:403,CantUnsubscribeFolder:404,CantDeleteNonEmptyFolder:405,CantSaveSettings:501,CantSavePluginSettings:502,DomainAlreadyExists:601,CantInstallPackage:701,CantDeletePackage:702,InvalidPluginPackage:703,UnsupportedPluginPackage:704,LicensingServerIsUnavailable:710,LicensingExpired:711,LicensingBanned:712,DemoSendMessageError:750,DemoAccountError:751,AccountAlreadyExists:801,AccountDoesNotExist:802,MailServerError:901,ClientViewError:902,InvalidInputArgument:903,AjaxFalse:950,AjaxAbort:951,AjaxParse:952,AjaxTimeout:953,UnknownNotification:999,UnknownError:999}},function(e,t,i){!function(){"use strict";function t(){this.oScreens={},this.sDefaultScreenName="",this.oCurrentScreen=null}var o=i(3),s=i(14),n=i(2),r=i(81),a=i(49),l=i(8),c=i(23),u=i(1);t.prototype.oScreens={},t.prototype.sDefaultScreenName="",t.prototype.oCurrentScreen=null,t.prototype.hideLoading=function(){s("#rl-content").show(),s("#rl-loading").hide().remove()},t.prototype.constructorEnd=function(e){u.isFunc(e.__constructor_end)&&e.__constructor_end.call(e)},t.prototype.extendAsViewModel=function(e,t){t&&(u.isArray(e)?t.__names=e:t.__names=[e],t.__name=t.__names[0])},t.prototype.addSettingsViewModel=function(e,t,i,o,s){e.__rlSettingsData={Label:i,Template:t,Route:o,IsDefault:!!s},l.aViewModels.settings.push(e)},t.prototype.removeSettingsViewModel=function(e){l.aViewModels["settings-removed"].push(e)},t.prototype.disableSettingsViewModel=function(e){l.aViewModels["settings-disabled"].push(e)},t.prototype.routeOff=function(){r.changed.active=!1},t.prototype.routeOn=function(){r.changed.active=!0},t.prototype.screen=function(e){return""===e||u.isUnd(this.oScreens[e])?null:this.oScreens[e]},t.prototype.buildViewModel=function(e,t){if(e&&!e.__builded){var i=this,r=new e(t),a=r.viewModelPosition(),d=s("#rl-content #rl-"+a.toLowerCase()),p=null;e.__builded=!0,e.__vm=r,r.onShowTrigger=n.observable(!1),r.onHideTrigger=n.observable(!1),r.viewModelName=e.__name,r.viewModelNames=e.__names,d&&1===d.length?(p=s("<div></div>").addClass("rl-view-model").addClass("RL-"+r.viewModelTemplate()).hide(),p.appendTo(d),r.viewModelDom=p,e.__dom=p,"Popups"===a&&(r.cancelCommand=r.closeCommand=u.createCommand(r,function(){i.hideScreenPopup(e)}),r.modalVisibility.subscribe(function(e){var t=this;e?(this.viewModelDom.show(),this.storeAndSetKeyScope(),l.popupVisibilityNames.push(this.viewModelName),r.viewModelDom.css("z-index",3e3+l.popupVisibilityNames().length+10),this.onShowTrigger&&this.onShowTrigger(!this.onShowTrigger()),u.delegateRun(this,"onShowWithDelay",[],500)):(u.delegateRun(this,"onHide"),u.delegateRun(this,"onHideWithDelay",[],500),this.onHideTrigger&&this.onHideTrigger(!this.onHideTrigger()),this.restoreKeyScope(),o.each(this.viewModelNames,function(e){c.runHook("view-model-on-hide",[e,t])}),l.popupVisibilityNames.remove(this.viewModelName),r.viewModelDom.css("z-index",2e3),o.delay(function(){t.viewModelDom.hide()},300))},r)),o.each(e.__names,function(e){c.runHook("view-model-pre-build",[e,r,p])}),n.applyBindingAccessorsToNode(p[0],{translatorInit:!0,template:function(){return{name:r.viewModelTemplate()}}},r),u.delegateRun(r,"onBuild",[p]),r&&"Popups"===a&&r.registerPopupKeyDown(),o.each(e.__names,function(e){c.runHook("view-model-post-build",[e,r,p])})):u.log("Cannot find view model position: "+a)}return e?e.__vm:null},t.prototype.hideScreenPopup=function(e){e&&e.__vm&&e.__dom&&e.__vm.modalVisibility(!1)},t.prototype.showScreenPopup=function(e,t){e&&(this.buildViewModel(e),e.__vm&&e.__dom&&(u.delegateRun(e.__vm,"onBeforeShow",t||[]),e.__vm.modalVisibility(!0),u.delegateRun(e.__vm,"onShow",t||[]),o.each(e.__names,function(i){c.runHook("view-model-on-show",[i,e.__vm,t||[]])})))},t.prototype.isPopupVisible=function(e){return e&&e.__vm?e.__vm.modalVisibility():!1},t.prototype.screenOnRoute=function(e,t){var i=this,s=null,n=!1,r=null;""===u.pString(e)&&(e=this.sDefaultScreenName),""!==e&&(s=this.screen(e),s||(s=this.screen(this.sDefaultScreenName),s&&(t=e+"/"+t,e=this.sDefaultScreenName)),s&&s.__started&&(n=this.oCurrentScreen&&s===this.oCurrentScreen,s.__builded||(s.__builded=!0,u.isNonEmptyArray(s.viewModels())&&o.each(s.viewModels(),function(e){this.buildViewModel(e,s)},this),u.delegateRun(s,"onBuild")),o.defer(function(){i.oCurrentScreen&&!n&&(u.delegateRun(i.oCurrentScreen,"onHide"),u.delegateRun(i.oCurrentScreen,"onHideWithDelay",[],500),i.oCurrentScreen.onHideTrigger&&i.oCurrentScreen.onHideTrigger(!i.oCurrentScreen.onHideTrigger()),u.isNonEmptyArray(i.oCurrentScreen.viewModels())&&o.each(i.oCurrentScreen.viewModels(),function(e){e.__vm&&e.__dom&&"Popups"!==e.__vm.viewModelPosition()&&(e.__dom.hide(),e.__vm.viewModelVisibility(!1),u.delegateRun(e.__vm,"onHide"),u.delegateRun(e.__vm,"onHideWithDelay",[],500),e.__vm.onHideTrigger&&e.__vm.onHideTrigger(!e.__vm.onHideTrigger()))})),i.oCurrentScreen=s,i.oCurrentScreen&&!n&&(u.delegateRun(i.oCurrentScreen,"onShow"),i.oCurrentScreen.onShowTrigger&&i.oCurrentScreen.onShowTrigger(!i.oCurrentScreen.onShowTrigger()),c.runHook("screen-on-show",[i.oCurrentScreen.screenName(),i.oCurrentScreen]),u.isNonEmptyArray(i.oCurrentScreen.viewModels())&&o.each(i.oCurrentScreen.viewModels(),function(e){e.__vm&&e.__dom&&"Popups"!==e.__vm.viewModelPosition()&&(u.delegateRun(e.__vm,"onBeforeShow"),e.__dom.show(),e.__vm.viewModelVisibility(!0),u.delegateRun(e.__vm,"onShow"),e.__vm.onShowTrigger&&e.__vm.onShowTrigger(!e.__vm.onShowTrigger()),u.delegateRun(e.__vm,"onShowWithDelay",[],200),o.each(e.__names,function(t){c.runHook("view-model-on-show",[t,e.__vm])}))},i)),r=s.__cross?s.__cross():null,r&&r.parse(t)})))},t.prototype.startScreens=function(e){s("#rl-content").css({visibility:"hidden"}),o.each(e,function(e){if(e){var t=new e,i=t?t.screenName():"";t&&""!==i&&(""===this.sDefaultScreenName&&(this.sDefaultScreenName=i),this.oScreens[i]=t)}},this),o.each(this.oScreens,function(e){e&&!e.__started&&e.__start&&(e.__started=!0,e.__start(),c.runHook("screen-pre-start",[e.screenName(),e]),u.delegateRun(e,"onStart"),c.runHook("screen-post-start",[e.screenName(),e]))},this);var t=a.create();t.addRoute(/^([a-zA-Z0-9\-]*)\/?(.*)$/,o.bind(this.screenOnRoute,this)),r.initialized.add(t.parse,t),r.changed.add(t.parse,t),r.init(),s("#rl-content").css({visibility:"visible"}),o.delay(function(){l.$html.removeClass("rl-started-trigger").addClass("rl-started")},100),o.delay(function(){l.$html.addClass("rl-started-delay")},200)},t.prototype.setHash=function(e,t,i){e="#"===e.substr(0,1)?e.substr(1):e,e="/"===e.substr(0,1)?e.substr(1):e,i=u.isUnd(i)?!1:!!i,(u.isUnd(t)?1:!t)?(r.changed.active=!0,r[i?"replaceHash":"setHash"](e),r.setHash(e)):(r.changed.active=!1,r[i?"replaceHash":"setHash"](e),r.changed.active=!0)},e.exports=new t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(2),a=o(r),l=i(4),c=i(1),u=o(c),d=i(8),p=o(d),h=function(){function e(){s(this,e),this.data={},this.notificationI18N={},this.data=n.window.rainloopI18N||{},this.trigger=a["default"].observable(!1),this.i18n=n._.bind(this.i18n,this),this.init()}return e.prototype.i18n=function(e,t,i){var o="",s=this.data[e];if(n._.isUndefined(s)&&(s=n._.isUndefined(i)?e:i),!n._.isUndefined(t)&&!n._.isNull(t))for(o in t)n._.has(t,o)&&(s=s.replace("%"+o+"%",t[o]));return s},e.prototype.i18nToNode=function(e){var t=(0,n.$)(e),i=t.data("i18n");if(i)if("["===i.substr(0,1))switch(i.substr(0,6)){case"[html]":t.html(this.i18n(i.substr(6)));break;case"[place":t.attr("placeholder",this.i18n(i.substr(13)));break;case"[title":t.attr("title",this.i18n(i.substr(7)))}else t.text(this.i18n(i))},e.prototype.i18nToNodes=function(e){var t=this,i=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];n._.defer(function(){(0,n.$)("[data-i18n]",e).each(function(e,i){t.i18nToNode(i)}),i&&p["default"].bAnimationSupported&&(0,n.$)(".i18n-animation[data-i18n]",e).letterfx({fx:"fall fade",backwards:!1,timing:50,fx_duration:"50ms",letter_end:"restore",element_end:"restore"})})},e.prototype.reloadData=function(){n.window.rainloopI18N&&(this.data=n.window.rainloopI18N||{},this.i18nToNodes(n.window.document,!0),i(26).reload(),this.trigger(!this.trigger())),n.window.rainloopI18N=null},e.prototype.initNotificationLanguage=function(){var e=this,t=[[l.Notification.InvalidToken,"NOTIFICATIONS/INVALID_TOKEN"],[l.Notification.InvalidToken,"NOTIFICATIONS/INVALID_TOKEN"],[l.Notification.AuthError,"NOTIFICATIONS/AUTH_ERROR"],[l.Notification.AccessError,"NOTIFICATIONS/ACCESS_ERROR"],[l.Notification.ConnectionError,"NOTIFICATIONS/CONNECTION_ERROR"],[l.Notification.CaptchaError,"NOTIFICATIONS/CAPTCHA_ERROR"],[l.Notification.SocialFacebookLoginAccessDisable,"NOTIFICATIONS/SOCIAL_FACEBOOK_LOGIN_ACCESS_DISABLE"],[l.Notification.SocialTwitterLoginAccessDisable,"NOTIFICATIONS/SOCIAL_TWITTER_LOGIN_ACCESS_DISABLE"],[l.Notification.SocialGoogleLoginAccessDisable,"NOTIFICATIONS/SOCIAL_GOOGLE_LOGIN_ACCESS_DISABLE"],[l.Notification.DomainNotAllowed,"NOTIFICATIONS/DOMAIN_NOT_ALLOWED"],[l.Notification.AccountNotAllowed,"NOTIFICATIONS/ACCOUNT_NOT_ALLOWED"],[l.Notification.AccountTwoFactorAuthRequired,"NOTIFICATIONS/ACCOUNT_TWO_FACTOR_AUTH_REQUIRED"],[l.Notification.AccountTwoFactorAuthError,"NOTIFICATIONS/ACCOUNT_TWO_FACTOR_AUTH_ERROR"],[l.Notification.CouldNotSaveNewPassword,"NOTIFICATIONS/COULD_NOT_SAVE_NEW_PASSWORD"],[l.Notification.CurrentPasswordIncorrect,"NOTIFICATIONS/CURRENT_PASSWORD_INCORRECT"],[l.Notification.NewPasswordShort,"NOTIFICATIONS/NEW_PASSWORD_SHORT"],[l.Notification.NewPasswordWeak,"NOTIFICATIONS/NEW_PASSWORD_WEAK"],[l.Notification.NewPasswordForbidden,"NOTIFICATIONS/NEW_PASSWORD_FORBIDDENT"],[l.Notification.ContactsSyncError,"NOTIFICATIONS/CONTACTS_SYNC_ERROR"],[l.Notification.CantGetMessageList,"NOTIFICATIONS/CANT_GET_MESSAGE_LIST"],[l.Notification.CantGetMessage,"NOTIFICATIONS/CANT_GET_MESSAGE"],[l.Notification.CantDeleteMessage,"NOTIFICATIONS/CANT_DELETE_MESSAGE"],[l.Notification.CantMoveMessage,"NOTIFICATIONS/CANT_MOVE_MESSAGE"],[l.Notification.CantCopyMessage,"NOTIFICATIONS/CANT_MOVE_MESSAGE"],[l.Notification.CantSaveMessage,"NOTIFICATIONS/CANT_SAVE_MESSAGE"],[l.Notification.CantSendMessage,"NOTIFICATIONS/CANT_SEND_MESSAGE"],[l.Notification.InvalidRecipients,"NOTIFICATIONS/INVALID_RECIPIENTS"],[l.Notification.CantSaveFilters,"NOTIFICATIONS/CANT_SAVE_FILTERS"],[l.Notification.CantGetFilters,"NOTIFICATIONS/CANT_GET_FILTERS"],[l.Notification.FiltersAreNotCorrect,"NOTIFICATIONS/FILTERS_ARE_NOT_CORRECT"],[l.Notification.CantCreateFolder,"NOTIFICATIONS/CANT_CREATE_FOLDER"],[l.Notification.CantRenameFolder,"NOTIFICATIONS/CANT_RENAME_FOLDER"],[l.Notification.CantDeleteFolder,"NOTIFICATIONS/CANT_DELETE_FOLDER"],[l.Notification.CantDeleteNonEmptyFolder,"NOTIFICATIONS/CANT_DELETE_NON_EMPTY_FOLDER"],[l.Notification.CantSubscribeFolder,"NOTIFICATIONS/CANT_SUBSCRIBE_FOLDER"],[l.Notification.CantUnsubscribeFolder,"NOTIFICATIONS/CANT_UNSUBSCRIBE_FOLDER"],[l.Notification.CantSaveSettings,"NOTIFICATIONS/CANT_SAVE_SETTINGS"],[l.Notification.CantSavePluginSettings,"NOTIFICATIONS/CANT_SAVE_PLUGIN_SETTINGS"],[l.Notification.DomainAlreadyExists,"NOTIFICATIONS/DOMAIN_ALREADY_EXISTS"],[l.Notification.CantInstallPackage,"NOTIFICATIONS/CANT_INSTALL_PACKAGE"],[l.Notification.CantDeletePackage,"NOTIFICATIONS/CANT_DELETE_PACKAGE"],[l.Notification.InvalidPluginPackage,"NOTIFICATIONS/INVALID_PLUGIN_PACKAGE"],[l.Notification.UnsupportedPluginPackage,"NOTIFICATIONS/UNSUPPORTED_PLUGIN_PACKAGE"],[l.Notification.LicensingServerIsUnavailable,"NOTIFICATIONS/LICENSING_SERVER_IS_UNAVAILABLE"],[l.Notification.LicensingExpired,"NOTIFICATIONS/LICENSING_EXPIRED"],[l.Notification.LicensingBanned,"NOTIFICATIONS/LICENSING_BANNED"],[l.Notification.DemoSendMessageError,"NOTIFICATIONS/DEMO_SEND_MESSAGE_ERROR"],[l.Notification.DemoAccountError,"NOTIFICATIONS/DEMO_ACCOUNT_ERROR"],[l.Notification.AccountAlreadyExists,"NOTIFICATIONS/ACCOUNT_ALREADY_EXISTS"],[l.Notification.AccountDoesNotExist,"NOTIFICATIONS/ACCOUNT_DOES_NOT_EXIST"],[l.Notification.MailServerError,"NOTIFICATIONS/MAIL_SERVER_ERROR"],[l.Notification.InvalidInputArgument,"NOTIFICATIONS/INVALID_INPUT_ARGUMENT"],[l.Notification.UnknownNotification,"NOTIFICATIONS/UNKNOWN_ERROR"],[l.Notification.UnknownError,"NOTIFICATIONS/UNKNOWN_ERROR"]];this.notificationI18N=this.notificationI18N||{},t.forEach(function(t){e.notificationI18N[t[0]]=e.i18n(t[1])})},e.prototype.initOnStartOrLangChange=function(e,t){var i=arguments.length<=2||void 0===arguments[2]?null:arguments[2];e&&e.call(t),i?this.trigger.subscribe(function(){e&&e.call(t),i.call(t)}):e&&this.trigger.subscribe(e,t)},e.prototype.getNotification=function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return e=n.window.parseInt(e,10)||0,l.Notification.ClientViewError===e&&t?t:(i=i?n.window.parseInt(i,10)||0:0,n._.isUndefined(this.notificationI18N[e])?i&&n._.isUndefined(this.notificationI18N[i])?this.notificationI18N[i]:"":this.notificationI18N[e])},e.prototype.getNotificationFromResponse=function(e){var t=arguments.length<=1||void 0===arguments[1]?l.Notification.UnknownNotification:arguments[1];return e&&e.ErrorCode?this.getNotification(u["default"].pInt(e.ErrorCode),e.ErrorMessage||""):this.getNotification(t)},e.prototype.getUploadErrorDescByCode=function(e){var t="";switch(n.window.parseInt(e,10)||0){case l.UploadErrorCode.FileIsTooBig:t=this.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG");break;case l.UploadErrorCode.FilePartiallyUploaded:t=this.i18n("UPLOAD/ERROR_FILE_PARTIALLY_UPLOADED");break;case l.UploadErrorCode.FileNoUploaded:t=this.i18n("UPLOAD/ERROR_NO_FILE_UPLOADED");break;case l.UploadErrorCode.MissingTempFolder:t=this.i18n("UPLOAD/ERROR_MISSING_TEMP_FOLDER");break;case l.UploadErrorCode.FileOnSaveingError:t=this.i18n("UPLOAD/ERROR_ON_SAVING_FILE");break;case l.UploadErrorCode.FileType:t=this.i18n("UPLOAD/ERROR_FILE_TYPE");break;default:t=this.i18n("UPLOAD/ERROR_UNKNOWN")}return t},e.prototype.reload=function(e,t,o,s){var r=this,a=u["default"].microtime();p["default"].$html.addClass("rl-changing-language"),n.$.ajax({url:i(12).langLink(t,e),dataType:"script",cache:!0}).fail(s||u["default"].emptyFunction).done(function(){n._.delay(function(){r.reloadData(),(o||u["default"].emptyFunction)();var e=-1<u["default"].inArray(t,["ar","ar_sa","he","he_he","ur","ur_ir"]);p["default"].$html.removeClass("rl-changing-language").removeClass("rl-rtl rl-ltr").addClass(e?"rl-rtl":"rl-ltr")},500<u["default"].microtime()-a?1:500)})},e.prototype.init=function(){p["default"].$html.addClass("rl-"+(p["default"].$html.attr("dir")||"ltr"))},e}();e.exports=new h},function(e,t,i){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function s(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=i(13),c=i(83),u=s(c),d=i(171),p=s(d),h=i(4),f=o(h),m=i(17),g=o(m),b=i(8),y=s(b),S=i(23),v=s(S),w=i(1),C=s(w),T=i(12),A=s(T),E=i(25),F=s(E),N=i(6),_=s(N),R=i(26),P=s(R),L=i(19),I=s(L),M=i(34),k=s(M),O=i(28),D=s(O),x=i(31),U=s(x),H=i(53),V=s(H),B=i(92),G=s(B),K=i(21),j=s(K),q=i(33),z=s(q),W=i(32),$=s(W),J=i(51),Y=s(J),X=i(47),Q=s(X),Z=i(9),ee=s(Z),te=i(15),ie=s(te),oe=i(41),se=s(oe),ne=i(30),re=s(ne),ae=i(101),le=s(ae),ce=i(107),ue=s(ce),de=i(110),pe=s(de),he=i(109),fe=s(he),me=i(5),ge=s(me),be=i(64),ye=function(e){function t(){n(this,t);var i=r(this,e.call(this,ie["default"]));return i.oMoveCache={},i.quotaDebounce=l._.debounce(i.quota,3e4),i.moveOrDeleteResponseHelper=l._.bind(i.moveOrDeleteResponseHelper,i),i.messagesMoveTrigger=l._.debounce(i.messagesMoveTrigger,500),l.window.setInterval(function(){return F["default"].pub("interval.30s")},3e4),l.window.setInterval(function(){return F["default"].pub("interval.1m")},6e4),l.window.setInterval(function(){return F["default"].pub("interval.2m")},12e4),l.window.setInterval(function(){return F["default"].pub("interval.3m")},18e4),l.window.setInterval(function(){return F["default"].pub("interval.5m")},3e5),l.window.setInterval(function(){return F["default"].pub("interval.10m")},6e5),l.window.setInterval(function(){return F["default"].pub("interval.15m")},9e5),l.window.setInterval(function(){return F["default"].pub("interval.20m")},9e5),l.window.setTimeout(function(){return l.window.setInterval(function(){return F["default"].pub("interval.2m-after5m")},12e4)},3e5),l.window.setTimeout(function(){return l.window.setInterval(function(){return F["default"].pub("interval.5m-after5m")},3e5)},3e5),l.window.setTimeout(function(){return l.window.setInterval(function(){return F["default"].pub("interval.10m-after5m")},6e5)},3e5),l.$.wakeUp(function(){ie["default"].jsVersion(function(e,t){f.StorageResultType.Success===e&&t&&!t.Result&&(l.window.parent&&ee["default"].appSettingsGet("inIframe")?l.window.parent.location.reload():l.window.location.reload())},ee["default"].appSettingsGet("version"))},{},36e5),ee["default"].settingsGet("UserBackgroundHash")&&l._.delay(function(){(0,l.$)("#rl-bg").attr("style","background-image: none !important;").backstretch(A["default"].userBackground(ee["default"].settingsGet("UserBackgroundHash")),{fade:y["default"].bAnimationSupported?1e3:0,centeredX:!0,centeredY:!0}).removeAttr("style")},1e3),i.socialUsers=l._.bind(i.socialUsers,i),i}return a(t,e),t.prototype.remote=function(){return ie["default"]},t.prototype.reloadFlagsCurrentMessageListAndMessageFromCache=function(){l._.each($["default"].messageList(),function(e){I["default"].initMessageFlagsFromCache(e)}),I["default"].initMessageFlagsFromCache($["default"].message())},t.prototype.reloadMessageList=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=($["default"].messageListPage()-1)*D["default"].messagesPerPage();t&&I["default"].setFolderHash(j["default"].currentFolderFullNameRaw(),""),e&&($["default"].messageListPage(1),$["default"].messageListPageBeforeThread(1),i=0,ge["default"].setHash(A["default"].mailBox(j["default"].currentFolderFullNameHash(),$["default"].messageListPage(),$["default"].messageListSearch(),$["default"].messageListThreadUid()),!0,!0)),$["default"].messageListLoading(!0),ie["default"].messageList(function(e,t,i){f.StorageResultType.Success===e&&t&&t.Result?($["default"].messageListError(""),$["default"].messageListLoading(!1),$["default"].setMessageList(t,i)):f.StorageResultType.Unload===e?($["default"].messageListError(""),$["default"].messageListLoading(!1)):f.StorageResultType.Abort!==e&&($["default"].messageList([]),$["default"].messageListLoading(!1),$["default"].messageListError(t&&t.ErrorCode?_["default"].getNotification(t.ErrorCode):_["default"].i18n("NOTIFICATIONS/CANT_GET_MESSAGE_LIST")))},j["default"].currentFolderFullNameRaw(),i,D["default"].messagesPerPage(),$["default"].messageListSearch(),$["default"].messageListThreadUid())},t.prototype.recacheInboxMessageList=function(){ie["default"].messageList(C["default"].emptyFunction,I["default"].getFolderInboxName(),0,D["default"].messagesPerPage(),"","",!0)},t.prototype.contactsSync=function(e){var t=Y["default"].contacts;return t.importing()||t.syncing()||!Y["default"].enableContactsSync()||!Y["default"].allowContactsSync()?!1:(t.syncing(!0),ie["default"].contactsSync(function(i,o){t.syncing(!1),e&&e(i,o)}),!0)},t.prototype.messagesMoveTrigger=function(){var e=this,t=j["default"].trashFolder(),i=j["default"].spamFolder();l._.each(this.oMoveCache,function(o){var s=i===o.To,n=t===o.To,r=!s&&i===o.From&&I["default"].getFolderInboxName()===o.To;ie["default"].messagesMove(e.moveOrDeleteResponseHelper,o.From,o.To,o.Uid,s?"SPAM":r?"HAM":"",s||n)}),this.oMoveCache={}},t.prototype.messagesMoveHelper=function(e,t,i){var o="$$"+e+"$$"+t+"$$";this.oMoveCache[o]||(this.oMoveCache[o]={From:e,To:t,Uid:[]}),this.oMoveCache[o].Uid=l._.union(this.oMoveCache[o].Uid,i),this.messagesMoveTrigger()},t.prototype.messagesCopyHelper=function(e,t,i){ie["default"].messagesCopy(this.moveOrDeleteResponseHelper,e,t,i)},t.prototype.messagesDeleteHelper=function(e,t){ie["default"].messagesDelete(this.moveOrDeleteResponseHelper,e,t)},t.prototype.moveOrDeleteResponseHelper=function(e,t){f.StorageResultType.Success===e&&j["default"].currentFolder()&&(t&&C["default"].isArray(t.Result)&&2===t.Result.length?I["default"].setFolderHash(t.Result[0],t.Result[1]):(I["default"].setFolderHash(j["default"].currentFolderFullNameRaw(),""),t&&-1<C["default"].inArray(t.ErrorCode,[f.Notification.CantMoveMessage,f.Notification.CantCopyMessage])&&l.window.alert(_["default"].getNotification(t.ErrorCode))),this.reloadMessageList(0===$["default"].messageList().length),this.quotaDebounce())},t.prototype.deleteMessagesFromFolderWithoutCheck=function(e,t){this.messagesDeleteHelper(e,t),$["default"].removeMessagesFromList(e,t)},t.prototype.deleteMessagesFromFolder=function(e,t,o,s){var n=this,r=null,a=null;switch(e){case f.FolderType.Spam:r=I["default"].getFolderFromCacheList(j["default"].spamFolder()),a=f.SetSystemFoldersNotification.Spam;break;case f.FolderType.NotSpam:r=I["default"].getFolderFromCacheList(I["default"].getFolderInboxName());break;case f.FolderType.Trash:r=I["default"].getFolderFromCacheList(j["default"].trashFolder()),a=f.SetSystemFoldersNotification.Trash;break;case f.FolderType.Archive:r=I["default"].getFolderFromCacheList(j["default"].archiveFolder()),a=f.SetSystemFoldersNotification.Archive}s=C["default"].isUnd(s)?!0:!!s,s&&(f.FolderType.Spam===e&&g.UNUSED_OPTION_VALUE===j["default"].spamFolder()||f.FolderType.Trash===e&&g.UNUSED_OPTION_VALUE===j["default"].trashFolder()||f.FolderType.Archive===e&&g.UNUSED_OPTION_VALUE===j["default"].archiveFolder())&&(s=!1),!r&&s?ge["default"].showScreenPopup(i(52),[a]):s&&(f.FolderType.Trash!==e||t!==j["default"].spamFolder()&&t!==j["default"].trashFolder())?r&&(this.messagesMoveHelper(t,r.fullNameRaw,o),$["default"].removeMessagesFromList(t,o,r.fullNameRaw)):ge["default"].showScreenPopup(i(43),[_["default"].i18n("POPUPS_ASK/DESC_WANT_DELETE_MESSAGES"),function(){n.messagesDeleteHelper(t,o),$["default"].removeMessagesFromList(t,o)}])},t.prototype.moveMessagesToFolder=function(e,t,i,o){if(e!==i&&C["default"].isArray(t)&&0<t.length){var s=I["default"].getFolderFromCacheList(e),n=I["default"].getFolderFromCacheList(i);if(s&&n)return(C["default"].isUnd(o)?1:!o)?this.messagesMoveHelper(s.fullNameRaw,n.fullNameRaw,t):this.messagesCopyHelper(s.fullNameRaw,n.fullNameRaw,t),$["default"].removeMessagesFromList(s.fullNameRaw,t,n.fullNameRaw,o),!0}return!1},t.prototype.foldersReload=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];se["default"].foldersReload(j["default"].foldersLoading).then(function(t){e&&e(!!t)}).fail(function(){e&&l._.delay(function(){return e(!1)},1)})},t.prototype.foldersPromisesActionHelper=function(e,t){se["default"].abort("Folders").fastResolve(!0).then(function(){return e}).fail(function(e){j["default"].folderList.error(_["default"].getNotification(e,"",t))}).fin(function(){se["default"].foldersReloadWithTimeout(j["default"].foldersLoading)}).done()},t.prototype.reloadOpenPgpKeys=function(){if(z["default"].capaOpenPGP()){var e=[],t=new re["default"],i=z["default"].openpgpKeyring,o=i?i.getAllKeys():[];l._.each(o,function(i,o){if(i&&i.primaryKey){var s=[],n=[],r=i.getPrimaryUser(),a=r&&r.user?r.user.userId.userid:i.users&&i.users[0]?i.users[0].userId.userid:"";i.users&&l._.each(i.users,function(e){t.clear(),t.mailsoParse(e.userId.userid),t.validate()&&(s.push(t.email),n.push(e.userId.userid))}),s.length&&e.push(new fe["default"](o,i.primaryKey.getFingerprint(),i.primaryKey.getKeyId().toHex().toLowerCase(),l._.uniq(l._.compact(l._.map(i.getKeyIds(),function(e){return e&&e.toHex?e.toHex():null}))),n,s,i.isPrivate(),i.armor(),a))}}),C["default"].delegateRunOnDestroy(z["default"].openpgpkeys()),z["default"].openpgpkeys(e)}},t.prototype.accountsCounts=function(){return!1},t.prototype.accountsAndIdentities=function(e){var t=this;U["default"].accounts.loading(!0),V["default"].identities.loading(!0),ie["default"].accountsAndIdentities(function(i,o){if(U["default"].accounts.loading(!1),V["default"].identities.loading(!1),f.StorageResultType.Success===i&&o.Result){var s={},n=ee["default"].settingsGet("ParentEmail"),r=U["default"].email();n=""===n?r:n,C["default"].isArray(o.Result.Accounts)&&(l._.each(U["default"].accounts(),function(e){s[e.email]=e.count()}),C["default"].delegateRunOnDestroy(U["default"].accounts()),U["default"].accounts(l._.map(o.Result.Accounts,function(e){return new le["default"](e,e!==n,s[e]||0)}))),(C["default"].isUnd(e)?1:!e)||(l._.delay(function(){return t.accountsCounts()},5e3),F["default"].sub("interval.10m-after5m",function(){return t.accountsCounts()})),C["default"].isArray(o.Result.Identities)&&(C["default"].delegateRunOnDestroy(V["default"].identities()),V["default"].identities(l._.map(o.Result.Identities,function(e){var t=C["default"].pString(e.Id),i=C["default"].pString(e.Email),o=new ue["default"](t,i);return o.name(C["default"].pString(e.Name)),o.replyTo(C["default"].pString(e.ReplyTo)),o.bcc(C["default"].pString(e.Bcc)),o.signature(C["default"].pString(e.Signature)),o.signatureInsertBefore(!!e.SignatureInsertBefore),o})))}})},t.prototype.templates=function(){G["default"].templates.loading(!0),ie["default"].templates(function(e,t){G["default"].templates.loading(!1),f.StorageResultType.Success===e&&t.Result&&C["default"].isArray(t.Result.Templates)&&(C["default"].delegateRunOnDestroy(G["default"].templates()),G["default"].templates(l._.compact(l._.map(t.Result.Templates,function(e){var t=new pe["default"];return t.parse(e)?t:null}))))})},t.prototype.quota=function(){ie["default"].quota(function(e,t){f.StorageResultType.Success===e&&t&&t.Result&&C["default"].isArray(t.Result)&&1<t.Result.length&&C["default"].isPosNumeric(t.Result[0],!0)&&C["default"].isPosNumeric(t.Result[1],!0)&&i(91).populateData(C["default"].pInt(t.Result[1]),C["default"].pInt(t.Result[0]))})},t.prototype.folderInformation=function(e,t){var i=this;""!==C["default"].trim(e)&&ie["default"].folderInformation(function(e,t){if(f.StorageResultType.Success===e&&t&&t.Result&&t.Result.Hash&&t.Result.Folder){var o="",s=!1,n=!1,r=I["default"].getFolderFromCacheList(t.Result.Folder);if(r){if(r.interval=P["default"].momentNowUnix(),t.Result.Hash&&I["default"].setFolderHash(t.Result.Folder,t.Result.Hash),C["default"].isNormal(t.Result.MessageCount)&&r.messageCountAll(t.Result.MessageCount),C["default"].isNormal(t.Result.MessageUnseenCount)&&(C["default"].pInt(r.messageCountUnread())!==C["default"].pInt(t.Result.MessageUnseenCount)&&(n=!0),r.messageCountUnread(t.Result.MessageUnseenCount)),n&&I["default"].clearMessageFlagsFromCacheByFolder(r.fullNameRaw),t.Result.Flags){for(o in t.Result.Flags)if(t.Result.Flags.hasOwnProperty(o)){s=!0;var a=t.Result.Flags[o];I["default"].storeMessageFlagsToCacheByFolderAndUid(r.fullNameRaw,o.toString(),[!a.IsSeen,!!a.IsFlagged,!!a.IsAnswered,!!a.IsForwarded,!!a.IsReadReceipt])}s&&i.reloadFlagsCurrentMessageListAndMessageFromCache()}$["default"].initUidNextAndNewMessages(r.fullNameRaw,t.Result.UidNext,t.Result.NewMessages);var l=I["default"].getFolderHash(t.Result.Folder);(t.Result.Hash!==l||""===l||n)&&(r.fullNameRaw===j["default"].currentFolderFullNameRaw()?i.reloadMessageList():I["default"].getFolderInboxName()===r.fullNameRaw&&i.recacheInboxMessageList())}}},e,t)},t.prototype.folderInformationMultiply=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],i=j["default"].getNextFolderNames();C["default"].isNonEmptyArray(i)&&ie["default"].folderInformationMultiply(function(i,o){
f.StorageResultType.Success===i&&o&&o.Result&&o.Result.List&&C["default"].isNonEmptyArray(o.Result.List)&&!function(){var i=P["default"].momentNowUnix();l._.each(o.Result.List,function(t){var o=I["default"].getFolderHash(t.Folder),s=I["default"].getFolderFromCacheList(t.Folder),n=!1;if(s)if(s.interval=i,t.Hash&&I["default"].setFolderHash(t.Folder,t.Hash),C["default"].isNormal(t.MessageCount)&&s.messageCountAll(t.MessageCount),C["default"].isNormal(t.MessageUnseenCount)&&(C["default"].pInt(s.messageCountUnread())!==C["default"].pInt(t.MessageUnseenCount)&&(n=!0),s.messageCountUnread(t.MessageUnseenCount)),n&&I["default"].clearMessageFlagsFromCacheByFolder(s.fullNameRaw),t.Hash!==o||""===o)s.fullNameRaw===j["default"].currentFolderFullNameRaw()&&e.reloadMessageList();else if(n&&s.fullNameRaw===j["default"].currentFolderFullNameRaw()){var r=$["default"].messageList();C["default"].isNonEmptyArray(r)&&e.folderInformation(s.fullNameRaw,r)}}),t&&l._.delay(function(){return e.folderInformationMultiply(!0)},2e3)}()},i)},t.prototype.messageListAction=function(e,t,i,o){var s=null,n=[],r=0;if(C["default"].isUnd(o)&&(o=$["default"].messageListChecked()),n=l._.uniq(l._.compact(l._.map(o,function(e){return e&&e.uid?e.uid:null}))),""!==e&&0<n.length){switch(i){case f.MessageSetAction.SetSeen:l._.each(n,function(t){r+=I["default"].storeMessageFlagsToCacheBySetAction(e,t,i)}),s=I["default"].getFolderFromCacheList(e),s&&s.messageCountUnread(s.messageCountUnread()-r),ie["default"].messageSetSeen(C["default"].emptyFunction,e,n,!0);break;case f.MessageSetAction.UnsetSeen:l._.each(n,function(t){r+=I["default"].storeMessageFlagsToCacheBySetAction(e,t,i)}),s=I["default"].getFolderFromCacheList(e),s&&s.messageCountUnread(s.messageCountUnread()-r+n.length),ie["default"].messageSetSeen(C["default"].emptyFunction,e,n,!1);break;case f.MessageSetAction.SetFlag:l._.each(n,function(t){I["default"].storeMessageFlagsToCacheBySetAction(e,t,i)}),ie["default"].messageSetFlagged(C["default"].emptyFunction,e,n,!0);break;case f.MessageSetAction.UnsetFlag:l._.each(n,function(t){I["default"].storeMessageFlagsToCacheBySetAction(e,t,i)}),ie["default"].messageSetFlagged(C["default"].emptyFunction,e,n,!1)}this.reloadFlagsCurrentMessageListAndMessageFromCache(),$["default"].message.viewTrigger(!$["default"].message.viewTrigger())}},t.prototype.googleConnect=function(){l.window.open(A["default"].socialGoogle(),"Google","left=200,top=100,width=650,height=600,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.twitterConnect=function(){l.window.open(A["default"].socialTwitter(),"Twitter","left=200,top=100,width=650,height=350,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.facebookConnect=function(){l.window.open(A["default"].socialFacebook(),"Facebook","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.socialUsers=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];!0===e&&(k["default"].google.loading(!0),k["default"].facebook.loading(!0),k["default"].twitter.loading(!0)),ie["default"].socialUsers(function(e,t){f.StorageResultType.Success===e&&t&&t.Result?(k["default"].google.userName(t.Result.Google||""),k["default"].facebook.userName(t.Result.Facebook||""),k["default"].twitter.userName(t.Result.Twitter||"")):(k["default"].google.userName(""),k["default"].facebook.userName(""),k["default"].twitter.userName("")),k["default"].google.loading(!1),k["default"].facebook.loading(!1),k["default"].twitter.loading(!1)})},t.prototype.googleDisconnect=function(){k["default"].google.loading(!0),ie["default"].googleDisconnect(this.socialUsers)},t.prototype.facebookDisconnect=function(){k["default"].facebook.loading(!0),ie["default"].facebookDisconnect(this.socialUsers)},t.prototype.twitterDisconnect=function(){k["default"].twitter.loading(!0),ie["default"].twitterDisconnect(this.socialUsers)},t.prototype.getAutocomplete=function(e,t){ie["default"].suggestions(function(e,i){f.StorageResultType.Success===e&&i&&C["default"].isArray(i.Result)?t(l._.compact(l._.map(i.Result,function(e){return e&&e[0]?new re["default"](e[0],e[1]):null}))):f.StorageResultType.Abort!==e&&t([])},e)},t.prototype.setExpandedFolder=function(e,t){var i=Q["default"].get(f.ClientSideKeyName.ExpandedFolders);C["default"].isArray(i)||(i=[]),t?(i.push(e),i=l._.uniq(i)):i=l._.without(i,e),Q["default"].set(f.ClientSideKeyName.ExpandedFolders,i)},t.prototype.initHorizontalLayoutResizer=function(e){var t=200,i=500,o=null,s=null,n=function(e){e&&(o&&o.attr("style","height:"+e+"px"),s&&s.attr("style","top:"+(55+e)+"px"))},r=function(e){if(e&&e.target){var t=(0,l.$)(e.target).find(".ui-resizable-handle");t.on("mousedown",function(){y["default"].$html.addClass("rl-resizer")}).on("mouseup",function(){y["default"].$html.removeClass("rl-resizer")})}},a=function(){y["default"].$html.addClass("rl-resizer")},c=l._.debounce(function(){y["default"].$html.addClass("rl-resizer")},500,!0),u=function(t,i){y["default"].$html.removeClass("rl-resizer"),i&&i.size&&i.size.height&&(Q["default"].set(e,i.size.height),n(i.size.height),C["default"].windowResize())},d={helper:"ui-resizable-helper-h",minHeight:t,maxHeight:i,handles:"s",create:r,resize:c,start:a,stop:u},p=function(i){if(i)o&&o.hasClass("ui-resizable")&&o.resizable("destroy").removeAttr("style"),s&&s.removeAttr("style");else if(y["default"].$html.hasClass("rl-bottom-preview-pane")){o=(0,l.$)(".b-message-list-wrapper"),s=(0,l.$)(".b-message-view-wrapper"),o.hasClass("ui-resizable")||o.resizable(d);var r=C["default"].pInt(Q["default"].get(e))||300;n(r>t?r:t)}};p(!1),F["default"].sub("layout",function(e){p(f.Layout.BottomPreview!==e)})},t.prototype.initVerticalLayoutResizer=function(e){var t=60,i=155,o=(0,l.$)("#rl-left"),s=(0,l.$)("#rl-right"),n=Q["default"].get(e)||null,r=function(e){e&&(y["default"].leftPanelWidth(e),y["default"].$html.removeClass("rl-resizer"),o.css({width:""+e+"px"}),s.css({left:""+e+"px"}))},a=function(s){if(s)o.resizable("disable"),r(t);else{o.resizable("enable");var n=C["default"].pInt(Q["default"].get(e))||i;r(n>i?n:i)}},c=function(e){e&&e.target&&(0,l.$)(e.target).find(".ui-resizable-handle").on("mousedown",function(){y["default"].$html.addClass("rl-resizer")}).on("mouseup",function(){y["default"].$html.removeClass("rl-resizer")})},u=l._.debounce(function(){y["default"].$html.addClass("rl-resizer")},500,!0),d=function(){y["default"].$html.addClass("rl-resizer")},p=function(t,i){y["default"].$html.removeClass("rl-resizer"),i&&i.size&&i.size.width&&(Q["default"].set(e,i.size.width),y["default"].leftPanelWidth(i.size.width),s.css({left:""+i.size.width+"px"}),o.css({position:"",top:"",left:"",height:""}))};null!==n&&r(n>i?n:i),o.resizable({helper:"ui-resizable-helper-w",minWidth:i,maxWidth:350,handles:"e",create:c,resize:u,start:d,stop:p}),F["default"].sub("left-panel.off",function(){a(!0)}),F["default"].sub("left-panel.on",function(){a(!1)})},t.prototype.logout=function(){var e=this;ie["default"].logout(function(){e.loginAndLogoutReload(!1,!0,ee["default"].settingsGet("ParentEmail")&&0<ee["default"].settingsGet("ParentEmail").length)})},t.prototype.bootstartTwoFactorScreen=function(){ge["default"].showScreenPopup(i(98),[!0])},t.prototype.bootstartWelcomePopup=function(e){ge["default"].showScreenPopup(i(152),[e])},t.prototype.bootstartLoginScreen=function(){y["default"].$html.removeClass("rl-user-auth").addClass("rl-user-no-auth");var e=C["default"].pString(ee["default"].appSettingsGet("customLoginLink"));e?(ge["default"].routeOff(),ge["default"].setHash(A["default"].root(),!0),ge["default"].routeOff(),l._.defer(function(){l.window.location.href=e})):(ge["default"].startScreens([i(115)]),v["default"].runHook("rl-start-login-screens"),F["default"].pub("rl.bootstart-login-screens"))},t.prototype.bootend=function(){u["default"]?(ge["default"].hideLoading(),u["default"].onbeforeend(function(){(0,l.$)(".progressjs-container").hide(),l._.delay(function(){(0,l.$)(".progressjs-container").remove()},100)}),u["default"].set(100).end()):ge["default"].hideLoading()},t.prototype.bootstart=function(){var t=this;e.prototype.bootstart.call(this),i(24).populate(),i(28).populate(),i(60).populate(),i(31).populate(),i(51).populate();var o=i(170),s=ee["default"].appSettingsGet("jsHash"),n=C["default"].pString(ee["default"].settingsGet("StartupUrl")),r=C["default"].pInt(ee["default"].settingsGet("ContactsSyncInterval")),a=ee["default"].settingsGet("AllowGoogleSocial"),c=ee["default"].settingsGet("AllowFacebookSocial"),d=ee["default"].settingsGet("AllowTwitterSocial");u["default"]&&u["default"].set(90),y["default"].leftPanelDisabled.subscribe(function(e){F["default"].pub("left-panel."+(e?"off":"on"))}),this.setWindowTitle(""),ee["default"].settingsGet("Auth")?(y["default"].$html.addClass("rl-user-auth"),ee["default"].capa(f.Capa.TwoFactor)&&ee["default"].capa(f.Capa.TwoFactorForce)&&ee["default"].settingsGet("RequireTwoFactor")?(this.bootend(),this.bootstartTwoFactorScreen()):(this.setWindowTitle(_["default"].i18n("TITLES/LOADING")),this.foldersReload(function(e){t.bootend(),e?(""!==n&&(ge["default"].routeOff(),ge["default"].setHash(A["default"].root(n),!0),ge["default"].routeOn()),o&&l.window.crypto&&l.window.crypto.getRandomValues&&ee["default"].capa(f.Capa.OpenPGP)?!function(){var e=function(e){if(z["default"].openpgp=e,l.window.Worker)try{z["default"].openpgp.initWorker({path:A["default"].openPgpWorkerJs()})}catch(i){C["default"].log(i)}z["default"].openpgpKeyring=new e.Keyring,z["default"].capaOpenPGP(!0),F["default"].pub("openpgp.init"),t.reloadOpenPgpKeys()};l.window.openpgp?e(l.window.openpgp):o.script(A["default"].openPgpJs()).wait(function(){l.window.openpgp&&e(l.window.openpgp)})}():z["default"].capaOpenPGP(!1),ge["default"].startScreens([i(116),ee["default"].capa(f.Capa.Settings)?i(117):null]),(a||c||d)&&t.socialUsers(!0),F["default"].sub("interval.2m",function(){return t.folderInformation(I["default"].getFolderInboxName())}),F["default"].sub("interval.3m",function(){var e=j["default"].currentFolderFullNameRaw();I["default"].getFolderInboxName()!==e&&t.folderInformation(e)}),F["default"].sub("interval.2m-after5m",function(){return t.folderInformationMultiply()}),F["default"].sub("interval.15m",function(){return t.quota()}),F["default"].sub("interval.20m",function(){return t.foldersReload()}),r=r>=5?r:20,r=320>=r?r:320,l._.delay(function(){return t.contactsSync()},1e4),l._.delay(function(){return t.folderInformationMultiply(!0)},2e3),l.window.setInterval(function(){return t.contactsSync()},6e4*r+5e3),t.accountsAndIdentities(!0),l._.delay(function(){var e=j["default"].currentFolderFullNameRaw();I["default"].getFolderInboxName()!==e&&t.folderInformation(e)},1e3),l._.delay(function(){return t.quota()},5e3),l._.delay(function(){return ie["default"].appDelayStart(C["default"].emptyFunction)},35e3),F["default"].sub("rl.auto-logout",function(){return t.logout()}),v["default"].runHook("rl-start-user-screens"),F["default"].pub("rl.bootstart-user-screens"),ee["default"].settingsGet("WelcomePageUrl")&&l._.delay(function(){return t.bootstartWelcomePopup(ee["default"].settingsGet("WelcomePageUrl"))},1e3),ee["default"].settingsGet("AccountSignMe")&&l.window.navigator.registerProtocolHandler&&ee["default"].capa(f.Capa.Composer)&&l._.delay(function(){try{l.window.navigator.registerProtocolHandler("mailto",l.window.location.protocol+"//"+l.window.location.host+l.window.location.pathname+"?mailto&to=%s",""+(ee["default"].settingsGet("Title")||"RainLoop"))}catch(e){}ee["default"].settingsGet("MailToEmail")&&C["default"].mailToHelper(ee["default"].settingsGet("MailToEmail"),i(29))},500),y["default"].bMobileDevice||(l._.defer(function(){return t.initVerticalLayoutResizer(f.ClientSideKeyName.FolderListSize)}),p["default"]&&ee["default"].appSettingsGet("faviconStatus")&&!ee["default"].appSettingsGet("listPermanentFiltered")&&(p["default"].setOptions({fallback:!1}),F["default"].sub("mailbox.inbox-unread-count",function(e){return p["default"].setBubble(e>0?e>99?99:e:0)})))):t.logout()}))):(this.bootend(),this.bootstartLoginScreen()),a&&(l.window["rl_"+s+"_google_service"]=function(){k["default"].google.loading(!0),t.socialUsers()}),c&&(l.window["rl_"+s+"_facebook_service"]=function(){k["default"].facebook.loading(!0),t.socialUsers()}),d&&(l.window["rl_"+s+"_twitter_service"]=function(){k["default"].twitter.loading(!0),t.socialUsers()}),F["default"].sub("interval.1m",function(){return P["default"].reload()}),v["default"].runHook("rl-start-screens"),F["default"].pub("rl.bootstart-end")},t}(be.AbstractApp);t["default"]=new ye},function(e,t,i){!function(){"use strict";var t={},o=i(11),s=i(3),n=i(14),r=i(2),a=i(18),l=i(4);t.$win=n(o),t.$doc=n(o.document),t.$html=n("html"),t.$body=n("body"),t.$div=n("<div></div>"),t.$win.__sizes=[0,0],t.startMicrotime=(new o.Date).getTime(),t.community=!0,t.dropdownVisibility=r.observable(!1).extend({rateLimit:0}),t.useKeyboardShortcuts=r.observable(!0),t.iAjaxErrorCount=0,t.iTokenErrorCount=0,t.iMessageBodyCacheCount=0,t.bUnload=!1,t.sUserAgent="navigator"in o&&"userAgent"in o.navigator&&o.navigator.userAgent.toLowerCase()||"",t.bIE=t.sUserAgent.indexOf("msie")>-1,t.bChrome=t.sUserAgent.indexOf("chrome")>-1,t.bSafari=!t.bChrome&&t.sUserAgent.indexOf("safari")>-1,t.bMobileDevice=/android/i.test(t.sUserAgent)||/iphone/i.test(t.sUserAgent)||/ipod/i.test(t.sUserAgent)||/ipad/i.test(t.sUserAgent)||/blackberry/i.test(t.sUserAgent),t.bDisableNanoScroll=t.bMobileDevice,t.bAllowPdfPreview=!t.bMobileDevice,t.bAnimationSupported=!t.bMobileDevice&&t.$html.hasClass("csstransitions")&&t.$html.hasClass("cssanimations"),t.bXMLHttpRequestSupported=!!o.XMLHttpRequest,t.__APP__=null,t.oHtmlEditorDefaultConfig={title:!1,stylesSet:!1,customConfig:"",contentsCss:"",toolbarGroups:[{name:"spec"},{name:"styles"},{name:"basicstyles",groups:["basicstyles","cleanup","bidi"]},{name:"colors"},t.bMobileDevice?{}:{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"links"},{name:"insert"},{name:"document",groups:["mode","document","doctools"]},{name:"others"}],removePlugins:"liststyle",removeButtons:"Format,Undo,Redo,Cut,Copy,Paste,Anchor,Strike,Subscript,Superscript,Image,SelectAll,Source",removeDialogTabs:"link:advanced;link:target;image:advanced;images:advanced",extraPlugins:"plain,signature",allowedContent:!0,extraAllowedContent:!0,fillEmptyBlocks:!1,ignoreEmptyParagraph:!0,disableNativeSpellChecker:!1,font_defaultLabel:"Arial",fontSize_defaultLabel:"13",fontSize_sizes:"10/10px;12/12px;13/13px;14/14px;16/16px;18/18px;20/20px;24/24px;28/28px;36/36px;48/48px"},t.oHtmlEditorLangsMap={bg_bg:"bg",de_de:"de",el_gr:"el",es_es:"es",fr_fr:"fr",hu_hu:"hu",is_is:"is",it_it:"it",ja_jp:"ja",ko_kr:"ko",lt_lt:"lt",lv_lv:"lv",nl_nl:"nl",bg_no:"no",pl_pl:"pl",pt_pt:"pt",pt_br:"pt-br",ro_ro:"ro",ru_ru:"ru",sk_sk:"sk",sl_si:"sl",sv_se:"sv",tr_tr:"tr",uk_ua:"ru",zh_tw:"zh",zh_cn:"zh-cn"},t.bAllowPdfPreview&&o.navigator&&o.navigator.mimeTypes&&(t.bAllowPdfPreview=!!s.find(o.navigator.mimeTypes,function(e){return e&&"application/pdf"===e.type}),t.bAllowPdfPreview||(t.bAllowPdfPreview="undefined"!=typeof o.navigator.mimeTypes["application/pdf"])),t.aBootstrapDropdowns=[],t.aViewModels={settings:[],"settings-removed":[],"settings-disabled":[]},t.leftPanelDisabled=r.observable(!1),t.leftPanelType=r.observable(""),t.leftPanelWidth=r.observable(0),t.popupVisibilityNames=r.observableArray([]),t.popupVisibility=r.computed(function(){return 0<t.popupVisibilityNames().length},this),t.popupVisibility.subscribe(function(e){t.$html.toggleClass("rl-modal",e)}),t.keyScopeReal=r.observable(l.KeyState.All),t.keyScopeFake=r.observable(l.KeyState.All),t.keyScope=r.computed({owner:this,read:function(){return t.keyScopeFake()},write:function(e){l.KeyState.Menu!==e&&(l.KeyState.Compose===e?a.filter=function(){return t.useKeyboardShortcuts()}:a.filter=function(e){if(t.useKeyboardShortcuts()){var i=e.target||e.srcElement,o=i?i.tagName:"";return o=o.toUpperCase(),!("INPUT"===o||"SELECT"===o||"TEXTAREA"===o||i&&"DIV"===o&&("editorHtmlArea"===i.className||"true"==""+i.contentEditable))}return!1},t.keyScopeFake(e),t.dropdownVisibility()&&(e=l.KeyState.Menu)),t.keyScopeReal(e)}}),t.keyScopeReal.subscribe(function(e){a.setScope(e)}),t.dropdownVisibility.subscribe(function(e){e?t.keyScope(l.KeyState.Menu):l.KeyState.Menu===a.getScope()&&t.keyScope(t.keyScopeFake())}),e.exports=t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(1),a=o(r),l=function(){function e(){s(this,e),this.settings={},this.appSettings={},this.settings=n.window.rainloopAppData||{},this.settings=a["default"].isNormal(this.settings)?this.settings:{},this.appSettings=this.settings.System||null,this.appSettings=a["default"].isNormal(this.appSettings)?this.appSettings:{}}return e.prototype.settingsGet=function(e){return a["default"].isUnd(this.settings[e])?null:this.settings[e]},e.prototype.settingsSet=function(e,t){this.settings[e]=t},e.prototype.appSettingsGet=function(e){return a["default"].isUnd(this.appSettings[e])?null:this.appSettings[e]},e.prototype.capa=function(e){var t=this.settingsGet("Capa");return a["default"].isArray(t)&&a["default"].isNormal(e)&&-1<a["default"].inArray(e,t)},e}();e.exports=new l},function(e,t,i){!function(){"use strict";function t(e,t){this.bDisabeCloseOnEsc=!1,this.sPosition=n.pString(e),this.sTemplate=n.pString(t),this.sDefaultKeyScope=s.KeyState.None,this.sCurrentKeyScope=this.sDefaultKeyScope,this.viewModelVisibility=o.observable(!1),this.modalVisibility=o.observable(!1).extend({rateLimit:0}),this.viewModelName="",this.viewModelNames=[],this.viewModelDom=null}var o=i(2),s=i(4),n=i(1),r=i(8);t.prototype.bDisabeCloseOnEsc=!1,t.prototype.sPosition="",t.prototype.sTemplate="",t.prototype.sDefaultKeyScope=s.KeyState.None,t.prototype.sCurrentKeyScope=s.KeyState.None,t.prototype.viewModelName="",t.prototype.viewModelNames=[],t.prototype.viewModelDom=null,t.prototype.viewModelTemplate=function(){return this.sTemplate},t.prototype.viewModelPosition=function(){return this.sPosition},t.prototype.cancelCommand=function(){},t.prototype.closeCommand=function(){},t.prototype.storeAndSetKeyScope=function(){this.sCurrentKeyScope=r.keyScope(),r.keyScope(this.sDefaultKeyScope)},t.prototype.restoreKeyScope=function(){r.keyScope(this.sCurrentKeyScope)},t.prototype.registerPopupKeyDown=function(){var e=this;r.$win.on("keydown",function(t){if(t&&e.modalVisibility&&e.modalVisibility()){if(!this.bDisabeCloseOnEsc&&s.EventKeyCode.Esc===t.keyCode)return n.delegateRun(e,"cancelCommand"),!1;if(s.EventKeyCode.Backspace===t.keyCode&&!n.inFocus())return!1}return!0})},e.exports=t}()},function(e,t){e.exports=window},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(1),a=o(r),l=i(9),c=o(l),u=function(){function e(){s(this,e),this.sBase="#/",this.sServer="./?",this.sVersion=c["default"].appSettingsGet("version"),this.sWebPrefix=c["default"].appSettingsGet("webPath")||"",this.sVersionPrefix=c["default"].appSettingsGet("webVersionPath")||"rainloop/v/"+this.sVersion+"/",this.sAdminPath=c["default"].appSettingsGet("adminPath")||"admin",this.sAuthSuffix=c["default"].settingsGet("AuthAccountHash")||"0",this.sStaticPrefix=this.sVersionPrefix+"static/"}return e.prototype.populateAuthSuffix=function(){this.sAuthSuffix=c["default"].settingsGet("AuthAccountHash")||"0"},e.prototype.subQueryPrefix=function(){return"&q[]="},e.prototype.root=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return this.sBase+a["default"].pString(e)},e.prototype.rootAdmin=function(){return this.sServer+this.sAdminPath},e.prototype.rootUser=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return e?"./?/Mobile/":"./"},e.prototype.attachmentRaw=function(e,t,i){return i=a["default"].isUnd(i)?this.sAuthSuffix:i,this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+i+"/"+e+"/"+this.subQueryPrefix()+"/"+t},e.prototype.attachmentDownload=function(e,t){return this.attachmentRaw("Download",e,t)},e.prototype.attachmentPreview=function(e,t){return this.attachmentRaw("View",e,t)},e.prototype.attachmentThumbnailPreview=function(e,t){return this.attachmentRaw("ViewThumbnail",e,t)},e.prototype.attachmentPreviewAsPlain=function(e,t){return this.attachmentRaw("ViewAsPlain",e,t)},e.prototype.attachmentFramed=function(e,t){return this.attachmentRaw("FramedView",e,t)},e.prototype.upload=function(){return this.sServer+"/Upload/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"},e.prototype.uploadContacts=function(){return this.sServer+"/UploadContacts/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"},e.prototype.uploadBackground=function(){return this.sServer+"/UploadBackground/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"},e.prototype.append=function(){return this.sServer+"/Append/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"},e.prototype.change=function(e){return this.sServer+"/Change/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"+a["default"].encodeURIComponent(e)+"/"},e.prototype.ajax=function(e){return this.sServer+"/Ajax/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/"+e},e.prototype.messageViewLink=function(e){return this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/ViewAsPlain/"+this.subQueryPrefix()+"/"+e},e.prototype.messageDownloadLink=function(e){return this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/Download/"+this.subQueryPrefix()+"/"+e},e.prototype.avatarLink=function(e){return this.sServer+"/Raw/0/Avatar/"+a["default"].encodeURIComponent(e)+"/"},e.prototype.publicLink=function(e){return this.sServer+"/Raw/0/Public/"+e+"/"},e.prototype.userBackground=function(e){return this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/UserBackground/"+this.subQueryPrefix()+"/"+e},e.prototype.inbox=function(){var e=arguments.length<=0||void 0===arguments[0]?"INBOX":arguments[0];return this.sBase+"mailbox/"+e},e.prototype.settings=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return this.sBase+"settings"+(e?"/"+e:"")},e.prototype.about=function(){return this.sBase+"about"},e.prototype.admin=function(e){var t=this.sBase;switch(e){case"AdminDomains":t+="domains";break;case"AdminSecurity":t+="security";break;case"AdminLicensing":t+="licensing"}return t},e.prototype.mailBox=function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],i=arguments.length<=2||void 0===arguments[2]?"":arguments[2],o=arguments.length<=3||void 0===arguments[3]?"":arguments[3];t=a["default"].isNormal(t)?a["default"].pInt(t):1,i=a["default"].pString(i);var s=this.sBase+"mailbox/";if(""!==e){var r=a["default"].pInt(o);s+=n.window.encodeURI(e)+(r>0?"~"+r:"")}return t>1&&(s=s.replace(/[\/]+$/,""),s+="/p"+t),""!==i&&(s=s.replace(/[\/]+$/,""),s+="/"+n.window.encodeURI(i)),s},e.prototype.phpInfo=function(){return this.sServer+"Info"},e.prototype.langLink=function(e,t){return this.sServer+"/Lang/0/"+(t?"Admin":"App")+"/"+n.window.encodeURI(e)+"/"+this.sVersion+"/"},e.prototype.exportContactsVcf=function(){return this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/ContactsVcf/"},e.prototype.exportContactsCsv=function(){return this.sServer+"/Raw/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/ContactsCsv/"},e.prototype.emptyContactPic=function(){return this.sStaticPrefix+"css/images/empty-contact.png"},e.prototype.sound=function(e){return this.sStaticPrefix+"sounds/"+e},e.prototype.themePreviewLink=function(e){var t=this.sVersionPrefix;return"@custom"===e.substr(-7)&&(e=a["default"].trim(e.substring(0,e.length-7)),t=this.sWebPrefix),t+"themes/"+n.window.encodeURI(e)+"/images/preview.png"},e.prototype.notificationMailIcon=function(){return this.sStaticPrefix+"css/images/icom-message-notification.png"},e.prototype.openPgpJs=function(){return this.sStaticPrefix+"js/min/openpgp.min.js"},e.prototype.openPgpWorkerJs=function(){return this.sStaticPrefix+"js/min/openpgp.worker.min.js"},e.prototype.openPgpWorkerPath=function(){return this.sStaticPrefix+"js/min/"},e.prototype.socialGoogle=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this.sServer+"SocialGoogle"+(""!==this.sAuthSuffix?"/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/":"")+(e?"&xauth=1":"")},e.prototype.socialTwitter=function(){return this.sServer+"SocialTwitter"+(""!==this.sAuthSuffix?"/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/":"")},e.prototype.socialFacebook=function(){return this.sServer+"SocialFacebook"+(""!==this.sAuthSuffix?"/"+this.subQueryPrefix()+"/"+this.sAuthSuffix+"/":"")},e}();e.exports=new u},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t.key=t.moment=t.Q=t._=t.JSON=t.$=t.window=void 0;var s=i(11),n=o(s),r=i(14),a=o(r),l=i(36),c=o(l),u=i(3),d=o(u),p=i(48),h=o(p),f=i(82),m=o(f),g=i(18),b=o(g);t.window=n["default"],t.$=a["default"],t.JSON=c["default"],t._=d["default"],t.Q=h["default"],t.moment=m["default"],t.key=b["default"]},function(e,t){e.exports=window.jQuery},function(e,t,i){!function(){"use strict";function t(){p.call(this),this.oRequests={}}var o=i(3),s=i(1),n=i(17),r=i(161),a=i(19),l=i(12),c=i(9),u=i(24),d=i(28),p=i(55);o.extend(t.prototype,p.prototype),t.prototype.folders=function(e){this.defaultRequest(e,"Folders",{SentFolder:c.settingsGet("SentFolder"),DraftFolder:c.settingsGet("DraftFolder"),SpamFolder:c.settingsGet("SpamFolder"),TrashFolder:c.settingsGet("TrashFolder"),ArchiveFolder:c.settingsGet("ArchiveFolder")},null,"",["Folders"])},t.prototype.login=function(e,t,i,o,s,n,r,a){this.defaultRequest(e,"Login",{Email:t,Login:i,Password:o,Language:n||"",AdditionalCode:r||"",AdditionalCodeSignMe:a?"1":"0",SignMe:s?"1":"0"})},t.prototype.getTwoFactor=function(e){this.defaultRequest(e,"GetTwoFactorInfo")},t.prototype.createTwoFactor=function(e){this.defaultRequest(e,"CreateTwoFactorSecret")},t.prototype.clearTwoFactor=function(e){this.defaultRequest(e,"ClearTwoFactorInfo")},t.prototype.showTwoFactorSecret=function(e){this.defaultRequest(e,"ShowTwoFactorSecret")},t.prototype.testTwoFactor=function(e,t){this.defaultRequest(e,"TestTwoFactorInfo",{Code:t})},t.prototype.enableTwoFactor=function(e,t){this.defaultRequest(e,"EnableTwoFactor",{Enable:t?"1":"0"})},t.prototype.clearTwoFactorInfo=function(e){this.defaultRequest(e,"ClearTwoFactorInfo")},t.prototype.contactsSync=function(e){this.defaultRequest(e,"ContactsSync",null,n.CONTACTS_SYNC_AJAX_TIMEOUT)},t.prototype.saveContactsSyncData=function(e,t,i,o,s){this.defaultRequest(e,"SaveContactsSyncData",{Enable:t?"1":"0",Url:i,User:o,Password:s})},t.prototype.accountSetup=function(e,t,i,o){o=s.isUnd(o)?!0:!!o,this.defaultRequest(e,"AccountSetup",{Email:t,Password:i,New:o?"1":"0"})},t.prototype.accountDelete=function(e,t){this.defaultRequest(e,"AccountDelete",{EmailToDelete:t})},t.prototype.accountsAndIdentitiesSortOrder=function(e,t,i){this.defaultRequest(e,"AccountsAndIdentitiesSortOrder",{Accounts:t,Identities:i})},t.prototype.identityUpdate=function(e,t,i,o,s,n,r,a){this.defaultRequest(e,"IdentityUpdate",{Id:t,Email:i,Name:o,ReplyTo:s,Bcc:n,Signature:r,SignatureInsertBefore:a?"1":"0"})},t.prototype.identityDelete=function(e,t){this.defaultRequest(e,"IdentityDelete",{IdToDelete:t})},t.prototype.accountsAndIdentities=function(e){this.defaultRequest(e,"AccountsAndIdentities")},t.prototype.accountsCounts=function(e){this.defaultRequest(e,"AccountsCounts")},t.prototype.filtersSave=function(e,t,i,s){this.defaultRequest(e,"FiltersSave",{Raw:i,RawIsActive:s?"1":"0",Filters:o.map(t,function(e){return e.toJson()})})},t.prototype.filtersGet=function(e){this.defaultRequest(e,"Filters",{})},t.prototype.templates=function(e){this.defaultRequest(e,"Templates",{})},t.prototype.templateGetById=function(e,t){this.defaultRequest(e,"TemplateGetByID",{ID:t})},t.prototype.templateDelete=function(e,t){this.defaultRequest(e,"TemplateDelete",{IdToDelete:t})},t.prototype.templateSetup=function(e,t,i,o){this.defaultRequest(e,"TemplateSetup",{ID:t,Name:i,Body:o})},t.prototype.messageList=function(e,t,i,o,c,p,h){t=s.pString(t);var f=a.getFolderHash(t),m=u.threadsAllowed()&&d.useThreads(),g=a.getFolderInboxName()===t?a.getFolderUidNext(t):"";return h=s.isUnd(h)?!1:!!h,i=s.isUnd(i)?0:s.pInt(i),o=s.isUnd(i)?20:s.pInt(o),c=s.pString(c),p=s.pString(p),""===f||""!==c&&-1!==c.indexOf("is:")?this.defaultRequest(e,"MessageList",{Folder:t,Offset:i,Limit:o,Search:c,UidNext:g,UseThreads:m?"1":"0",ThreadUid:m?p:""},""===c?n.DEFAULT_AJAX_TIMEOUT:n.SEARCH_AJAX_TIMEOUT,"",h?[]:["MessageList"]):this.defaultRequest(e,"MessageList",{},""===c?n.DEFAULT_AJAX_TIMEOUT:n.SEARCH_AJAX_TIMEOUT,"MessageList/"+l.subQueryPrefix()+"/"+r.urlsafe_encode([t,i,o,c,u.projectHash(),f,g,m?"1":"0",m?p:""].join(String.fromCharCode(0))),h?[]:["MessageList"])},t.prototype.messageUploadAttachments=function(e,t){this.defaultRequest(e,"MessageUploadAttachments",{Attachments:t},999e3)},t.prototype.message=function(e,t,i){return t=s.pString(t),i=s.pInt(i),a.getFolderFromCacheList(t)&&i>0?(this.defaultRequest(e,"Message",{},null,"Message/"+l.subQueryPrefix()+"/"+r.urlsafe_encode([t,i,u.projectHash(),u.threadsAllowed()&&d.useThreads()?"1":"0"].join(String.fromCharCode(0))),["Message"]),!0):!1},t.prototype.composeUploadExternals=function(e,t){this.defaultRequest(e,"ComposeUploadExternals",{Externals:t},999e3)},t.prototype.composeUploadDrive=function(e,t,i){this.defaultRequest(e,"ComposeUploadDrive",{AccessToken:i,Url:t},999e3)},t.prototype.folderInformation=function(e,t,n){var r=!0,l=[];s.isArray(n)&&0<n.length&&(r=!1,o.each(n,function(e){a.getMessageFlagsFromCache(e.folderFullNameRaw,e.uid)||l.push(e.uid),0<e.threads().length&&o.each(e.threads(),function(t){a.getMessageFlagsFromCache(e.folderFullNameRaw,t)||l.push(t)})}),0<l.length&&(r=!0)),r?this.defaultRequest(e,"FolderInformation",{Folder:t,FlagsUids:s.isArray(l)?l.join(","):"",UidNext:a.getFolderInboxName()===t?a.getFolderUidNext(t):""}):d.useThreads()&&i(7)["default"].reloadFlagsCurrentMessageListAndMessageFromCache()},t.prototype.folderInformationMultiply=function(e,t){this.defaultRequest(e,"FolderInformationMultiply",{Folders:t})},t.prototype.logout=function(e){this.defaultRequest(e,"Logout")},t.prototype.messageSetFlagged=function(e,t,i,o){this.defaultRequest(e,"MessageSetFlagged",{Folder:t,Uids:i.join(","),SetAction:o?"1":"0"})},t.prototype.messageSetSeen=function(e,t,i,o){this.defaultRequest(e,"MessageSetSeen",{Folder:t,Uids:i.join(","),SetAction:o?"1":"0"})},t.prototype.messageSetSeenToAll=function(e,t,i){this.defaultRequest(e,"MessageSetSeenToAll",{Folder:t,SetAction:i?"1":"0"})},t.prototype.saveMessage=function(e,t,i,o,s,r,a,l,c,u,d,p,h,f,m,g,b){this.defaultRequest(e,"SaveMessage",{IdentityID:t,MessageFolder:i,MessageUid:o,DraftFolder:s,To:r,Cc:a,Bcc:l,ReplyTo:c,Subject:u,TextIsHtml:d?"1":"0",Text:p,DraftInfo:f,InReplyTo:m,References:g,MarkAsImportant:b?"1":"0",Attachments:h},n.SAVE_MESSAGE_AJAX_TIMEOUT)},t.prototype.sendReadReceiptMessage=function(e,t,i,o,s,n){this.defaultRequest(e,"SendReadReceiptMessage",{MessageFolder:t,MessageUid:i,ReadReceipt:o,Subject:s,Text:n})},t.prototype.sendMessage=function(e,t,i,o,s,r,a,l,c,u,d,p,h,f,m,g,b,y,S){this.defaultRequest(e,"SendMessage",{IdentityID:t,MessageFolder:i,MessageUid:o,SentFolder:s,To:r,Cc:a,Bcc:l,ReplyTo:c,Subject:u,TextIsHtml:d?"1":"0",Text:p,DraftInfo:f,InReplyTo:m,References:g,Dsn:b?"1":"0",ReadReceiptRequest:y?"1":"0",MarkAsImportant:S?"1":"0",Attachments:h},n.SEND_MESSAGE_AJAX_TIMEOUT)},t.prototype.saveSystemFolders=function(e,t){this.defaultRequest(e,"SystemFoldersUpdate",t)},t.prototype.saveSettings=function(e,t){this.defaultRequest(e,"SettingsUpdate",t)},t.prototype.changePassword=function(e,t,i){this.defaultRequest(e,"ChangePassword",{PrevPassword:t,NewPassword:i})},t.prototype.folderClear=function(e,t){this.defaultRequest(e,"FolderClear",{
Folder:t})},t.prototype.folderSetSubscribe=function(e,t,i){this.defaultRequest(e,"FolderSubscribe",{Folder:t,Subscribe:i?"1":"0"})},t.prototype.folderSetCheckable=function(e,t,i){this.defaultRequest(e,"FolderCheckable",{Folder:t,Checkable:i?"1":"0"})},t.prototype.messagesMove=function(e,t,i,o,s,n){this.defaultRequest(e,"MessageMove",{FromFolder:t,ToFolder:i,Uids:o.join(","),MarkAsRead:n?"1":"0",Learning:s||""},null,"",["MessageList"])},t.prototype.messagesCopy=function(e,t,i,o){this.defaultRequest(e,"MessageCopy",{FromFolder:t,ToFolder:i,Uids:o.join(",")})},t.prototype.messagesDelete=function(e,t,i){this.defaultRequest(e,"MessageDelete",{Folder:t,Uids:i.join(",")},null,"",["MessageList"])},t.prototype.appDelayStart=function(e){this.defaultRequest(e,"AppDelayStart")},t.prototype.quota=function(e){this.defaultRequest(e,"Quota")},t.prototype.contacts=function(e,t,i,o){this.defaultRequest(e,"Contacts",{Offset:t,Limit:i,Search:o},null,"",["Contacts"])},t.prototype.contactSave=function(e,t,i,o){this.defaultRequest(e,"ContactSave",{RequestUid:t,Uid:s.trim(i),Properties:o})},t.prototype.contactsDelete=function(e,t){this.defaultRequest(e,"ContactsDelete",{Uids:t.join(",")})},t.prototype.suggestions=function(e,t,i){this.defaultRequest(e,"Suggestions",{Query:t,Page:i},null,"",["Suggestions"])},t.prototype.clearUserBackground=function(e){this.defaultRequest(e,"ClearUserBackground")},t.prototype.facebookUser=function(e){this.defaultRequest(e,"SocialFacebookUserInformation")},t.prototype.facebookDisconnect=function(e){this.defaultRequest(e,"SocialFacebookDisconnect")},t.prototype.twitterUser=function(e){this.defaultRequest(e,"SocialTwitterUserInformation")},t.prototype.twitterDisconnect=function(e){this.defaultRequest(e,"SocialTwitterDisconnect")},t.prototype.googleUser=function(e){this.defaultRequest(e,"SocialGoogleUserInformation")},t.prototype.googleDisconnect=function(e){this.defaultRequest(e,"SocialGoogleDisconnect")},t.prototype.socialUsers=function(e){this.defaultRequest(e,"SocialUsers")},e.exports=new t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t.componentExportHelper=t.AbstractComponent=void 0;var n=i(13),r=i(2),a=o(r),l=i(1),c=o(l),u=function(){function e(){s(this,e),this.disposable=[]}return e.prototype.dispose=function(){this.disposable.forEach(function(e){e&&e.dispose&&e.dispose()})},e}(),d=function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return{template:t?{element:t}:"<b></b>",viewModel:{createViewModel:function(t,o){return t=t||{},t.element=null,o&&o.element&&(t.component=o,t.element=(0,n.$)(o.element),i(6).i18nToNodes(t.element),!c["default"].isUnd(t.inline)&&a["default"].unwrap(t.inline)&&t.element.css("display","inline-block")),new e(t)}}}};t.AbstractComponent=u,t.componentExportHelper=d},function(e,t){"use strict";t.__esModule=!0;t.MESSAGES_PER_PAGE=20,t.MESSAGES_PER_PAGE_VALUES=[10,20,30,50,100],t.CONTACTS_PER_PAGE=50,t.DEFAULT_AJAX_TIMEOUT=3e4,t.SEARCH_AJAX_TIMEOUT=3e5,t.SEND_MESSAGE_AJAX_TIMEOUT=3e5,t.SAVE_MESSAGE_AJAX_TIMEOUT=2e5,t.CONTACTS_SYNC_AJAX_TIMEOUT=2e5,t.UNUSED_OPTION_VALUE="__UNUSE__",t.CLIENT_SIDE_STORAGE_INDEX_NAME="rlcsc",t.IMAP_DEFAULT_PORT=143,t.IMAP_DEFAULT_SECURE_PORT=993,t.SMTP_DEFAULT_PORT=25,t.SMTP_DEFAULT_SECURE_PORT=465,t.SIEVE_DEFAULT_PORT=4190,t.MESSAGE_BODY_CACHE_LIMIT=15,t.AJAX_ERROR_LIMIT=7,t.TOKEN_ERROR_LIMIT=10,t.RAINLOOP_TRIAL_KEY="RAINLOOP-TRIAL-KEY",t.DATA_IMAGE_USER_DOT_PIC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAHHklEQVRoQ7VZW08bVxCeXRuwIbTGXIwNtBBaqjwgVUiR8lDlbza9qe1DpVZ9aNQ/0KpPeaJK07SpcuEeCEmUAObm21bfrL9lONjexSYrWfbunj37zXdmvpkz9oIgCKTD0Wg0xPd94TDP83Q0zvWa50vzklSrdanVanqf4/D84GBGr+F+Op3S8fqoJxLOdnZgTvsO/nYhenHA+UC7CWF1uXwkb9++ldPTUwVerVbVqFQqpR8YPjQ0JCMjI5LNDijoRgP3PQVu5+5Eor2XGLg7IV4GkIdHJ/LmzRs5ODiIwNbrdR0O0GCcq4Xz4eFhmZyclP7+tDQaIik/BG5XKQn4SwG3zJTLZXn9+rUclI8UHD5YVoDDN8bSzXhONwL48fFxGR4eilzFZT1uFRIB5yT8BqCdnR3Z3d0VP9Un6XRawYJpggVrZBv38ME4XKtUKnLt2jUplUoy1PR/l3U7T6sVSAQcgMAkj8PDQ9ne3pajoyMRL7zeKsYZWHgWYDGmv78/mmdwcFA+mJlSgziHDWrERrsjEXDXegTi1tZW+DLxI2bxIrqFNYTXyDyCFweMAHCwb8e4RnTNuOsqe3t7sra21pTD0Kct666E8XlcZyzw9/RUUXK5nK5oUinUQI6TQ3cynO/v78vq6qrKXCNwlTiJJpyNGc3nZHp6uqV2dwrQWOCtZBDAV1ZWwsQk7f0wiQn5kffbAu/0/KWBYzIC1+XukfGx0RGZmppKlC2tIV0Bh4aDcZW7HhkfH8urLLZL7T2pihvlkMNnz56FiadHxicL41IsFpN41bkxsYxbRdFo9jwB8KdPn14J8KnSpBQKhQs63nPmbCVRcBUAR2Lq1VVmpksyMTFxAXjcEsQybiegESionjx5osCZOeNe1O4+EhCAX7bQSgQcxRHTMgAgcz5+/Dis/hL4uHU3/B4YGNASGHIKxuEql0k+l05AeIAF1vPnz5VxFFmdDlaJrMtZITJeSsXCOTlMunKxjLtMYOKNjQ158eJFuAuKkUOb5sEwgff19SkJUBVkThZUbnXZrtCKBQ6gbnWIkjZpyne3ejAWoGnA7Icz6irvBLgbOMicCM6TkxPx/LAkbXfgWcsazuE2kFRsKD5Z+CiqDumKncpZvieWcS6dDVD8xiYCNflpJdwcdwJOf9airLmVQ7DPzMxIYWLsXGXoVqLt5k0M3K3JUVPDZdbWNzsCp48TPFdvdnZWUz32nDha7bJ63kgAJPzSdRks9/Kf9xMJAQ1gq2NpaUmy2Yz4zar4nQC3xb99AQwCcGzLAAwuhG8YiWvcOKts+r4GOe5nMhm5efOm9lUA3E3vSZJRrKvE0fnPv//Jy5cvo5cTHIPQbSjhOoqq69evS19f6lxDKK4+sVhigZPtKJqbrQeqxd5+WR4+fKgqgT0k2XX3nhiPgETWXFhYkFzuPZ2yVq1GTSOXpE47/VjgNnD4m4GG7/LhsTx69EiwD4Vr2MwIIxgbAH18fKx1yfz8vEogNvGtWnCuhLZa9UTAreVWFsHy/b/+Vrbdl7E5REMQD2jDoUbByty+/ZnU64GkU2HzyJLhktU1cLv8nARgkYS2d3ajAgwG8qU2oLmDZ92CMaOjo7K4uCiZgbDWaRWgnZhPxLhrMUCvr69riwKZk1LHF7XqrWAO9hJxH6ozNzcnCx/PqztZg9mf6SQMscCtm2C5ke4BGMlHWTUp36036AJajDVrFMzBrhhWslQsSrFYiOqVpMriNYIgqFRq2j3FAb/zffT6zuxFXxsNzs3NTXn16lW4gYiW96w1FyedF+83xG/2FNGCRpU4NjamMsn+OZ9xE5RXqdaDdPpib6RWCzuwKF9RxqI2AVNQBwQYJoK0wdBejnqtEikP3pfP51XjUTESl12FqJEKxsEorARYDD44ONTeID7YpsEnrRvQfWAI2e8WfDaTUSIwJ0iBCmFOtOUAHvVMPp/TPwvYFVYFIuP8l+DBgwdaa2Miqwa0GgYwfeMltovbDfh6c1vIgMYcliSsKv4IWFr6VDHxvldvBAH+1sA+cnl5WYOPmmr9ir+1l9I0Cgz0yjhXjfJJ0JROnmezWbl165ayr/5fqwcBNr7IfhjMqKcvESSM4eRcCasQ3bDNObmKPLdGUGpZsN24cUNLBm9zazu4d++e6qpNBFaTuUS26U5dpuR1CxyA7J9ddrMRqlz4pwLLYawymPd++/2PADt2ugcGwq9gCCdhQ96C6xWwa6j1ceuq+I0EhW0i8MAIVJfeL3d/DVD8EKi12P6/2S2jV/EccVB54O/ejz/9HGCpoBBMta5rXMXLu53D1XAwjhXwvvv+h4BAXVe4bOu3O3ChxF08LiZFG3fel199G9CH3fLyqv24NcB44MRhpdK788U3CpyKwsCw590xmfSpzsBt0Fqc3ud3vtZigxWcVZCklVpSiN0w3q5E/h9TGMIUuA3+EQAAAABJRU5ErkJggg==",t.DATA_IMAGE_TRANSP_PIC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII="},function(e,t){e.exports=window.key},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(4),a=i(1),l=o(a),c=i(12),u=o(c),d=i(9),p=o(d),h=function(){function e(){s(this,e),this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={},this.oNewMessage={},this.oRequestedMessage={},this.bCapaGravatar=!1,this.inboxFolderName="",this.bCapaGravatar=p["default"].capa(r.Capa.Gravatar)}return e.prototype.clear=function(){this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={}},e.prototype.getUserPic=function(e,t){e=l["default"].trim(e),t(this.bCapaGravatar&&""!==e?u["default"].avatarLink(e):"",e)},e.prototype.getMessageKey=function(e,t){return e+"#"+t},e.prototype.addRequestedMessage=function(e,t){this.oRequestedMessage[this.getMessageKey(e,t)]=!0},e.prototype.hasRequestedMessage=function(e,t){return!0===this.oRequestedMessage[this.getMessageKey(e,t)]},e.prototype.addNewMessageCache=function(e,t){this.oNewMessage[this.getMessageKey(e,t)]=!0},e.prototype.hasNewMessageAndRemoveFromCache=function(e,t){return this.oNewMessage[this.getMessageKey(e,t)]?(this.oNewMessage[this.getMessageKey(e,t)]=null,!0):!1},e.prototype.clearNewMessageCache=function(){this.oNewMessage={}},e.prototype.getFolderInboxName=function(){return""===this.inboxFolderName?"INBOX":this.inboxFolderName},e.prototype.getFolderFullNameRaw=function(e){return""!==e&&this.oFoldersNamesCache[e]?this.oFoldersNamesCache[e]:""},e.prototype.setFolderFullNameRaw=function(e,t){this.oFoldersNamesCache[e]=t,"INBOX"!==t&&""!==this.inboxFolderName||(this.inboxFolderName=t)},e.prototype.getFolderHash=function(e){return""!==e&&this.oFolderHashCache[e]?this.oFolderHashCache[e]:""},e.prototype.setFolderHash=function(e,t){""!==e&&(this.oFolderHashCache[e]=t)},e.prototype.getFolderUidNext=function(e){return""!==e&&this.oFolderUidNextCache[e]?this.oFolderUidNextCache[e]:""},e.prototype.setFolderUidNext=function(e,t){this.oFolderUidNextCache[e]=t},e.prototype.getFolderFromCacheList=function(e){return""!==e&&this.oFoldersCache[e]?this.oFoldersCache[e]:null},e.prototype.setFolderToCacheList=function(e,t){this.oFoldersCache[e]=t},e.prototype.removeFolderFromCacheList=function(e){this.setFolderToCacheList(e,null)},e.prototype.getMessageFlagsFromCache=function(e,t){return this.oMessageFlagsCache[e]&&this.oMessageFlagsCache[e][t]?this.oMessageFlagsCache[e][t]:null},e.prototype.setMessageFlagsToCache=function(e,t,i){this.oMessageFlagsCache[e]||(this.oMessageFlagsCache[e]={}),this.oMessageFlagsCache[e][t]=i},e.prototype.clearMessageFlagsFromCacheByFolder=function(e){this.oMessageFlagsCache[e]={}},e.prototype.initMessageFlagsFromCache=function(e){var t=this;e&&!function(){var i=e.uid,o=t.getMessageFlagsFromCache(e.folderFullNameRaw,i);if(o&&0<o.length&&(e.flagged(!!o[1]),e.__simple_message__||(e.unseen(!!o[0]),e.answered(!!o[2]),e.forwarded(!!o[3]),e.isReadReceipt(!!o[4]),e.deletedMark(!!o[5]))),0<e.threads().length){var s=n._.find(e.threads(),function(o){if(i!==o){var s=t.getMessageFlagsFromCache(e.folderFullNameRaw,o);return s&&0<s.length&&!!s[0]}return!1}),r=n._.find(e.threads(),function(o){if(i!==o){var s=t.getMessageFlagsFromCache(e.folderFullNameRaw,o);return s&&0<s.length&&!!s[1]}return!1});e.hasUnseenSubMessage(s&&0<l["default"].pInt(s)),e.hasFlaggedSubMessage(r&&0<l["default"].pInt(r))}}()},e.prototype.storeMessageFlagsToCache=function(e){e&&this.setMessageFlagsToCache(e.folderFullNameRaw,e.uid,[e.unseen(),e.flagged(),e.answered(),e.forwarded(),e.isReadReceipt(),e.deletedMark()])},e.prototype.storeMessageFlagsToCacheByFolderAndUid=function(e,t,i){l["default"].isArray(i)&&0<i.length&&this.setMessageFlagsToCache(e,t,i)},e.prototype.storeMessageFlagsToCacheBySetAction=function(e,t,i){var o=0,s=this.getMessageFlagsFromCache(e,t);if(l["default"].isArray(s)&&0<s.length){switch(s[0]&&(o=1),i){case r.MessageSetAction.SetSeen:s[0]=!1;break;case r.MessageSetAction.UnsetSeen:s[0]=!0;break;case r.MessageSetAction.SetFlag:s[1]=!0;break;case r.MessageSetAction.UnsetFlag:s[1]=!1}this.setMessageFlagsToCache(e,t,s)}return o},e}();e.exports=new h},,function(e,t,i){!function(){"use strict";function t(){this.displaySpecSetting=s.observable(!0),this.sentFolder=s.observable(""),this.draftFolder=s.observable(""),this.spamFolder=s.observable(""),this.trashFolder=s.observable(""),this.archiveFolder=s.observable(""),this.namespace="",this.folderList=s.observableArray([]),this.folderList.optimized=s.observable(!1),this.folderList.error=s.observable(""),this.foldersLoading=s.observable(!1),this.foldersCreating=s.observable(!1),this.foldersDeleting=s.observable(!1),this.foldersRenaming=s.observable(!1),this.foldersInboxUnreadCount=s.observable(0),this.currentFolder=s.observable(null).extend({toggleSubscribe:[null,function(e){e&&e.selected(!1)},function(e){e&&e.selected(!0)}]}),this.computers(),this.subscribers()}var o=i(3),s=i(2),n=i(4),r=i(17),a=i(1),l=i(19);t.prototype.computers=function(){this.draftFolderNotEnabled=s.computed(function(){return""===this.draftFolder()||r.UNUSED_OPTION_VALUE===this.draftFolder()},this),this.foldersListWithSingleInboxRootFolder=s.computed(function(){return!o.find(this.folderList(),function(e){return e&&!e.isSystemFolder()&&e.visible()})},this),this.currentFolderFullNameRaw=s.computed(function(){return this.currentFolder()?this.currentFolder().fullNameRaw:""},this),this.currentFolderFullName=s.computed(function(){return this.currentFolder()?this.currentFolder().fullName:""},this),this.currentFolderFullNameHash=s.computed(function(){return this.currentFolder()?this.currentFolder().fullNameHash:""},this),this.foldersChanging=s.computed(function(){var e=this.foldersLoading(),t=this.foldersCreating(),i=this.foldersDeleting(),o=this.foldersRenaming();return e||t||i||o},this),this.folderListSystemNames=s.computed(function(){var e=[l.getFolderInboxName()],t=this.folderList(),i=this.sentFolder(),o=this.draftFolder(),s=this.spamFolder(),n=this.trashFolder(),c=this.archiveFolder();return a.isArray(t)&&0<t.length&&(""!==i&&r.UNUSED_OPTION_VALUE!==i&&e.push(i),""!==o&&r.UNUSED_OPTION_VALUE!==o&&e.push(o),""!==s&&r.UNUSED_OPTION_VALUE!==s&&e.push(s),""!==n&&r.UNUSED_OPTION_VALUE!==n&&e.push(n),""!==c&&r.UNUSED_OPTION_VALUE!==c&&e.push(c)),e},this),this.folderListSystem=s.computed(function(){return o.compact(o.map(this.folderListSystemNames(),function(e){return l.getFolderFromCacheList(e)}))},this),this.folderMenuForMove=s.computed(function(){return a.folderListOptionsBuilder(this.folderListSystem(),this.folderList(),[this.currentFolderFullNameRaw()],null,null,null,null,function(e){return e?e.localName():""})},this),this.folderMenuForFilters=s.computed(function(){return a.folderListOptionsBuilder(this.folderListSystem(),this.folderList(),["INBOX"],[["",""]],null,null,null,function(e){return e?e.localName():""})},this)},t.prototype.subscribers=function(){var e=function(e){return function(){var t=l.getFolderFromCacheList(e());t&&t.type(n.FolderType.User)}},t=function(e){return function(t){var i=l.getFolderFromCacheList(t);i&&i.type(e)}};this.sentFolder.subscribe(e(this.sentFolder),this,"beforeChange"),this.draftFolder.subscribe(e(this.draftFolder),this,"beforeChange"),this.spamFolder.subscribe(e(this.spamFolder),this,"beforeChange"),this.trashFolder.subscribe(e(this.trashFolder),this,"beforeChange"),this.archiveFolder.subscribe(e(this.archiveFolder),this,"beforeChange"),this.sentFolder.subscribe(t(n.FolderType.SentItems),this),this.draftFolder.subscribe(t(n.FolderType.Draft),this),this.spamFolder.subscribe(t(n.FolderType.Spam),this),this.trashFolder.subscribe(t(n.FolderType.Trash),this),this.archiveFolder.subscribe(t(n.FolderType.Archive),this)},t.prototype.getNextFolderNames=function(){var e=[],t=5,s=i(26).momentNowUnix(),n=s-300,r=[],a=l.getFolderInboxName(),c=function(e){o.each(e,function(e){e&&a!==e.fullNameRaw&&e.selectable&&e.existen&&n>e.interval&&(e.isSystemFolder()||e.subScribed()&&e.checkable())&&r.push([e.interval,e.fullNameRaw]),e&&0<e.subFolders().length&&c(e.subFolders())})};return c(this.folderList()),r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),o.find(r,function(i){var o=l.getFolderFromCacheList(i[1]);return o&&(o.interval=s,e.push(i[1])),t<=e.length}),e=o.uniq(e)},e.exports=new t}()},,function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(1),a=o(r),l=i(8),c=o(l),u=i(9),d=o(u),p=function(){function e(){s(this,e),this.oSimpleHooks={},this.aUserViewModelsHooks=[],this.aAdminViewModelsHooks=[]}return e.prototype.addHook=function(e,t){a["default"].isFunc(t)&&(a["default"].isArray(this.oSimpleHooks[e])||(this.oSimpleHooks[e]=[]),this.oSimpleHooks[e].push(t))},e.prototype.runHook=function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];a["default"].isArray(this.oSimpleHooks[e])&&n._.each(this.oSimpleHooks[e],function(e){e.apply(null,t)})},e.prototype.mainSettingsGet=function(e){return d["default"].settingsGet(e)},e.prototype.remoteRequest=function(e,t,i,o){c["default"].__APP__&&c["default"].__APP__.remote().defaultRequest(e,"Plugin"+t,i,o)},e.prototype.addSettingsViewModel=function(e,t,i,o){this.aUserViewModelsHooks.push([e,t,i,o])},e.prototype.addSettingsViewModelForAdmin=function(e,t,i,o){this.aAdminViewModelsHooks.push([e,t,i,o])},e.prototype.runSettingsViewModelHooks=function(e){var t=i(5);n._.each(e?this.aAdminViewModelsHooks:this.aUserViewModelsHooks,function(e){t.addSettingsViewModel(e[0],e[1],e[2],e[3])})},e.prototype.settingsGet=function(e,t){var i=d["default"].settingsGet("Plugins");return i=i&&!a["default"].isUnd(i[e])?i[e]:null,i?a["default"].isUnd(i[t])?null:i[t]:null},e}();e.exports=new p},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(2),l=o(a),c=i(4),u=i(8),d=o(u),p=i(1),h=o(p),f=i(9),m=o(f),g=i(76),b=function(e){function t(){s(this,t);var i=n(this,e.call(this));return i.currentAudio=l["default"].observable(""),i.focusedState=l["default"].observable(c.Focused.None),i.focusedState.subscribe(function(e){switch(e){default:break;case c.Focused.MessageList:d["default"].keyScope(c.KeyState.MessageList);break;case c.Focused.MessageView:d["default"].keyScope(c.KeyState.MessageView);break;case c.Focused.FolderList:d["default"].keyScope(c.KeyState.FolderList)}},i),i.projectHash=l["default"].observable(""),i.threadsAllowed=l["default"].observable(!1),i.composeInEdit=l["default"].observable(!1),i.contactsAutosave=l["default"].observable(!1),i.useLocalProxyForExternalImages=l["default"].observable(!1),i.contactsIsAllowed=l["default"].observable(!1),i.attachmentsActions=l["default"].observableArray([]),i.devEmail="",i.devPassword="",i}return r(t,e),t.prototype.populate=function(){e.prototype.populate.call(this),this.projectHash(m["default"].settingsGet("ProjectHash")),this.contactsAutosave(!!m["default"].settingsGet("ContactsAutosave")),this.useLocalProxyForExternalImages(!!m["default"].settingsGet("UseLocalProxyForExternalImages")),this.contactsIsAllowed(!!m["default"].settingsGet("ContactsIsAllowed"));var t=m["default"].appSettingsGet("attachmentsActions");this.attachmentsActions(h["default"].isNonEmptyArray(t)?t:[]),this.devEmail=m["default"].settingsGet("DevEmail"),this.devPassword=m["default"].settingsGet("DevPassword")},t}(g.AbstractAppStore);e.exports=new b},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(1),a=o(r),l=i(23),c=o(l),u=function(){function e(){s(this,e),this.subs={}}return e.prototype.sub=function(e,t,i){var o=this;return a["default"].isObject(e)?(i=t||null,t=null,n._.each(e,function(e,t){o.sub(t,e,i)},this)):(a["default"].isUnd(this.subs[e])&&(this.subs[e]=[]),this.subs[e].push([t,i])),this},e.prototype.pub=function(e,t){return c["default"].runHook("rl-pub",[e,t]),a["default"].isUnd(this.subs[e])||n._.each(this.subs[e],function(e){e[0]&&e[0].apply(e[1]||null,t||[])}),this},e}();e.exports=new u},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(6),a=o(r),l=function(){function e(){var t=this;s(this,e),this._moment=null,this._momentNow=0,this.updateMomentNow=n._.debounce(function(){t._moment=(0,n.moment)()},500,!0),this.updateMomentNowUnix=n._.debounce(function(){t._momentNow=(0,n.moment)().unix()},500,!0),this.format=n._.bind(this.format,this)}return e.prototype.momentNow=function(){return this.updateMomentNow(),this._moment||(0,n.moment)()},e.prototype.momentNowUnix=function(){return this.updateMomentNowUnix(),this._momentNow||0},e.prototype.searchSubtractFormatDateHelper=function(e){return this.momentNow().clone().subtract("days",e).format("YYYY.MM.DD")},e.prototype.formatCustomShortDate=function(e){var t=this.momentNow();if(e&&t)switch(!0){case 4>=t.diff(e,"hours"):return e.fromNow();case t.format("L")===e.format("L"):return a["default"].i18n("MESSAGE_LIST/TODAY_AT",{TIME:e.format("LT")});case t.clone().subtract("days",1).format("L")===e.format("L"):return a["default"].i18n("MESSAGE_LIST/YESTERDAY_AT",{TIME:e.format("LT")});case t.year()===e.year():return e.format("D MMM.")}return e?e.format("LL"):""},e.prototype.format=function(e,t){var i=null,o="",s=this.momentNowUnix();if(e=e>0?e:0===e?s:0,e=e>s?s:e,i=e>0?n.moment.unix(e):null,i&&1970===i.year()&&(i=null),i)switch(t){case"FROMNOW":o=i.fromNow();break;case"SHORT":o=this.formatCustomShortDate(i);break;case"FULL":o=i.format("LLL");break;default:o=i.format(t)}return o},e.prototype.momentToNode=function(e){var t="",i=0,o=(0,n.$)(e);i=o.data("moment-time"),i&&(t=o.data("moment-format"),t&&o.text(this.format(i,t)),t=o.data("moment-format-title"),t&&o.attr("title",this.format(i,t)))},e.prototype.momentToNodes=function(e){var t=this;n._.defer(function(){(0,n.$)(".moment",e).each(function(e,i){t.momentToNode(i)})})},e.prototype.reload=function(){this.momentToNodes(n.window.document)},e}();e.exports=new l},function(e,t,i){!function(){"use strict";function t(e){this.sModelName=e||"",this.disposables=[]}var o=i(3),s=i(1);t.prototype.regDisposables=function(e){s.isArray(e)?o.each(e,function(e){this.disposables.push(e)},this):e&&this.disposables.push(e)},t.prototype.onDestroy=function(){s.disposeObject(this)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.iAutoLogoutTimer=0,this.layout=s.observable(r.Layout.SidePreview).extend({limitedList:[r.Layout.SidePreview,r.Layout.BottomPreview,r.Layout.NoPreview]}),this.editorDefaultType=s.observable(r.EditorDefaultType.Html).extend({limitedList:[r.EditorDefaultType.Html,r.EditorDefaultType.Plain,r.EditorDefaultType.HtmlForced,r.EditorDefaultType.PlainForced]}),this.messagesPerPage=s.observable(n.MESSAGES_PER_PAGE).extend({limitedList:n.MESSAGES_PER_PAGE_VALUES}),this.showImages=s.observable(!1),this.useCheckboxesInList=s.observable(!0),this.useThreads=s.observable(!1),this.replySameFolder=s.observable(!1),this.autoLogout=s.observable(30),this.computers(),this.subscribers()}var o=i(11),s=i(2),n=i(17),r=i(4),a=i(8),l=i(1),c=i(25),u=i(9);t.prototype.computers=function(){this.usePreviewPane=s.computed(function(){return r.Layout.NoPreview!==this.layout()},this)},t.prototype.subscribers=function(){this.layout.subscribe(function(e){a.$html.toggleClass("rl-no-preview-pane",r.Layout.NoPreview===e),a.$html.toggleClass("rl-side-preview-pane",r.Layout.SidePreview===e),a.$html.toggleClass("rl-bottom-preview-pane",r.Layout.BottomPreview===e),a.$html.toggleClass("rl-mobile-layout",r.Layout.Mobile===e),c.pub("layout",[e])})},t.prototype.populate=function(){this.layout(l.pInt(u.settingsGet("Layout"))),this.editorDefaultType(u.settingsGet("EditorDefaultType")),this.autoLogout(l.pInt(u.settingsGet("AutoLogout"))),this.messagesPerPage(u.settingsGet("MPP")),this.showImages(!!u.settingsGet("ShowImages")),this.useCheckboxesInList(!!u.settingsGet("UseCheckboxesInList")),this.useThreads(!!u.settingsGet("UseThreads")),this.replySameFolder(!!u.settingsGet("ReplySameFolder"));var e=this;c.sub("rl.auto-logout-refresh",function(){o.clearTimeout(e.iAutoLogoutTimer),0<e.autoLogout()&&(e.iAutoLogoutTimer=o.setTimeout(function(){c.pub("rl.auto-logout")},1e3*e.autoLogout()*60))}),c.pub("rl.auto-logout-refresh")},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){L.call(this,"Popups","PopupsCompose");var e=this,n=function(e,t,i,o){if(t&&e&&t[i]()&&(o?!0:e[i]())){var n=t[i](),r=d.trim(e[i]()).split(/[,]/);r=s.filter(r,function(e){return e=d.trim(e),e&&d.trim(n)!==e}),o&&r.push(n),e[i](r.join(","))}};this.oLastMessage=null,this.oEditor=null,this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.sReferences="",this.sLastFocusedField="to",this.resizerTrigger=s.bind(this.resizerTrigger,this),this.allowContacts=!!S.contactsIsAllowed(),this.allowFolders=!!N.capa(c.Capa.Folders),this.bSkipNextHide=!1,this.composeInEdit=S.composeInEdit,this.editorDefaultType=v.editorDefaultType,this.capaOpenPGP=A.capaOpenPGP,this.identitiesDropdownTrigger=r.observable(!1),this.to=r.observable(""),this.to.focused=r.observable(!1),this.cc=r.observable(""),this.cc.focused=r.observable(!1),this.bcc=r.observable(""),this.bcc.focused=r.observable(!1),this.replyTo=r.observable(""),this.replyTo.focused=r.observable(!1),r.computed(function(){switch(!0){case this.to.focused():this.sLastFocusedField="to";break;case this.cc.focused():this.sLastFocusedField="cc";break;case this.bcc.focused():this.sLastFocusedField="bcc"}},this).extend({notify:"always"}),this.subject=r.observable(""),this.subject.focused=r.observable(!1),this.isHtml=r.observable(!1),this.requestDsn=r.observable(!1),this.requestReadReceipt=r.observable(!1),this.markAsImportant=r.observable(!1),this.sendError=r.observable(!1),this.sendSuccessButSaveError=r.observable(!1),this.savedError=r.observable(!1),this.sendButtonSuccess=r.computed(function(){return!this.sendError()&&!this.sendSuccessButSaveError()},this),this.sendErrorDesc=r.observable(""),this.savedErrorDesc=r.observable(""),this.sendError.subscribe(function(e){e||this.sendErrorDesc("")},this),this.savedError.subscribe(function(e){e||this.savedErrorDesc("")},this),this.sendSuccessButSaveError.subscribe(function(e){e||this.savedErrorDesc("")},this),this.savedTime=r.observable(0),this.savedTimeText=r.computed(function(){return 0<this.savedTime()?g.i18n("COMPOSE/SAVED_TIME",{TIME:b.format(this.savedTime()-1,"LT")}):""},this),this.emptyToError=r.observable(!1),this.emptyToErrorTooltip=r.computed(function(){return this.emptyToError()?g.i18n("COMPOSE/EMPTY_TO_ERROR_DESC"):""},this),this.attachmentsInProcessError=r.observable(!1),this.attachmentsInErrorError=r.observable(!1),this.attachmentsErrorTooltip=r.computed(function(){var e="";switch(!0){case this.attachmentsInProcessError():e=g.i18n("COMPOSE/ATTACHMENTS_UPLOAD_ERROR_DESC");break;case this.attachmentsInErrorError():e=g.i18n("COMPOSE/ATTACHMENTS_ERROR_DESC")}return e},this),this.showCc=r.observable(!1),this.showBcc=r.observable(!1),this.showReplyTo=r.observable(!1),this.cc.subscribe(function(t){!1===e.showCc()&&0<t.length&&e.showCc(!0)},this),this.bcc.subscribe(function(t){!1===e.showBcc()&&0<t.length&&e.showBcc(!0)},this),this.replyTo.subscribe(function(t){!1===e.showReplyTo()&&0<t.length&&e.showReplyTo(!0)},this),this.draftFolder=r.observable(""),this.draftUid=r.observable(""),this.sending=r.observable(!1),this.saving=r.observable(!1),this.attachments=r.observableArray([]),this.attachmentsInProcess=this.attachments.filter(function(e){return e&&!e.complete()}),this.attachmentsInReady=this.attachments.filter(function(e){return e&&e.complete()}),this.attachmentsInError=this.attachments.filter(function(e){return e&&""!==e.error()}),this.attachmentsCount=r.computed(function(){return this.attachments().length},this),this.attachmentsInErrorCount=r.computed(function(){return this.attachmentsInError().length},this),this.attachmentsInProcessCount=r.computed(function(){return this.attachmentsInProcess().length},this),this.isDraftFolderMessage=r.computed(function(){return""!==this.draftFolder()&&""!==this.draftUid()},this),this.attachmentsPlace=r.observable(!1),this.attachments.subscribe(this.resizerTrigger),this.attachmentsPlace.subscribe(this.resizerTrigger),this.attachmentsInErrorCount.subscribe(function(e){0===e&&this.attachmentsInErrorError(!1)},this),this.composeUploaderButton=r.observable(null),this.composeUploaderDropPlace=r.observable(null),this.dragAndDropEnabled=r.observable(!1),this.dragAndDropOver=r.observable(!1).extend({throttle:1}),this.dragAndDropVisible=r.observable(!1).extend({throttle:1}),this.attacheMultipleAllowed=r.observable(!1),this.addAttachmentEnabled=r.observable(!1),this.composeEditorArea=r.observable(null),this.identities=w.identities,this.identitiesOptions=r.computed(function(){return s.map(w.identities(),function(e){return{item:e,optValue:e.id(),optText:e.formattedName()}})},this),this.currentIdentity=r.observable(this.identities()[0]?this.identities()[0]:null),this.currentIdentity.extend({toggleSubscribe:[this,function(e){n(this,e,"bcc"),n(this,e,"replyTo")},function(e){n(this,e,"bcc",!0),n(this,e,"replyTo",!0)}]}),this.currentIdentityView=r.computed(function(){var e=this.currentIdentity();return e?e.formattedName():"unknown"},this),this.to.subscribe(function(e){this.emptyToError()&&0<e.length&&this.emptyToError(!1)},this),this.attachmentsInProcess.subscribe(function(e){this.attachmentsInProcessError()&&d.isArray(e)&&0===e.length&&this.attachmentsInProcessError(!1)},this),this.resizer=r.observable(!1).extend({throttle:50}),this.resizer.subscribe(s.bind(function(){this.oEditor&&this.oEditor.resize()},this)),this.canBeSentOrSaved=r.computed(function(){return!this.sending()&&!this.saving()},this),this.deleteCommand=d.createCommand(this,function(){i(7)["default"].deleteMessagesFromFolderWithoutCheck(this.draftFolder(),[this.draftUid()]),P.hideScreenPopup(t)},function(){return this.isDraftFolderMessage()}),this.sendMessageResponse=s.bind(this.sendMessageResponse,this),this.saveMessageResponse=s.bind(this.saveMessageResponse,this),this.sendCommand=d.createCommand(this,function(){var e=d.trim(this.to()),t=d.trim(this.cc()),o=d.trim(this.bcc()),s=T.sentFolder(),n=[];this.attachmentsInProcessError(!1),this.attachmentsInErrorError(!1),this.emptyToError(!1),0<this.attachmentsInProcess().length?(this.attachmentsInProcessError(!0),this.attachmentsPlace(!0)):0<this.attachmentsInError().length&&(this.attachmentsInErrorError(!0),this.attachmentsPlace(!0)),""===e&&""===t&&""===o&&this.emptyToError(!0),this.emptyToError()||this.attachmentsInErrorError()||this.attachmentsInProcessError()||(v.replySameFolder()&&d.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&d.isNormal(this.aDraftInfo[2])&&0<this.aDraftInfo[2].length&&(s=this.aDraftInfo[2]),this.allowFolders||(s=u.UNUSED_OPTION_VALUE),""===s?P.showScreenPopup(i(52),[c.SetSystemFoldersNotification.Sent]):(this.sendError(!1),this.sending(!0),d.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&(n=y.getMessageFlagsFromCache(this.aDraftInfo[2],this.aDraftInfo[1]),n&&("forward"===this.aDraftInfo[0]?n[3]=!0:n[2]=!0,y.setMessageFlagsToCache(this.aDraftInfo[2],this.aDraftInfo[1],n),i(7)["default"].reloadFlagsCurrentMessageListAndMessageFromCache(),y.setFolderHash(this.aDraftInfo[2],""))),s=u.UNUSED_OPTION_VALUE===s?"":s,y.setFolderHash(this.draftFolder(),""),y.setFolderHash(s,""),_.sendMessage(this.sendMessageResponse,this.currentIdentity()?this.currentIdentity().id():"",this.draftFolder(),this.draftUid(),s,e,this.cc(),this.bcc(),this.replyTo(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData(!0,!0):"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences,this.requestDsn(),this.requestReadReceipt(),this.markAsImportant())))},this.canBeSentOrSaved),this.saveCommand=d.createCommand(this,function(){return this.allowFolders?void(T.draftFolderNotEnabled()?P.showScreenPopup(i(52),[c.SetSystemFoldersNotification.Draft]):(this.savedError(!1),this.saving(!0),this.autosaveStart(),y.setFolderHash(T.draftFolder(),""),_.saveMessage(this.saveMessageResponse,this.currentIdentity()?this.currentIdentity().id():"",this.draftFolder(),this.draftUid(),T.draftFolder(),this.to(),this.cc(),this.bcc(),this.replyTo(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData(!0):"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences,this.markAsImportant()))):!1},this.canBeSentOrSaved),this.skipCommand=d.createCommand(this,function(){this.bSkipNextHide=!0,!this.modalVisibility()||this.saving()||this.sending()||T.draftFolderNotEnabled()||this.saveCommand(),this.tryToClosePopup()},this.canBeSentOrSaved),this.contactsCommand=d.createCommand(this,function(){
if(this.allowContacts){this.skipCommand();var e=this;s.delay(function(){P.showScreenPopup(i(62),[!0,e.sLastFocusedField])},200)}},function(){return this.allowContacts}),h.sub("interval.2m",function(){!this.modalVisibility()||T.draftFolderNotEnabled()||this.isEmptyForm(!1)||this.saving()||this.sending()||this.savedError()||this.saveCommand()},this),this.showCc.subscribe(this.resizerTrigger),this.showBcc.subscribe(this.resizerTrigger),this.showReplyTo.subscribe(this.resizerTrigger),this.dropboxEnabled=F.dropbox.enabled,this.dropboxApiKey=F.dropbox.apiKey,this.dropboxCommand=d.createCommand(this,function(){return o.Dropbox&&o.Dropbox.choose({success:function(t){t&&t[0]&&t[0].link&&e.addDropboxAttachment(t[0])},linkType:"direct",multiselect:!1}),!0},function(){return this.dropboxEnabled()}),this.driveEnabled=r.observable(p.bXMLHttpRequestSupported&&!!N.settingsGet("AllowGoogleSocial")&&!!N.settingsGet("AllowGoogleSocialDrive")&&!!N.settingsGet("GoogleClientID")&&!!N.settingsGet("GoogleApiKey")),this.driveVisible=r.observable(!1),this.driveCommand=d.createCommand(this,function(){return this.driveOpenPopup(),!0},function(){return this.driveEnabled()}),this.driveCallback=s.bind(this.driveCallback,this),this.onMessageUploadAttachments=s.bind(this.onMessageUploadAttachments,this),this.bDisabeCloseOnEsc=!0,this.sDefaultKeyScope=c.KeyState.Compose,this.tryToClosePopup=s.debounce(s.bind(this.tryToClosePopup,this),200),this.emailsSource=s.bind(this.emailsSource,this),this.autosaveFunction=s.bind(this.autosaveFunction,this),this.iTimer=0,P.constructorEnd(this)}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(36),l=i(80),c=i(4),u=i(17),d=i(1),p=i(8),h=i(25),f=i(12),m=i(45),g=i(6),b=i(26),y=i(19),S=i(24),v=i(28),w=i(53),C=i(31),T=i(21),A=i(33),E=i(32),F=i(34),N=i(9),_=i(15),R=i(102),P=i(5),L=i(10);P.extendAsViewModel(["View/Popup/Compose","PopupsComposeViewModel"],t),s.extend(t.prototype,L.prototype),t.prototype.autosaveFunction=function(){!this.modalVisibility()||T.draftFolderNotEnabled()||this.isEmptyForm(!1)||this.saving()||this.sending()||this.savedError()||this.saveCommand(),this.autosaveStart()},t.prototype.autosaveStart=function(){o.clearTimeout(this.iTimer),this.iTimer=o.setTimeout(this.autosaveFunction,6e4)},t.prototype.autosaveStop=function(){o.clearTimeout(this.iTimer)},t.prototype.emailsSource=function(e,t){i(7)["default"].getAutocomplete(e.term,function(e){t(s.map(e,function(e){return e.toLine(!1)}))})},t.prototype.openOpenPgpPopup=function(){if(A.capaOpenPGP()&&this.oEditor&&!this.oEditor.isHtml()){var e=this;P.showScreenPopup(i(145),[function(t){e.editor(function(e){e.setPlain(t)})},this.oEditor.getData(!1,!0),this.currentIdentity(),this.to(),this.cc(),this.bcc()])}},t.prototype.reloadDraftFolder=function(){var e=T.draftFolder();""!==e&&u.UNUSED_OPTION_VALUE!==e&&(y.setFolderHash(e,""),T.currentFolderFullNameRaw()===e?i(7)["default"].reloadMessageList(!0):i(7)["default"].folderInformation(e))},t.prototype.findIdentityByMessage=function(e,t){var i=w.identities(),o=1e3,n=null,r={},a=function(e){e&&e.email&&r[e.email]&&(!n||o>r[e.email][1])&&(n=r[e.email][0],o=r[e.email][1])};if(s.each(i,function(e,t){r[e.email()]=[e,t]}),t)switch(e){case c.ComposeType.Empty:break;case c.ComposeType.Reply:case c.ComposeType.ReplyAll:case c.ComposeType.Forward:case c.ComposeType.ForwardAsAttachment:s.each(s.union(t.to,t.cc,t.bcc),a),n||s.each(t.deliveredTo,a);break;case c.ComposeType.Draft:s.each(s.union(t.from,t.replyTo),a)}return n||i[0]||null},t.prototype.selectIdentity=function(e){e&&e.item&&(this.currentIdentity(e.item),this.setSignatureFromIdentity(e.item))},t.prototype.sendMessageResponse=function(e,t){var i=!1,o="";this.sending(!1),c.StorageResultType.Success===e&&t&&t.Result&&(i=!0,this.modalVisibility()&&d.delegateRun(this,"closeCommand")),this.modalVisibility()&&!i&&(t&&c.Notification.CantSaveMessage===t.ErrorCode?(this.sendSuccessButSaveError(!0),this.savedErrorDesc(d.trim(g.i18n("COMPOSE/SAVED_ERROR_ON_SEND")))):(o=g.getNotification(t&&t.ErrorCode?t.ErrorCode:c.Notification.CantSendMessage,t&&t.ErrorMessage?t.ErrorMessage:""),this.sendError(!0),this.sendErrorDesc(o||g.getNotification(c.Notification.CantSendMessage)))),this.reloadDraftFolder()},t.prototype.saveMessageResponse=function(e,t){var i=!1,s=null;this.saving(!1),c.StorageResultType.Success===e&&t&&t.Result&&t.Result.NewFolder&&t.Result.NewUid&&(i=!0,this.bFromDraft&&(s=E.message(),s&&this.draftFolder()===s.folderFullNameRaw&&this.draftUid()===s.uid&&E.message(null)),this.draftFolder(t.Result.NewFolder),this.draftUid(t.Result.NewUid),this.savedTime(o.Math.round((new o.Date).getTime()/1e3)),this.bFromDraft&&y.setFolderHash(this.draftFolder(),"")),i||(this.savedError(!0),this.savedErrorDesc(g.getNotification(c.Notification.CantSaveMessage))),this.reloadDraftFolder()},t.prototype.onHide=function(){this.autosaveStop(),this.bSkipNextHide||(S.composeInEdit(!1),this.reset()),this.bSkipNextHide=!1,this.to.focused(!1),P.routeOn()},t.prototype.editor=function(e){if(e){var t=this;!this.oEditor&&this.composeEditorArea()?t.oEditor=new m(t.composeEditorArea(),null,function(){e(t.oEditor),t.resizerTrigger()},function(e){t.isHtml(!!e)}):this.oEditor&&(e(this.oEditor),this.resizerTrigger())}},t.prototype.converSignature=function(e){var t=10,i=null,o=[],n=/{{MOMENT:([^}]+)}}/g,r="";if(e=e.replace(/[\r]/g,""),r=this.oLastMessage?this.emailArrayToStringLineHelper(this.oLastMessage.from,!0):"",""!==r&&(e=e.replace(/{{FROM-FULL}}/g,r),-1===r.indexOf(" ")&&0<r.indexOf("@")&&(r=r.replace(/@[\S]+/,"")),e=e.replace(/{{FROM}}/g,r)),e=e.replace(/[\s]{1,2}{{FROM}}/g,"{{FROM}}"),e=e.replace(/[\s]{1,2}{{FROM-FULL}}/g,"{{FROM-FULL}}"),e=e.replace(/{{FROM}}/g,""),e=e.replace(/{{FROM-FULL}}/g,""),-1<e.indexOf("{{DATE}}")&&(e=e.replace(/{{DATE}}/g,b.format(0,"llll"))),-1<e.indexOf("{{TIME}}")&&(e=e.replace(/{{TIME}}/g,b.format(0,"LT"))),-1<e.indexOf("{{MOMENT:"))try{for(;null!==(i=n.exec(e))&&(i&&i[0]&&i[1]&&o.push([i[0],i[1]]),t--,0!==t););o&&0<o.length&&s.each(o,function(t){e=e.replace(t[0],b.format(0,t[1]))}),e=e.replace(/{{MOMENT:[^}]+}}/g,"")}catch(a){}return e},t.prototype.setSignatureFromIdentity=function(e){if(e){var t=this;this.editor(function(i){var o=!1,s=e.signature();""!==s&&":HTML:"===s.substr(0,6)&&(o=!0,s=s.substr(6)),i.setSignature(t.converSignature(s),o,!!e.signatureInsertBefore())})}},t.prototype.onShow=function(e,t,o,s,n,r,a){if(P.routeOff(),this.autosaveStart(),S.composeInEdit()){e=e||c.ComposeType.Empty;var l=this;c.ComposeType.Empty!==e?P.showScreenPopup(i(43),[g.i18n("COMPOSE/DISCARD_UNSAVED_DATA"),function(){l.initOnShow(e,t,o,s,n,r,a)},null,null,null,!1]):(this.addEmailsTo(this.to,o),this.addEmailsTo(this.cc,s),this.addEmailsTo(this.bcc,n),d.isNormal(r)&&""!==r&&""===this.subject()&&this.subject(r))}else this.initOnShow(e,t,o,s,n,r,a)},t.prototype.addEmailsTo=function(e,t){var i=d.trim(e()),o=[];d.isNonEmptyArray(t)&&(o=s.uniq(s.compact(s.map(t,function(e){return e?e.toLine(!1):null}))),e(i+(""===i?"":", ")+d.trim(o.join(", "))))},t.prototype.emailArrayToStringLineHelper=function(e,t){for(var i=0,o=e.length,s=[];o>i;i++)s.push(e[i].toLine(!!t));return s.join(", ")},t.prototype.initOnShow=function(e,t,i,o,r,a,l){S.composeInEdit(!0);var u=this,p="",h="",f="",m="",y="",v=null,w="",T="",A=[],E={},F=null,N=C.email(),R=[],P=null,L=null,I=e||c.ComposeType.Empty;if(t=t||null,t&&d.isNormal(t)&&(L=d.isArray(t)&&1===t.length?t[0]:d.isArray(t)?null:t),this.oLastMessage=L,null!==N&&(E[N]=!0),this.reset(),F=this.findIdentityByMessage(I,L),F&&(E[F.email()]=!0),d.isNonEmptyArray(i)&&this.to(this.emailArrayToStringLineHelper(i)),d.isNonEmptyArray(o)&&this.cc(this.emailArrayToStringLineHelper(o)),d.isNonEmptyArray(r)&&this.bcc(this.emailArrayToStringLineHelper(r)),""!==I&&L){switch(m=b.format(L.dateTimeStampInUTC(),"FULL"),y=L.subject(),P=L.aDraftInfo,v=n(L.body).clone(),v&&(v.find("blockquote.rl-bq-switcher").removeClass("rl-bq-switcher hidden-bq"),v.find(".rlBlockquoteSwitcher").off(".rlBlockquoteSwitcher").remove(),v.find("[data-html-editor-font-wrapper]").removeAttr("data-html-editor-font-wrapper"),w=v.html()),I){case c.ComposeType.Empty:break;case c.ComposeType.Reply:this.to(this.emailArrayToStringLineHelper(L.replyEmails(E))),this.subject(d.replySubjectAdd("Re",y)),this.prepearMessageAttachments(L,I),this.aDraftInfo=["reply",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case c.ComposeType.ReplyAll:A=L.replyAllEmails(E),this.to(this.emailArrayToStringLineHelper(A[0])),this.cc(this.emailArrayToStringLineHelper(A[1])),this.subject(d.replySubjectAdd("Re",y)),this.prepearMessageAttachments(L,I),this.aDraftInfo=["reply",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.references());break;case c.ComposeType.Forward:this.subject(d.replySubjectAdd("Fwd",y)),this.prepearMessageAttachments(L,I),this.aDraftInfo=["forward",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case c.ComposeType.ForwardAsAttachment:this.subject(d.replySubjectAdd("Fwd",y)),this.prepearMessageAttachments(L,I),this.aDraftInfo=["forward",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case c.ComposeType.Draft:this.to(this.emailArrayToStringLineHelper(L.to)),this.cc(this.emailArrayToStringLineHelper(L.cc)),this.bcc(this.emailArrayToStringLineHelper(L.bcc)),this.replyTo(this.emailArrayToStringLineHelper(L.replyTo)),this.bFromDraft=!0,this.draftFolder(L.folderFullNameRaw),this.draftUid(L.uid),this.subject(y),this.prepearMessageAttachments(L,I),this.aDraftInfo=d.isNonEmptyArray(P)&&3===P.length?P:null,this.sInReplyTo=L.sInReplyTo,this.sReferences=L.sReferences;break;case c.ComposeType.EditAsNew:this.to(this.emailArrayToStringLineHelper(L.to)),this.cc(this.emailArrayToStringLineHelper(L.cc)),this.bcc(this.emailArrayToStringLineHelper(L.bcc)),this.replyTo(this.emailArrayToStringLineHelper(L.replyTo)),this.subject(y),this.prepearMessageAttachments(L,I),this.aDraftInfo=d.isNonEmptyArray(P)&&3===P.length?P:null,this.sInReplyTo=L.sInReplyTo,this.sReferences=L.sReferences}switch(I){case c.ComposeType.Reply:case c.ComposeType.ReplyAll:p=L.fromToLine(!1,!0),T=g.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATETIME:m,EMAIL:p}),w="<br /><br />"+T+":<blockquote>"+d.trim(w)+"</blockquote>";break;case c.ComposeType.Forward:p=L.fromToLine(!1,!0),h=L.toToLine(!1,!0),f=L.ccToLine(!1,!0),w="<br /><br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TITLE")+"<br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_FROM")+": "+p+"<br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TO")+": "+h+(0<f.length?"<br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_CC")+": "+f:"")+"<br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SENT")+": "+d.encodeHtml(m)+"<br />"+g.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SUBJECT")+": "+d.encodeHtml(y)+"<br /><br />"+d.trim(w)+"<br /><br />";break;case c.ComposeType.ForwardAsAttachment:w=""}this.editor(function(e){e.setHtml(w,!1),(c.EditorDefaultType.PlainForced===u.editorDefaultType()||!L.isHtml()&&c.EditorDefaultType.HtmlForced!==u.editorDefaultType())&&e.modeToggle(!1),F&&c.ComposeType.Draft!==I&&c.ComposeType.EditAsNew!==I&&u.setSignatureFromIdentity(F),u.setFocusInPopup()})}else c.ComposeType.Empty===I?(this.subject(d.isNormal(a)?""+a:""),w=d.isNormal(l)?""+l:"",this.editor(function(e){e.setHtml(w,!1),c.EditorDefaultType.Html!==u.editorDefaultType()&&c.EditorDefaultType.HtmlForced!==u.editorDefaultType()&&e.modeToggle(!1),F&&u.setSignatureFromIdentity(F),u.setFocusInPopup()})):d.isNonEmptyArray(t)?(s.each(t,function(e){u.addMessageAsAttachment(e)}),this.editor(function(e){e.setHtml("",!1),c.EditorDefaultType.Html!==u.editorDefaultType()&&c.EditorDefaultType.HtmlForced!==u.editorDefaultType()&&e.modeToggle(!1),F&&c.ComposeType.Draft!==I&&c.ComposeType.EditAsNew!==I&&u.setSignatureFromIdentity(F),u.setFocusInPopup()})):this.setFocusInPopup();R=this.getAttachmentsDownloadsForUpload(),d.isNonEmptyArray(R)&&_.messageUploadAttachments(this.onMessageUploadAttachments,R),F&&this.currentIdentity(F),this.resizerTrigger()},t.prototype.onMessageUploadAttachments=function(e,t){if(c.StorageResultType.Success===e&&t&&t.Result){var i=null,o="";if(!this.viewModelVisibility())for(o in t.Result)t.Result.hasOwnProperty(o)&&(i=this.getAttachmentById(t.Result[o]),i&&(i.tempName(o),i.waiting(!1).uploading(!1).complete(!0)))}else this.setMessageAttachmentFailedDownloadText()},t.prototype.setFocusInPopup=function(){if(!p.bMobileDevice){var e=this;s.delay(function(){""===e.to()?e.to.focused(!0):e.oEditor&&(e.to.focused()||e.oEditor.focus())},100)}},t.prototype.onShowWithDelay=function(){this.resizerTrigger()},t.prototype.tryToClosePopup=function(){var e=this,t=i(43);!P.isPopupVisible(t)&&this.modalVisibility()&&(this.bSkipNextHide||this.isEmptyForm()&&!this.draftUid()?d.delegateRun(e,"closeCommand"):P.showScreenPopup(t,[g.i18n("POPUPS_ASK/DESC_WANT_CLOSE_THIS_WINDOW"),function(){e.modalVisibility()&&d.delegateRun(e,"closeCommand")}]))},t.prototype.onBuild=function(){this.initUploader();var e=this,t=null;key("ctrl+q, command+q, ctrl+w, command+w",c.KeyState.Compose,function(){return!1}),key("`",c.KeyState.Compose,function(){return!e.oEditor||e.oEditor.hasFocus()||d.inFocus()?void 0:(e.identitiesDropdownTrigger(!0),!1)}),key("ctrl+`",c.KeyState.Compose,function(){return e.identitiesDropdownTrigger(!0),!1}),key("esc, ctrl+down, command+down",c.KeyState.Compose,function(){return e.skipCommand(),!1}),this.allowFolders&&key("ctrl+s, command+s",c.KeyState.Compose,function(){return e.saveCommand(),!1}),N.appSettingsGet("allowCtrlEnterOnCompose")&&key("ctrl+enter, command+enter",c.KeyState.Compose,function(){return e.sendCommand(),!1}),key("shift+esc",c.KeyState.Compose,function(){return e.modalVisibility()&&e.tryToClosePopup(),!1}),h.sub("window.resize.real",this.resizerTrigger),h.sub("window.resize.real",s.debounce(this.resizerTrigger,50)),this.dropboxEnabled()&&this.dropboxApiKey()&&!o.Dropbox&&(t=o.document.createElement("script"),t.type="text/javascript",t.src="https://www.dropbox.com/static/api/2/dropins.js",n(t).attr("id","dropboxjs").attr("data-app-key",e.dropboxApiKey()),o.document.body.appendChild(t)),this.driveEnabled()&&n.getScript("https://apis.google.com/js/api.js",function(){o.gapi&&e.driveVisible(!0)}),o.setInterval(function(){e.modalVisibility()&&e.oEditor&&e.oEditor.resize()},5e3)},t.prototype.driveCallback=function(e,t){if(t&&o.XMLHttpRequest&&o.google&&t[o.google.picker.Response.ACTION]===o.google.picker.Action.PICKED&&t[o.google.picker.Response.DOCUMENTS]&&t[o.google.picker.Response.DOCUMENTS][0]&&t[o.google.picker.Response.DOCUMENTS][0].id){var i=this,s=new o.XMLHttpRequest;s.open("GET","https://www.googleapis.com/drive/v2/files/"+t[o.google.picker.Response.DOCUMENTS][0].id),s.setRequestHeader("Authorization","Bearer "+e),s.addEventListener("load",function(){if(s&&s.responseText){var t=a.parse(s.responseText),o=function(e,t,i){e&&e.exportLinks&&(e.exportLinks[t]?(e.downloadUrl=e.exportLinks[t],e.title=e.title+"."+i,e.mimeType=t):e.exportLinks["application/pdf"]&&(e.downloadUrl=e.exportLinks["application/pdf"],e.title=e.title+".pdf",e.mimeType="application/pdf"))};if(t&&!t.downloadUrl&&t.mimeType&&t.exportLinks)switch(t.mimeType.toString().toLowerCase()){case"application/vnd.google-apps.document":o(t,"application/vnd.openxmlformats-officedocument.wordprocessingml.document","docx");break;case"application/vnd.google-apps.spreadsheet":o(t,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx");break;case"application/vnd.google-apps.drawing":o(t,"image/png","png");break;case"application/vnd.google-apps.presentation":o(t,"application/vnd.openxmlformats-officedocument.presentationml.presentation","pptx");break;default:o(t,"application/pdf","pdf")}t&&t.downloadUrl&&i.addDriveAttachment(t,e)}}),s.send()}},t.prototype.driveCreatePiker=function(e){if(o.gapi&&e&&e.access_token){var t=this;o.gapi.load("picker",{callback:function(){if(o.google&&o.google.picker){var i=(new o.google.picker.PickerBuilder).addView(o.google.picker.ViewId.DOCS).setAppId(N.settingsGet("GoogleClientID")).setOAuthToken(e.access_token).setCallback(s.bind(t.driveCallback,t,e.access_token)).enableFeature(o.google.picker.Feature.NAV_HIDDEN).build();i.setVisible(!0)}}})}},t.prototype.driveOpenPopup=function(){if(o.gapi){var e=this;o.gapi.load("auth",{callback:function(){var t=o.gapi.auth.getToken(),i=function(t){if(t&&!t.error){var i=o.gapi.auth.getToken();return i&&e.driveCreatePiker(i),!0}return!1};t?e.driveCreatePiker(t):o.gapi.auth.authorize({client_id:N.settingsGet("GoogleClientID"),scope:"https://www.googleapis.com/auth/drive.readonly",immediate:!0},function(e){i(e)||o.gapi.auth.authorize({client_id:N.settingsGet("GoogleClientID"),scope:"https://www.googleapis.com/auth/drive.readonly",immediate:!1},i)})}})}},t.prototype.getAttachmentById=function(e){for(var t=this.attachments(),i=0,o=t.length;o>i;i++)if(t[i]&&e===t[i].id)return t[i];return null},t.prototype.cancelAttachmentHelper=function(e,t){var i=this;return function(){var o=s.find(i.attachments(),function(t){return t&&t.id===e});o&&(i.attachments.remove(o),d.delegateRunOnDestroy(o),t&&t.cancel(e))}},t.prototype.initUploader=function(){if(this.composeUploaderButton()){var e={},t=d.pInt(N.settingsGet("AttachmentLimit")),i=new l({action:f.upload(),name:"uploader",queueSize:2,multipleSizeLimit:50,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace()});i?(i.on("onDragEnter",s.bind(function(){this.dragAndDropOver(!0)},this)).on("onDragLeave",s.bind(function(){this.dragAndDropOver(!1)},this)).on("onBodyDragEnter",s.bind(function(){this.attachmentsPlace(!0),this.dragAndDropVisible(!0)},this)).on("onBodyDragLeave",s.bind(function(){this.dragAndDropVisible(!1)},this)).on("onProgress",s.bind(function(t,i,s){var n=null;d.isUnd(e[t])?(n=this.getAttachmentById(t),n&&(e[t]=n)):n=e[t],n&&n.progress(o.Math.floor(i/s*100))},this)).on("onSelect",s.bind(function(e,o){this.dragAndDropOver(!1);var s=this,n=d.isUnd(o.FileName)?"":o.FileName.toString(),r=d.isNormal(o.Size)?d.pInt(o.Size):null,a=new R(e,n,r);return a.cancel=s.cancelAttachmentHelper(e,i),this.attachments.push(a),this.attachmentsPlace(!0),r>0&&t>0&&r>t?(a.waiting(!1).uploading(!0).complete(!0).error(g.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):!0},this)).on("onStart",s.bind(function(t){var i=null;d.isUnd(e[t])?(i=this.getAttachmentById(t),i&&(e[t]=i)):i=e[t],i&&i.waiting(!1).uploading(!0).complete(!1)},this)).on("onComplete",s.bind(function(t,i,o){var s="",n=null,r=null,a=this.getAttachmentById(t);r=i&&o&&o.Result&&o.Result.Attachment?o.Result.Attachment:null,n=o&&o.Result&&o.Result.ErrorCode?o.Result.ErrorCode:null,null!==n?s=g.getUploadErrorDescByCode(n):r||(s=g.i18n("UPLOAD/ERROR_UNKNOWN")),a&&(""!==s&&0<s.length?a.waiting(!1).uploading(!1).complete(!0).error(s):r&&(a.waiting(!1).uploading(!1).complete(!0),a.initByUploadJson(r)),d.isUnd(e[t])&&delete e[t])},this)),this.addAttachmentEnabled(!0).dragAndDropEnabled(i.isDragAndDropSupported())):this.addAttachmentEnabled(!1).dragAndDropEnabled(!1)}},t.prototype.prepearAttachmentsForSendOrSave=function(){var e={};return s.each(this.attachmentsInReady(),function(t){t&&""!==t.tempName()&&t.enabled()&&(e[t.tempName()]=[t.fileName(),t.isInline?"1":"0",t.CID,t.contentLocation])}),e},t.prototype.addMessageAsAttachment=function(e){if(e){var t=null,i=e.subject();i=".eml"===i.substr(-4).toLowerCase()?i:i+".eml",t=new R(e.requestHash,i,e.size()),t.fromMessage=!0,t.cancel=this.cancelAttachmentHelper(e.requestHash),t.waiting(!1).uploading(!0).complete(!0),this.attachments.push(t)}},t.prototype.addDropboxAttachment=function(e){var t=null,i=d.pInt(N.settingsGet("AttachmentLimit")),o=e.bytes;return t=new R(e.link,e.name,o),t.fromMessage=!1,t.cancel=this.cancelAttachmentHelper(e.link),t.waiting(!1).uploading(!0).complete(!1),this.attachments.push(t),this.attachmentsPlace(!0),o>0&&i>0&&o>i?(t.uploading(!1).complete(!0),t.error(g.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):(_.composeUploadExternals(function(e,i){var o=!1;t.uploading(!1).complete(!0),c.StorageResultType.Success===e&&i&&i.Result&&i.Result[t.id]&&(o=!0,t.tempName(i.Result[t.id])),o||t.error(g.getUploadErrorDescByCode(c.UploadErrorCode.FileNoUploaded))},[e.link]),!0)},t.prototype.addDriveAttachment=function(e,t){var i=d.pInt(N.settingsGet("AttachmentLimit")),o=null,s=e.fileSize?d.pInt(e.fileSize):0;return o=new R(e.downloadUrl,e.title,s),o.fromMessage=!1,o.cancel=this.cancelAttachmentHelper(e.downloadUrl),o.waiting(!1).uploading(!0).complete(!1),this.attachments.push(o),this.attachmentsPlace(!0),s>0&&i>0&&s>i?(o.uploading(!1).complete(!0),o.error(g.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):(_.composeUploadDrive(function(e,t){var i=!1;o.uploading(!1).complete(!0),c.StorageResultType.Success===e&&t&&t.Result&&t.Result[o.id]&&(i=!0,o.tempName(t.Result[o.id][0]),o.size(d.pInt(t.Result[o.id][1]))),i||o.error(g.getUploadErrorDescByCode(c.UploadErrorCode.FileNoUploaded))},e.downloadUrl,t),!0)},t.prototype.prepearMessageAttachments=function(e,t){if(e){var i=d.isNonEmptyArray(e.attachments())?e.attachments():[],o=0,s=i.length,n=null,r=null,a=!1;if(c.ComposeType.ForwardAsAttachment===t)this.addMessageAsAttachment(e);else for(;s>o;o++){switch(r=i[o],a=!1,t){case c.ComposeType.Reply:case c.ComposeType.ReplyAll:a=r.isLinked;break;case c.ComposeType.Forward:case c.ComposeType.Draft:case c.ComposeType.EditAsNew:a=!0}a&&(n=new R(r.download,r.fileName,r.estimatedSize,r.isInline,r.isLinked,r.cid,r.contentLocation),n.fromMessage=!0,n.cancel=this.cancelAttachmentHelper(r.download),n.waiting(!1).uploading(!0).complete(!1),this.attachments.push(n))}}},t.prototype.removeLinkedAttachments=function(){var e=s.find(this.attachments(),function(e){return e&&e.isLinked});e&&(this.attachments.remove(e),d.delegateRunOnDestroy(e))},t.prototype.setMessageAttachmentFailedDownloadText=function(){s.each(this.attachments(),function(e){e&&e.fromMessage&&e.waiting(!1).uploading(!1).complete(!0).error(g.getUploadErrorDescByCode(c.UploadErrorCode.FileNoUploaded))},this)},t.prototype.isEmptyForm=function(e){e=d.isUnd(e)?!0:!!e;var t=e?0===this.attachments().length:0===this.attachmentsInReady().length;return 0===this.to().length&&0===this.cc().length&&0===this.bcc().length&&0===this.replyTo().length&&0===this.subject().length&&t&&(!this.oEditor||""===this.oEditor.getData())},t.prototype.reset=function(){this.to(""),this.cc(""),this.bcc(""),this.replyTo(""),this.subject(""),this.requestDsn(!1),this.requestReadReceipt(!1),this.markAsImportant(!1),this.attachmentsPlace(!1),this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.sReferences="",this.sendError(!1),this.sendSuccessButSaveError(!1),this.savedError(!1),this.savedTime(0),this.emptyToError(!1),this.attachmentsInProcessError(!1),this.showCc(!1),this.showBcc(!1),this.showReplyTo(!1),d.delegateRunOnDestroy(this.attachments()),this.attachments([]),this.dragAndDropOver(!1),this.dragAndDropVisible(!1),this.draftFolder(""),this.draftUid(""),this.sending(!1),this.saving(!1),this.oEditor&&this.oEditor.clear(!1)},t.prototype.getAttachmentsDownloadsForUpload=function(){return s.map(s.filter(this.attachments(),function(e){return e&&""===e.tempName()}),function(e){return e.id})},t.prototype.resizerTrigger=function(){this.resizer(!this.resizer())},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t,i,o){this.email=e||"",this.name=t||"",this.dkimStatus=i||"none",this.dkimValue=o||"",this.clearDuplicateName()}var o=i(1);t.newInstanceFromJson=function(e){var i=new t;return i.initByJson(e)?i:null},t.splitHelper=function(e,t){t=t||";",e=e.replace(/[\r\n]+/g,"; ").replace(/[\s]+/g," ");for(var i=0,o=e.length,s=!1,n="",r="";o>i;i++){switch(n=e.charAt(i)){case"@":s=!0;break;case" ":s&&(s=!1,r+=t)}r+=n}return r.split(t)},t.prototype.name="",t.prototype.email="",t.prototype.dkimStatus="none",t.prototype.dkimValue="",t.prototype.clear=function(){this.email="",this.name="",this.dkimStatus="none",this.dkimValue=""},t.prototype.validate=function(){return""!==this.name||""!==this.email},t.prototype.hash=function(e){return"#"+(e?"":this.name)+"#"+this.email+"#"},t.prototype.clearDuplicateName=function(){this.name===this.email&&(this.name="")},t.prototype.search=function(e){return-1<(this.name+" "+this.email).toLowerCase().indexOf(e.toLowerCase())},t.prototype.parse=function(e){this.clear(),e=o.trim(e);var t=/(?:"([^"]+)")? ?[<]?(.*?@[^>,]+)>?,? ?/g,i=t.exec(e);i?(this.name=i[1]||"",this.email=i[2]||"",this.clearDuplicateName()):/^[^@]+@[^@]+$/.test(e)&&(this.name="",this.email=e)},t.prototype.initByJson=function(e){var t=!1;return e&&"Object/Email"===e["@Object"]&&(this.name=o.trim(e.Name),this.email=o.trim(e.Email),this.dkimStatus=o.trim(e.DkimStatus||""),this.dkimValue=o.trim(e.DkimValue||""),t=""!==this.email,this.clearDuplicateName()),t},t.prototype.toLine=function(e,t,i){var s="";return""!==this.email&&(t=o.isUnd(t)?!1:!!t,i=o.isUnd(i)?!1:!!i,e&&""!==this.name?s=t?'<a href="mailto:'+o.encodeHtml('"'+this.name+'" <'+this.email+">")+'" target="_blank" tabindex="-1">'+o.encodeHtml(this.name)+"</a>":i?o.encodeHtml(this.name):this.name:(s=this.email,""!==this.name?t?s=o.encodeHtml('"'+this.name+'" <')+'<a href="mailto:'+o.encodeHtml('"'+this.name+'" <'+this.email+">")+'" target="_blank" tabindex="-1">'+o.encodeHtml(s)+"</a>"+o.encodeHtml(">"):(s='"'+this.name+'" <'+s+">",i&&(s=o.encodeHtml(s))):t&&(s='<a href="mailto:'+o.encodeHtml(this.email)+'" target="_blank" tabindex="-1">'+o.encodeHtml(this.email)+"</a>"))),s},t.prototype.mailsoParse=function(e){if(e=o.trim(e),""===e)return!1;for(var t=function(e,t,i){e+="";var o=e.length;return 0>t&&(t+=o),o="undefined"==typeof i?o:0>i?i+o:i+t,t>=e.length||0>t||t>o?!1:e.slice(t,o)},i=function(e,t,i,o){return 0>i&&(i+=e.length),o=void 0!==o?o:e.length,0>o&&(o=o+e.length-i),e.slice(0,i)+t.substr(0,o)+t.slice(o)+e.slice(i+o)},s="",n="",r="",a=!1,l=!1,c=!1,u=null,d=0,p=0,h=0;h<e.length;){switch(e.substr(h,1)){case'"':a||l||c?l||c||(p=h,s=t(e,d+1,p-d-1),e=i(e,"",d,p-d+1),p=0,h=0,d=0,a=!1):(a=!0,d=h);break;case"<":a||l||c||(h>0&&0===s.length&&(s=t(e,0,h)),l=!0,d=h);break;case">":l&&(p=h,n=t(e,d+1,p-d-1),e=i(e,"",d,p-d+1),p=0,h=0,d=0,l=!1);break;case"(":a||l||c||(c=!0,d=h);break;case")":c&&(p=h,r=t(e,d+1,p-d-1),e=i(e,"",d,p-d+1),p=0,h=0,d=0,c=!1);break;case"\\":h++}h++}return 0===n.length&&(u=e.match(/[^@\s]+@\S+/i),u&&u[0]?n=u[0]:s=e),n.length>0&&0===s.length&&0===r.length&&(s=e.replace(n,"")),n=o.trim(n).replace(/^[<]+/,"").replace(/[>]+$/,""),s=o.trim(s).replace(/^["']+/,"").replace(/["']+$/,""),r=o.trim(r).replace(/^[(]+/,"").replace(/[)]+$/,""),s=s.replace(/\\\\(.)/g,"$1"),r=r.replace(/\\\\(.)/g,"$1"),this.name=s,this.email=n,this.clearDuplicateName(),!0},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.email=s.observable(""),this.parentEmail=s.observable(""),this.signature=s.observable(""),this.accounts=s.observableArray([]),this.accounts.loading=s.observable(!1).extend({throttle:100}),this.computers()}var o=i(3),s=i(2),n=i(9);t.prototype.computers=function(){this.accountsEmails=s.computed(function(){return o.compact(o.map(this.accounts(),function(e){return e?e.email:null}))},this),this.accountsUnreadCount=s.computed(function(){var e=0;return e},this)},t.prototype.populate=function(){this.email(n.settingsGet("Email")),this.parentEmail(n.settingsGet("ParentEmail"))},t.prototype.isRootAccount=function(){return""===this.parentEmail()},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.staticMessage=new v,this.messageList=s.observableArray([]).extend({rateLimit:0}),this.messageListCount=s.observable(0),this.messageListSearch=s.observable(""),this.messageListThreadUid=s.observable(""),this.messageListPage=s.observable(1),this.messageListPageBeforeThread=s.observable(1),this.messageListError=s.observable(""),this.messageListEndFolder=s.observable(""),this.messageListEndSearch=s.observable(""),this.messageListEndThreadUid=s.observable(""),this.messageListEndPage=s.observable(1),this.messageListLoading=s.observable(!1),this.messageListIsNotCompleted=s.observable(!1),this.messageListCompleteLoadingThrottle=s.observable(!1).extend({throttle:200}),this.messageListCompleteLoadingThrottleForAnimation=s.observable(!1).extend({specialThrottle:700}),this.messageListDisableAutoSelect=s.observable(!1).extend({falseTimeout:500}),this.selectorMessageSelected=s.observable(null),this.selectorMessageFocused=s.observable(null),this.message=s.observable(null),this.message.viewTrigger=s.observable(!1),this.messageError=s.observable(""),this.messageCurrentLoading=s.observable(!1),this.messageLoading=s.computed(function(){return this.messageCurrentLoading()},this),this.messageLoadingThrottle=s.observable(!1).extend({throttle:50}),this.messageFullScreenMode=s.observable(!1),this.messagesBodiesDom=s.observable(null),this.messageActiveDom=s.observable(null),this.computers(),this.subscribers(),this.onMessageResponse=o.bind(this.onMessageResponse,this),this.purgeMessageBodyCacheThrottle=o.throttle(this.purgeMessageBodyCache,3e4)}var o=i(3),s=i(2),n=i(11),r=i(14),a=i(5),l=i(4),c=i(17),u=i(8),d=i(1),p=i(12),h=i(6),f=i(19),m=i(24),g=i(21),b=i(33),y=i(28),S=i(15),v=i(108),w=i(85);t.prototype.computers=function(){var e=this;this.messageListEndHash=s.computed(function(){return this.messageListEndFolder()+"|"+this.messageListEndSearch()+"|"+this.messageListEndThreadUid()+"|"+this.messageListEndPage()},this),this.messageListPageCount=s.computed(function(){var e=n.Math.ceil(this.messageListCount()/y.messagesPerPage());return 0>=e?1:e},this),this.mainMessageListSearch=s.computed({read:this.messageListSearch,write:function(t){a.setHash(p.mailBox(g.currentFolderFullNameHash(),1,d.trim(t.toString()),e.messageListThreadUid()))},owner:this}),this.messageListCompleteLoading=s.computed(function(){var e=this.messageListLoading(),t=this.messageListIsNotCompleted();return e||t},this),this.isMessageSelected=s.computed(function(){return null!==this.message()},this),this.messageListChecked=s.computed(function(){return o.filter(this.messageList(),function(e){return e.checked()})},this).extend({rateLimit:0}),this.hasCheckedMessages=s.computed(function(){return 0<this.messageListChecked().length},this).extend({rateLimit:0}),this.messageListCheckedOrSelected=s.computed(function(){var e=this.messageListChecked(),t=this.selectorMessageSelected();return o.union(e,t?[t]:[])},this),this.messageListCheckedOrSelectedUidsWithSubMails=s.computed(function(){var e=[];return o.each(this.messageListCheckedOrSelected(),function(t){t&&(e.push(t.uid),1<t.threadsLen()&&(e=o.union(e,t.threads())))}),e},this)},t.prototype.subscribers=function(){this.messageListCompleteLoading.subscribe(function(e){e=!!e,this.messageListCompleteLoadingThrottle(e),this.messageListCompleteLoadingThrottleForAnimation(e)},this),this.messageList.subscribe(o.debounce(function(e){o.each(e,function(e){e&&e.newForAnimation()&&e.newForAnimation(!1)})},500)),this.message.subscribe(function(e){e?l.Layout.NoPreview===y.layout()&&m.focusedState(l.Focused.MessageView):(m.focusedState(l.Focused.MessageList),this.messageFullScreenMode(!1),this.hideMessageBodies())},this),this.messageLoading.subscribe(function(e){this.messageLoadingThrottle(e)},this),this.messagesBodiesDom.subscribe(function(e){!e||e instanceof r||this.messagesBodiesDom(r(e))},this),this.messageListEndFolder.subscribe(function(e){var t=this.message();t&&e&&e!==t.folderFullNameRaw&&this.message(null)},this)},t.prototype.purgeMessageBodyCache=function(){var e=0,t=null,i=u.iMessageBodyCacheCount-c.MESSAGE_BODY_CACHE_LIMIT;i>0&&(t=this.messagesBodiesDom(),t&&(t.find(".rl-cache-class").each(function(){var t=r(this);i>t.data("rl-cache-count")&&(t.addClass("rl-cache-purge"),e++)}),e>0&&o.delay(function(){t.find(".rl-cache-purge").remove()},300)))},t.prototype.initUidNextAndNewMessages=function(e,t,s){if(f.getFolderInboxName()===e&&d.isNormal(t)&&""!==t){
if(d.isArray(s)&&0<s.length){var n=0,r=s.length,a=i(60);if(o.each(s,function(t){f.addNewMessageCache(e,t.Uid)}),a.playSoundNotification(),r>3)a.displayDesktopNotification(p.notificationMailIcon(),i(31).email(),h.i18n("MESSAGE_LIST/NEW_MESSAGE_NOTIFICATION",{COUNT:r}),{Folder:"",Uid:""});else for(;r>n;n++)a.displayDesktopNotification(p.notificationMailIcon(),w.emailArrayToString(w.emailArrayFromJson(s[n].From),!1),s[n].Subject,{Folder:s[n].Folder,Uid:s[n].Uid})}f.setFolderUidNext(e,t)}},t.prototype.hideMessageBodies=function(){var e=this.messagesBodiesDom();e&&e.find(".b-text-part").hide()},t.prototype.removeMessagesFromList=function(e,t,i,s){i=d.isNormal(i)?i:"",s=d.isUnd(s)?!1:!!s,t=o.map(t,function(e){return d.pInt(e)});var n=this,r=0,l=null,c=g.trashFolder(),u=g.spamFolder(),h=this.messageList(),m=f.getFolderFromCacheList(e),b=""===i?null:f.getFolderFromCacheList(i||""),y=g.currentFolderFullNameRaw(),S=this.message(),v=y===e?o.filter(h,function(e){return e&&-1<d.inArray(d.pInt(e.uid),t)}):[];o.each(v,function(e){e&&e.unseen()&&r++}),m&&!s&&(m.messageCountAll(0<=m.messageCountAll()-t.length?m.messageCountAll()-t.length:0),r>0&&m.messageCountUnread(0<=m.messageCountUnread()-r?m.messageCountUnread()-r:0)),b&&(c!==b.fullNameRaw&&u!==b.fullNameRaw||(r=0),b.messageCountAll(b.messageCountAll()+t.length),r>0&&b.messageCountUnread(b.messageCountUnread()+r),b.actionBlink(!0)),0<v.length&&(s?o.each(v,function(e){e.checked(!1)}):(this.messageListIsNotCompleted(!0),o.each(v,function(e){S&&S.hash===e.hash&&(S=null,n.message(null)),e.deleted(!0)}),o.delay(function(){o.each(v,function(e){n.messageList.remove(e)})},400))),""!==e&&f.setFolderHash(e,""),""!==i&&f.setFolderHash(i,""),""!==this.messageListThreadUid()&&(h=this.messageList(),h&&0<h.length&&o.find(h,function(e){return!(!e||!e.deleted()||e.uid!==n.messageListThreadUid())})&&(l=o.find(h,function(e){return e&&!e.deleted()}),l&&this.messageListThreadUid()!==d.pString(l.uid)?(this.messageListThreadUid(d.pString(l.uid)),a.setHash(p.mailBox(g.currentFolderFullNameHash(),this.messageListPage(),this.messageListSearch(),this.messageListThreadUid()),!0,!0)):l||(1<this.messageListPage()?(this.messageListPage(this.messageListPage()-1),a.setHash(p.mailBox(g.currentFolderFullNameHash(),this.messageListPage(),this.messageListSearch(),this.messageListThreadUid()),!0,!0)):(this.messageListThreadUid(""),a.setHash(p.mailBox(g.currentFolderFullNameHash(),this.messageListPageBeforeThread(),this.messageListSearch()),!0,!0)))))},t.prototype.addBlockquoteSwitcherCallback=function(){var e=r(this);""!==d.trim(e.text())&&(e.addClass("rl-bq-switcher hidden-bq"),r('<span class="rlBlockquoteSwitcher"><i class="icon-ellipsis" /></span>').insertBefore(e).on("click.rlBlockquoteSwitcher",function(){e.toggleClass("hidden-bq"),d.windowResize()}).after("<br />").before("<br />"))},t.prototype.initBlockquoteSwitcher=function(e){if(e){var t=r("blockquote:not(.rl-bq-switcher)",e).filter(function(){return 0===r(this).parent().closest("blockquote",e).length});t&&0<t.length&&t.each(this.addBlockquoteSwitcherCallback)}},t.prototype.initOpenPgpControls=function(e,t){e&&e.find&&e.find(".b-plain-openpgp:not(.inited)").each(function(){b.initMessageBodyControls(r(this),t)})},t.prototype.setMessage=function(e,t){var s=!1,n=!1,a=!1,c=!1,p=null,h=null,m="",g="",b="",S=!1,w=!1,C=this.messagesBodiesDom(),T=this.selectorMessageSelected(),A=this.message(),E=[];e&&A&&e.Result&&"Object/Message"===e.Result["@Object"]&&A.folderFullNameRaw===e.Result.Folder&&(E=A.threads(),A.uid!==e.Result.Uid&&1<E.length&&-1<d.inArray(e.Result.Uid,E)&&(A=v.newInstanceFromJson(e.Result),A&&(A.threads(E),f.initMessageFlagsFromCache(A),this.message(this.staticMessage.populateByMessageListItem(A)),A=this.message(),s=!0)),A&&A.uid===e.Result.Uid&&(this.messageError(""),A.initUpdateByMessageJson(e.Result),f.addRequestedMessage(A.folderFullNameRaw,A.uid),t||A.initFlagsByJson(e.Result),C=C&&C[0]?C:null,C&&(m="rl-mgs-"+A.hash.replace(/[^a-zA-Z0-9]/g,""),h=C.find("#"+m),h&&h[0]?(A.body=h,A.body&&(A.body.data("rl-cache-count",++u.iMessageBodyCacheCount),A.fetchDataFromDom())):(a=!!e.Result.HasExternals,c=!!e.Result.HasInternals,d.isNormal(e.Result.Html)&&""!==e.Result.Html?(n=!0,b=e.Result.Html.toString()):d.isNormal(e.Result.Plain)&&""!==e.Result.Plain?(n=!1,b=d.plainToHtml(e.Result.Plain.toString(),!1),(A.isPgpSigned()||A.isPgpEncrypted())&&i(33).capaOpenPGP()?(g=d.pString(e.Result.Plain),w=/---BEGIN PGP MESSAGE---/.test(g),w||(S=/-----BEGIN PGP SIGNED MESSAGE-----/.test(g)&&/-----BEGIN PGP SIGNATURE-----/.test(g)),u.$div.empty(),b=S&&A.isPgpSigned()?u.$div.append(r('<pre class="b-plain-openpgp signed"></pre>').text(g)).html():w&&A.isPgpEncrypted()?u.$div.append(r('<pre class="b-plain-openpgp encrypted"></pre>').text(g)).html():"<pre>"+b+"</pre>",g="",u.$div.empty(),A.isPgpSigned(S),A.isPgpEncrypted(w)):b="<pre>"+b+"</pre>"):(n=!1,b="<pre>"+b+"</pre>"),p=r('<div id="'+m+'" ></div>').hide().addClass("rl-cache-class"),p.data("rl-cache-count",++u.iMessageBodyCacheCount),p.html(d.findEmailAndLinks(b)).addClass("b-text-part "+(n?"html":"plain")),A.isHtml(!!n),A.hasImages(!!a),A.body=p,A.body&&C.append(A.body),A.storeDataInDom(),c&&A.showInternalImages(!0),A.hasImages()&&y.showImages()&&A.showExternalImages(!0),this.purgeMessageBodyCacheThrottle()),this.messageActiveDom(A.body),this.hideMessageBodies(),p&&(this.initOpenPgpControls(p,A),this.initBlockquoteSwitcher(p)),A.body.show()),f.initMessageFlagsFromCache(A),(A.unseen()||A.hasUnseenSubMessage())&&i(7)["default"].messageListAction(A.folderFullNameRaw,A.uid,l.MessageSetAction.SetSeen,[A]),s&&(A=this.message(),T&&A&&(A.folderFullNameRaw!==T.folderFullNameRaw||A.uid!==T.uid)?(this.selectorMessageSelected(null),1===this.messageList().length&&this.selectorMessageFocused(null)):!T&&A&&(T=o.find(this.messageList(),function(e){return e&&e.folderFullNameRaw===A.folderFullNameRaw&&e.uid===A.uid}),T&&(this.selectorMessageSelected(T),this.selectorMessageFocused(T)))),d.windowResize()))},t.prototype.selectMessage=function(e){e?(this.message(this.staticMessage.populateByMessageListItem(e)),this.populateMessageBody(this.message())):this.message(null)},t.prototype.selectMessageByFolderAndUid=function(e,t){e&&t?(this.message(this.staticMessage.populateByMessageListItem(null)),this.message().folderFullNameRaw=e,this.message().uid=t,this.populateMessageBody(this.message())):this.message(null)},t.prototype.populateMessageBody=function(e){e&&S.message(this.onMessageResponse,e.folderFullNameRaw,e.uid)&&this.messageCurrentLoading(!0)},t.prototype.onMessageResponse=function(e,t,i){this.hideMessageBodies(),this.messageCurrentLoading(!1),l.StorageResultType.Success===e&&t&&t.Result?this.setMessage(t,i):l.StorageResultType.Unload===e?(this.message(null),this.messageError("")):l.StorageResultType.Abort!==e&&(this.message(null),this.messageError(t&&t.ErrorCode?h.getNotification(t.ErrorCode):h.getNotification(l.Notification.UnknownError)))},t.prototype.calculateMessageListHash=function(e){return o.map(e,function(e){return""+e.hash+"_"+e.threadsLen()+"_"+e.flagHash()}).join("|")},t.prototype.setMessageList=function(e,t){if(e&&e.Result&&"Collection/MessageCollection"===e.Result["@Object"]&&e.Result["@Collection"]&&d.isArray(e.Result["@Collection"])){var o=0,s=0,r=0,a=0,c=[],u=null,p=null,m=null,g=0,b=i(26).momentNowUnix(),S=!1;for(r=d.pInt(e.Result.MessageResultCount),a=d.pInt(e.Result.Offset),m=f.getFolderFromCacheList(d.isNormal(e.Result.Folder)?e.Result.Folder:""),m&&!t&&(m.interval=b,f.setFolderHash(e.Result.Folder,e.Result.FolderHash),d.isNormal(e.Result.MessageCount)&&m.messageCountAll(e.Result.MessageCount),d.isNormal(e.Result.MessageUnseenCount)&&(d.pInt(m.messageCountUnread())!==d.pInt(e.Result.MessageUnseenCount)&&(S=!0),m.messageCountUnread(e.Result.MessageUnseenCount)),this.initUidNextAndNewMessages(m.fullNameRaw,e.Result.UidNext,e.Result.NewMessages)),S&&m&&f.clearMessageFlagsFromCacheByFolder(m.fullNameRaw),o=0,s=e.Result["@Collection"].length;s>o;o++)u=e.Result["@Collection"][o],u&&"Object/Message"===u["@Object"]&&(p=v.newInstanceFromJson(u),p&&(f.hasNewMessageAndRemoveFromCache(p.folderFullNameRaw,p.uid)&&5>=g&&(g++,p.newForAnimation(!0)),p.deleted(!1),t?f.initMessageFlagsFromCache(p):f.storeMessageFlagsToCache(p),c.push(p)));this.messageListCount(r),this.messageListSearch(d.isNormal(e.Result.Search)?e.Result.Search:""),this.messageListPage(n.Math.ceil(a/y.messagesPerPage()+1)),this.messageListThreadUid(d.isNormal(e.Result.ThreadUid)?d.pString(e.Result.ThreadUid):""),this.messageListEndFolder(d.isNormal(e.Result.Folder)?e.Result.Folder:""),this.messageListEndSearch(this.messageListSearch()),this.messageListEndThreadUid(this.messageListThreadUid()),this.messageListEndPage(this.messageListPage()),this.messageListDisableAutoSelect(!0),this.messageList(c),this.messageListIsNotCompleted(!1),f.clearNewMessageCache(),m&&(t||S||y.useThreads())&&i(7)["default"].folderInformation(m.fullNameRaw,c)}else this.messageListCount(0),this.messageList([]),this.messageListError(h.getNotification(e&&e.ErrorCode?e.ErrorCode:l.Notification.CantGetMessageList))},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.capaOpenPGP=s.observable(!1),this.openpgp=null,this.openpgpkeys=s.observableArray([]),this.openpgpKeyring=null,this.openpgpkeysPublic=this.openpgpkeys.filter(function(e){return!(!e||e.isPrivate)}),this.openpgpkeysPrivate=this.openpgpkeys.filter(function(e){return!(!e||!e.isPrivate)})}var o=i(3),s=i(2),n=i(14),r=i(5),a=i(6),l=i(1);t.prototype.isSupported=function(){return!!this.openpgp},t.prototype.findKeyByHex=function(e,t){return o.find(e,function(e){return t&&e&&(t===e.id||-1<e.ids.indexOf(t))})},t.prototype.findPublicKeyByHex=function(e){return this.findKeyByHex(this.openpgpkeysPublic(),e)},t.prototype.findPrivateKeyByHex=function(e){return this.findKeyByHex(this.openpgpkeysPrivate(),e)},t.prototype.findPublicKeysByEmail=function(e){return o.compact(o.flatten(o.map(this.openpgpkeysPublic(),function(t){var i=t&&-1<t.emails.indexOf(e)?t:null;return i?i.getNativeKeys():[null]}),!0))},t.prototype.findPublicKeysBySigningKeyIds=function(e){var t=this;return o.compact(o.flatten(o.map(e,function(e){var i=e&&e.toHex?t.findPublicKeyByHex(e.toHex()):null;return i?i.getNativeKeys():[null]}),!0))},t.prototype.findPrivateKeysByEncryptionKeyIds=function(e,t,i){var s=this,n=[];return n=l.isArray(e)?o.compact(o.flatten(o.map(e,function(e){var t=e&&e.toHex?s.findPrivateKeyByHex(e.toHex()):null;return t?i?[t]:t.getNativeKeys():[null]}),!0)):[],0===n.length&&l.isNonEmptyArray(t)&&(n=o.uniq(o.compact(o.flatten(o.map(t,function(e){var t=e?s.findAllPrivateKeysByEmailNotNative(e):null;return t?i?t:o.flatten(o.map(t,function(e){return e.getNativeKeys()}),!0):[null]}),!0)),function(e){return e.id})),n},t.prototype.findPublicKeyByEmailNotNative=function(e){return o.find(this.openpgpkeysPublic(),function(t){return t&&-1<t.emails.indexOf(e)})||null},t.prototype.findPrivateKeyByEmailNotNative=function(e){return o.find(this.openpgpkeysPrivate(),function(t){return t&&-1<t.emails.indexOf(e)})||null},t.prototype.findAllPublicKeysByEmailNotNative=function(e){return o.filter(this.openpgpkeysPublic(),function(t){return t&&-1<t.emails.indexOf(e)})||null},t.prototype.findAllPrivateKeysByEmailNotNative=function(e){return o.filter(this.openpgpkeysPrivate(),function(t){return t&&-1<t.emails.indexOf(e)})||null},t.prototype.findPrivateKeyByEmail=function(e,t){var i=[],s=null,n=o.find(this.openpgpkeysPrivate(),function(t){return t&&-1<t.emails.indexOf(e)});if(n){i=n.getNativeKeys(),s=i[0]||null;try{s&&s.decrypt(l.pString(t))}catch(r){s=null}}return s},t.prototype.findSelfPrivateKey=function(e){return this.findPrivateKeyByEmail(i(31).email(),e)},t.prototype.decryptMessage=function(e,t,o){var s=this,n=[];return e&&e.getEncryptionKeyIds&&(n=this.findPrivateKeysByEncryptionKeyIds(e.getEncryptionKeyIds(),t,!0),n&&0<n.length)?(r.showScreenPopup(i(147),[function(t){t?e.decrypt(t).then(function(e){var i=null;e?(i=s.findPrivateKeyByHex(t.primaryKey.keyid.toHex()),i?s.verifyMessage(e,function(t,s){o(i,e,t||null,s||null)}):o(i,e)):o(i,e)},function(){o(null,null)}):o(null,null)},n]),!1):(o(null,null),!1)},t.prototype.verifyMessage=function(e,t){var i=null,s=[],n=[],r=[];if(e&&e.getSigningKeyIds&&(r=e.getSigningKeyIds(),r&&0<r.length)){if(n=this.findPublicKeysBySigningKeyIds(r),n&&0<n.length)try{if(s=e.verify(n),i=o.find(o.isArray(s)?s:[],function(e){return e&&e.valid&&e.keyid}),i&&i.keyid&&i.keyid&&i.keyid.toHex)return t(this.findPublicKeyByHex(i.keyid.toHex())),!0}catch(a){l.log(a)}return t(null,r),!1}return t(null),!1},t.prototype.controlsHelper=function(e,t,i,o,s){i?(e.removeClass("error").addClass("success").attr("title",o),t.removeClass("error").addClass("success").attr("title",o)):(e.removeClass("success").addClass("error").attr("title",o),t.removeClass("success").addClass("error").attr("title",o)),l.isUnd(s)||e.text(l.trim(s.replace(/(\u200C|\u0002)/g,"")))},t.domControlEncryptedClickHelper=function(e,t,i,s){return function(){var r=null,c=n(this);if(c.hasClass("success"))return!1;try{r=e.openpgp.message.readArmored(i)}catch(u){l.log(u)}return r&&r.getText&&r.verify&&r.decrypt?(e.decryptMessage(r,s,function(i,s,n,r){if(s)if(n)e.controlsHelper(t,c,!0,a.i18n("PGP_NOTIFICATIONS/GOOD_SIGNATURE",{USER:n.user+" ("+n.id+")"}),s.getText());else if(i){var u=l.isNonEmptyArray(r)?r:null,d=u?o.compact(o.map(u,function(e){return e&&e.toHex?e.toHex():null})).join(", "):"";e.controlsHelper(t,c,!1,a.i18n("PGP_NOTIFICATIONS/UNVERIFIRED_SIGNATURE")+(d?" ("+d+")":""),s.getText())}else e.controlsHelper(t,c,!1,a.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR"));else e.controlsHelper(t,c,!1,a.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR"))}),!1):(e.controlsHelper(t,c,!1,a.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR")),!1)}},t.domControlSignedClickHelper=function(e,t,i){return function(){var s=null,r=n(this);if(r.hasClass("success")||r.hasClass("error"))return!1;try{s=e.openpgp.cleartext.readArmored(i)}catch(c){l.log(c)}return s&&s.getText&&s.verify?(e.verifyMessage(s,function(i,n){if(i)e.controlsHelper(t,r,!0,a.i18n("PGP_NOTIFICATIONS/GOOD_SIGNATURE",{USER:i.user+" ("+i.id+")"}),s.getText());else{var c=l.isNonEmptyArray(n)?n:null,u=c?o.compact(o.map(c,function(e){return e&&e.toHex?e.toHex():null})).join(", "):"";e.controlsHelper(t,r,!1,a.i18n("PGP_NOTIFICATIONS/UNVERIFIRED_SIGNATURE")+(u?" ("+u+")":""))}}),!1):(e.controlsHelper(t,r,!1,a.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR")),!1)}},t.prototype.initMessageBodyControls=function(e,i){if(e&&!e.hasClass("inited")){e.addClass("inited");var o=e.hasClass("encrypted"),s=e.hasClass("signed"),r=null,l=i?i.getEmails(["from","to","cc"]):[],c="";(o||s)&&(c=e.text(),e.data("openpgp-original",c),o?r=n('<div class="b-openpgp-control"><i class="icon-lock"></i></div>').attr("title",a.i18n("MESSAGE/PGP_ENCRYPTED_MESSAGE_DESC")).on("click",t.domControlEncryptedClickHelper(this,e,c,l)):s&&(r=n('<div class="b-openpgp-control"><i class="icon-lock"></i></div>').attr("title",a.i18n("MESSAGE/PGP_SIGNED_MESSAGE_DESC")).on("click",t.domControlSignedClickHelper(this,e,c))),r&&e.before(r).before("<div></div>"))}},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.google={},this.twitter={},this.facebook={},this.dropbox={},this.google.enabled=o.observable(!1),this.google.clientID=o.observable(""),this.google.clientSecret=o.observable(""),this.google.apiKey=o.observable(""),this.google.loading=o.observable(!1),this.google.userName=o.observable(""),this.google.loggined=o.computed(function(){return""!==this.google.userName()},this),this.google.capa={},this.google.capa.auth=o.observable(!1),this.google.capa.authFast=o.observable(!1),this.google.capa.drive=o.observable(!1),this.google.capa.preview=o.observable(!1),this.google.require={},this.google.require.clientSettings=o.computed(function(){return this.google.enabled()&&(this.google.capa.auth()||this.google.capa.drive())},this),this.google.require.apiKeySettings=o.computed(function(){return this.google.enabled()&&this.google.capa.drive()},this),this.facebook.enabled=o.observable(!1),this.facebook.appID=o.observable(""),this.facebook.appSecret=o.observable(""),this.facebook.loading=o.observable(!1),this.facebook.userName=o.observable(""),this.facebook.supported=o.observable(!1),this.facebook.loggined=o.computed(function(){return""!==this.facebook.userName()},this),this.twitter.enabled=o.observable(!1),this.twitter.consumerKey=o.observable(""),this.twitter.consumerSecret=o.observable(""),this.twitter.loading=o.observable(!1),this.twitter.userName=o.observable(""),this.twitter.loggined=o.computed(function(){return""!==this.twitter.userName()},this),this.dropbox.enabled=o.observable(!1),this.dropbox.apiKey=o.observable("")}var o=i(2);t.prototype.google={},t.prototype.twitter={},t.prototype.facebook={},t.prototype.dropbox={},t.prototype.populate=function(){var e=i(9);this.google.enabled(!!e.settingsGet("AllowGoogleSocial")),this.google.clientID(e.settingsGet("GoogleClientID")),this.google.clientSecret(e.settingsGet("GoogleClientSecret")),this.google.apiKey(e.settingsGet("GoogleApiKey")),this.google.capa.auth(!!e.settingsGet("AllowGoogleSocialAuth")),this.google.capa.authFast(!!e.settingsGet("AllowGoogleSocialAuthFast")),this.google.capa.drive(!!e.settingsGet("AllowGoogleSocialDrive")),this.google.capa.preview(!!e.settingsGet("AllowGoogleSocialPreview")),this.facebook.enabled(!!e.settingsGet("AllowFacebookSocial")),this.facebook.appID(e.settingsGet("FacebookAppID")),this.facebook.appSecret(e.settingsGet("FacebookAppSecret")),this.facebook.supported(!!e.settingsGet("SupportedFacebookSocial")),this.twitter.enabled=o.observable(!!e.settingsGet("AllowTwitterSocial")),this.twitter.consumerKey=o.observable(e.settingsGet("TwitterConsumerKey")),this.twitter.consumerSecret=o.observable(e.settingsGet("TwitterConsumerSecret")),this.dropbox.enabled(!!e.settingsGet("AllowDropboxSocial")),this.dropbox.apiKey(e.settingsGet("DropboxApiKey"))},e.exports=new t}()},,function(e,t){e.exports=window.JSON},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0,t["default"]=t.AbstractInput=void 0;var a=i(2),l=o(a),c=i(1),u=o(c),d=i(4),p=i(16),h=function(e){function t(i){s(this,t);var o=n(this,e.call(this));return o.value=i.value||"",o.size=i.size||0,o.label=i.label||"",o.preLabel=i.preLabel||"",o.enable=u["default"].isUnd(i.enable)?!0:i.enable,o.trigger=i.trigger&&i.trigger.subscribe?i.trigger:null,o.placeholder=i.placeholder||"",o.labeled=!u["default"].isUnd(i.label),o.preLabeled=!u["default"].isUnd(i.preLabel),o.triggered=!u["default"].isUnd(i.trigger)&&!!o.trigger,o.classForTrigger=l["default"].observable(""),o.className=l["default"].computed(function(){var e=l["default"].unwrap(o.size),t=o.trigger?" "+u["default"].trim("settings-saved-trigger-input "+o.classForTrigger()):"";return(e>0?"span"+e:"")+t},o),!u["default"].isUnd(i.width)&&i.element&&i.element.find("input,select,textarea").css("width",i.width),o.disposable.push(o.className),o.trigger&&(o.setTriggerState(o.trigger()),o.disposable.push(o.trigger.subscribe(o.setTriggerState,o))),o}return r(t,e),t.prototype.setTriggerState=function(e){switch(u["default"].pInt(e)){case d.SaveSettingsStep.TrueResult:this.classForTrigger("success");break;case d.SaveSettingsStep.FalseResult:this.classForTrigger("error");break;default:this.classForTrigger("")}},t}(p.AbstractComponent);t.AbstractInput=h,t["default"]=h},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=i(16),a=i(46),l=function(e){function t(){return o(this,t),s(this,e.apply(this,arguments))}return n(t,e),t}(a.AbstracCheckbox);e.exports=(0,r.componentExportHelper)(l,"CheckboxComponent")},function(e,t,i){!function(){"use strict";function t(e,t){this.sScreenName=e,this.aViewModels=n.isArray(t)?t:[]}var o=i(3),s=i(49),n=i(1);t.prototype.oCross=null,t.prototype.sScreenName="",t.prototype.aViewModels=[],t.prototype.viewModels=function(){return this.aViewModels},t.prototype.screenName=function(){return this.sScreenName},t.prototype.routes=function(){return null},t.prototype.__cross=function(){return this.oCross},t.prototype.__start=function(){var e=this.routes(),t=null,i=null;n.isNonEmptyArray(e)&&(i=o.bind(this.onRoute||n.emptyFunction,this),t=s.create(),o.each(e,function(e){t.addRoute(e[0],i).rules=e[1]}),this.oCross=t)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.languages=o.observableArray([]),this.languagesAdmin=o.observableArray([]),this.language=o.observable("").extend({limitedList:this.languages}),this.languageAdmin=o.observable("").extend({limitedList:this.languagesAdmin}),this.userLanguage=o.observable(""),this.userLanguageAdmin=o.observable("")}var o=i(2),s=i(1),n=i(9);t.prototype.populate=function(){var e=n.appSettingsGet("languages"),t=n.appSettingsGet("languagesAdmin");this.languages(s.isArray(e)?e:[]),this.languagesAdmin(s.isArray(t)?t:[]),this.language(n.settingsGet("Language")),this.languageAdmin(n.settingsGet("LanguageAdmin")),this.userLanguage(n.settingsGet("UserLanguage")),this.userLanguageAdmin(n.settingsGet("UserLanguageAdmin"))},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){r.call(this)}var o=i(11),s=i(3),n=i(112),r=i(111);s.extend(t.prototype,r.prototype),t.prototype.foldersReload=function(e){return this.abort("Folders").postRequest("Folders",e).then(function(e){return n.foldersList(e.Result),n.foldersAdditionalParameters(e.Result),!0})},t.prototype._folders_timeout_=0,t.prototype.foldersReloadWithTimeout=function(e){this.setTrigger(e,!0);var t=this;o.clearTimeout(this._folders_timeout_),this._folders_timeout_=o.setTimeout(function(){t.foldersReload(e)},500)},t.prototype.folderDelete=function(e,t){return this.postRequest("FolderDelete",t,{Folder:e})},t.prototype.folderCreate=function(e,t,i){return this.postRequest("FolderCreate",i,{Folder:e,Parent:t})},t.prototype.folderRename=function(e,t,i){return this.postRequest("FolderRename",i,{Folder:e,NewFolderName:t})},t.prototype.attachmentsActions=function(e,t,i){return this.postRequest("AttachmentsActions",i,{Do:e,Hashes:t})},t.prototype.welcomeClose=function(){return this.postRequest("WelcomeClose")},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.themes=o.observableArray([]),this.themeBackgroundName=o.observable(""),this.themeBackgroundHash=o.observable(""),this.theme=o.observable("").extend({limitedList:this.themes})}var o=i(2),s=i(1),n=i(9);t.prototype.populate=function(){var e=n.appSettingsGet("themes");this.themes(s.isArray(e)?e:[]),this.theme(n.settingsGet("Theme")),this.themeBackgroundName(n.settingsGet("UserBackgroundName")),this.themeBackgroundHash(n.settingsGet("UserBackgroundHash"))},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){u.call(this,"Popups","PopupsAsk"),this.askDesc=s.observable(""),this.yesButton=s.observable(""),this.noButton=s.observable(""),this.yesFocus=s.observable(!1),this.noFocus=s.observable(!1),this.fYesAction=null,this.fNoAction=null,this.bFocusYesOnShow=!0,this.bDisabeCloseOnEsc=!0,this.sDefaultKeyScope=r.KeyState.PopupAsk,c.constructorEnd(this)}var o=i(3),s=i(2),n=i(18),r=i(4),a=i(1),l=i(6),c=i(5),u=i(10);c.extendAsViewModel(["View/Popup/Ask","PopupsAskViewModel"],t),o.extend(t.prototype,u.prototype),t.prototype.clearPopup=function(){this.askDesc(""),this.yesButton(l.i18n("POPUPS_ASK/BUTTON_YES")),this.noButton(l.i18n("POPUPS_ASK/BUTTON_NO")),this.yesFocus(!1),this.noFocus(!1),this.fYesAction=null,this.fNoAction=null},t.prototype.yesClick=function(){this.cancelCommand(),a.isFunc(this.fYesAction)&&this.fYesAction.call(null)},t.prototype.noClick=function(){this.cancelCommand(),a.isFunc(this.fNoAction)&&this.fNoAction.call(null)},t.prototype.onShow=function(e,t,i,o,s,n){this.clearPopup(),this.fYesAction=t||null,this.fNoAction=i||null,this.askDesc(e||""),o&&this.yesButton(o),o&&this.yesButton(s),this.bFocusYesOnShow=a.isUnd(n)?!0:!!n},t.prototype.onShowWithDelay=function(){this.bFocusYesOnShow&&this.yesFocus(!0)},t.prototype.onBuild=function(){n("tab, shift+tab, right, left",r.KeyState.PopupAsk,o.bind(function(){return this.yesFocus()?this.noFocus(!0):this.yesFocus(!0),!1},this)),n("esc",r.KeyState.PopupAsk,o.bind(function(){return this.noClick(),!1},this))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){a.call(this,"Popups","PopupsLanguages");var e=this;this.fLang=null,this.userLanguage=s.observable(""),this.langs=s.observableArray([]),this.languages=s.computed(function(){var t=e.userLanguage();return o.map(e.langs(),function(e){return{key:e,user:e===t,selected:s.observable(!1),fullName:n.convertLangName(e)}})}),this.langs.subscribe(function(){this.setLanguageSelection()},this),r.constructorEnd(this)}var o=i(3),s=i(2),n=i(1),r=i(5),a=i(10);r.extendAsViewModel(["View/Popup/Languages","PopupsLanguagesViewModel"],t),o.extend(t.prototype,a.prototype),t.prototype.languageTooltipName=function(e){var t=n.convertLangName(e,!0);return n.convertLangName(e,!1)===t?"":t},t.prototype.setLanguageSelection=function(){var e=this.fLang?s.unwrap(this.fLang):"";o.each(this.languages(),function(t){t.selected(t.key===e)})},t.prototype.onBeforeShow=function(){this.fLang=null,this.userLanguage(""),this.langs([])},t.prototype.onShow=function(e,t,i){this.fLang=e,this.userLanguage(i||""),this.langs(t)},t.prototype.changeLanguage=function(e){this.fLang&&this.fLang(e),this.cancelCommand()},e.exports=t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t["default"]=t.HtmlEditor=void 0;var n=i(13),r=i(8),a=o(r),l=i(9),c=o(l),u=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];s(this,e),this.editor=null,this.$element=null,this.blurTimer=0,this.onBlur=null,this.onReady=null,this.onModeChange=null,this.__inited=null,this.onBlur=i,this.onReady=o,this.onModeChange=r,this.$element=(0,n.$)(t),this.resize=n._.throttle(n._.bind(this.resize,this),100),this.__inited=!1,this.init()}return e.prototype.blurTrigger=function(){var e=this;this.onBlur&&(n.window.clearTimeout(this.blurTimer),this.blurTimer=n.window.setTimeout(function(){e.onBlur()},200))},e.prototype.focusTrigger=function(){this.onBlur&&n.window.clearTimeout(this.blurTimer)},e.prototype.isHtml=function(){return this.editor?"wysiwyg"===this.editor.mode:!1},e.prototype.setSignature=function(e,t,i){this.editor&&this.editor.execCommand("insertSignature",{isHtml:t,insertBefore:i,signature:e})},e.prototype.checkDirty=function(){return this.editor?this.editor.checkDirty():!1},e.prototype.resetDirty=function(){this.editor&&this.editor.resetDirty()},e.prototype.clearSignatureSigns=function(e){return e.replace(/(\u200C|\u0002)/g,"")},e.prototype.getData=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i="";if(this.editor){try{i="plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain?this.editor.__plain.getRawData():e?'<div data-html-editor-font-wrapper="true" style="font-family: arial, sans-serif; font-size: 13px;">'+this.editor.getData()+"</div>":this.editor.getData()}catch(o){}t&&(i=this.clearSignatureSigns(i))}return i},e.prototype.getDataWithHtmlMark=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return(this.isHtml()?":HTML:":"")+this.getData(e,t)},e.prototype.modeToggle=function(e,t){if(this.editor){try{e?"plain"===this.editor.mode&&this.editor.setMode("wysiwyg"):"wysiwyg"===this.editor.mode&&this.editor.setMode("plain")}catch(i){}t&&this.resize()}},e.prototype.setHtmlOrPlain=function(e,t){":HTML:"===e.substr(0,6)?this.setHtml(e.substr(6),t):this.setPlain(e,t)},e.prototype.setHtml=function(e,t){if(this.editor&&this.__inited){this.modeToggle(!0),e=e.replace(/<p[^>]*><\/p>/gi,"");try{this.editor.setData(e)}catch(i){}t&&this.focus()}},e.prototype.replaceHtml=function(e,t){if(this.editor&&this.__inited&&"wysiwyg"===this.editor.mode)try{this.editor.setData(this.editor.getData().replace(e,t))}catch(i){}},e.prototype.setPlain=function(e,t){if(this.editor&&this.__inited){if(this.modeToggle(!1),"plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain)this.editor.__plain.setRawData(e);else try{this.editor.setData(e)}catch(i){}t&&this.focus()}},e.prototype.init=function(){var e=this;if(this.$element&&this.$element[0]&&!this.editor){var t=function(){var t=a["default"].oHtmlEditorDefaultConfig,i=c["default"].settingsGet("Language"),o=!!c["default"].appSettingsGet("allowHtmlEditorSourceButton"),s=!!c["default"].appSettingsGet("allowHtmlEditorBitiButtons");!o&&s||t.toolbarGroups.__cfgInited||(t.toolbarGroups.__cfgInited=!0,o&&(t.removeButtons=t.removeButtons.replace(",Source","")),s||(t.removePlugins+=(t.removePlugins?",":"")+"bidi")),t.enterMode=n.window.CKEDITOR.ENTER_BR,t.shiftEnterMode=n.window.CKEDITOR.ENTER_P,t.language=a["default"].oHtmlEditorLangsMap[i]||"en",n.window.CKEDITOR.env&&(n.window.CKEDITOR.env.isCompatible=!0),e.editor=n.window.CKEDITOR.appendTo(e.$element[0],t),e.editor.on("key",function(e){return e&&e.data&&9===e.data.keyCode?!1:void 0}),e.editor.on("blur",function(){e.blurTrigger()}),e.editor.on("mode",function(){e.blurTrigger(),e.onModeChange&&e.onModeChange("plain"!==e.editor.mode)}),e.editor.on("focus",function(){e.focusTrigger()}),n.window.FileReader&&e.editor.on("drop",function(t){if(0<t.data.dataTransfer.getFilesCount()){var i=t.data.dataTransfer.getFile(0);if(i&&n.window.FileReader&&t.data.dataTransfer.id&&i.type&&i.type.match(/^image/i)){var o=t.data.dataTransfer.id,s="[img="+o+"]",r=new n.window.FileReader;r.onloadend=function(){r.result&&e.replaceHtml(s,'<img src="'+r.result+'" />')},r.readAsDataURL(i),t.data.dataTransfer.setData("text/html",s)}}}),e.editor.on("instanceReady",function(){e.editor.removeMenuItem&&(e.editor.removeMenuItem("cut"),e.editor.removeMenuItem("copy"),e.editor.removeMenuItem("paste")),e.__resizable=!0,e.__inited=!0,e.resize(),e.onReady&&e.onReady()})};n.window.CKEDITOR?t():n.window.__initEditor=t}},e.prototype.focus=function(){if(this.editor)try{this.editor.focus()}catch(e){}},e.prototype.hasFocus=function(){if(this.editor)try{return!!this.editor.focusManager.hasFocus}catch(e){}return!1},e.prototype.blur=function(){if(this.editor)try{this.editor.focusManager.blur(!0)}catch(e){}},e.prototype.resize=function(){if(this.editor&&this.__resizable)try{this.editor.resize(this.$element.width(),this.$element.innerHeight())}catch(e){}},e.prototype.setReadOnly=function(e){if(this.editor)try{this.editor.setReadOnly(!!e)}catch(t){}},e.prototype.clear=function(e){
this.setHtml("",e)},e}();t.HtmlEditor=u,t["default"]=u,e.exports=u},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0,t["default"]=t.AbstracCheckbox=void 0;var a=i(2),l=o(a),c=i(1),u=o(c),d=i(16),p=function(e){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];s(this,t);var o=n(this,e.call(this));return o.value=i.value,!u["default"].isUnd(o.value)&&o.value.subscribe||(o.value=l["default"].observable(u["default"].isUnd(o.value)?!1:!!o.value)),o.enable=i.enable,!u["default"].isUnd(o.enable)&&o.enable.subscribe||(o.enable=l["default"].observable(u["default"].isUnd(o.enable)?!0:!!o.enable)),o.disable=i.disable,!u["default"].isUnd(o.disable)&&o.disable.subscribe||(o.disable=l["default"].observable(u["default"].isUnd(o.disable)?!1:!!o.disable)),o.label=i.label||"",o.inline=u["default"].isUnd(i.inline)?!1:i.inline,o.readOnly=u["default"].isUnd(i.readOnly)?!1:!!i.readOnly,o.inverted=u["default"].isUnd(i.inverted)?!1:!!i.inverted,o.labeled=!u["default"].isUnd(i.label),o.labelAnimated=!!i.labelAnimated,o}return r(t,e),t.prototype.click=function(){this.readOnly||!this.enable()||this.disable()||this.value(!this.value())},t}(d.AbstractComponent);t.AbstracCheckbox=p,t["default"]=p},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(13),n=i(163),r=i(164),a=function(){function e(){o(this,e);var t=s._.find([r.LocalStorageDriver,n.CookieDriver],function(e){return e&&e.supported()});this.driver=t?new t:null}return e.prototype.set=function(e,t){return this.driver?this.driver.set("p"+e,t):!1},e.prototype.get=function(e){return this.driver?this.driver.get("p"+e):null},e}();e.exports=new a},function(e,t){e.exports=window.Q},function(e,t){e.exports=window.crossroads},,function(e,t,i){!function(){"use strict";function t(){this.contacts=o.observableArray([]),this.contacts.loading=o.observable(!1).extend({throttle:200}),this.contacts.importing=o.observable(!1).extend({throttle:200}),this.contacts.syncing=o.observable(!1).extend({throttle:200}),this.contacts.exportingVcf=o.observable(!1).extend({throttle:200}),this.contacts.exportingCsv=o.observable(!1).extend({throttle:200}),this.allowContactsSync=o.observable(!1),this.enableContactsSync=o.observable(!1),this.contactsSyncUrl=o.observable(""),this.contactsSyncUser=o.observable(""),this.contactsSyncPass=o.observable("")}var o=i(2),s=i(9);t.prototype.populate=function(){this.allowContactsSync(!!s.settingsGet("ContactsSyncIsAllowed")),this.enableContactsSync(!!s.settingsGet("EnableContactsSync")),this.contactsSyncUrl(s.settingsGet("ContactsSyncUrl")),this.contactsSyncUser(s.settingsGet("ContactsSyncUser")),this.contactsSyncPass(s.settingsGet("ContactsSyncPassword"))},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){h.call(this,"Popups","PopupsFolderSystem"),l.initOnStartOrLangChange(function(){this.sChooseOnText=l.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_CHOOSE_ONE"),this.sUnuseText=l.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_UNUSE_NAME")},this),this.notification=s.observable(""),this.folderSelectList=s.computed(function(){return a.folderListOptionsBuilder([],c.folderList(),c.folderListSystemNames(),[["",this.sChooseOnText],[r.UNUSED_OPTION_VALUE,this.sUnuseText]],null,null,null,null,null,!0)},this);var e=null,t=null;this.sentFolder=c.sentFolder,this.draftFolder=c.draftFolder,this.spamFolder=c.spamFolder,this.trashFolder=c.trashFolder,this.archiveFolder=c.archiveFolder,e=o.debounce(function(){u.settingsSet("SentFolder",c.sentFolder()),u.settingsSet("DraftFolder",c.draftFolder()),u.settingsSet("SpamFolder",c.spamFolder()),u.settingsSet("TrashFolder",c.trashFolder()),u.settingsSet("ArchiveFolder",c.archiveFolder()),d.saveSystemFolders(a.emptyFunction,{SentFolder:c.sentFolder(),DraftFolder:c.draftFolder(),SpamFolder:c.spamFolder(),TrashFolder:c.trashFolder(),ArchiveFolder:c.archiveFolder(),NullFolder:"NullFolder"})},1e3),t=function(){u.settingsSet("SentFolder",c.sentFolder()),u.settingsSet("DraftFolder",c.draftFolder()),u.settingsSet("SpamFolder",c.spamFolder()),u.settingsSet("TrashFolder",c.trashFolder()),u.settingsSet("ArchiveFolder",c.archiveFolder()),e()},c.sentFolder.subscribe(t),c.draftFolder.subscribe(t),c.spamFolder.subscribe(t),c.trashFolder.subscribe(t),c.archiveFolder.subscribe(t),this.defautOptionsAfterRender=a.defautOptionsAfterRender,p.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(17),a=i(1),l=i(6),c=i(21),u=i(9),d=i(15),p=i(5),h=i(10);p.extendAsViewModel(["View/Popup/FolderSystem","PopupsFolderSystemViewModel"],t),o.extend(t.prototype,h.prototype),t.prototype.sChooseOnText="",t.prototype.sUnuseText="",t.prototype.onShow=function(e){var t="";switch(e=a.isUnd(e)?n.SetSystemFoldersNotification.None:e){case n.SetSystemFoldersNotification.Sent:t=l.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SENT");break;case n.SetSystemFoldersNotification.Draft:t=l.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_DRAFTS");break;case n.SetSystemFoldersNotification.Spam:t=l.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SPAM");break;case n.SetSystemFoldersNotification.Trash:t=l.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_TRASH");break;case n.SetSystemFoldersNotification.Archive:t=l.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_ARCHIVE")}this.notification(t)},e.exports=t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(2),a=o(r),l=function c(){var e=this;s(this,c),this.identities=a["default"].observableArray([]),this.identities.loading=a["default"].observable(!1).extend({throttle:100}),this.identitiesIDS=a["default"].computed(function(){return n._.compact(n._.map(e.identities(),function(e){return e?e.id:null}))},this)};e.exports=new l},function(e,t,i){!function(){"use strict";var t=i(11),o=t.Opentip;o.styles.rainloop={"extends":"standard",fixed:!0,target:!0,delay:.2,hideDelay:0,hideEffect:"fade",hideEffectDuration:.2,showEffect:"fade",showEffectDuration:.2,showOn:"mouseover click",removeElementsOnHide:!0,background:"#fff",shadow:!1,borderColor:"#999",borderRadius:2,borderWidth:1},o.styles.rainloopTip={"extends":"rainloop",delay:.4,group:"rainloopTips"},o.styles.rainloopErrorTip={"extends":"rainloop",className:"rainloopErrorTip"},e.exports=o}()},function(e,t,i){!function(){"use strict";function t(){this.oRequests={}}var o=i(11),s=i(3),n=i(14),r=i(17),a=i(4),l=i(8),c=i(1),u=i(23),d=i(12),p=i(9);t.prototype.oRequests={},t.prototype.defaultResponse=function(e,t,i,o,n,d){var p=function(){a.StorageResultType.Success!==i&&l.bUnload&&(i=a.StorageResultType.Unload),a.StorageResultType.Success===i&&o&&!o.Result?(o&&-1<c.inArray(o.ErrorCode,[a.Notification.AuthError,a.Notification.AccessError,a.Notification.ConnectionError,a.Notification.DomainNotAllowed,a.Notification.AccountNotAllowed,a.Notification.MailServerError,a.Notification.UnknownNotification,a.Notification.UnknownError])&&l.iAjaxErrorCount++,o&&a.Notification.InvalidToken===o.ErrorCode&&l.iTokenErrorCount++,r.TOKEN_ERROR_LIMIT<l.iTokenErrorCount&&l.__APP__&&l.__APP__.loginAndLogoutReload&&l.__APP__.loginAndLogoutReload(!1,!0),(o.ClearAuth||o.Logout||r.AJAX_ERROR_LIMIT<l.iAjaxErrorCount)&&l.__APP__&&l.__APP__.clearClientSideToken&&(l.__APP__.clearClientSideToken(),!o.ClearAuth&&l.__APP__.loginAndLogoutReload&&l.__APP__.loginAndLogoutReload(!1,!0))):a.StorageResultType.Success===i&&o&&o.Result&&(l.iAjaxErrorCount=0,l.iTokenErrorCount=0),e&&(u.runHook("ajax-default-response",[t,a.StorageResultType.Success===i?o:null,i,n,d]),e(i,a.StorageResultType.Success===i?o:null,n,t,d))};switch(i){case"success":i=a.StorageResultType.Success;break;case"abort":i=a.StorageResultType.Abort;break;default:i=a.StorageResultType.Error}a.StorageResultType.Error===i?s.delay(p,300):p()},t.prototype.ajaxRequest=function(e,t,i,r,a){var l=this,u=""===r,h={},f=(new o.Date).getTime(),m=null,g="";return t=t||{},i=c.isNormal(i)?i:2e4,r=c.isUnd(r)?"":c.pString(r),a=c.isArray(a)?a:[],g=t.Action||"",g&&0<a.length&&s.each(a,function(e){l.oRequests[e]&&(l.oRequests[e].__aborted=!0,l.oRequests[e].abort&&l.oRequests[e].abort(),l.oRequests[e]=null)}),u&&(t.XToken=p.appSettingsGet("token")),m=n.ajax({type:u?"POST":"GET",url:d.ajax(r),async:!0,dataType:"json",data:u?t:{},headers:h,timeout:i,global:!0}),m.always(function(i,s){var n=!1;i&&i.Time&&(n=c.pInt(i.Time)>(new o.Date).getTime()-f),g&&l.oRequests[g]&&(l.oRequests[g].__aborted&&(s="abort"),l.oRequests[g]=null),l.defaultResponse(e,g,s,i,n,t)}),g&&0<a.length&&-1<c.inArray(g,a)&&(this.oRequests[g]&&(this.oRequests[g].__aborted=!0,this.oRequests[g].abort&&this.oRequests[g].abort(),this.oRequests[g]=null),this.oRequests[g]=m),m},t.prototype.defaultRequest=function(e,t,i,o,s,n){return i=i||{},i.Action=t,s=c.pString(s),u.runHook("ajax-default-request",[t,i,s]),this.ajaxRequest(e,i,c.isUnd(o)?r.DEFAULT_AJAX_TIMEOUT:c.pInt(o),s,n)},t.prototype.noop=function(e){this.defaultRequest(e,"Noop")},t.prototype.jsError=function(e,t,i,o,s,n,r){this.defaultRequest(e,"JsError",{Message:t,FileName:i,LineNo:o,Location:s,HtmlCapa:n,TimeOnPage:r})},t.prototype.jsInfo=function(e,t,i,o){this.defaultRequest(e,"JsInfo",{Type:t,Data:i,IsError:(c.isUnd(o)?1:!o)?"0":"1"})},t.prototype.getPublicKey=function(e){this.defaultRequest(e,"GetPublicKey")},t.prototype.jsVersion=function(e,t){this.defaultRequest(e,"Version",{Version:t})},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e){u.call(this,"settings",e),this.menu=n.observableArray([]),this.oCurrentSubScreen=null,this.oViewModelPlace=null,this.setupSettings()}var o=i(3),s=i(14),n=i(2),r=i(8),a=i(1),l=i(12),c=i(5),u=i(39);o.extend(t.prototype,u.prototype),t.prototype.setupSettings=function(e){e&&e()},t.prototype.onRoute=function(e){var t=this,i=null,u=null,d=null,p=null;u=o.find(r.aViewModels.settings,function(t){return t&&t.__rlSettingsData&&e===t.__rlSettingsData.Route}),u&&(o.find(r.aViewModels["settings-removed"],function(e){return e&&e===u})&&(u=null),u&&o.find(r.aViewModels["settings-disabled"],function(e){return e&&e===u})&&(u=null)),u?(u.__builded&&u.__vm?i=u.__vm:(d=this.oViewModelPlace,d&&1===d.length?(i=new u,p=s("<div></div>").addClass("rl-settings-view-model").hide(),p.appendTo(d),i.viewModelDom=p,i.__rlSettingsData=u.__rlSettingsData,u.__dom=p,u.__builded=!0,u.__vm=i,n.applyBindingAccessorsToNode(p[0],{translatorInit:!0,template:function(){return{name:u.__rlSettingsData.Template}}},i),a.delegateRun(i,"onBuild",[p])):a.log("Cannot find sub settings view model position: SettingsSubScreen")),i&&o.defer(function(){t.oCurrentSubScreen&&(a.delegateRun(t.oCurrentSubScreen,"onHide"),t.oCurrentSubScreen.viewModelDom.hide()),t.oCurrentSubScreen=i,t.oCurrentSubScreen&&(a.delegateRun(t.oCurrentSubScreen,"onBeforeShow"),t.oCurrentSubScreen.viewModelDom.show(),a.delegateRun(t.oCurrentSubScreen,"onShow"),a.delegateRun(t.oCurrentSubScreen,"onShowWithDelay",[],200),o.each(t.menu(),function(e){e.selected(i&&i.__rlSettingsData&&e.route===i.__rlSettingsData.Route)}),s("#rl-content .b-settings .b-content .content").scrollTop(0)),a.windowResize()})):c.setHash(l.settings(),!1,!0)},t.prototype.onHide=function(){this.oCurrentSubScreen&&this.oCurrentSubScreen.viewModelDom&&(a.delegateRun(this.oCurrentSubScreen,"onHide"),this.oCurrentSubScreen.viewModelDom.hide())},t.prototype.onBuild=function(){o.each(r.aViewModels.settings,function(e){e&&e.__rlSettingsData&&!o.find(r.aViewModels["settings-removed"],function(t){return t&&t===e})&&this.menu.push({route:e.__rlSettingsData.Route,label:e.__rlSettingsData.Label,selected:n.observable(!1),disabled:!!o.find(r.aViewModels["settings-disabled"],function(t){return t&&t===e})})},this),this.oViewModelPlace=s("#rl-content #rl-settings-subscreen")},t.prototype.routes=function(){var e=o.find(r.aViewModels.settings,function(e){return e&&e.__rlSettingsData&&e.__rlSettingsData.IsDefault}),t=e?e.__rlSettingsData.Route:"general",i={subname:/^(.*)$/,normalize_:function(e,i){return i.subname=a.isUnd(i.subname)?t:a.pString(i.subname),[i.subname]}};return[["{subname}/",i],["{subname}",i],["",i]]},e.exports=t}()},,,,function(e,t,i){!function(){"use strict";function t(){var e=this;this.enableSoundNotification=s.observable(!1),this.soundNotificationIsSupported=s.observable(!1),this.allowDesktopNotification=s.observable(!1),this.desktopNotificationPermissions=s.computed(function(){this.allowDesktopNotification();var e=this.notificationClass(),t=n.DesktopNotification.NotSupported;if(e&&e.permission)switch(e.permission.toLowerCase()){case"granted":t=n.DesktopNotification.Allowed;break;case"denied":t=n.DesktopNotification.Denied;break;case"default":t=n.DesktopNotification.NotAllowed}else o.webkitNotifications&&o.webkitNotifications.checkPermission&&(t=o.webkitNotifications.checkPermission());return t},this).extend({notify:"always"}),this.enableDesktopNotification=s.computed({owner:this,read:function(){return this.allowDesktopNotification()&&n.DesktopNotification.Allowed===this.desktopNotificationPermissions()},write:function(t){if(t){var i=this.notificationClass(),o=this.desktopNotificationPermissions();i&&n.DesktopNotification.Allowed===o?this.allowDesktopNotification(!0):i&&n.DesktopNotification.NotAllowed===o?i.requestPermission(function(){e.allowDesktopNotification.valueHasMutated(),n.DesktopNotification.Allowed===e.desktopNotificationPermissions()?e.allowDesktopNotification()?e.allowDesktopNotification.valueHasMutated():e.allowDesktopNotification(!0):e.allowDesktopNotification()?e.allowDesktopNotification(!1):e.allowDesktopNotification.valueHasMutated()}):this.allowDesktopNotification(!1)}else this.allowDesktopNotification(!1)}}).extend({notify:"always"}),this.enableDesktopNotification.valueHasMutated||(this.enableDesktopNotification.valueHasMutated=function(){e.allowDesktopNotification.valueHasMutated()}),this.computers(),this.initNotificationPlayer()}var o=i(11),s=i(2),n=i(4),r=i(25),a=i(65),l=i(9);t.prototype.computers=function(){this.isDesktopNotificationSupported=s.computed(function(){return n.DesktopNotification.NotSupported!==this.desktopNotificationPermissions()},this),this.isDesktopNotificationDenied=s.computed(function(){return n.DesktopNotification.NotSupported===this.desktopNotificationPermissions()||n.DesktopNotification.Denied===this.desktopNotificationPermissions()},this)},t.prototype.initNotificationPlayer=function(){a&&a.supportedNotification?this.soundNotificationIsSupported(!0):(this.enableSoundNotification(!1),this.soundNotificationIsSupported(!1))},t.prototype.playSoundNotification=function(e){a&&a.supportedNotification&&(e?!0:this.enableSoundNotification())&&a.playNotification()},t.prototype.displayDesktopNotification=function(e,t,i,s){if(this.enableDesktopNotification()){var n=this.notificationClass(),a=n?new n(t,{body:i,icon:e}):null;a&&(a.show&&a.show(),s&&(a.onclick=function(){o.focus(),s.Folder&&s.Uid&&r.pub("mailbox.message.show",[s.Folder,s.Uid])}),o.setTimeout(function(e){return function(){e.cancel?e.cancel():e.close&&e.close()}}(a),7e3))}},t.prototype.populate=function(){this.enableSoundNotification(!!l.settingsGet("SoundNotification")),this.enableDesktopNotification(!!l.settingsGet("DesktopNotifications"))},t.prototype.notificationClass=function(){return o.Notification&&o.Notification.requestPermission?o.Notification:null},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){u.call(this,"Popups","PopupsAccount"),this.isNew=s.observable(!0),this.email=s.observable(""),this.password=s.observable(""),this.emailError=s.observable(!1),this.passwordError=s.observable(!1),this.email.subscribe(function(){this.emailError(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.submitRequest=s.observable(!1),this.submitError=s.observable(""),this.submitErrorAdditional=s.observable(""),this.emailFocus=s.observable(!1),this.addAccountCommand=r.createCommand(this,function(){return this.emailError(""===r.trim(this.email())),this.passwordError(""===r.trim(this.password())),this.emailError()||this.passwordError()?!1:(this.submitRequest(!0),l.accountSetup(o.bind(function(e,t){this.submitRequest(!1),n.StorageResultType.Success===e&&t?t.Result?(i(7)["default"].accountsAndIdentities(),this.cancelCommand()):(this.submitError(t.ErrorCode?a.getNotification(t.ErrorCode):a.getNotification(n.Notification.UnknownError)),t.ErrorMessageAdditional&&this.submitErrorAdditional(t.ErrorMessageAdditional)):(this.submitError(a.getNotification(n.Notification.UnknownError)),this.submitErrorAdditional(""))},this),this.email(),this.password(),this.isNew()),!0)},function(){return!this.submitRequest()}),c.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(15),c=i(5),u=i(10);c.extendAsViewModel(["View/Popup/Account","View/Popup/AddAccount","PopupsAddAccountViewModel"],t),o.extend(t.prototype,u.prototype),t.prototype.clearPopup=function(){this.isNew(!0),this.email(""),this.password(""),this.emailError(!1),this.passwordError(!1),this.submitRequest(!1),this.submitError(""),this.submitErrorAdditional("")},t.prototype.onShow=function(e){this.clearPopup(),e&&e.canBeEdit()&&(this.isNew(!1),this.email(e.email))},t.prototype.onShowWithDelay=function(){this.emailFocus(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){T.call(this,"Popups","PopupsContacts");var e=this,t=function(t){t&&0<t.length&&(e.viewProperties.removeAll(t),d.delegateRunOnDestroy(t))};this.bBackToCompose=!1,this.sLastComposeFocusedField="",this.allowContactsSync=g.allowContactsSync,this.enableContactsSync=g.enableContactsSync,this.allowExport=!u.bMobileDevice,this.search=r.observable(""),this.contactsCount=r.observable(0),this.contacts=g.contacts,this.currentContact=r.observable(null),this.importUploaderButton=r.observable(null),this.contactsPage=r.observable(1),this.contactsPageCount=r.computed(function(){var e=o.Math.ceil(this.contactsCount()/c.CONTACTS_PER_PAGE);return 0>=e?1:e},this),this.contactsPagenator=r.computed(d.computedPagenatorHelper(this.contactsPage,this.contactsPageCount)),this.emptySelection=r.observable(!0),this.viewClearSearch=r.observable(!1),this.viewID=r.observable(""),this.viewReadOnly=r.observable(!1),this.viewProperties=r.observableArray([]),this.viewSaveTrigger=r.observable(l.SaveSettingsStep.Idle),this.viewPropertiesNames=this.viewProperties.filter(function(e){return-1<d.inArray(e.type(),[l.ContactPropertyType.FirstName,l.ContactPropertyType.LastName])}),this.viewPropertiesOther=this.viewProperties.filter(function(e){return-1<d.inArray(e.type(),[l.ContactPropertyType.Note])}),this.viewPropertiesOther=r.computed(function(){var e=s.filter(this.viewProperties(),function(e){return-1<d.inArray(e.type(),[l.ContactPropertyType.Nick])});return s.sortBy(e,function(e){return e.type()})},this),this.viewPropertiesEmails=this.viewProperties.filter(function(e){return l.ContactPropertyType.Email===e.type()}),this.viewPropertiesWeb=this.viewProperties.filter(function(e){return l.ContactPropertyType.Web===e.type()}),this.viewHasNonEmptyRequaredProperties=r.computed(function(){var e=this.viewPropertiesNames(),t=this.viewPropertiesEmails(),i=function(e){return""!==d.trim(e.value())};return!(!s.find(e,i)&&!s.find(t,i))},this),this.viewPropertiesPhones=this.viewProperties.filter(function(e){return l.ContactPropertyType.Phone===e.type()}),this.viewPropertiesEmailsNonEmpty=this.viewPropertiesNames.filter(function(e){return""!==d.trim(e.value())}),this.viewPropertiesEmailsEmptyAndOnFocused=this.viewPropertiesEmails.filter(function(e){var t=e.focused();return""===d.trim(e.value())&&!t}),this.viewPropertiesPhonesEmptyAndOnFocused=this.viewPropertiesPhones.filter(function(e){var t=e.focused();return""===d.trim(e.value())&&!t}),this.viewPropertiesWebEmptyAndOnFocused=this.viewPropertiesWeb.filter(function(e){var t=e.focused();return""===d.trim(e.value())&&!t}),this.viewPropertiesOtherEmptyAndOnFocused=r.computed(function(){return s.filter(this.viewPropertiesOther(),function(e){var t=e.focused();return""===d.trim(e.value())&&!t})},this),this.viewPropertiesEmailsEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesPhonesEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesWebEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesOtherEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewSaving=r.observable(!1),this.useCheckboxesInList=m.useCheckboxesInList,this.search.subscribe(function(){this.reloadContactList()},this),this.contacts.subscribe(d.windowResizeCallback),this.viewProperties.subscribe(d.windowResizeCallback),this.contactsChecked=r.computed(function(){return s.filter(this.contacts(),function(e){return e.checked()})},this),this.contactsCheckedOrSelected=r.computed(function(){var e=this.contactsChecked(),t=this.currentContact();return s.union(e,t?[t]:[])},this),this.contactsCheckedOrSelectedUids=r.computed(function(){return s.map(this.contactsCheckedOrSelected(),function(e){return e.idContact})},this),this.selector=new p(this.contacts,this.currentContact,null,".e-contact-item .actionHandle",".e-contact-item.selected",".e-contact-item .checkboxItem",".e-contact-item.focused"),this.selector.on("onItemSelect",s.bind(function(e){this.populateViewContact(e?e:null),e||this.emptySelection(!0)},this)),this.selector.on("onItemGetUid",function(e){return e?e.generateUid():""}),this.newCommand=d.createCommand(this,function(){this.populateViewContact(null),this.currentContact(null)}),this.deleteCommand=d.createCommand(this,function(){this.deleteSelectedContacts(),this.emptySelection(!0)},function(){return 0<this.contactsCheckedOrSelected().length}),this.newMessageCommand=d.createCommand(this,function(){if(!b.capa(l.Capa.Composer))return!1;var t=[],o=this.contactsCheckedOrSelected(),n=null,r=null,a=null;if(d.isNonEmptyArray(o)&&(t=s.map(o,function(e){if(e){var t=e.getNameAndEmailHelper(),i=t?new S(t[0],t[1]):null;if(i&&i.validate())return i}return null}),t=s.compact(t)),d.isNonEmptyArray(t)){switch(e.bBackToCompose=!1,C.hideScreenPopup(i(62)),e.sLastComposeFocusedField){default:case"to":n=t;break;case"cc":r=t;break;case"bcc":a=t}e.sLastComposeFocusedField="",s.delay(function(){C.showScreenPopup(i(29),[l.ComposeType.Empty,null,n,r,a])},200)}},function(){return 0<this.contactsCheckedOrSelected().length}),this.clearCommand=d.createCommand(this,function(){this.search("")}),this.saveCommand=d.createCommand(this,function(){this.viewSaving(!0),this.viewSaveTrigger(l.SaveSettingsStep.Animate);var t=d.fakeMd5(),i=[];s.each(this.viewProperties(),function(e){e.type()&&""!==d.trim(e.value())&&i.push([e.type(),e.value(),e.typeStr()])}),y.contactSave(function(i,o){var n=!1;e.viewSaving(!1),l.StorageResultType.Success===i&&o&&o.Result&&o.Result.RequestUid===t&&0<d.pInt(o.Result.ResultID)&&(""===e.viewID()&&e.viewID(d.pInt(o.Result.ResultID)),e.reloadContactList(),n=!0),s.delay(function(){e.viewSaveTrigger(n?l.SaveSettingsStep.TrueResult:l.SaveSettingsStep.FalseResult)},300),n&&(e.watchDirty(!1),s.delay(function(){e.viewSaveTrigger(l.SaveSettingsStep.Idle)},1e3))},t,this.viewID(),i)},function(){var e=this.viewHasNonEmptyRequaredProperties(),t=this.viewReadOnly();return!this.viewSaving()&&e&&!t}),this.syncCommand=d.createCommand(this,function(){var e=this;i(7)["default"].contactsSync(function(t,i){l.StorageResultType.Success===t&&i&&i.Result||o.alert(f.getNotification(i&&i.ErrorCode?i.ErrorCode:l.Notification.ContactsSyncError)),e.reloadContactList(!0)})},function(){return!this.contacts.syncing()&&!this.contacts.importing()}),this.bDropPageAfterDelete=!1,this.watchDirty=r.observable(!1),this.watchHash=r.observable(!1),this.viewHash=r.computed(function(){return""+s.map(e.viewProperties(),function(e){return e.value()}).join("")}),this.viewHash.subscribe(function(){!this.watchHash()||this.viewReadOnly()||this.watchDirty()||this.watchDirty(!0)},this),this.sDefaultKeyScope=l.KeyState.ContactList,C.constructorEnd(this)}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(18),l=i(4),c=i(17),u=i(8),d=i(1),p=i(100),h=i(12),f=i(6),m=i(28),g=i(51),b=i(9),y=i(15),S=i(30),v=i(103),w=i(104),C=i(5),T=i(10);C.extendAsViewModel(["View/Popup/Contacts","PopupsContactsViewModel"],t),s.extend(t.prototype,T.prototype),t.prototype.getPropertyPlaceholder=function(e){var t="";switch(e){case l.ContactPropertyType.LastName:t="CONTACTS/PLACEHOLDER_ENTER_LAST_NAME";break;case l.ContactPropertyType.FirstName:t="CONTACTS/PLACEHOLDER_ENTER_FIRST_NAME";break;case l.ContactPropertyType.Nick:t="CONTACTS/PLACEHOLDER_ENTER_NICK_NAME"}return t},t.prototype.addNewProperty=function(e,t){this.viewProperties.push(new w(e,t||"","",!0,this.getPropertyPlaceholder(e)))},t.prototype.addNewOrFocusProperty=function(e,t){var i=s.find(this.viewProperties(),function(t){return e===t.type()});i?i.focused(!0):this.addNewProperty(e,t)},t.prototype.addNewEmail=function(){this.addNewProperty(l.ContactPropertyType.Email,"Home")},t.prototype.addNewPhone=function(){this.addNewProperty(l.ContactPropertyType.Phone,"Mobile")},t.prototype.addNewWeb=function(){this.addNewProperty(l.ContactPropertyType.Web)},t.prototype.addNewNickname=function(){this.addNewOrFocusProperty(l.ContactPropertyType.Nick)},t.prototype.addNewNotes=function(){this.addNewOrFocusProperty(l.ContactPropertyType.Note)},t.prototype.addNewBirthday=function(){this.addNewOrFocusProperty(l.ContactPropertyType.Birthday)},t.prototype.exportVcf=function(){i(7)["default"].download(h.exportContactsVcf())},t.prototype.exportCsv=function(){i(7)["default"].download(h.exportContactsCsv())},t.prototype.initUploader=function(){if(this.importUploaderButton()){var e=new Jua({action:h.uploadContacts(),name:"uploader",queueSize:1,multipleSizeLimit:1,disableDragAndDrop:!0,disableMultiple:!0,disableDocumentDropPrevent:!0,clickElement:this.importUploaderButton()});e&&e.on("onStart",s.bind(function(){this.contacts.importing(!0)},this)).on("onComplete",s.bind(function(e,t,i){this.contacts.importing(!1),this.reloadContactList(),e&&t&&i&&i.Result||o.alert(f.i18n("CONTACTS/ERROR_IMPORT_FILE"))},this))}},t.prototype.removeCheckedOrSelectedContactsFromList=function(){var e=this,t=this.contacts,i=this.currentContact(),o=this.contacts().length,n=this.contactsCheckedOrSelected();0<n.length&&(s.each(n,function(t){i&&i.idContact===t.idContact&&(i=null,e.currentContact(null)),t.deleted(!0),o--}),0>=o&&(this.bDropPageAfterDelete=!0),s.delay(function(){s.each(n,function(e){t.remove(e),d.delegateRunOnDestroy(e)})},500))},t.prototype.deleteSelectedContacts=function(){0<this.contactsCheckedOrSelected().length&&(y.contactsDelete(s.bind(this.deleteResponse,this),this.contactsCheckedOrSelectedUids()),this.removeCheckedOrSelectedContactsFromList())},t.prototype.deleteResponse=function(e,t){500<(l.StorageResultType.Success===e&&t&&t.Time?d.pInt(t.Time):0)?this.reloadContactList(this.bDropPageAfterDelete):s.delay(function(e){return function(){e.reloadContactList(e.bDropPageAfterDelete)}}(this),500)},t.prototype.removeProperty=function(e){this.viewProperties.remove(e),d.delegateRunOnDestroy(e)},t.prototype.populateViewContact=function(e){var t="",i="",o="",n=[];this.watchHash(!1),this.emptySelection(!1),this.viewReadOnly(!1),e&&(t=e.idContact,d.isNonEmptyArray(e.properties)&&s.each(e.properties,function(e){e&&e[0]&&(l.ContactPropertyType.LastName===e[0]?i=e[1]:l.ContactPropertyType.FirstName===e[0]?o=e[1]:n.push(new w(e[0],e[2]||"",e[1])))}),this.viewReadOnly(!!e.readOnly)),n.unshift(new w(l.ContactPropertyType.LastName,"",i,!1,this.getPropertyPlaceholder(l.ContactPropertyType.LastName))),n.unshift(new w(l.ContactPropertyType.FirstName,"",o,!e,this.getPropertyPlaceholder(l.ContactPropertyType.FirstName))),this.viewID(t),d.delegateRunOnDestroy(this.viewProperties()),this.viewProperties([]),this.viewProperties(n),this.watchDirty(!1),this.watchHash(!0)},t.prototype.reloadContactList=function(e){var t=this,i=(this.contactsPage()-1)*c.CONTACTS_PER_PAGE;this.bDropPageAfterDelete=!1,(d.isUnd(e)?1:!e)||(this.contactsPage(1),i=0),this.contacts.loading(!0),y.contacts(function(e,i){var o=0,n=[];l.StorageResultType.Success===e&&i&&i.Result&&i.Result.List&&d.isNonEmptyArray(i.Result.List)&&(n=s.map(i.Result.List,function(e){var t=new v;return t.parse(e)?t:null}),n=s.compact(n),o=d.pInt(i.Result.Count),o=o>0?o:0),t.contactsCount(o),d.delegateRunOnDestroy(t.contacts()),t.contacts(n),t.contacts.loading(!1),t.viewClearSearch(""!==t.search())},i,c.CONTACTS_PER_PAGE,this.search())},t.prototype.onBuild=function(e){this.oContentVisible=n(".b-list-content",e),this.oContentScrollable=n(".content",this.oContentVisible),this.selector.init(this.oContentVisible,this.oContentScrollable,l.KeyState.ContactList);var t=this;a("delete",l.KeyState.ContactList,function(){return t.deleteCommand(),!1}),a("c, w",l.KeyState.ContactList,function(){return t.newMessageCommand(),!1}),e.on("click",".e-pagenator .e-page",function(){var e=r.dataFor(this);e&&(t.contactsPage(d.pInt(e.value)),t.reloadContactList())}),this.initUploader()},t.prototype.onShow=function(e,t){this.bBackToCompose=d.isUnd(e)?!1:!!e,this.sLastComposeFocusedField=d.isUnd(t)?"":t,C.routeOff(),this.reloadContactList(!0)},t.prototype.onHide=function(){C.routeOn(),this.currentContact(null),this.emptySelection(!0),this.search(""),this.contactsCount(0),d.delegateRunOnDestroy(this.contacts()),this.contacts([]),this.sLastComposeFocusedField="",this.bBackToCompose&&(this.bBackToCompose=!1,b.capa(l.Capa.Composer)&&C.showScreenPopup(i(29)))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){d.call(this,"Popups","PopupsIdentity");var e=this;this.id="",this.edit=s.observable(!1),this.owner=s.observable(!1),this.email=s.observable("").validateEmail(),this.email.focused=s.observable(!1),this.name=s.observable(""),this.name.focused=s.observable(!1),this.replyTo=s.observable("").validateSimpleEmail(),this.replyTo.focused=s.observable(!1),this.bcc=s.observable("").validateSimpleEmail(),this.bcc.focused=s.observable(!1),this.signature=s.observable(""),this.signatureInsertBefore=s.observable(!1),this.showBcc=s.observable(!1),this.showReplyTo=s.observable(!1),this.submitRequest=s.observable(!1),this.submitError=s.observable(""),this.bcc.subscribe(function(t){!1===e.showBcc()&&0<t.length&&e.showBcc(!0)},this),this.replyTo.subscribe(function(t){!1===e.showReplyTo()&&0<t.length&&e.showReplyTo(!0)},this),this.addOrEditIdentityCommand=a.createCommand(this,function(){return this.signature&&this.signature.__fetchEditorValue&&this.signature.__fetchEditorValue(),this.email.hasError()||this.email.hasError(""===a.trim(this.email())),this.email.hasError()?(this.owner()||this.email.focused(!0),!1):this.replyTo.hasError()?(this.replyTo.focused(!0),!1):this.bcc.hasError()?(this.bcc.focused(!0),!1):(this.submitRequest(!0),c.identityUpdate(o.bind(function(e,t){this.submitRequest(!1),n.StorageResultType.Success===e&&t?t.Result?(i(7)["default"].accountsAndIdentities(),this.cancelCommand()):t.ErrorCode&&this.submitError(l.getNotification(t.ErrorCode)):this.submitError(l.getNotification(n.Notification.UnknownError))},this),this.id,this.email(),this.name(),this.replyTo(),this.bcc(),this.signature(),this.signatureInsertBefore()),!0)},function(){return!this.submitRequest()}),u.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(8),a=i(1),l=i(6),c=i(15),u=i(5),d=i(10);u.extendAsViewModel(["View/Popup/Identity","PopupsIdentityViewModel"],t),o.extend(t.prototype,d.prototype),t.prototype.clearPopup=function(){this.id="",this.edit(!1),this.owner(!1),
this.name(""),this.email(""),this.replyTo(""),this.bcc(""),this.signature(""),this.signatureInsertBefore(!1),this.email.hasError(!1),this.replyTo.hasError(!1),this.bcc.hasError(!1),this.showBcc(!1),this.showReplyTo(!1),this.submitRequest(!1),this.submitError("")},t.prototype.onShow=function(e){this.clearPopup(),e?(this.edit(!0),this.id=e.id()||"",this.name(e.name()),this.email(e.email()),this.replyTo(e.replyTo()),this.bcc(e.bcc()),this.signature(e.signature()),this.signatureInsertBefore(e.signatureInsertBefore()),this.owner(""===this.id)):this.id=a.fakeMd5()},t.prototype.onShowWithDelay=function(){this.owner()||r.bMobile||this.email.focused(!0)},t.prototype.onHideWithDelay=function(){this.clearPopup()},e.exports=t}()},function(e,t,i){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function s(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0,t["default"]=t.AbstractApp=void 0;var l=i(13),c=i(8),u=s(c),d=i(4),p=o(d),h=i(1),f=s(h),m=i(12),g=s(m),b=i(25),y=s(b),S=i(6),v=s(S),w=i(9),C=s(w),T=i(75),A=function(e){function t(i){n(this,t);var o=r(this,e.call(this));return o.googlePreviewSupportedCache=null,o.isLocalAutocomplete=!0,o.iframe=null,o.iframe=(0,l.$)('<iframe style="display:none" src="javascript:;" />').appendTo("body"),u["default"].$win.on("error",function(e){e&&e.originalEvent&&e.originalEvent.message&&-1===f["default"].inArray(e.originalEvent.message,["Script error.","Uncaught Error: Error calling method on NPObject."])&&i.jsError(f["default"].emptyFunction,e.originalEvent.message,e.originalEvent.filename,e.originalEvent.lineno,l.window.location&&l.window.location.toString?l.window.location.toString():"",u["default"].$html.attr("class"),f["default"].microtime()-u["default"].startMicrotime)}),u["default"].$win.on("resize",function(){y["default"].pub("window.resize")}),y["default"].sub("window.resize",l._.throttle(function(){var e=u["default"].$win.height(),t=u["default"].$win.height();u["default"].$win.__sizes[0]===e&&u["default"].$win.__sizes[1]===t||(u["default"].$win.__sizes[0]=e,u["default"].$win.__sizes[1]=t,y["default"].pub("window.resize.real"))},50)),u["default"].$doc.on("keydown",function(e){e&&e.ctrlKey&&u["default"].$html.addClass("rl-ctrl-key-pressed")}).on("keyup",function(e){e&&!e.ctrlKey&&u["default"].$html.removeClass("rl-ctrl-key-pressed")}),u["default"].$doc.on("mousemove keypress click",l._.debounce(function(){y["default"].pub("rl.auto-logout-refresh")},5e3)),(0,l.key)("esc, enter",p.KeyState.All,l._.bind(function(){f["default"].detectDropdownVisibility()},o)),o}return a(t,e),t.prototype.remote=function(){return null},t.prototype.data=function(){return null},t.prototype.getApplicationConfiguration=function(e,t){return this.applicationConfiguration[e]||t},t.prototype.download=function(e){if(u["default"].sUserAgent&&(u["default"].sUserAgent.indexOf("chrome")>-1||u["default"].sUserAgent.indexOf("chrome")>-1)){var t=l.window.document.createElement("a");if(t.href=e,l.window.document&&l.window.document.createEvent){var i=l.window.document.createEvent.MouseEvents;if(i&&i.initEvent&&t.dispatchEvent)return i.initEvent("click",!0,!0),t.dispatchEvent(i),!0}}return u["default"].bMobileDevice?(l.window.open(e,"_self"),l.window.focus()):this.iframe.attr("src",e),!0},t.prototype.googlePreviewSupported=function(){return null===this.googlePreviewSupportedCache&&(this.googlePreviewSupportedCache=!!C["default"].settingsGet("AllowGoogleSocial")&&!!C["default"].settingsGet("AllowGoogleSocialPreview")),this.googlePreviewSupportedCache},t.prototype.setWindowTitle=function(e){e=f["default"].isNormal(e)&&0<e.length?""+e:"",C["default"].settingsGet("Title")&&(e+=(e?" - ":"")+C["default"].settingsGet("Title")),l.window.document.title=e+" ...",l.window.document.title=e},t.prototype.redirectToAdminPanel=function(){l._.delay(function(){return l.window.location.href=g["default"].rootAdmin()},100)},t.prototype.clearClientSideToken=function(){l.window.__rlah_clear&&l.window.__rlah_clear()},t.prototype.setClientSideToken=function(e){l.window.__rlah_set&&(l.window.__rlah_set(e),i(9).settingsSet("AuthAccountHash",e),i(12).populateAuthSuffix())},t.prototype.loginAndLogoutReload=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],s=i(5),n=C["default"].appSettingsGet("mobile"),r=!!C["default"].appSettingsGet("inIframe"),a=f["default"].pString(C["default"].appSettingsGet("customLogoutLink"));t&&this.clearClientSideToken(),t&&o&&l.window.close&&l.window.close(),a=a||(e?g["default"].rootAdmin(n):g["default"].rootUser(n)),t&&l.window.location.href!==a?l._.delay(function(){r&&l.window.parent?l.window.parent.location.href=a:l.window.location.href=a},100):(s.routeOff(),s.setHash(g["default"].root(),!0),s.routeOff(),l._.delay(function(){r&&l.window.parent?l.window.parent.location.reload():l.window.location.reload()},100))},t.prototype.historyBack=function(){l.window.history.back()},t.prototype.bootstart=function(){y["default"].pub("rl.bootstart");var e=C["default"].appSettingsGet("mobile"),t=i(84),o=i(2);o.components.register("SaveTrigger",i(71)),o.components.register("Input",i(68)),o.components.register("Select",i(73)),o.components.register("Radio",i(70)),o.components.register("TextArea",i(74)),o.components.register("x-script",i(72)),C["default"].appSettingsGet("materialDesign")&&u["default"].bAnimationSupported?(o.components.register("Checkbox",i(69)),o.components.register("CheckboxSimple",i(38))):(o.components.register("Checkbox",i(38)),o.components.register("CheckboxSimple",i(38))),v["default"].initOnStartOrLangChange(v["default"].initNotificationLanguage,v["default"]),l._.delay(f["default"].windowResizeCallback,1e3),y["default"].sub("ssm.mobile-enter",function(){u["default"].leftPanelDisabled(!0)}),y["default"].sub("ssm.mobile-leave",function(){u["default"].leftPanelDisabled(!1)}),e?(u["default"].$html.addClass("ssm-state-mobile").addClass("rl-mobile"),y["default"].pub("ssm.mobile-enter")):(t.addState({id:"mobile",maxWidth:767,onEnter:function(){u["default"].$html.addClass("ssm-state-mobile"),y["default"].pub("ssm.mobile-enter")},onLeave:function(){u["default"].$html.removeClass("ssm-state-mobile"),y["default"].pub("ssm.mobile-leave")}}),t.addState({id:"tablet",minWidth:768,maxWidth:999,onEnter:function(){u["default"].$html.addClass("ssm-state-tablet")},onLeave:function(){u["default"].$html.removeClass("ssm-state-tablet")}}),t.addState({id:"desktop",minWidth:1e3,maxWidth:1400,onEnter:function(){u["default"].$html.addClass("ssm-state-desktop")},onLeave:function(){u["default"].$html.removeClass("ssm-state-desktop")}}),t.addState({id:"desktop-large",minWidth:1400,onEnter:function(){u["default"].$html.addClass("ssm-state-desktop-large")},onLeave:function(){u["default"].$html.removeClass("ssm-state-desktop-large")}})),u["default"].leftPanelDisabled.subscribe(function(e){u["default"].$html.toggleClass("rl-left-panel-disabled",e),u["default"].$html.toggleClass("rl-left-panel-enabled",!e)}),u["default"].leftPanelType.subscribe(function(e){u["default"].$html.toggleClass("rl-left-panel-none","none"===e),u["default"].$html.toggleClass("rl-left-panel-short","short"===e)}),u["default"].leftPanelDisabled.valueHasMutated(),t.ready(),i(40).populate(),i(42).populate(),i(34).populate()},t}(T.AbstractBoot);t.AbstractApp=A,t["default"]=A},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=i(13),r=i(8),a=o(r),l=i(1),c=o(l),u=i(12),d=o(u),p=i(25),h=o(p),f=function(){function e(){var t=this;s(this,e),this.player=null,this.notificator=null,this.supported=!1,this.supportedMp3=!1,this.supportedOgg=!1,this.supportedWav=!1,this.supportedNotification=!1,this.player=this.createNewObject(),this.supported=!(a["default"].bMobileDevice||a["default"].bSafari||!this.player||!this.player.play),this.supported&&this.player.canPlayType&&(this.supportedMp3=""!==this.player.canPlayType("audio/mpeg;").replace(/no/,""),this.supportedWav=""!==this.player.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.supportedOgg=""!==this.player.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.supportedNotification=this.supported&&this.supportedMp3),this.player&&(this.supportedMp3||this.supportedOgg||this.supportedWav)||(this.supported=!1,this.supportedMp3=!1,this.supportedOgg=!1,this.supportedWav=!1,this.supportedNotification=!1),this.supported&&((0,n.$)(this.player).on("ended error",function(){return t.stop()}),h["default"].sub("audio.api.stop",function(){return t.stop()}))}return e.prototype.createNewObject=function(){var e=n.window.Audio?new n.window.Audio:null;return e&&e.canPlayType&&e.pause&&e.play&&(e.preload="none",e.loop=!1,e.autoplay=!1,e.muted=!1),e},e.prototype.paused=function(){return this.supported?!!this.player.paused:!0},e.prototype.stop=function(){this.supported&&this.player.pause&&this.player.pause(),h["default"].pub("audio.stop")},e.prototype.pause=function(){this.stop()},e.prototype.clearName=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return e=c["default"].trim(e),t&&"."+t===e.toLowerCase().substr(-1*(t.length+1))&&(e=c["default"].trim(e.substr(0,e.length-4))),""===e?"audio":e},e.prototype.playMp3=function(e,t){this.supported&&this.supportedMp3&&(this.player.src=e,this.player.play(),h["default"].pub("audio.start",[this.clearName(t,"mp3"),"mp3"]))},e.prototype.playOgg=function(e,t){this.supported&&this.supportedOgg&&(this.player.src=e,this.player.play(),t=this.clearName(t,"oga"),t=this.clearName(t,"ogg"),h["default"].pub("audio.start",[t,"ogg"]))},e.prototype.playWav=function(e,t){this.supported&&this.supportedWav&&(this.player.src=e,this.player.play(),h["default"].pub("audio.start",[this.clearName(t,"wav"),"wav"]))},e.prototype.playNotification=function(){this.supported&&this.supportedMp3&&(this.notificator||(this.notificator=this.createNewObject(),this.notificator.src=d["default"].sound("new-mail.mp3")),this.notificator&&this.notificator.play&&this.notificator.play())},e}();e.exports=new f},function(e,t){"use strict";e.exports={eml:"message/rfc822",mime:"message/rfc822",txt:"text/plain",text:"text/plain",def:"text/plain",list:"text/plain","in":"text/plain",ini:"text/plain",log:"text/plain",sql:"text/plain",cfg:"text/plain",conf:"text/plain",asc:"text/plain",rtx:"text/richtext",vcard:"text/vcard",vcf:"text/vcard",htm:"text/html",html:"text/html",csv:"text/csv",ics:"text/calendar",ifb:"text/calendar",xml:"text/xml",json:"application/json",swf:"application/x-shockwave-flash",hlp:"application/winhlp",wgt:"application/widget",chm:"application/vnd.ms-htmlhelp",p10:"application/pkcs10",p7c:"application/pkcs7-mime",p7m:"application/pkcs7-mime",p7s:"application/pkcs7-signature",torrent:"application/x-bittorrent",js:"application/javascript",pl:"text/perl",css:"text/css",asp:"text/asp",php:"application/x-httpd-php",php3:"application/x-httpd-php",php4:"application/x-httpd-php",php5:"application/x-httpd-php",phtml:"application/x-httpd-php",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",jpe:"image/jpeg",jfif:"image/jpeg",gif:"image/gif",bmp:"image/bmp",cgm:"image/cgm",ief:"image/ief",ico:"image/x-icon",tif:"image/tiff",tiff:"image/tiff",svg:"image/svg+xml",svgz:"image/svg+xml",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",webp:"image/webp",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",exe:"application/x-msdownload",dll:"application/x-msdownload",scr:"application/x-msdownload",com:"application/x-msdownload",bat:"application/x-msdownload",msi:"application/x-msdownload",cab:"application/vnd.ms-cab-compressed",gz:"application/x-gzip",tgz:"application/x-gzip",bz:"application/x-bzip",bz2:"application/x-bzip2",deb:"application/x-debian-package",psf:"application/x-font-linux-psf",otf:"application/x-font-otf",pcf:"application/x-font-pcf",snf:"application/x-font-snf",ttf:"application/x-font-ttf",ttc:"application/x-font-ttf",mp3:"audio/mpeg",amr:"audio/amr",aac:"audio/x-aac",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",wav:"audio/x-wav",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",midi:"audio/midi",mp4a:"audio/mp4",ogg:"audio/ogg",weba:"audio/webm",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",rmp:"audio/x-pn-realaudio-plugin",m3u:"audio/x-mpegurl",flv:"video/x-flv",qt:"video/quicktime",mov:"video/quicktime",wmv:"video/windows-media",avi:"video/x-msvideo",mpg:"video/mpeg",mpeg:"video/mpeg",mpe:"video/mpeg",m1v:"video/mpeg",m2v:"video/mpeg","3gp":"video/3gpp","3g2":"video/3gpp2",h261:"video/h261",h263:"video/h263",h264:"video/h264",jpgv:"video/jpgv",mp4:"video/mp4",mp4v:"video/mp4",mpg4:"video/mp4",ogv:"video/ogg",webm:"video/webm",m4v:"video/x-m4v",asf:"video/x-ms-asf",asx:"video/x-ms-asf",wm:"video/x-ms-wm",wmx:"video/x-ms-wmx",wvx:"video/x-ms-wvx",movie:"video/x-sgi-movie",pdf:"application/pdf",psd:"image/vnd.adobe.photoshop",ai:"application/postscript",eps:"application/postscript",ps:"application/postscript",doc:"application/msword",dot:"application/msword",rtf:"application/rtf",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet"}},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0,t["default"]=t.AbstracRadio=void 0;var a=i(13),l=i(2),c=o(l),u=i(1),d=o(u),p=i(16),h=function(e){function t(i){s(this,t);var o=n(this,e.call(this));return o.values=c["default"].observableArray([]),o.value=i.value,!d["default"].isUnd(o.value)&&o.value.subscribe||(o.value=c["default"].observable("")),o.inline=d["default"].isUnd(i.inline)?!1:i.inline,o.readOnly=d["default"].isUnd(i.readOnly)?!1:!!i.readOnly,i.values&&o.values(a._.map(i.values,function(e,t){return{label:e,value:t}})),o.click=a._.bind(o.click,o),o}return r(t,e),t.prototype.click=function(e){!this.readOnly&&e&&this.value(e.value)},t}(p.AbstractComponent);t.AbstracRadio=h,t["default"]=h},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=i(16),a=i(37),l=function(e){function t(){return o(this,t),s(this,e.apply(this,arguments))}return n(t,e),t}(a.AbstractInput);e.exports=(0,r.componentExportHelper)(l,"InputComponent")},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(13),l=i(2),c=o(l),u=i(16),d=i(46),p=function(e){function t(i){s(this,t);var o=n(this,e.call(this,i));return o.animationBox=c["default"].observable(!1).extend({falseTimeout:200}),o.animationCheckmark=c["default"].observable(!1).extend({falseTimeout:200}),o.animationBoxSetTrue=a._.bind(o.animationBoxSetTrue,o),o.animationCheckmarkSetTrue=a._.bind(o.animationCheckmarkSetTrue,o),o.disposable.push(o.value.subscribe(function(e){o.triggerAnimation(e)},o)),o}return r(t,e),t.prototype.animationBoxSetTrue=function(){this.animationBox(!0)},t.prototype.animationCheckmarkSetTrue=function(){this.animationCheckmark(!0)},t.prototype.triggerAnimation=function(e){e?(this.animationBoxSetTrue(),a._.delay(this.animationCheckmarkSetTrue,200)):(this.animationCheckmarkSetTrue(),a._.delay(this.animationBoxSetTrue,200))},t}(d.AbstracCheckbox);e.exports=(0,u.componentExportHelper)(p,"CheckboxMaterialDesignComponent")},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=i(16),a=i(67),l=function(e){function t(){return o(this,t),s(this,e.apply(this,arguments))}return n(t,e),t}(a.AbstracRadio);e.exports=(0,r.componentExportHelper)(l,"RadioComponent")},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(1),l=o(a),c=i(4),u=i(16),d=function(e){function t(i){s(this,t);var o=n(this,e.call(this));return o.element=i.element||null,o.value=i.value&&i.value.subscribe?i.value:null,o.element&&(o.value?(o.element.css("display","inline-block"),i.verticalAlign&&o.element.css("vertical-align",i.verticalAlign),o.setState(o.value()),o.disposable.push(o.value.subscribe(o.setState,o))):o.element.hide()),o}return r(t,e),t.prototype.setState=function(e){switch(l["default"].pInt(e)){case c.SaveSettingsStep.TrueResult:this.element.find(".animated,.error").hide().removeClass("visible").end().find(".success").show().addClass("visible");break;case c.SaveSettingsStep.FalseResult:this.element.find(".animated,.success").hide().removeClass("visible").end().find(".error").show().addClass("visible");break;case c.SaveSettingsStep.Animate:this.element.find(".error,.success").hide().removeClass("visible").end().find(".animated").show().addClass("visible");break;default:case c.SaveSettingsStep.Idle:this.element.find(".animated").hide().end().find(".error,.success").removeClass("visible")}},t}(u.AbstractComponent);e.exports=(0,u.componentExportHelper)(d,"SaveTriggerComponent")},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=i(13),a=i(16),l=function(e){function t(i){o(this,t);var n=s(this,e.call(this));if(i.component&&i.component.templateNodes&&i.element&&i.element[0]&&i.element[0].outerHTML){var a=i.element[0].outerHTML;a=a?a.replace(/<x-script/i,"<script").replace(/<b><\/b><\/x-script>/i,"</script>"):"",a?(i.element.text(""),i.element.replaceWith((0,r.$)(a).text(i.component.templateNodes[0]&&i.component.templateNodes[0].nodeValue?i.component.templateNodes[0].nodeValue:""))):i.element.remove()}return n}return n(t,e),t}(a.AbstractComponent);e.exports=(0,a.componentExportHelper)(l,"ScriptComponent")},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(1),l=o(a),c=i(6),u=o(c),d=i(16),p=i(37),h=function(e){function t(i){s(this,t);var o=n(this,e.call(this,i));return o.options=i.options||"",o.optionsText=i.optionsText||null,o.optionsValue=i.optionsValue||null,o.optionsCaption=i.optionsCaption||null,o.optionsCaption&&(o.optionsCaption=u["default"].i18n(o.optionsCaption)),o.defautOptionsAfterRender=l["default"].defautOptionsAfterRender,o}return r(t,e),t}(p.AbstractInput);e.exports=(0,d.componentExportHelper)(h,"SelectComponent")},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=i(1),l=o(a),c=i(16),u=i(37),d=function(e){function t(i){s(this,t);var o=n(this,e.call(this,i));return o.rows=i.rows||5,o.spellcheck=l["default"].isUnd(i.spellcheck)?!1:!!i.spellcheck,o}return r(t,e),t}(u.AbstractInput);e.exports=(0,c.componentExportHelper)(d,"TextAreaComponent")},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=function(){function e(){i(this,e)}return e.prototype.bootstart=function(){},e}();t.AbstractBoot=o,t["default"]=o},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t["default"]=t.AbstractAppStore=void 0;var n=i(2),r=o(n),a=i(8),l=o(a),c=i(9),u=o(c),d=function(){function e(){s(this,e),this.allowLanguagesOnSettings=r["default"].observable(!0),this.allowLanguagesOnLogin=r["default"].observable(!0),this.interfaceAnimation=r["default"].observable(!0),this.interfaceAnimation.subscribe(function(e){var t=l["default"].bMobileDevice||!e;l["default"].$html.toggleClass("rl-anim",!t).toggleClass("no-rl-anim",t)}),this.interfaceAnimation.valueHasMutated(),this.prem=r["default"].observable(!1),this.community=r["default"].observable(!0)}return e.prototype.populate=function(){this.allowLanguagesOnLogin(!!u["default"].settingsGet("AllowLanguagesOnLogin")),this.allowLanguagesOnSettings(!!u["default"].settingsGet("AllowLanguagesOnSettings")),this.interfaceAnimation(!!u["default"].settingsGet("InterfaceAnimation")),this.prem(!!u["default"].settingsGet("PremType")),this.community(!!u["default"].settingsGet("Community"))},e}();t.AbstractAppStore=d,t["default"]=d},function(e,t,i){"use strict";t.__esModule=!0,t["default"]=function(e){var t=i(11),o=i(3),s=i(14),n=i(8),r=i(23),a=i(1),l=i(4),c=i(6),u=i(30);n.__APP__=e,n.$win.keydown(a.kill_CtrlA_CtrlS).unload(function(){n.bUnload=!0}),n.$html.addClass(n.bMobileDevice?"mobile":"no-mobile").on("click.dropdown.data-api",function(){a.detectDropdownVisibility()}),t.rl=t.rl||{},t.rl.i18n=o.bind(c.i18n,c),t.rl.addHook=o.bind(r.addHook,r),t.rl.settingsGet=o.bind(r.mainSettingsGet,r),t.rl.createCommand=a.createCommand,t.rl.addSettingsViewModel=o.bind(r.addSettingsViewModel,r),t.rl.pluginRemoteRequest=o.bind(r.remoteRequest,r),t.rl.pluginSettingsGet=o.bind(r.settingsGet,r),t.rl.EmailModel=u,t.rl.Enums=l,t.__APP_BOOT=function(i){s(o.delay(function(){s("#rl-check").is(":visible")||n.$html.addClass("no-css"),s("#rl-check").remove(),t.rainloopTEMPLATES&&t.rainloopTEMPLATES[0]?(s("#rl-templates").html(t.rainloopTEMPLATES[0]),o.delay(function(){e.bootstart(),n.$html.removeClass("no-js rl-booted-trigger").addClass("rl-booted")},10)):i(!1),t.__APP_BOOT=null},10))}}},function(e,t){e.exports=window.Autolinker},function(e,t){e.exports=window.JSEncrypt},function(e,t){e.exports=window.Jua},function(e,t){e.exports=window.hasher},function(e,t){e.exports=window.moment},function(e,t){e.exports=window.rainloopProgressJs},function(e,t){e.exports=window.ssm},function(e,t,i){!function(){"use strict";function t(){}var o=i(1),s=i(30);t.prototype.emailArrayToString=function(e,t,i){var s=[],n=0,r=0;if(o.isNonEmptyArray(e))for(n=0,r=e.length;r>n;n++)s.push(e[n].toLine(t,i));return s.join(", ")},t.prototype.emailArrayToStringClear=function(e){var t=[],i=0,s=0;if(o.isNonEmptyArray(e))for(i=0,s=e.length;s>i;i++)e[i]&&e[i].email&&""!==e[i].name&&t.push(e[i].email);return t.join(", ")},t.prototype.emailArrayFromJson=function(e){var t=0,i=0,n=null,r=[];if(o.isNonEmptyArray(e))for(t=0,i=e.length;i>t;t++)n=s.newInstanceFromJson(e[t]),n&&r.push(n);return r},t.prototype.replyHelper=function(e,t,i){if(e&&0<e.length)for(var s=0,n=e.length;n>s;s++)o.isUnd(t[e[s].email])&&(t[e[s].email]=!0,i.push(e[s]))},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){d.call(this,"AttachmentModel"),this.checked=n.observable(!1),this.mimeType="",this.fileName="",this.fileNameExt="",this.fileType=r.FileType.Unknown,this.estimatedSize=0,this.friendlySize="",this.isInline=!1,this.isLinked=!1,this.isThumbnail=!1,this.cid="",this.cidWithOutTags="",this.contentLocation="",this.download="",this.folder="",this.uid="",this.mimeIndex="",this.framed=!1}var o=i(11),s=i(3),n=i(2),r=i(4),a=i(8),l=i(1),c=i(12),u=i(65),d=i(27);s.extend(t.prototype,d.prototype),t.newInstanceFromJson=function(e){var i=new t;return i.initByJson(e)?i:null},t.prototype.mimeType="",t.prototype.fileName="",t.prototype.fileType="",t.prototype.fileNameExt="",t.prototype.estimatedSize=0,t.prototype.friendlySize="",t.prototype.isInline=!1,t.prototype.isLinked=!1,t.prototype.isThumbnail=!1,t.prototype.cid="",t.prototype.cidWithOutTags="",t.prototype.contentLocation="",t.prototype.download="",t.prototype.folder="",t.prototype.uid="",t.prototype.mimeIndex="",t.prototype.framed=!1,t.prototype.initByJson=function(e){var i=!1;return e&&"Object/Attachment"===e["@Object"]&&(this.mimeType=l.trim((e.MimeType||"").toLowerCase()),this.fileName=l.trim(e.FileName),this.estimatedSize=l.pInt(e.EstimatedSize),this.isInline=!!e.IsInline,this.isLinked=!!e.IsLinked,this.isThumbnail=!!e.IsThumbnail,this.cid=e.CID,this.contentLocation=e.ContentLocation,this.download=e.Download,this.folder=e.Folder,this.uid=e.Uid,this.mimeIndex=e.MimeIndex,this.framed=!!e.Framed,this.friendlySize=l.friendlySize(this.estimatedSize),this.cidWithOutTags=this.cid.replace(/^<+/,"").replace(/>+$/,""),this.fileNameExt=l.getFileExtension(this.fileName),this.fileType=t.staticFileType(this.fileNameExt,this.mimeType),i=!0),i},t.prototype.isImage=function(){return r.FileType.Image===this.fileType},t.prototype.isMp3=function(){return r.FileType.Audio===this.fileType&&"mp3"===this.fileNameExt},t.prototype.isOgg=function(){return r.FileType.Audio===this.fileType&&("oga"===this.fileNameExt||"ogg"===this.fileNameExt)},t.prototype.isWav=function(){return r.FileType.Audio===this.fileType&&"wav"===this.fileNameExt},t.prototype.hasThumbnail=function(){return this.isThumbnail},t.prototype.isText=function(){return r.FileType.Text===this.fileType||r.FileType.Eml===this.fileType||r.FileType.Certificate===this.fileType||r.FileType.Html===this.fileType||r.FileType.Code===this.fileType},t.prototype.isPdf=function(){return r.FileType.Pdf===this.fileType},t.prototype.isFramed=function(){return this.framed&&a.__APP__&&a.__APP__.googlePreviewSupported()&&!(this.isPdf()&&a.bAllowPdfPreview)&&!this.isText()&&!this.isImage()},t.prototype.hasPreview=function(){return this.isImage()||this.isPdf()&&a.bAllowPdfPreview||this.isText()||this.isFramed()},t.prototype.hasPreplay=function(){return u.supportedMp3&&this.isMp3()||u.supportedOgg&&this.isOgg()||u.supportedWav&&this.isWav()},t.prototype.linkDownload=function(){return c.attachmentDownload(this.download)},t.prototype.linkPreview=function(){return c.attachmentPreview(this.download)},t.prototype.linkThumbnail=function(){return this.hasThumbnail()?c.attachmentThumbnailPreview(this.download):""},t.prototype.linkThumbnailPreviewStyle=function(){var e=this.linkThumbnail();return""===e?"":"background:url("+e+")"},t.prototype.linkFramed=function(){return c.attachmentFramed(this.download)},t.prototype.linkPreviewAsPlain=function(){return c.attachmentPreviewAsPlain(this.download)},t.prototype.linkPreviewMain=function(){var e="";switch(!0){case this.isImage():case this.isPdf()&&a.bAllowPdfPreview:e=this.linkPreview();break;case this.isText():e=this.linkPreviewAsPlain();break;case this.isFramed():e=this.linkFramed()}return e},t.prototype.generateTransferDownloadUrl=function(){var e=this.linkDownload();return"http"!==e.substr(0,4)&&(e=o.location.protocol+"//"+o.location.host+o.location.pathname+e),this.mimeType+":"+this.fileName+":"+e},t.prototype.eventDragStart=function(e,t){var i=t.originalEvent||t;return e&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},t.staticFileType=s.memoize(function(e,t){e=l.trim(e).toLowerCase(),t=l.trim(t).toLowerCase();var i=r.FileType.Unknown,o=t.split("/");switch(!0){case"image"===o[0]||-1<l.inArray(e,["png","jpg","jpeg","gif","bmp"]):i=r.FileType.Image;break;case"audio"===o[0]||-1<l.inArray(e,["mp3","ogg","oga","wav"]):i=r.FileType.Audio;break;case"video"===o[0]||-1<l.inArray(e,["mkv","avi"]):i=r.FileType.Video;
break;case-1<l.inArray(e,["php","js","css"]):i=r.FileType.Code;break;case"eml"===e||-1<l.inArray(t,["message/delivery-status","message/rfc822"]):i=r.FileType.Eml;break;case"text"===o[0]&&"html"!==o[1]||-1<l.inArray(e,["txt","log"]):i=r.FileType.Text;break;case"text/html"===t||-1<l.inArray(e,["html"]):i=r.FileType.Html;break;case-1<l.inArray(o[1],["zip","7z","tar","rar","gzip","bzip","bzip2","x-zip","x-7z","x-rar","x-tar","x-gzip","x-bzip","x-bzip2","x-zip-compressed","x-7z-compressed","x-rar-compressed"])||-1<l.inArray(e,["zip","7z","tar","rar","gzip","bzip","bzip2"]):i=r.FileType.Archive;break;case-1<l.inArray(o[1],["pdf","x-pdf"])||-1<l.inArray(e,["pdf"]):i=r.FileType.Pdf;break;case-1<l.inArray(t,["application/pgp-signature","application/pgp-keys"])||-1<l.inArray(e,["asc","pem","ppk"]):i=r.FileType.Certificate;break;case-1<l.inArray(t,["application/pkcs7-signature"])||-1<l.inArray(e,["p7s"]):i=r.FileType.CertificateBin;break;case-1<l.inArray(o[1],["rtf","msword","vnd.msword","vnd.openxmlformats-officedocument.wordprocessingml.document","vnd.openxmlformats-officedocument.wordprocessingml.template","vnd.ms-word.document.macroEnabled.12","vnd.ms-word.template.macroEnabled.12"]):i=r.FileType.WordText;break;case-1<l.inArray(o[1],["excel","ms-excel","vnd.ms-excel","vnd.openxmlformats-officedocument.spreadsheetml.sheet","vnd.openxmlformats-officedocument.spreadsheetml.template","vnd.ms-excel.sheet.macroEnabled.12","vnd.ms-excel.template.macroEnabled.12","vnd.ms-excel.addin.macroEnabled.12","vnd.ms-excel.sheet.binary.macroEnabled.12"]):i=r.FileType.Sheet;break;case-1<l.inArray(o[1],["powerpoint","ms-powerpoint","vnd.ms-powerpoint","vnd.openxmlformats-officedocument.presentationml.presentation","vnd.openxmlformats-officedocument.presentationml.template","vnd.openxmlformats-officedocument.presentationml.slideshow","vnd.ms-powerpoint.addin.macroEnabled.12","vnd.ms-powerpoint.presentation.macroEnabled.12","vnd.ms-powerpoint.template.macroEnabled.12","vnd.ms-powerpoint.slideshow.macroEnabled.12"]):i=r.FileType.Presentation}return i}),t.staticIconClass=s.memoize(function(e){var t="",i="icon-file";switch(e){case r.FileType.Text:case r.FileType.Eml:case r.FileType.WordText:i="icon-file-text";break;case r.FileType.Html:case r.FileType.Code:i="icon-file-code";break;case r.FileType.Image:i="icon-file-image";break;case r.FileType.Audio:i="icon-file-music";break;case r.FileType.Video:i="icon-file-movie";break;case r.FileType.Archive:i="icon-file-zip";break;case r.FileType.Certificate:case r.FileType.CertificateBin:i="icon-file-certificate";break;case r.FileType.Sheet:i="icon-file-excel";break;case r.FileType.Presentation:i="icon-file-chart-graph";break;case r.FileType.Pdf:t="pdf",i="icon-none"}return[i,t]}),t.staticCombinedIconClass=function(e){var i="",o=[];if(l.isNonEmptyArray(e)&&(i="icon-attachment",o=s.uniq(s.compact(s.map(e,function(e){return e?t.staticFileType(l.getFileExtension(e[0]),e[1]):""}))),o&&1===o.length&&o[0]))switch(o[0]){case r.FileType.Text:case r.FileType.WordText:i="icon-file-text";break;case r.FileType.Html:case r.FileType.Code:i="icon-file-code";break;case r.FileType.Image:i="icon-file-image";break;case r.FileType.Audio:i="icon-file-music";break;case r.FileType.Video:i="icon-file-movie";break;case r.FileType.Archive:i="icon-file-zip";break;case r.FileType.Certificate:case r.FileType.CertificateBin:i="icon-file-certificate";break;case r.FileType.Sheet:i="icon-file-excel";break;case r.FileType.Presentation:i="icon-file-chart-graph"}return i},t.prototype.iconClass=function(){return t.staticIconClass(this.fileType)[0]},t.prototype.iconText=function(){return t.staticIconClass(this.fileType)[1]},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){u.call(this,"FilterModel"),this.enabled=s.observable(!0),this.id="",this.name=s.observable(""),this.name.error=s.observable(!1),this.name.focused=s.observable(!1),this.conditions=s.observableArray([]),this.conditionsType=s.observable(n.FilterRulesType.Any),this.actionValue=s.observable(""),this.actionValue.error=s.observable(!1),this.actionValueSecond=s.observable(""),this.actionValueThird=s.observable(""),this.actionValueFourth=s.observable(""),this.actionValueFourth.error=s.observable(!1),this.actionMarkAsRead=s.observable(!1),this.actionKeep=s.observable(!0),this.actionNoStop=s.observable(!1),this.actionType=s.observable(n.FiltersAction.MoveTo),this.actionType.subscribe(function(){this.actionValue(""),this.actionValue.error(!1),this.actionValueSecond(""),this.actionValueThird(""),this.actionValueFourth(""),this.actionValueFourth.error(!1)},this);var e=function(e){var t=l.getFolderFromCacheList(e);return t?t.fullName.replace("."===t.delimiter?/\./:/[\\\/]+/," / "):e};this.nameSub=s.computed(function(){var t="",i=this.actionValue();switch(this.actionType()){case n.FiltersAction.MoveTo:t=a.i18n("SETTINGS_FILTERS/SUBNAME_MOVE_TO",{FOLDER:e(i)});break;case n.FiltersAction.Forward:t=a.i18n("SETTINGS_FILTERS/SUBNAME_FORWARD_TO",{EMAIL:i});break;case n.FiltersAction.Vacation:t=a.i18n("SETTINGS_FILTERS/SUBNAME_VACATION_MESSAGE");break;case n.FiltersAction.Reject:t=a.i18n("SETTINGS_FILTERS/SUBNAME_REJECT");break;case n.FiltersAction.Discard:t=a.i18n("SETTINGS_FILTERS/SUBNAME_DISCARD")}return t?"("+t+")":""},this),this.actionTemplate=s.computed(function(){var e="";switch(this.actionType()){default:case n.FiltersAction.MoveTo:e="SettingsFiltersActionMoveToFolder";break;case n.FiltersAction.Forward:e="SettingsFiltersActionForward";break;case n.FiltersAction.Vacation:e="SettingsFiltersActionVacation";break;case n.FiltersAction.Reject:e="SettingsFiltersActionReject";break;case n.FiltersAction.None:e="SettingsFiltersActionNone";break;case n.FiltersAction.Discard:e="SettingsFiltersActionDiscard"}return e},this),this.regDisposables(this.conditions.subscribe(r.windowResizeCallback)),this.regDisposables(this.name.subscribe(function(e){this.name.error(""===e)},this)),this.regDisposables(this.actionValue.subscribe(function(e){this.actionValue.error(""===e)},this)),this.regDisposables([this.actionNoStop,this.actionTemplate]),this.deleteAccess=s.observable(!1),this.canBeDeleted=s.observable(!0)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(19),c=i(105),u=i(27);o.extend(t.prototype,u.prototype),t.prototype.generateID=function(){this.id=r.fakeMd5()},t.prototype.verify=function(){return""===this.name()?(this.name.error(!0),!1):0<this.conditions().length&&o.find(this.conditions(),function(e){return e&&!e.verify()})?!1:""===this.actionValue()&&-1<r.inArray(this.actionType(),[n.FiltersAction.MoveTo,n.FiltersAction.Forward,n.FiltersAction.Reject,n.FiltersAction.Vacation])?(this.actionValue.error(!0),!1):n.FiltersAction.Forward===this.actionType()&&-1===this.actionValue().indexOf("@")?(this.actionValue.error(!0),!1):n.FiltersAction.Vacation===this.actionType()&&""!==this.actionValueFourth()&&-1===this.actionValueFourth().indexOf("@")?(this.actionValueFourth.error(!0),!1):(this.name.error(!1),this.actionValue.error(!1),!0)},t.prototype.toJson=function(){return{ID:this.id,Enabled:this.enabled()?"1":"0",Name:this.name(),ConditionsType:this.conditionsType(),Conditions:o.map(this.conditions(),function(e){return e.toJson()}),ActionValue:this.actionValue(),ActionValueSecond:this.actionValueSecond(),ActionValueThird:this.actionValueThird(),ActionValueFourth:this.actionValueFourth(),ActionType:this.actionType(),Stop:this.actionNoStop()?"0":"1",Keep:this.actionKeep()?"1":"0",MarkAsRead:this.actionMarkAsRead()?"1":"0"}},t.prototype.addCondition=function(){this.conditions.push(new c)},t.prototype.removeCondition=function(e){this.conditions.remove(e),r.delegateRunOnDestroy(e)},t.prototype.setRecipients=function(){this.actionValueFourth(i(31).accountsEmails().join(", "))},t.prototype.parse=function(e){var t=!1;return e&&"Object/Filter"===e["@Object"]&&(this.id=r.pString(e.ID),this.name(r.pString(e.Name)),this.enabled(!!e.Enabled),this.conditionsType(r.pString(e.ConditionsType)),this.conditions([]),r.isNonEmptyArray(e.Conditions)&&this.conditions(o.compact(o.map(e.Conditions,function(e){var t=new c;return t&&t.parse(e)?t:null}))),this.actionType(r.pString(e.ActionType)),this.actionValue(r.pString(e.ActionValue)),this.actionValueSecond(r.pString(e.ActionValueSecond)),this.actionValueThird(r.pString(e.ActionValueThird)),this.actionValueFourth(r.pString(e.ActionValueFourth)),this.actionNoStop(!e.Stop),this.actionKeep(!!e.Keep),this.actionMarkAsRead(!!e.MarkAsRead),t=!0),t},t.prototype.cloneSelf=function(){var e=new t;return e.id=this.id,e.enabled(this.enabled()),e.name(this.name()),e.name.error(this.name.error()),e.conditionsType(this.conditionsType()),e.actionMarkAsRead(this.actionMarkAsRead()),e.actionType(this.actionType()),e.actionValue(this.actionValue()),e.actionValue.error(this.actionValue.error()),e.actionValueSecond(this.actionValueSecond()),e.actionValueThird(this.actionValueThird()),e.actionValueFourth(this.actionValueFourth()),e.actionKeep(this.actionKeep()),e.actionNoStop(this.actionNoStop()),e.conditions(o.map(this.conditions(),function(e){return e.cloneSelf()})),e},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.oPromisesStack={}}var o=i(3),s=i(48),n=i(1);t.prototype.func=function(e){return e(),this},t.prototype.fastResolve=function(e){var t=s.defer();return t.resolve(e),t.promise},t.prototype.fastReject=function(e){var t=s.defer();return t.reject(e),t.promise},t.prototype.setTrigger=function(e,t){e&&o.each(n.isArray(e)?e:[e],function(e){e&&e(!!t)})},e.exports=t}()},,function(e,t,i){!function(){"use strict";function t(){this.capa=o.observable(""),this.modules=o.observable({}),this.filters=o.observableArray([]),this.filters.loading=o.observable(!1).extend({throttle:200}),this.filters.saving=o.observable(!1).extend({throttle:200}),this.raw=o.observable("")}var o=i(2);e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.quota=s.observable(0),this.usage=s.observable(0),this.percentage=s.computed(function(){var e=this.quota(),t=this.usage();return e>0?o.Math.ceil(t/e*100):0},this)}var o=i(11),s=i(2);t.prototype.populateData=function(e,t){this.quota(1024*e),this.usage(1024*t)},e.exports=new t}()},function(e,t,i){!function(){"use strict";function t(){this.templates=s.observableArray([]),this.templates.loading=s.observable(!1).extend({throttle:100}),this.templatesNames=s.observableArray([]).extend({throttle:1e3}),this.templatesNames.skipFirst=!0,this.subscribers()}var o=i(3),s=i(2);t.prototype.subscribers=function(){this.templates.subscribe(function(e){this.templatesNames(o.compact(o.map(e,function(e){return e?e.name:null})))},this)},e.exports=new t}()},,function(e,t,i){!function(){"use strict";function t(){p.call(this,"Popups","PopupsFilter"),this.isNew=s.observable(!0),this.modules=c.modules,this.fTrueCallback=null,this.filter=s.observable(null),this.allowMarkAsRead=s.observable(!1),this.defautOptionsAfterRender=a.defautOptionsAfterRender,this.folderSelectList=u.folderMenuForFilters,this.selectedFolderValue=s.observable(""),this.selectedFolderValue.subscribe(function(){this.filter()&&this.filter().actionValue.error(!1)},this),this.saveFilter=a.createCommand(this,function(){if(this.filter()){if(n.FiltersAction.MoveTo===this.filter().actionType()&&this.filter().actionValue(this.selectedFolderValue()),!this.filter().verify())return!1;this.fTrueCallback&&this.fTrueCallback(this.filter()),this.modalVisibility()&&a.delegateRun(this,"closeCommand")}return!0}),this.actionTypeOptions=s.observableArray([]),this.fieldOptions=s.observableArray([]),this.typeOptions=s.observableArray([]),this.typeOptionsSize=s.observableArray([]),l.initOnStartOrLangChange(this.populateOptions,this),this.modules.subscribe(this.populateOptions,this),d.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(8),a=i(1),l=i(6),c=i(90),u=i(21),d=i(5),p=i(10);d.extendAsViewModel(["View/Popup/Filter","PopupsFilterViewModel"],t),o.extend(t.prototype,p.prototype),t.prototype.populateOptions=function(){this.actionTypeOptions([]);var e=this.modules();e&&(e.markasread&&this.allowMarkAsRead(!0),e.moveto&&this.actionTypeOptions.push({id:n.FiltersAction.MoveTo,name:l.i18n("POPUPS_FILTER/SELECT_ACTION_MOVE_TO")}),e.redirect&&this.actionTypeOptions.push({id:n.FiltersAction.Forward,name:l.i18n("POPUPS_FILTER/SELECT_ACTION_FORWARD_TO")}),e.reject&&this.actionTypeOptions.push({id:n.FiltersAction.Reject,name:l.i18n("POPUPS_FILTER/SELECT_ACTION_REJECT")}),e.vacation&&this.actionTypeOptions.push({id:n.FiltersAction.Vacation,name:l.i18n("POPUPS_FILTER/SELECT_ACTION_VACATION_MESSAGE")})),this.actionTypeOptions.push({id:n.FiltersAction.Discard,name:l.i18n("POPUPS_FILTER/SELECT_ACTION_DISCARD")}),this.fieldOptions([{id:n.FilterConditionField.From,name:l.i18n("POPUPS_FILTER/SELECT_FIELD_FROM")},{id:n.FilterConditionField.Recipient,name:l.i18n("POPUPS_FILTER/SELECT_FIELD_RECIPIENTS")},{id:n.FilterConditionField.Subject,name:l.i18n("POPUPS_FILTER/SELECT_FIELD_SUBJECT")},{id:n.FilterConditionField.Size,name:l.i18n("POPUPS_FILTER/SELECT_FIELD_SIZE")},{id:n.FilterConditionField.Header,name:l.i18n("POPUPS_FILTER/SELECT_FIELD_HEADER")}]),this.typeOptions([{id:n.FilterConditionType.Contains,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_CONTAINS")},{id:n.FilterConditionType.NotContains,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_NOT_CONTAINS")},{id:n.FilterConditionType.EqualTo,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_EQUAL_TO")},{id:n.FilterConditionType.NotEqualTo,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_NOT_EQUAL_TO")}]),this.typeOptionsSize([{id:n.FilterConditionType.Over,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_OVER")},{id:n.FilterConditionType.Under,name:l.i18n("POPUPS_FILTER/SELECT_TYPE_UNDER")}])},t.prototype.removeCondition=function(e){this.filter()&&this.filter().removeCondition(e)},t.prototype.clearPopup=function(){this.isNew(!0),this.fTrueCallback=null,this.filter(null)},t.prototype.onShow=function(e,t,i){this.clearPopup(),this.fTrueCallback=t,this.filter(e),e&&this.selectedFolderValue(e.actionValue()),this.isNew(!i),!i&&e&&e.name.focused(!0)},t.prototype.onShowWithDelay=function(){this.isNew()&&this.filter()&&!r.bMobile&&this.filter().name.focused(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){p.call(this,"Popups","PopupsFolderCreate"),this.folderName=s.observable(""),this.folderName.focused=s.observable(!1),this.selectedParentValue=s.observable(r.UNUSED_OPTION_VALUE),this.parentFolderSelectList=s.computed(function(){var e=[],t=null,i=null,o=c.folderList(),s=function(e){return e?e.isSystemFolder()?e.name()+" "+e.manageFolderSystemName():e.name():""};return e.push(["",""]),""!==c.namespace&&(t=function(e){return c.namespace!==e.fullNameRaw.substr(0,c.namespace.length)}),l.folderListOptionsBuilder([],o,[],e,null,t,i,s)},this),this.createFolder=l.createCommand(this,function(){var e=this.selectedParentValue();""===e&&1<c.namespace.length&&(e=c.namespace.substr(0,c.namespace.length-1)),i(7)["default"].foldersPromisesActionHelper(u.folderCreate(this.folderName(),e,c.foldersCreating),n.Notification.CantCreateFolder),this.cancelCommand()},function(){return this.simpleFolderNameValidation(this.folderName())}),this.defautOptionsAfterRender=l.defautOptionsAfterRender,d.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(17),a=i(8),l=i(1),c=i(21),u=i(41),d=i(5),p=i(10);d.extendAsViewModel(["View/Popup/FolderCreate","PopupsFolderCreateViewModel"],t),o.extend(t.prototype,p.prototype),t.prototype.simpleFolderNameValidation=function(e){return/^[^\\\/]+$/g.test(l.trim(e))},t.prototype.clearPopup=function(){this.folderName(""),this.selectedParentValue(""),this.folderName.focused(!1)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){a.bMobile||this.folderName.focused(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){a.call(this,"Popups","PopupsKeyboardShortcutsHelp"),this.sDefaultKeyScope=n.KeyState.PopupKeyboardShortcutsHelp,r.constructorEnd(this)}var o=i(3),s=i(18),n=i(4),r=i(5),a=i(10);r.extendAsViewModel(["View/Popup/KeyboardShortcutsHelp","PopupsKeyboardShortcutsHelpViewModel"],t),o.extend(t.prototype,a.prototype),t.prototype.onBuild=function(e){s("tab, shift+tab, left, right",n.KeyState.PopupKeyboardShortcutsHelp,o.throttle(o.bind(function(t,i){if(t&&i){var o=e.find(".nav.nav-tabs > li"),s=i&&("tab"===i.shortcut||"right"===i.shortcut),n=o.index(o.filter(".active"));return!s&&n>0?n--:s&&n<o.length-1?n++:n=s?0:o.length-1,o.eq(n).find('a[data-toggle="tab"]').tab("show"),!1}},this),100))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){d.call(this,"Popups","PopupsTemplate"),this.editor=null,this.signatureDom=s.observable(null),this.id=s.observable(""),this.name=s.observable(""),this.name.error=s.observable(!1),this.name.focus=s.observable(!1),this.body=s.observable(""),this.body.loading=s.observable(!1),this.body.error=s.observable(!1),this.name.subscribe(function(){this.name.error(!1)},this),this.body.subscribe(function(){this.body.error(!1)},this),this.submitRequest=s.observable(!1),this.submitError=s.observable(""),this.addTemplateCommand=r.createCommand(this,function(){return this.populateBodyFromEditor(),this.name.error(""===r.trim(this.name())),this.body.error(""===r.trim(this.body())||":HTML:"===r.trim(this.body())),this.name.error()||this.body.error()?!1:(this.submitRequest(!0),c.templateSetup(o.bind(function(e,t){this.submitRequest(!1),n.StorageResultType.Success===e&&t?t.Result?(i(7)["default"].templates(),this.cancelCommand()):t.ErrorCode&&this.submitError(a.getNotification(t.ErrorCode)):this.submitError(a.getNotification(n.Notification.UnknownError))},this),this.id(),this.name(),this.body()),!0)},function(){return!this.submitRequest()}),u.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(45),c=i(15),u=i(5),d=i(10);u.extendAsViewModel(["View/Popup/Template"],t),o.extend(t.prototype,d.prototype),t.prototype.clearPopup=function(){this.id(""),this.name(""),this.name.error(!1),this.body(""),this.body.loading(!1),this.body.error(!1),this.submitRequest(!1),this.submitError(""),this.editor&&this.editor.setPlain("",!1)},t.prototype.populateBodyFromEditor=function(){this.editor&&this.body(this.editor.getDataWithHtmlMark())},t.prototype.editorSetBody=function(e){if(!this.editor&&this.signatureDom()){var t=this;this.editor=new l(t.signatureDom(),function(){t.populateBodyFromEditor()},function(){t.editor.setHtmlOrPlain(e)})}else this.editor.setHtmlOrPlain(e)},t.prototype.onShow=function(e){var t=this;this.clearPopup(),e&&e.id?(this.id(e.id),this.name(e.name),this.body(e.body),e.populated?t.editorSetBody(this.body()):(this.body.loading(!0),t.body.error(!1),c.templateGetById(function(i,o){t.body.loading(!1),n.StorageResultType.Success===i&&o&&o.Result&&"Object/Template"===o.Result["@Object"]&&r.isNormal(o.Result.Body)?(e.body=o.Result.Body,e.populated=!0,t.body(e.body),t.body.error(!1)):(t.body(""),t.body.error(!0)),t.editorSetBody(t.body())},this.id()))):t.editorSetBody("")},t.prototype.onShowWithDelay=function(){this.name.focus(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){p.call(this,"Popups","PopupsTwoFactorConfiguration"),this.lock=n.observable(!1),this.capaTwoFactor=c.capa(r.Capa.TwoFactor),this.processing=n.observable(!1),this.clearing=n.observable(!1),this.secreting=n.observable(!1),this.viewUser=n.observable(""),this.twoFactorStatus=n.observable(!1),this.twoFactorTested=n.observable(!1),this.viewSecret=n.observable(""),this.viewBackupCodes=n.observable(""),this.viewUrl=n.observable(""),this.viewEnable_=n.observable(!1),this.viewEnable=n.computed({owner:this,read:this.viewEnable_,write:function(e){var t=this;e=!!e,e&&this.twoFactorTested()?(this.viewEnable_(e),u.enableTwoFactor(function(e,i){r.StorageResultType.Success===e&&i&&i.Result||t.viewEnable_(!1)},!0)):(e||this.viewEnable_(e),u.enableTwoFactor(function(e,i){r.StorageResultType.Success===e&&i&&i.Result||t.viewEnable_(!1)},!1))}}),this.viewTwoFactorEnableTooltip=n.computed(function(){return l.trigger(),this.twoFactorTested()||this.viewEnable_()?"":l.i18n("POPUPS_TWO_FACTOR_CFG/TWO_FACTOR_SECRET_TEST_BEFORE_DESC")},this),this.viewTwoFactorStatus=n.computed(function(){return l.trigger(),l.i18n(this.twoFactorStatus()?"POPUPS_TWO_FACTOR_CFG/TWO_FACTOR_SECRET_CONFIGURED_DESC":"POPUPS_TWO_FACTOR_CFG/TWO_FACTOR_SECRET_NOT_CONFIGURED_DESC")},this),this.twoFactorAllowedEnable=n.computed(function(){return this.viewEnable()||this.twoFactorTested()},this),this.onResult=s.bind(this.onResult,this),this.onShowSecretResult=s.bind(this.onShowSecretResult,this),d.constructorEnd(this)}var o=i(11),s=i(3),n=i(2),r=i(4),a=i(1),l=i(6),c=i(9),u=i(15),d=i(5),p=i(10);d.extendAsViewModel(["View/Popup/TwoFactorConfiguration","TwoFactorConfigurationPopupView"],t),s.extend(t.prototype,p.prototype),t.prototype.showSecret=function(){this.secreting(!0),u.showTwoFactorSecret(this.onShowSecretResult)},t.prototype.hideSecret=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},t.prototype.createTwoFactor=function(){this.processing(!0),u.createTwoFactor(this.onResult)},t.prototype.logout=function(){i(7)["default"].logout()},t.prototype.testTwoFactor=function(){i(5).showScreenPopup(i(150),[this.twoFactorTested])},t.prototype.clearTwoFactor=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl(""),this.twoFactorTested(!1),this.clearing(!0),u.clearTwoFactor(this.onResult)},t.prototype.onShow=function(e){this.lock(!!e),this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},t.prototype.onHide=function(){this.lock()&&o.location.reload()},t.prototype.onResult=function(e,t){this.processing(!1),this.clearing(!1),r.StorageResultType.Success===e&&t&&t.Result?(this.viewUser(a.pString(t.Result.User)),this.viewEnable_(!!t.Result.Enable),this.twoFactorStatus(!!t.Result.IsSet),this.twoFactorTested(!!t.Result.Tested),this.viewSecret(a.pString(t.Result.Secret)),this.viewBackupCodes(a.pString(t.Result.BackupCodes).replace(/[\s]+/g,"  ")),this.viewUrl(a.pString(t.Result.Url))):(this.viewUser(""),this.viewEnable_(!1),this.twoFactorStatus(!1),this.twoFactorTested(!1),this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl(""))},t.prototype.onShowSecretResult=function(e,t){this.secreting(!1),r.StorageResultType.Success===e&&t&&t.Result?(this.viewSecret(a.pString(t.Result.Secret)),this.viewUrl(a.pString(t.Result.Url))):(this.viewSecret(""),this.viewUrl(""))},t.prototype.onBuild=function(){this.capaTwoFactor&&(this.processing(!0),u.getTwoFactor(this.onResult))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){f.call(this,"Right","SystemDropDown"),this.logoImg=a.trim(h.settingsGet("UserLogo")),this.logoTitle=a.trim(h.settingsGet("UserLogoTitle")),this.mobile=!!h.appSettingsGet("mobile"),this.mobileDevice=!!h.appSettingsGet("mobileDevice"),this.allowSettings=!!h.capa(r.Capa.Settings),this.allowHelp=!!h.capa(r.Capa.Help),this.currentAudio=u.currentAudio,this.accountEmail=d.email,this.accounts=d.accounts,this.accountsUnreadCount=d.accountsUnreadCount,this.accountMenuDropdownTrigger=s.observable(!1),this.capaAdditionalAccounts=s.observable(h.capa(r.Capa.AdditionalAccounts)),this.accountClick=o.bind(this.accountClick,this),this.accountClick=o.bind(this.accountClick,this),c.sub("audio.stop",function(){u.currentAudio("")}),c.sub("audio.start",function(e){u.currentAudio(e)})}var o=i(3),s=i(2),n=i(18),r=i(4),a=i(1),l=i(12),c=i(25),u=i(24),d=i(31),p=i(32),h=i(9),f=i(10);o.extend(t.prototype,f.prototype),t.prototype.stopPlay=function(){c.pub("audio.api.stop")},t.prototype.accountClick=function(e,t){return e&&t&&!a.isUnd(t.which)&&1===t.which&&(d.accounts.loading(!0),o.delay(function(){d.accounts.loading(!1)},1e3)),!0},t.prototype.emailTitle=function(){return d.email()},t.prototype.settingsClick=function(){h.capa(r.Capa.Settings)&&i(5).setHash(l.settings())},t.prototype.settingsHelp=function(){h.capa(r.Capa.Help)&&i(5).showScreenPopup(i(96))},t.prototype.addAccountClick=function(){this.capaAdditionalAccounts()&&i(5).showScreenPopup(i(61))},t.prototype.logoutClick=function(){i(7)["default"].logout()},t.prototype.onBuild=function(){var e=this;n("`",[r.KeyState.MessageList,r.KeyState.MessageView,r.KeyState.Settings],function(){e.viewModelVisibility()&&(p.messageFullScreenMode(!1),e.accountMenuDropdownTrigger(!0))}),n("shift+/",[r.KeyState.MessageList,r.KeyState.MessageView,r.KeyState.Settings],function(){return e.viewModelVisibility()?(i(5).showScreenPopup(i(96)),!1):void 0})},e.exports=t}()},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t["default"]=t.Selector=void 0;var n=i(13),r=i(2),a=o(r),l=i(4),c=i(1),u=o(c),d=function(){function e(t,i,o,r,l,c,d){var p=this;s(this,e),this.actionClick=function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(e){var i=!0;t&&(!t.shiftKey||t.ctrlKey||t.metaKey||t.altKey?!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey||(i=!1,this.focusedItem(e),this.selectedItem()&&e!==this.selectedItem()&&this.selectedItem().checked(!0),e.checked(!e.checked())):(i=!1,""===this.sLastUid&&(this.sLastUid=this.getItemUid(e)),e.checked(!e.checked()),this.eventClickFunction(e,t),this.focusedItem(e))),i&&this.selectMessageItem(e)}},this.list=t,this.listChecked=a["default"].computed(function(){return n._.filter(p.list(),function(e){return e.checked()})},this).extend({rateLimit:0}),this.isListChecked=a["default"].computed(function(){return 0<p.listChecked().length}),this.focusedItem=o||a["default"].observable(null),this.selectedItem=i||a["default"].observable(null),this.selectedItemUseCallback=!0,this.itemSelectedThrottle=n._.debounce(n._.bind(this.itemSelected,this),300),this.listChecked.subscribe(function(e){0<e.length?null===p.selectedItem()?p.selectedItem.valueHasMutated&&p.selectedItem.valueHasMutated():p.selectedItem(null):p.autoSelect()&&p.focusedItem()&&p.selectedItem(p.focusedItem())},this),this.selectedItem.subscribe(function(e){e?(p.isListChecked()&&n._.each(p.listChecked(),function(e){e.checked(!1)}),p.selectedItemUseCallback&&p.itemSelectedThrottle(e)):p.selectedItemUseCallback&&p.itemSelected(null)},this),this.selectedItem=this.selectedItem.extend({toggleSubscribe:[null,function(e){e&&e.selected(!1)},function(e){e&&e.selected(!0)}]}),this.focusedItem=this.focusedItem.extend({toggleSubscribe:[null,function(e){e&&e.focused(!1)},function(e){e&&e.focused(!0)}]}),this.iSelectNextHelper=0,this.iFocusedNextHelper=0,this.oContentVisible=null,this.oContentScrollable=null,this.sItemSelector=r,this.sItemSelectedSelector=l,this.sItemCheckedSelector=c,this.sItemFocusedSelector=d,this.sLastUid="",this.oCallbacks={},this.emptyFunction=function(){},this.emptyTrueFunction=function(){return!0},this.focusedItem.subscribe(function(e){e&&(p.sLastUid=p.getItemUid(e))},this);var h=[],f=[],m=null,g=null;this.list.subscribe(function(e){u["default"].isArray(e)&&n._.each(e,function(e){if(e){var t=p.getItemUid(e);h.push(t),e.checked()&&f.push(t),null===m&&e.focused()&&(m=t),null===g&&e.selected()&&(g=t)}})},this,"beforeChange"),this.list.subscribe(function(e){var t=null,i=!1,o=[],s=m,r=!1,a=!1,l=0;p.selectedItemUseCallback=!1,p.focusedItem(null),p.selectedItem(null),u["default"].isArray(e)&&(l=f.length,n._.each(e,function(e){var t=p.getItemUid(e);o.push(t),null!==m&&m===t&&(p.focusedItem(e),m=null),l>0&&-1<u["default"].inArray(t,f)&&(r=!0,e.checked(!0),l--),r||null===g||g!==t||(a=!0,p.selectedItem(e),g=null)}),p.selectedItemUseCallback=!0,r||a||!p.autoSelect()||(p.focusedItem()?p.selectedItem(p.focusedItem()):0<e.length&&(null!==s&&(i=!1,s=n._.find(h,function(e){return i&&-1<u["default"].inArray(e,o)?e:(s===e&&(i=!0),!1)}),s&&(t=n._.find(e,function(e){return s===p.getItemUid(e)}))),p.selectedItem(t||null),p.focusedItem(p.selectedItem()))),(0!==p.iSelectNextHelper||0!==p.iFocusedNextHelper)&&0<e.length&&!p.focusedItem()&&(t=null,0!==p.iFocusedNextHelper&&(t=e[-1===p.iFocusedNextHelper?e.length-1:0]||null),t||0===p.iSelectNextHelper||(t=e[-1===p.iSelectNextHelper?e.length-1:0]||null),t&&(0!==p.iSelectNextHelper&&p.selectedItem(t||null),p.focusedItem(t||null),p.scrollToFocused(),n._.delay(function(){return p.scrollToFocused()},100)),p.iSelectNextHelper=0,p.iFocusedNextHelper=0)),h=[],f=[],m=null,g=null},this)}return e.prototype.itemSelected=function(e){this.isListChecked()?e||(this.oCallbacks.onItemSelect||this.emptyFunction)(e||null):e&&(this.oCallbacks.onItemSelect||this.emptyFunction)(e)},e.prototype.goDown=function(e){this.newSelectPosition(l.EventKeyCode.Down,!1,e)},e.prototype.goUp=function(e){this.newSelectPosition(l.EventKeyCode.Up,!1,e)},e.prototype.unselect=function(){this.selectedItem(null),this.focusedItem(null)},e.prototype.init=function(e,t){var i=this,o=arguments.length<=2||void 0===arguments[2]?"all":arguments[2];this.oContentVisible=e,this.oContentScrollable=t,this.oContentVisible&&this.oContentScrollable&&((0,n.$)(this.oContentVisible).on("selectstart",function(e){e&&e.preventDefault&&e.preventDefault()}).on("click",this.sItemSelector,function(e){i.actionClick(a["default"].dataFor(e.currentTarget),e)}).on("click",this.sItemCheckedSelector,function(e){var t=a["default"].dataFor(e.currentTarget);t&&(e&&e.shiftKey?i.actionClick(t,e):(i.focusedItem(t),t.checked(!t.checked())))}),(0,n.key)("enter",o,function(){return i.focusedItem()&&!i.focusedItem().selected()?(i.actionClick(i.focusedItem()),!1):!0}),(0,n.key)("ctrl+up, command+up, ctrl+down, command+down",o,function(){return!1}),(0,n.key)("up, shift+up, down, shift+down, home, end, pageup, pagedown, insert, space",o,function(e,t){if(e&&t&&t.shortcut){var o=0;switch(t.shortcut){case"up":case"shift+up":o=l.EventKeyCode.Up;break;case"down":case"shift+down":o=l.EventKeyCode.Down;break;case"insert":o=l.EventKeyCode.Insert;break;case"space":o=l.EventKeyCode.Space;break;case"home":o=l.EventKeyCode.Home;break;case"end":o=l.EventKeyCode.End;break;case"pageup":o=l.EventKeyCode.PageUp;break;case"pagedown":o=l.EventKeyCode.PageDown}if(o>0)return i.newSelectPosition(o,n.key.shift),!1}}))},e.prototype.autoSelect=function(){return!!(this.oCallbacks.onAutoSelect||this.emptyTrueFunction)()},e.prototype.doUpUpOrDownDown=function(e){(this.oCallbacks.onUpUpOrDownDown||this.emptyTrueFunction)(!!e)},e.prototype.getItemUid=function(e){var t="",i=this.oCallbacks.onItemGetUid||null;return i&&e&&(t=i(e)),t.toString()},e.prototype.newSelectPosition=function(e,t,i){var o=0,s=10,r=!1,a=!1,c=null,u=this.list(),d=u?u.length:0,p=this.focusedItem();if(d>0)if(p){if(p)if(l.EventKeyCode.Down===e||l.EventKeyCode.Up===e||l.EventKeyCode.Insert===e||l.EventKeyCode.Space===e)n._.each(u,function(t){if(!a)switch(e){case l.EventKeyCode.Up:p===t?a=!0:c=t;break;case l.EventKeyCode.Down:case l.EventKeyCode.Insert:r?(c=t,a=!0):p===t&&(r=!0)}}),c||l.EventKeyCode.Down!==e&&l.EventKeyCode.Up!==e||this.doUpUpOrDownDown(l.EventKeyCode.Up===e);else if(l.EventKeyCode.Home===e||l.EventKeyCode.End===e)l.EventKeyCode.Home===e?c=u[0]:l.EventKeyCode.End===e&&(c=u[u.length-1]);else if(l.EventKeyCode.PageDown===e){for(;d>o;o++)if(p===u[o]){o+=s,o=o>d-1?d-1:o,c=u[o];break}}else if(l.EventKeyCode.PageUp===e)for(o=d;o>=0;o--)if(p===u[o]){o-=s,o=0>o?0:o,c=u[o];break}}else l.EventKeyCode.Down===e||l.EventKeyCode.Insert===e||l.EventKeyCode.Space===e||l.EventKeyCode.Home===e||l.EventKeyCode.PageUp===e?c=u[0]:l.EventKeyCode.Up!==e&&l.EventKeyCode.End!==e&&l.EventKeyCode.PageDown!==e||(c=u[u.length-1]);c?(this.focusedItem(c),p&&(t?l.EventKeyCode.Up!==e&&l.EventKeyCode.Down!==e||p.checked(!p.checked()):l.EventKeyCode.Insert!==e&&l.EventKeyCode.Space!==e||p.checked(!p.checked())),!this.autoSelect()&&!i||this.isListChecked()||l.EventKeyCode.Space===e||this.selectedItem(c),this.scrollToFocused()):p&&(!t||l.EventKeyCode.Up!==e&&l.EventKeyCode.Down!==e?l.EventKeyCode.Insert!==e&&l.EventKeyCode.Space!==e||p.checked(!p.checked()):p.checked(!p.checked()),this.focusedItem(p))},e.prototype.scrollToFocused=function(){if(!this.oContentVisible||!this.oContentScrollable)return!1;
var e=20,t=this.list(),i=(0,n.$)(this.sItemFocusedSelector,this.oContentScrollable),o=i.position(),s=this.oContentVisible.height(),r=i.outerHeight();return t&&t[0]&&t[0].focused()?(this.oContentScrollable.scrollTop(0),!0):o&&(o.top<0||o.top+r>s)?(this.oContentScrollable.scrollTop(o.top<0?this.oContentScrollable.scrollTop()+o.top-e:this.oContentScrollable.scrollTop()+o.top-s+r+e),!0):!1},e.prototype.scrollToTop=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this.oContentVisible&&this.oContentScrollable?(e||50>this.oContentScrollable.scrollTop()?this.oContentScrollable.scrollTop(0):this.oContentScrollable.stop().animate({scrollTop:0},200),!0):!1},e.prototype.eventClickFunction=function(e,t){var i=0,o=0,s=!1,n=!1,r=[],a=!1,l=null,c="",u=this.getItemUid(e);if(t&&t.shiftKey&&""!==u&&""!==this.sLastUid&&u!==this.sLastUid)for(r=this.list(),a=e.checked(),i=0,o=r.length;o>i;i++)l=r[i],c=this.getItemUid(l),s=!1,c!==this.sLastUid&&c!==u||(s=!0),s&&(n=!n),(n||s)&&l.checked(a);this.sLastUid=""===u?"":u},e.prototype.on=function(e,t){this.oCallbacks[e]=t},e.prototype.selectMessageItem=function(e){this.focusedItem(e),this.selectedItem(e),this.scrollToFocused()},e}();t.Selector=d,t["default"]=d,e.exports=d},function(e,t,i){!function(){"use strict";function t(e,t,i){r.call(this,"AccountModel"),this.email=e,this.count=s.observable(i||0),this.deleteAccess=s.observable(!1),this.canBeDeleted=s.observable(n.isUnd(t)?!0:!!t),this.canBeEdit=this.canBeDeleted}var o=i(3),s=i(2),n=i(1),r=i(27);o.extend(t.prototype,r.prototype),t.prototype.email="",t.prototype.changeAccountLink=function(){return i(12).change(this.email)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t,i,o,r,l,c){a.call(this,"ComposeAttachmentModel"),this.id=e,this.isInline=n.isUnd(o)?!1:!!o,this.isLinked=n.isUnd(r)?!1:!!r,this.CID=n.isUnd(l)?"":l,this.contentLocation=n.isUnd(c)?"":c,this.fromMessage=!1,this.fileName=s.observable(t),this.size=s.observable(n.isUnd(i)?null:i),this.tempName=s.observable(""),this.progress=s.observable(0),this.error=s.observable(""),this.waiting=s.observable(!0),this.uploading=s.observable(!1),this.enabled=s.observable(!0),this.complete=s.observable(!1),this.progressText=s.computed(function(){var e=this.progress();return 0===e?"":""+(e>98?100:e)+"%"},this),this.progressStyle=s.computed(function(){var e=this.progress();return 0===e?"":"width:"+(e>98?100:e)+"%"},this),this.title=s.computed(function(){var e=this.error();return""!==e?e:this.fileName()},this),this.friendlySize=s.computed(function(){var e=this.size();return null===e?"":n.friendlySize(this.size())},this),this.mimeType=s.computed(function(){return n.mimeContentType(this.fileName())},this),this.fileExt=s.computed(function(){return n.getFileExtension(this.fileName())},this),this.regDisposables([this.progressText,this.progressStyle,this.title,this.friendlySize,this.mimeType,this.fileExt])}var o=i(3),s=i(2),n=i(1),r=i(86),a=i(27);o.extend(t.prototype,a.prototype),t.prototype.id="",t.prototype.isInline=!1,t.prototype.isLinked=!1,t.prototype.CID="",t.prototype.contentLocation="",t.prototype.fromMessage=!1,t.prototype.cancel=n.emptyFunction,t.prototype.initByUploadJson=function(e){var t=!1;return e&&(this.fileName(e.Name),this.size(n.isUnd(e.Size)?0:n.pInt(e.Size)),this.tempName(n.isUnd(e.TempName)?"":e.TempName),this.isInline=!1,t=!0),t},t.prototype.iconClass=function(){return r.staticIconClass(r.staticFileType(this.fileExt(),this.mimeType()))[0]},t.prototype.iconText=function(){return r.staticIconClass(r.staticFileType(this.fileExt(),this.mimeType()))[1]},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){l.call(this,"ContactModel"),this.idContact=0,this.display="",this.properties=[],this.readOnly=!1,this.focused=s.observable(!1),this.selected=s.observable(!1),this.checked=s.observable(!1),this.deleted=s.observable(!1)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(12),l=i(27);o.extend(t.prototype,l.prototype),t.prototype.getNameAndEmailHelper=function(){var e="",t="";return r.isNonEmptyArray(this.properties)&&o.each(this.properties,function(i){i&&(n.ContactPropertyType.FirstName===i[0]?e=r.trim(i[1]+" "+e):n.ContactPropertyType.LastName===i[0]?e=r.trim(e+" "+i[1]):""===t&&n.ContactPropertyType.Email===i[0]&&(t=i[1]))},this),""===t?null:[t,e]},t.prototype.parse=function(e){var t=!1;return e&&"Object/Contact"===e["@Object"]&&(this.idContact=r.pInt(e.IdContact),this.display=r.pString(e.Display),this.readOnly=!!e.ReadOnly,r.isNonEmptyArray(e.Properties)&&o.each(e.Properties,function(e){e&&e.Type&&r.isNormal(e.Value)&&r.isNormal(e.TypeStr)&&this.properties.push([r.pInt(e.Type),r.pString(e.Value),r.pString(e.TypeStr)])},this),t=!0),t},t.prototype.srcAttr=function(){return a.emptyContactPic()},t.prototype.generateUid=function(){return""+this.idContact},t.prototype.lineAsCss=function(){var e=[];return this.deleted()&&e.push("deleted"),this.selected()&&e.push("selected"),this.checked()&&e.push("checked"),this.focused()&&e.push("focused"),e.join(" ")},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t,i,o,c){l.call(this,"ContactPropertyModel"),this.type=s.observable(r.isUnd(e)?n.ContactPropertyType.Unknown:e),this.typeStr=s.observable(r.isUnd(t)?"":t),this.focused=s.observable(r.isUnd(o)?!1:!!o),this.value=s.observable(r.pString(i)),this.placeholder=s.observable(c||""),this.placeholderValue=s.computed(function(){var e=this.placeholder();return e?a.i18n(e):""},this),this.largeValue=s.computed(function(){return n.ContactPropertyType.Note===this.type()},this),this.regDisposables([this.placeholderValue,this.largeValue])}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(27);o.extend(t.prototype,l.prototype),e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){a.call(this,"FilterConditionModel"),this.field=s.observable(n.FilterConditionField.From),this.type=s.observable(n.FilterConditionType.Contains),this.value=s.observable(""),this.value.error=s.observable(!1),this.valueSecond=s.observable(""),this.valueSecond.error=s.observable(!1),this.template=s.computed(function(){var e="";switch(this.field()){case n.FilterConditionField.Size:e="SettingsFiltersConditionSize";break;case n.FilterConditionField.Header:e="SettingsFiltersConditionMore";break;default:e="SettingsFiltersConditionDefault"}return e},this),this.field.subscribe(function(){this.value(""),this.valueSecond("")},this),this.regDisposables([this.template])}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(27);o.extend(t.prototype,a.prototype),t.prototype.verify=function(){return""===this.value()?(this.value.error(!0),!1):n.FilterConditionField.Header===this.field()&&""===this.valueSecond()?(this.valueSecond.error(!0),!1):!0},t.prototype.parse=function(e){return e&&e.Field&&e.Type?(this.field(r.pString(e.Field)),this.type(r.pString(e.Type)),this.value(r.pString(e.Value)),this.valueSecond(r.pString(e.ValueSecond)),!0):!1},t.prototype.toJson=function(){return{Field:this.field(),Type:this.type(),Value:this.value(),ValueSecond:this.valueSecond()}},t.prototype.cloneSelf=function(){var e=new t;return e.field(this.field()),e.type(this.type()),e.value(this.value()),e.valueSecond(this.valueSecond()),e},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){u.call(this,"FolderModel"),this.name=s.observable(""),this.fullName="",this.fullNameRaw="",this.fullNameHash="",this.delimiter="",this.namespace="",this.deep=0,this.interval=0,this.selectable=!1,this.existen=!0,this.type=s.observable(n.FolderType.User),this.focused=s.observable(!1),this.selected=s.observable(!1),this.edited=s.observable(!1),this.collapsed=s.observable(!0),this.subScribed=s.observable(!0),this.checkable=s.observable(!1),this.subFolders=s.observableArray([]),this.deleteAccess=s.observable(!1),this.actionBlink=s.observable(!1).extend({falseTimeout:1e3}),this.nameForEdit=s.observable(""),this.privateMessageCountAll=s.observable(0),this.privateMessageCountUnread=s.observable(0),this.collapsedPrivate=s.observable(!0)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(25),l=i(6),c=i(19),u=i(27);o.extend(t.prototype,u.prototype),t.newInstanceFromJson=function(e){var i=new t;return i.initByJson(e)?i.initComputed():null},t.prototype.initComputed=function(){var e=c.getFolderInboxName();return this.isInbox=s.computed(function(){return n.FolderType.Inbox===this.type()},this),this.hasSubScribedSubfolders=s.computed(function(){return!!o.find(this.subFolders(),function(e){return(e.subScribed()||e.hasSubScribedSubfolders())&&!e.isSystemFolder()})},this),this.canBeEdited=s.computed(function(){return n.FolderType.User===this.type()&&this.existen&&this.selectable},this),this.visible=s.computed(function(){var e=this.subScribed(),t=this.hasSubScribedSubfolders();return e||t&&(!this.existen||!this.selectable)},this),this.isSystemFolder=s.computed(function(){return n.FolderType.User!==this.type()},this),this.hidden=s.computed(function(){var e=this.isSystemFolder(),t=this.hasSubScribedSubfolders();return e&&!t||!this.selectable&&!t},this),this.selectableForFolderList=s.computed(function(){return!this.isSystemFolder()&&this.selectable},this),this.messageCountAll=s.computed({read:this.privateMessageCountAll,write:function(e){r.isPosNumeric(e,!0)?this.privateMessageCountAll(e):this.privateMessageCountAll.valueHasMutated()},owner:this}).extend({notify:"always"}),this.messageCountUnread=s.computed({read:this.privateMessageCountUnread,write:function(e){r.isPosNumeric(e,!0)?this.privateMessageCountUnread(e):this.privateMessageCountUnread.valueHasMutated()},owner:this}).extend({notify:"always"}),this.printableUnreadCount=s.computed(function(){var e=this.messageCountAll(),t=this.messageCountUnread(),i=this.type();if(e>0){if(n.FolderType.Draft===i)return""+e;if(t>0&&n.FolderType.Trash!==i&&n.FolderType.Archive!==i&&n.FolderType.SentItems!==i)return""+t}return""},this),this.canBeDeleted=s.computed(function(){var t=this.isSystemFolder();return!t&&0===this.subFolders().length&&e!==this.fullNameRaw},this),this.canBeSubScribed=s.computed(function(){return!this.isSystemFolder()&&this.selectable&&e!==this.fullNameRaw},this),this.canBeChecked=this.canBeSubScribed,this.localName=s.computed(function(){l.trigger();var e=this.type(),t=this.name();if(this.isSystemFolder())switch(e){case n.FolderType.Inbox:t=l.i18n("FOLDER_LIST/INBOX_NAME");break;case n.FolderType.SentItems:t=l.i18n("FOLDER_LIST/SENT_NAME");break;case n.FolderType.Draft:t=l.i18n("FOLDER_LIST/DRAFTS_NAME");break;case n.FolderType.Spam:t=l.i18n("FOLDER_LIST/SPAM_NAME");break;case n.FolderType.Trash:t=l.i18n("FOLDER_LIST/TRASH_NAME");break;case n.FolderType.Archive:t=l.i18n("FOLDER_LIST/ARCHIVE_NAME")}return t},this),this.manageFolderSystemName=s.computed(function(){l.trigger();var e="",t=this.type(),i=this.name();if(this.isSystemFolder())switch(t){case n.FolderType.Inbox:e="("+l.i18n("FOLDER_LIST/INBOX_NAME")+")";break;case n.FolderType.SentItems:e="("+l.i18n("FOLDER_LIST/SENT_NAME")+")";break;case n.FolderType.Draft:e="("+l.i18n("FOLDER_LIST/DRAFTS_NAME")+")";break;case n.FolderType.Spam:e="("+l.i18n("FOLDER_LIST/SPAM_NAME")+")";break;case n.FolderType.Trash:e="("+l.i18n("FOLDER_LIST/TRASH_NAME")+")";break;case n.FolderType.Archive:e="("+l.i18n("FOLDER_LIST/ARCHIVE_NAME")+")"}return(""!==e&&"("+i+")"===e||"(inbox)"===e.toLowerCase())&&(e=""),e},this),this.collapsed=s.computed({read:function(){return!this.hidden()&&this.collapsedPrivate()},write:function(e){this.collapsedPrivate(e)},owner:this}),this.hasUnreadMessages=s.computed(function(){return 0<this.messageCountUnread()&&""!==this.printableUnreadCount()},this),this.hasSubScribedUnreadMessagesSubfolders=s.computed(function(){return!!o.find(this.subFolders(),function(e){return e.hasUnreadMessages()||e.hasSubScribedUnreadMessagesSubfolders()})},this),this.name.subscribe(function(e){this.nameForEdit(e)},this),this.edited.subscribe(function(e){e&&this.nameForEdit(this.name())},this),this.messageCountUnread.subscribe(function(e){n.FolderType.Inbox===this.type()&&a.pub("mailbox.inbox-unread-count",[e])},this),this},t.prototype.fullName="",t.prototype.fullNameRaw="",t.prototype.fullNameHash="",t.prototype.delimiter="",t.prototype.namespace="",t.prototype.deep=0,t.prototype.interval=0,t.prototype.collapsedCss=function(){return this.hasSubScribedSubfolders()?this.collapsed()?"icon-right-mini e-collapsed-sign":"icon-down-mini e-collapsed-sign":"icon-none e-collapsed-sign"},t.prototype.initByJson=function(e){var t=!1,i=c.getFolderInboxName();return e&&"Object/Folder"===e["@Object"]&&(this.name(e.Name),this.delimiter=e.Delimiter,this.fullName=e.FullName,this.fullNameRaw=e.FullNameRaw,this.fullNameHash=e.FullNameHash,this.deep=e.FullNameRaw.split(this.delimiter).length-1,this.selectable=!!e.IsSelectable,this.existen=!!e.IsExists,this.subScribed(!!e.IsSubscribed),this.checkable(!!e.Checkable),this.type(i===this.fullNameRaw?n.FolderType.Inbox:n.FolderType.User),t=!0),t},t.prototype.printableFullName=function(){return this.fullName.split(this.delimiter).join(" / ")},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t){n.call(this,"IdentityModel"),this.id=s.observable(e||""),this.email=s.observable(t),this.name=s.observable(""),this.replyTo=s.observable(""),this.bcc=s.observable(""),this.signature=s.observable(""),this.signatureInsertBefore=s.observable(!1),this.deleteAccess=s.observable(!1),this.canBeDeleted=s.computed(function(){return""!==this.id()},this)}var o=i(3),s=i(2),n=i(27);o.extend(t.prototype,n.prototype),t.prototype.formattedName=function(){var e=this.name(),t=this.email();return""!==e?e+" ("+t+")":t},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){h.call(this,"MessageModel"),this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject=r.observable(""),this.subjectPrefix=r.observable(""),this.subjectSuffix=r.observable(""),this.size=r.observable(0),this.dateTimeStampInUTC=r.observable(0),this.priority=r.observable(a.MessagePriority.Normal),this.proxy=!1,this.fromEmailString=r.observable(""),this.fromClearEmailString=r.observable(""),this.toEmailsString=r.observable(""),this.toClearEmailsString=r.observable(""),this.senderEmailsString=r.observable(""),this.senderClearEmailsString=r.observable(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation=r.observable(!1),this.deleted=r.observable(!1),this.deletedMark=r.observable(!1),this.unseen=r.observable(!1),this.flagged=r.observable(!1),this.answered=r.observable(!1),this.forwarded=r.observable(!1),this.isReadReceipt=r.observable(!1),this.focused=r.observable(!1),this.selected=r.observable(!1),this.checked=r.observable(!1),this.hasAttachments=r.observable(!1),this.attachmentsSpecData=r.observableArray([]),this.attachmentIconClass=r.computed(function(){return d.staticCombinedIconClass(this.hasAttachments()?this.attachmentsSpecData():[])},this),this.body=null,this.isHtml=r.observable(!1),this.hasImages=r.observable(!1),this.attachments=r.observableArray([]),this.isPgpSigned=r.observable(!1),this.isPgpEncrypted=r.observable(!1),this.pgpSignedVerifyStatus=r.observable(a.SignedVerifyStatus.None),this.pgpSignedVerifyUser=r.observable(""),this.priority=r.observable(a.MessagePriority.Normal),this.readReceipt=r.observable(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.hasUnseenSubMessage=r.observable(!1),this.hasFlaggedSubMessage=r.observable(!1),this.threads=r.observableArray([]),this.threadsLen=r.computed(function(){return this.threads().length},this),this.isImportant=r.computed(function(){return a.MessagePriority.High===this.priority()},this),this.regDisposables([this.attachmentIconClass,this.threadsLen,this.isImportant])}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(4),l=i(1),c=i(8),u=i(12),d=i(86),p=i(85),h=i(27);s.extend(t.prototype,h.prototype),t.newInstanceFromJson=function(e){var i=new t;return i.initByJson(e)?i:null},t.prototype.clear=function(){this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject(""),this.subjectPrefix(""),this.subjectSuffix(""),this.size(0),this.dateTimeStampInUTC(0),this.priority(a.MessagePriority.Normal),this.proxy=!1,this.fromEmailString(""),this.fromClearEmailString(""),this.toEmailsString(""),this.toClearEmailsString(""),this.senderEmailsString(""),this.senderClearEmailsString(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation(!1),this.deleted(!1),this.deletedMark(!1),this.unseen(!1),this.flagged(!1),this.answered(!1),this.forwarded(!1),this.isReadReceipt(!1),this.selected(!1),this.checked(!1),this.hasAttachments(!1),this.attachmentsSpecData([]),this.body=null,this.isHtml(!1),this.hasImages(!1),this.attachments([]),this.isPgpSigned(!1),this.isPgpEncrypted(!1),this.pgpSignedVerifyStatus(a.SignedVerifyStatus.None),this.pgpSignedVerifyUser(""),this.priority(a.MessagePriority.Normal),this.readReceipt(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.threads([]),this.hasUnseenSubMessage(!1),this.hasFlaggedSubMessage(!1)},t.prototype.getRecipientsEmails=function(){return this.getEmails(["to","cc"])},t.prototype.getEmails=function(e){var t=this;return s.compact(s.uniq(s.map(s.reduce(e,function(e,i){return e.concat(t[i])},[]),function(e){return e?e.email:""})))},t.prototype.friendlySize=function(){return l.friendlySize(this.size())},t.prototype.computeSenderEmail=function(){var e=i(21).sentFolder(),t=i(21).draftFolder();this.senderEmailsString(this.folderFullNameRaw===e||this.folderFullNameRaw===t?this.toEmailsString():this.fromEmailString()),this.senderClearEmailsString(this.folderFullNameRaw===e||this.folderFullNameRaw===t?this.toClearEmailsString():this.fromClearEmailString())},t.prototype.initByJson=function(e){var t=!1,i=a.MessagePriority.Normal;return e&&"Object/Message"===e["@Object"]&&(i=l.pInt(e.Priority),this.priority(-1<l.inArray(i,[a.MessagePriority.High,a.MessagePriority.Low])?i:a.MessagePriority.Normal),this.folderFullNameRaw=e.Folder,this.uid=e.Uid,this.hash=e.Hash,this.requestHash=e.RequestHash,this.proxy=!!e.ExternalProxy,this.size(l.pInt(e.Size)),this.from=p.emailArrayFromJson(e.From),this.to=p.emailArrayFromJson(e.To),this.cc=p.emailArrayFromJson(e.Cc),this.bcc=p.emailArrayFromJson(e.Bcc),this.replyTo=p.emailArrayFromJson(e.ReplyTo),this.deliveredTo=p.emailArrayFromJson(e.DeliveredTo),this.subject(e.Subject),l.isArray(e.SubjectParts)?(this.subjectPrefix(e.SubjectParts[0]),this.subjectSuffix(e.SubjectParts[1])):(this.subjectPrefix(""),this.subjectSuffix(this.subject())),this.dateTimeStampInUTC(l.pInt(e.DateTimeStampInUTC)),this.hasAttachments(!!e.HasAttachments),this.attachmentsSpecData(l.isArray(e.AttachmentsSpecData)?e.AttachmentsSpecData:[]),this.fromEmailString(p.emailArrayToString(this.from,!0)),this.fromClearEmailString(p.emailArrayToStringClear(this.from)),this.toEmailsString(p.emailArrayToString(this.to,!0)),this.toClearEmailsString(p.emailArrayToStringClear(this.to)),this.threads(l.isArray(e.Threads)?e.Threads:[]),this.initFlagsByJson(e),this.computeSenderEmail(),t=!0),t},t.prototype.initUpdateByMessageJson=function(e){var t=!1,o=a.MessagePriority.Normal;return e&&"Object/Message"===e["@Object"]&&(o=l.pInt(e.Priority),this.priority(-1<l.inArray(o,[a.MessagePriority.High,a.MessagePriority.Low])?o:a.MessagePriority.Normal),this.aDraftInfo=e.DraftInfo,this.sMessageId=e.MessageId,this.sInReplyTo=e.InReplyTo,this.sReferences=e.References,this.proxy=!!e.ExternalProxy,i(33).capaOpenPGP()&&(this.isPgpSigned(!!e.PgpSigned),this.isPgpEncrypted(!!e.PgpEncrypted)),this.hasAttachments(!!e.HasAttachments),this.attachmentsSpecData(l.isArray(e.AttachmentsSpecData)?e.AttachmentsSpecData:[]),this.foundedCIDs=l.isArray(e.FoundedCIDs)?e.FoundedCIDs:[],this.attachments(this.initAttachmentsFromJson(e.Attachments)),this.readReceipt(e.ReadReceipt||""),this.computeSenderEmail(),t=!0),t},t.prototype.initAttachmentsFromJson=function(e){var t=0,i=0,o=null,s=[];if(e&&"Collection/AttachmentCollection"===e["@Object"]&&l.isNonEmptyArray(e["@Collection"]))for(t=0,i=e["@Collection"].length;i>t;t++)o=d.newInstanceFromJson(e["@Collection"][t]),o&&(""!==o.cidWithOutTags&&0<this.foundedCIDs.length&&0<=l.inArray(o.cidWithOutTags,this.foundedCIDs)&&(o.isLinked=!0),s.push(o));return s},t.prototype.initFlagsByJson=function(e){var t=!1;return e&&"Object/Message"===e["@Object"]&&(this.unseen(!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),this.isReadReceipt(!!e.IsReadReceipt),this.deletedMark(!!e.IsDeleted),t=!0),t},t.prototype.fromToLine=function(e,t){return p.emailArrayToString(this.from,e,t)},t.prototype.fromDkimData=function(){var e=["none",""];return l.isNonEmptyArray(this.from)&&1===this.from.length&&this.from[0]&&this.from[0].dkimStatus&&(e=[this.from[0].dkimStatus,this.from[0].dkimValue||""]),e},t.prototype.toToLine=function(e,t){return p.emailArrayToString(this.to,e,t)},t.prototype.ccToLine=function(e,t){return p.emailArrayToString(this.cc,e,t)},t.prototype.bccToLine=function(e,t){return p.emailArrayToString(this.bcc,e,t)},t.prototype.replyToToLine=function(e,t){return p.emailArrayToString(this.replyTo,e,t)},t.prototype.lineAsCss=function(){var e=[];return this.deleted()&&e.push("deleted"),this.deletedMark()&&e.push("deleted-mark"),this.selected()&&e.push("selected"),this.checked()&&e.push("checked"),this.flagged()&&e.push("flagged"),this.unseen()&&e.push("unseen"),this.answered()&&e.push("answered"),this.forwarded()&&e.push("forwarded"),this.focused()&&e.push("focused"),this.isImportant()&&e.push("important"),this.hasAttachments()&&e.push("withAttachments"),this.newForAnimation()&&e.push("new"),""===this.subject()&&e.push("emptySubject"),this.hasUnseenSubMessage()&&e.push("hasUnseenSubMessage"),this.hasFlaggedSubMessage()&&e.push("hasFlaggedSubMessage"),e.join(" ")},t.prototype.hasVisibleAttachments=function(){return!!s.find(this.attachments(),function(e){return!e.isLinked})},t.prototype.findAttachmentByCid=function(e){var t=null,i=this.attachments();return l.isNonEmptyArray(i)&&(e=e.replace(/^<+/,"").replace(/>+$/,""),t=s.find(i,function(t){return e===t.cidWithOutTags})),t||null},t.prototype.findAttachmentByContentLocation=function(e){var t=null,i=this.attachments();return l.isNonEmptyArray(i)&&(t=s.find(i,function(t){return e===t.contentLocation})),t||null},t.prototype.messageId=function(){return this.sMessageId},t.prototype.inReplyTo=function(){return this.sInReplyTo},t.prototype.references=function(){return this.sReferences},t.prototype.fromAsSingleEmail=function(){return l.isArray(this.from)&&this.from[0]?this.from[0].email:""},t.prototype.viewLink=function(){return u.messageViewLink(this.requestHash)},t.prototype.downloadLink=function(){return u.messageDownloadLink(this.requestHash)},t.prototype.replyEmails=function(e,t){var i=[],o=l.isUnd(e)?{}:e;return p.replyHelper(this.replyTo,o,i),0===i.length&&p.replyHelper(this.from,o,i),0!==i.length||t?i:this.replyEmails({},!0)},t.prototype.replyAllEmails=function(e,t){var i=[],o=[],s=[],n=l.isUnd(e)?{}:e;return p.replyHelper(this.replyTo,n,o),0===o.length&&p.replyHelper(this.from,n,o),p.replyHelper(this.to,n,o),p.replyHelper(this.cc,n,s),0!==o.length||t?[o,s]:(i=this.replyAllEmails({},!0),[i[0],s])},t.prototype.textBodyToString=function(){return this.body?this.body.html():""},t.prototype.attachmentsToStringLine=function(){var e=s.map(this.attachments(),function(e){return e.fileName+" ("+e.friendlySize+")"});return e&&0<e.length?e.join(", "):""},t.prototype.getDataForWindowPopup=function(){return{popupFrom:this.fromToLine(!1),popupTo:this.toToLine(!1),popupCc:this.ccToLine(!1),popupBcc:this.bccToLine(!1),popupReplyTo:this.replyToToLine(!1),popupSubject:this.subject(),popupIsHtml:this.isHtml(),popupDate:i(26).format(this.dateTimeStampInUTC(),"FULL"),popupAttachments:this.attachmentsToStringLine(),popupBody:this.textBodyToString()}},t.prototype.viewPopupMessage=function(e){l.windowPopupKnockout(this.getDataForWindowPopup(),"PopupsWindowSimpleMessage",this.subject(),function(t){t&&t.document&&t.document.body&&(n("img.lazy",t.document.body).each(function(e,t){var i=n(t),o=i.data("original"),s=i.attr("src");e>=0&&o&&!s&&i.attr("src",o)}),e&&o.setTimeout(function(){t.print()},100))})},t.prototype.printMessage=function(){this.viewPopupMessage(!0)},t.prototype.generateUid=function(){return this.folderFullNameRaw+"/"+this.uid},t.prototype.populateByMessageListItem=function(e){return e&&(this.folderFullNameRaw=e.folderFullNameRaw,this.uid=e.uid,this.hash=e.hash,this.requestHash=e.requestHash,this.subject(e.subject())),this.subjectPrefix(this.subjectPrefix()),this.subjectSuffix(this.subjectSuffix()),e&&(this.size(e.size()),this.dateTimeStampInUTC(e.dateTimeStampInUTC()),this.priority(e.priority()),this.proxy=e.proxy,this.fromEmailString(e.fromEmailString()),this.fromClearEmailString(e.fromClearEmailString()),this.toEmailsString(e.toEmailsString()),this.toClearEmailsString(e.toClearEmailsString()),this.emails=e.emails,this.from=e.from,this.to=e.to,this.cc=e.cc,this.bcc=e.bcc,this.replyTo=e.replyTo,this.deliveredTo=e.deliveredTo,this.unseen(e.unseen()),this.flagged(e.flagged()),this.answered(e.answered()),this.forwarded(e.forwarded()),this.isReadReceipt(e.isReadReceipt()),this.deletedMark(e.deletedMark()),this.priority(e.priority()),this.selected(e.selected()),this.checked(e.checked()),this.hasAttachments(e.hasAttachments()),this.attachmentsSpecData(e.attachmentsSpecData())),this.body=null,this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",e&&this.threads(e.threads()),this.computeSenderEmail(),this},t.prototype.showExternalImages=function(e){if(this.body&&this.body.data("rl-has-images")){var t="";e=l.isUnd(e)?!1:e,this.hasImages(!1),this.body.data("rl-has-images",!1),t=this.proxy?"data-x-additional-src":"data-x-src",n("["+t+"]",this.body).each(function(){e&&n(this).is("img")?n(this).addClass("lazy").attr("data-original",n(this).attr(t)).removeAttr(t):n(this).attr("src",n(this).attr(t)).removeAttr(t)}),t=this.proxy?"data-x-additional-style-url":"data-x-style-url",n("["+t+"]",this.body).each(function(){var e=l.trim(n(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",n(this).attr("style",e+n(this).attr(t)).removeAttr(t)}),e&&(n("img.lazy",this.body).addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:n(".RL-MailMessageView .messageView .messageItem .content")[0]}),c.$win.resize()),l.windowResize(500)}},t.prototype.showInternalImages=function(e){if(this.body&&!this.body.data("rl-init-internal-images")){this.body.data("rl-init-internal-images",!0),e=l.isUnd(e)?!1:e;var t=this;n("[data-x-src-cid]",this.body).each(function(){var i=t.findAttachmentByCid(n(this).attr("data-x-src-cid"));i&&i.download&&(e&&n(this).is("img")?n(this).addClass("lazy").attr("data-original",i.linkPreview()):n(this).attr("src",i.linkPreview()))}),n("[data-x-src-location]",this.body).each(function(){var i=t.findAttachmentByContentLocation(n(this).attr("data-x-src-location"));i||(i=t.findAttachmentByCid(n(this).attr("data-x-src-location"))),i&&i.download&&(e&&n(this).is("img")?n(this).addClass("lazy").attr("data-original",i.linkPreview()):n(this).attr("src",i.linkPreview()))}),n("[data-x-style-cid]",this.body).each(function(){var e="",i="",o=t.findAttachmentByCid(n(this).attr("data-x-style-cid"));o&&o.linkPreview&&(i=n(this).attr("data-x-style-cid-name"),""!==i&&(e=l.trim(n(this).attr("style")),e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",n(this).attr("style",e+i+": url('"+o.linkPreview()+"')")))}),e&&!function(e,t){s.delay(function(){e.addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:t})},300)}(n("img.lazy",t.body),n(".RL-MailMessageView .messageView .messageItem .content")[0]),l.windowResize(500)}},t.prototype.storeDataInDom=function(){this.body&&(this.body.data("rl-is-html",!!this.isHtml()),this.body.data("rl-has-images",!!this.hasImages()))},t.prototype.fetchDataFromDom=function(){this.body&&(this.isHtml(!!this.body.data("rl-is-html")),this.hasImages(!!this.body.data("rl-has-images")))},t.prototype.replacePlaneTextBody=function(e){this.body&&this.body.html(e).addClass("b-text-part plain")},t.prototype.flagHash=function(){return[this.deleted(),this.deletedMark(),this.unseen(),this.flagged(),this.answered(),this.forwarded(),this.isReadReceipt()].join(",")},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t,i,o,r,l,c,u,d){a.call(this,"OpenPgpKeyModel"),this.index=e,this.id=i,this.ids=n.isNonEmptyArray(o)?o:[i],this.guid=t,this.users=r,this.emails=l,this.armor=u,this.isPrivate=!!c,this.selectUser(d),this.deleteAccess=s.observable(!1)}var o=i(3),s=i(2),n=i(1),r=i(33),a=i(27);o.extend(t.prototype,a.prototype),t.prototype.index=0,t.prototype.id="",t.prototype.ids=[],t.prototype.guid="",t.prototype.user="",t.prototype.users=[],t.prototype.email="",t.prototype.emails=[],t.prototype.armor="",t.prototype.isPrivate=!1,t.prototype.getNativeKey=function(){var e=null;try{if(e=r.openpgp.key.readArmored(this.armor),e&&!e.err&&e.keys&&e.keys[0])return e}catch(t){n.log(t)}return null},t.prototype.getNativeKeys=function(){var e=this.getNativeKey();return e&&e.keys?e.keys:null},t.prototype.select=function(e,t){if(this[t]){var i=this[t].indexOf(e);-1!==i&&(this.user=this.users[i],this.email=this.emails[i])}},t.prototype.selectUser=function(e){this.select(e,"users")},t.prototype.selectEmail=function(e){this.select(e,"emails")},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e,t,i){r.call(this,"TemplateModel"),this.id=e,this.name=t,this.body=i,this.populated=!0,this.deleteAccess=s.observable(!1)}var o=i(3),s=i(2),n=i(1),r=i(27);o.extend(t.prototype,r.prototype),t.prototype.id="",t.prototype.name="",t.prototype.body="",t.prototype.populated=!0,t.prototype.parse=function(e){var t=!1;return e&&"Object/Template"===e["@Object"]&&(this.id=n.pString(e.ID),this.name=n.pString(e.Name),this.body=n.pString(e.Body),this.populated=!!e.Populated,t=!0),t},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){h.call(this),this.clear()}var o=i(14),s=i(3),n=i(48),r=i(17),a=i(4),l=i(8),c=i(1),u=i(12),d=i(23),p=i(9),h=i(88);s.extend(t.prototype,h.prototype),t.prototype.oRequests={},t.prototype.clear=function(){this.oRequests={}},t.prototype.abort=function(e,t){return this.oRequests[e]&&(!t&&this.oRequests[e].abort&&(this.oRequests[e].__aborted__=!0,this.oRequests[e].abort()),this.oRequests[e]=null,delete this.oRequests[e]),this},t.prototype.ajaxRequest=function(e,t,i,s,h,f){var m=null,g=this,b=c.microtime(),y=n.defer();return i=c.isNormal(i)?i:r.DEFAULT_AJAX_TIMEOUT,h=c.isUnd(h)?"":c.pString(h),t&&(s.XToken=p.appSettingsGet("token")),d.runHook("ajax-default-request",[e,s,h]),this.setTrigger(f,!0),m=o.ajax({type:t?"POST":"GET",url:u.ajax(h),async:!0,dataType:"json",data:t?s||{}:{},timeout:i,global:!0}).always(function(t,i){var o=!1,n=null,u=a.StorageResultType.Error;switch(t&&t.Time&&(o=c.pInt(t.Time)>c.microtime()-b),!0){case"success"===i&&t&&t.Result&&e===t.Action:u=a.StorageResultType.Success;break;case!("abort"!==i||t&&t.__aborted__):u=a.StorageResultType.Abort}d.runHook("ajax-default-response",[e,a.StorageResultType.Success===u?t:null,u,o,s]),"success"===i?t&&t.Result&&e===t.Action?(t.__cached__=o,y.resolve(t)):t&&t.Action?(n=t,y.reject(t.ErrorCode?t.ErrorCode:a.Notification.AjaxFalse)):(n=t,y.reject(a.Notification.AjaxParse)):"timeout"===i?(n=t,y.reject(a.Notification.AjaxTimeout)):"abort"===i?t&&t.__aborted__||y.reject(a.Notification.AjaxAbort):(n=t,y.reject(a.Notification.AjaxParse)),g.oRequests[e]&&(g.oRequests[e]=null,delete g.oRequests[e]),g.setTrigger(f,!1),n&&(-1<c.inArray(n.ErrorCode,[a.Notification.AuthError,a.Notification.AccessError,a.Notification.ConnectionError,a.Notification.DomainNotAllowed,a.Notification.AccountNotAllowed,a.Notification.MailServerError,a.Notification.UnknownNotification,a.Notification.UnknownError])&&l.iAjaxErrorCount++,a.Notification.InvalidToken===n.ErrorCode&&l.iTokenErrorCount++,
r.TOKEN_ERROR_LIMIT<l.iTokenErrorCount&&l.__APP__&&l.__APP__.loginAndLogoutReload&&l.__APP__.loginAndLogoutReload(!1,!0),(n.ClearAuth||n.Logout||r.AJAX_ERROR_LIMIT<l.iAjaxErrorCount)&&(l.__APP__&&l.__APP__.clearClientSideToken&&l.__APP__.clearClientSideToken(),l.__APP__&&!n.ClearAuth&&l.__APP__.loginAndLogoutReload&&l.__APP__.loginAndLogoutReload(!1,!0)))}),m&&(this.oRequests[e]&&(this.oRequests[e]=null,delete this.oRequests[e]),this.oRequests[e]=m),y.promise},t.prototype.getRequest=function(e,t,i,o){return i=c.isUnd(i)?"":c.pString(i),i=e+"/"+i,this.ajaxRequest(e,!1,o,null,i,t)},t.prototype.postRequest=function(e,t,i,o){return i=i||{},i.Action=e,this.ajaxRequest(e,!0,o,i,"",t)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){h.call(this)}var o=i(3),s=i(17),n=i(4),r=i(1),a=i(19),l=i(24),c=i(21),u=i(9),d=i(47),p=i(106),h=i(88);o.extend(t.prototype,h.prototype),t.prototype.isFolderExpanded=function(e){var t=d.get(n.ClientSideKeyName.ExpandedFolders);return r.isArray(t)&&-1!==o.indexOf(t,e)},t.prototype.normalizeFolder=function(e){return""===e||s.UNUSED_OPTION_VALUE===e||null!==a.getFolderFromCacheList(e)?e:""},t.prototype.folderResponseParseRec=function(e,t){var i=this,o=0,s=0,n=null,l=null,u="",d=[],h=[];for(o=0,s=t.length;s>o;o++)n=t[o],n&&(u=n.FullNameRaw,l=a.getFolderFromCacheList(u),l||(l=p.newInstanceFromJson(n),l&&(a.setFolderToCacheList(u,l),a.setFolderFullNameRaw(l.fullNameHash,u,l))),l&&(c.displaySpecSetting()?l.checkable(!!n.Checkable):l.checkable(!0),l.collapsed(!i.isFolderExpanded(l.fullNameHash)),n.Extended&&(n.Extended.Hash&&a.setFolderHash(l.fullNameRaw,n.Extended.Hash),r.isNormal(n.Extended.MessageCount)&&l.messageCountAll(n.Extended.MessageCount),r.isNormal(n.Extended.MessageUnseenCount)&&l.messageCountUnread(n.Extended.MessageUnseenCount)),d=n.SubFolders,d&&"Collection/FolderCollection"===d["@Object"]&&d["@Collection"]&&r.isArray(d["@Collection"])&&l.subFolders(this.folderResponseParseRec(e,d["@Collection"])),h.push(l)));return h},t.prototype.foldersList=function(e){if(e&&"Collection/FolderCollection"===e["@Object"]&&e["@Collection"]&&r.isArray(e["@Collection"])){var t=r.pInt(u.appSettingsGet("folderSpecLimit")),i=r.pInt(e.CountRec);t=t>100?100:10>t?10:t,c.displaySpecSetting(0>=i||i>t),c.folderList(this.folderResponseParseRec(r.isUnd(e.Namespace)?"":e.Namespace,e["@Collection"]))}},t.prototype.foldersAdditionalParameters=function(e){if(e&&e&&"Collection/FolderCollection"===e["@Object"]&&e["@Collection"]&&r.isArray(e["@Collection"])){r.isUnd(e.Namespace)||(c.namespace=e.Namespace),l.threadsAllowed(!!u.appSettingsGet("useImapThread")&&e.IsThreadsSupported&&!0),c.folderList.optimized(!!e.Optimized);var t=!1;e.SystemFolders&&""==""+u.settingsGet("SentFolder")+u.settingsGet("DraftFolder")+u.settingsGet("SpamFolder")+u.settingsGet("TrashFolder")+u.settingsGet("ArchiveFolder")+u.settingsGet("NullFolder")&&(u.settingsSet("SentFolder",e.SystemFolders[n.ServerFolderType.SENT]||null),u.settingsSet("DraftFolder",e.SystemFolders[n.ServerFolderType.DRAFTS]||null),u.settingsSet("SpamFolder",e.SystemFolders[n.ServerFolderType.JUNK]||null),u.settingsSet("TrashFolder",e.SystemFolders[n.ServerFolderType.TRASH]||null),u.settingsSet("ArchiveFolder",e.SystemFolders[n.ServerFolderType.ALL]||null),t=!0),c.sentFolder(this.normalizeFolder(u.settingsGet("SentFolder"))),c.draftFolder(this.normalizeFolder(u.settingsGet("DraftFolder"))),c.spamFolder(this.normalizeFolder(u.settingsGet("SpamFolder"))),c.trashFolder(this.normalizeFolder(u.settingsGet("TrashFolder"))),c.archiveFolder(this.normalizeFolder(u.settingsGet("ArchiveFolder"))),t&&i(15).saveSystemFolders(r.emptyFunction,{SentFolder:c.sentFolder(),DraftFolder:c.draftFolder(),SpamFolder:c.spamFolder(),TrashFolder:c.trashFolder(),ArchiveFolder:c.archiveFolder(),NullFolder:"NullFolder"}),d.set(n.ClientSideKeyName.FoldersLashHash,e.FoldersHash)}},e.exports=new t}()},,,function(e,t,i){!function(){"use strict";function t(){s.call(this,"login",[i(153)])}var o=i(3),s=i(39);o.extend(t.prototype,s.prototype),t.prototype.onShow=function(){i(7)["default"].setWindowTitle("")},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){g.call(this,"mailbox",[i(157),i(154),i(155),i(156)]),this.oLastRoute={}}var o=i(3),s=i(4),n=i(8),r=i(1),a=i(25),l=i(6),c=i(19),u=i(24),d=i(31),p=i(28),h=i(21),f=i(32),m=i(9),g=i(39);o.extend(t.prototype,g.prototype),t.prototype.oLastRoute={},t.prototype.updateWindowTitle=function(){var e=d.email(),t=h.foldersInboxUnreadCount();m.appSettingsGet("listPermanentFiltered")&&(t=0),i(7)["default"].setWindowTitle((""===e?"":""+(t>0?"("+t+") ":" ")+e+" - ")+l.i18n("TITLES/MAILBOX"))},t.prototype.onShow=function(){this.updateWindowTitle(),u.focusedState(s.Focused.None),u.focusedState(s.Focused.MessageList),m.appSettingsGet("mobile")&&n.leftPanelDisabled(!0),m.capa(s.Capa.Folders)?n.leftPanelType(""):n.leftPanelType(m.capa(s.Capa.Composer)||m.capa(s.Capa.Contacts)?"short":"none")},t.prototype.onRoute=function(e,t,o){var s=e.replace(/^(.+)~([\d]+)$/,"$2"),n=c.getFolderFromCacheList(c.getFolderFullNameRaw(e.replace(/~([\d]+)$/,"")));n&&(e===s&&(s=""),h.currentFolder(n),f.messageListPage(t),f.messageListSearch(o),f.messageListThreadUid(s),i(7)["default"].reloadMessageList())},t.prototype.onStart=function(){h.folderList.subscribe(r.windowResizeCallback),f.messageList.subscribe(r.windowResizeCallback),f.message.subscribe(r.windowResizeCallback),o.delay(function(){p.layout.valueHasMutated()},50),a.sub("mailbox.inbox-unread-count",o.bind(function(e){h.foldersInboxUnreadCount(e);var t=d.email();o.each(d.accounts(),function(i){i&&t===i.email&&i.count(e)}),this.updateWindowTitle()},this))},t.prototype.onBuild=function(){n.bMobileDevice||m.appSettingsGet("mobile")||o.defer(function(){i(7)["default"].initHorizontalLayoutResizer(s.ClientSideKeyName.MessageListSize)})},t.prototype.routes=function(){var e=c.getFolderInboxName(),t=function(t,i){return i[0]=r.pString(i[0]),i[1]=r.pInt(i[1]),i[1]=0>=i[1]?1:i[1],i[2]=r.pString(i[2]),""===t&&(i[0]=e,i[1]=1),[decodeURI(i[0]),i[1],decodeURI(i[2])]},i=function(t,i){return i[0]=r.pString(i[0]),i[1]=r.pString(i[1]),""===t&&(i[0]=e),[decodeURI(i[0]),1,decodeURI(i[1])]};return[[/^([a-zA-Z0-9~]+)\/p([1-9][0-9]*)\/(.+)\/?$/,{normalize_:t}],[/^([a-zA-Z0-9~]+)\/p([1-9][0-9]*)$/,{normalize_:t}],[/^([a-zA-Z0-9~]+)\/(.+)\/?$/,{normalize_:i}],[/^([^\/]*)$/,{normalize_:t}]]},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){p.call(this,[i(160),i(158),i(159)]),r.initOnStartOrLangChange(function(){this.sSettingsTitle=r.i18n("TITLES/SETTINGS")},this,function(){this.setSettingsTitle()})}var o=i(3),s=i(4),n=i(8),r=i(6),a=i(23),l=i(24),c=i(31),u=i(9),d=i(5),p=i(56);o.extend(t.prototype,p.prototype),t.prototype.setupSettings=function(e){return u.capa(s.Capa.Settings)?(d.addSettingsViewModel(i(133),"SettingsGeneral","SETTINGS_LABELS/LABEL_GENERAL_NAME","general",!0),l.contactsIsAllowed()&&d.addSettingsViewModel(i(130),"SettingsContacts","SETTINGS_LABELS/LABEL_CONTACTS_NAME","contacts"),(u.capa(s.Capa.AdditionalAccounts)||u.capa(s.Capa.Identities))&&d.addSettingsViewModel(i(128),"SettingsAccounts",u.capa(s.Capa.AdditionalAccounts)?"SETTINGS_LABELS/LABEL_ACCOUNTS_NAME":"SETTINGS_LABELS/LABEL_IDENTITIES_NAME","accounts"),u.capa(s.Capa.Sieve)&&d.addSettingsViewModel(i(131),"SettingsFilters","SETTINGS_LABELS/LABEL_FILTERS_NAME","filters"),(u.capa(s.Capa.AutoLogout)||u.capa(s.Capa.TwoFactor))&&d.addSettingsViewModel(i(135),"SettingsSecurity","SETTINGS_LABELS/LABEL_SECURITY_NAME","security"),c.isRootAccount()&&(u.settingsGet("AllowGoogleSocial")&&u.settingsGet("AllowGoogleSocialAuth")||u.settingsGet("AllowFacebookSocial")||u.settingsGet("AllowTwitterSocial"))&&d.addSettingsViewModel(i(136),"SettingsSocial","SETTINGS_LABELS/LABEL_SOCIAL_NAME","social"),u.settingsGet("ChangePasswordIsAllowed")&&d.addSettingsViewModel(i(129),"SettingsChangePassword","SETTINGS_LABELS/LABEL_CHANGE_PASSWORD_NAME","change-password"),u.capa(s.Capa.Templates)&&d.addSettingsViewModel(i(137),"SettingsTemplates","SETTINGS_LABELS/LABEL_TEMPLATES_NAME","templates"),u.capa(s.Capa.Folders)&&d.addSettingsViewModel(i(132),"SettingsFolders","SETTINGS_LABELS/LABEL_FOLDERS_NAME","folders"),u.capa(s.Capa.Themes)&&d.addSettingsViewModel(i(138),"SettingsThemes","SETTINGS_LABELS/LABEL_THEMES_NAME","themes"),u.capa(s.Capa.OpenPGP)&&d.addSettingsViewModel(i(134),"SettingsOpenPGP","SETTINGS_LABELS/LABEL_OPEN_PGP_NAME","openpgp"),a.runSettingsViewModelHooks(!1),e&&e(),!0):(e&&e(),!1)},t.prototype.onShow=function(){this.setSettingsTitle(),n.keyScope(s.KeyState.Settings),n.leftPanelType(""),u.appSettingsGet("mobile")&&n.leftPanelDisabled(!0)},t.prototype.setSettingsTitle=function(){var e=c.email();i(7)["default"].setWindowTitle((""===e?"":e+" - ")+this.sSettingsTitle)},e.exports=t}()},,,,,,,,,,,function(e,t,i){!function(){"use strict";function t(){this.allowAdditionalAccount=u.capa(r.Capa.AdditionalAccounts),this.allowIdentities=u.capa(r.Capa.Identities),this.accounts=l.accounts,this.identities=c.identities,this.accountForDeletion=n.observable(null).deleteAccessHelper(),this.identityForDeletion=n.observable(null).deleteAccessHelper()}var o=i(11),s=i(3),n=i(2),r=i(4),a=i(12),l=i(31),c=i(53),u=i(9),d=i(15);t.prototype.scrollableOptions=function(e){return{handle:".drag-handle",containment:e||"parent",axis:"y"}},t.prototype.addNewAccount=function(){i(5).showScreenPopup(i(61))},t.prototype.editAccount=function(e){e&&e.canBeEdit()&&i(5).showScreenPopup(i(61),[e])},t.prototype.addNewIdentity=function(){i(5).showScreenPopup(i(63))},t.prototype.editIdentity=function(e){i(5).showScreenPopup(i(63),[e])},t.prototype.deleteAccount=function(e){if(e&&e.deleteAccess()){this.accountForDeletion(null);var t=i(5),n=function(t){return e===t};e&&(this.accounts.remove(n),d.accountDelete(function(e,n){r.StorageResultType.Success===e&&n&&n.Result&&n.Reload?(t.routeOff(),t.setHash(a.root(),!0),t.routeOff(),s.defer(function(){o.location.reload()})):i(7)["default"].accountsAndIdentities()},e.email))}},t.prototype.deleteIdentity=function(e){e&&e.deleteAccess()&&(this.identityForDeletion(null),e&&(c.identities.remove(function(t){return e===t}),d.identityDelete(function(){i(7)["default"].accountsAndIdentities()},e.id)))},t.prototype.accountsAndIdentitiesAfterMove=function(){d.accountsAndIdentitiesSortOrder(null,l.accountsEmails.peek(),c.identitiesIDS.peek())},t.prototype.onBuild=function(e){var t=this;e.on("click",".accounts-list .account-item .e-action",function(){var e=n.dataFor(this);e&&t.editAccount(e)}).on("click",".identities-list .identity-item .e-action",function(){var e=n.dataFor(this);e&&t.editIdentity(e)})},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.changeProcess=s.observable(!1),this.errorDescription=s.observable(""),this.passwordMismatch=s.observable(!1),this.passwordUpdateError=s.observable(!1),this.passwordUpdateSuccess=s.observable(!1),this.currentPassword=s.observable(""),this.currentPassword.error=s.observable(!1),this.newPassword=s.observable(""),this.newPassword2=s.observable(""),this.currentPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1)},this),this.newPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.newPassword2.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.saveNewPasswordCommand=r.createCommand(this,function(){this.newPassword()!==this.newPassword2()?(this.passwordMismatch(!0),this.errorDescription(a.i18n("SETTINGS_CHANGE_PASSWORD/ERROR_PASSWORD_MISMATCH"))):(this.changeProcess(!0),this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1),this.passwordMismatch(!1),this.errorDescription(""),l.changePassword(this.onChangePasswordResponse,this.currentPassword(),this.newPassword()))},function(){return!this.changeProcess()&&""!==this.currentPassword()&&""!==this.newPassword()&&""!==this.newPassword2()}),this.onChangePasswordResponse=o.bind(this.onChangePasswordResponse,this)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(15);t.prototype.onHide=function(){this.changeProcess(!1),this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.errorDescription(""),this.passwordMismatch(!1),this.currentPassword.error(!1)},t.prototype.onChangePasswordResponse=function(e,t){this.changeProcess(!1),this.passwordMismatch(!1),this.errorDescription(""),this.currentPassword.error(!1),n.StorageResultType.Success===e&&t&&t.Result?(this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.passwordUpdateSuccess(!0),this.currentPassword.error(!1),i(7)["default"].setClientSideToken(t.Result)):(t&&n.Notification.CurrentPasswordIncorrect===t.ErrorCode&&this.currentPassword.error(!0),this.passwordUpdateError(!0),this.errorDescription(a.getNotificationFromResponse(t,n.Notification.CouldNotSaveNewPassword)))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.contactsAutosave=s.contactsAutosave,this.allowContactsSync=n.allowContactsSync,this.enableContactsSync=n.enableContactsSync,this.contactsSyncUrl=n.contactsSyncUrl,this.contactsSyncUser=n.contactsSyncUser,this.contactsSyncPass=n.contactsSyncPass,this.saveTrigger=o.computed(function(){return[this.enableContactsSync()?"1":"0",this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass()].join("|")},this).extend({throttle:500})}var o=i(2),s=i(24),n=i(51),r=i(15);t.prototype.onBuild=function(){this.contactsAutosave.subscribe(function(e){r.saveSettings(null,{ContactsAutosave:e?"1":"0"})}),this.saveTrigger.subscribe(function(){r.saveContactsSyncData(null,this.enableContactsSync(),this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass())},this)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){var e=this;this.modules=l.modules,this.filters=l.filters,this.inited=o.observable(!1),this.serverError=o.observable(!1),this.serverErrorDesc=o.observable(""),this.haveChanges=o.observable(!1),this.saveErrorText=o.observable(""),this.filters.subscribe(r.windowResizeCallback),this.serverError.subscribe(function(e){e||this.serverErrorDesc("")},this),this.filterRaw=l.raw,this.filterRaw.capa=l.capa,this.filterRaw.active=o.observable(!1),this.filterRaw.allow=o.observable(!1),this.filterRaw.error=o.observable(!1),this.filterForDeletion=o.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribeProperty:[this,"deleteAccess"]}),this.saveChanges=r.createCommand(this,function(){if(!this.filters.saving()){if(this.filterRaw.active()&&""===r.trim(this.filterRaw()))return this.filterRaw.error(!0),!1;this.filters.saving(!0),this.saveErrorText(""),c.filtersSave(function(t,i){e.filters.saving(!1),n.StorageResultType.Success===t&&i&&i.Result?(e.haveChanges(!1),e.updateList()):i&&i.ErrorCode?e.saveErrorText(i.ErrorMessageAdditional||a.getNotification(i.ErrorCode)):e.saveErrorText(a.getNotification(n.Notification.CantSaveFilters))},this.filters(),this.filterRaw(),this.filterRaw.active())}return!0},function(){return this.haveChanges()}),this.filters.subscribe(function(){this.haveChanges(!0)},this),this.filterRaw.subscribe(function(){this.haveChanges(!0),this.filterRaw.error(!1)},this),this.haveChanges.subscribe(function(){this.saveErrorText("")},this),this.filterRaw.active.subscribe(function(){this.haveChanges(!0),this.filterRaw.error(!1)},this)}var o=i(2),s=i(3),n=i(4),r=i(1),a=i(6),l=i(90),c=i(15);t.prototype.scrollableOptions=function(e){return{handle:".drag-handle",containment:e||"parent",axis:"y"}},t.prototype.updateList=function(){var e=this,t=i(87);this.filters.loading()||(this.filters.loading(!0),c.filtersGet(function(i,o){if(e.filters.loading(!1),e.serverError(!1),n.StorageResultType.Success===i&&o&&o.Result&&r.isArray(o.Result.Filters)){e.inited(!0),e.serverError(!1);var l=s.compact(s.map(o.Result.Filters,function(e){var i=new t;return i&&i.parse(e)?i:null}));e.filters(l),e.modules(o.Result.Modules?o.Result.Modules:{}),e.filterRaw(o.Result.Raw||""),e.filterRaw.capa(r.isArray(o.Result.Capa)?o.Result.Capa.join(" "):""),e.filterRaw.active(!!o.Result.RawIsActive),e.filterRaw.allow(!!o.Result.RawIsAllow)}else e.filters([]),e.modules({}),e.filterRaw(""),e.filterRaw.capa({}),e.serverError(!0),e.serverErrorDesc(o&&o.ErrorCode?a.getNotification(o.ErrorCode):a.getNotification(n.Notification.CantGetFilters));e.haveChanges(!1)}))},t.prototype.deleteFilter=function(e){this.filters.remove(e),r.delegateRunOnDestroy(e)},t.prototype.addFilter=function(){var e=this,t=i(87),o=new t;o.generateID(),i(5).showScreenPopup(i(94),[o,function(){e.filters.push(o),e.filterRaw.active(!1)},!1])},t.prototype.editFilter=function(e){var t=this,o=e.cloneSelf();i(5).showScreenPopup(i(94),[o,function(){var i=t.filters(),s=i.indexOf(e);s>-1&&i[s]&&(r.delegateRunOnDestroy(i[s]),i[s]=o,t.filters(i),t.haveChanges(!0))},!0])},t.prototype.onBuild=function(e){var t=this;e.on("click",".filter-item .e-action",function(){var e=o.dataFor(this);e&&t.editFilter(e)})},t.prototype.onShow=function(){this.updateList()},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.displaySpecSetting=u.displaySpecSetting,this.folderList=u.folderList,this.folderListHelp=o.observable("").extend({throttle:100}),this.loading=o.computed(function(){var e=u.foldersLoading(),t=u.foldersCreating(),i=u.foldersDeleting(),o=u.foldersRenaming();return e||t||i||o},this),this.folderForDeletion=o.observable(null).deleteAccessHelper(),this.folderForEdit=o.observable(null).extend({toggleSubscribe:[this,function(e){e&&e.edited(!1)},function(e){e&&e.canBeEdited()&&e.edited(!0)}]}),this.useImapSubscribe=!!l.appSettingsGet("useImapSubscribe")}var o=i(2),s=i(4),n=i(1),r=i(6),a=i(19),l=i(9),c=i(47),u=i(21),d=i(41),p=i(15);t.prototype.folderEditOnEnter=function(e){var t=e?n.trim(e.nameForEdit()):"";""!==t&&e.name()!==t&&(c.set(s.ClientSideKeyName.FoldersLashHash,""),i(7)["default"].foldersPromisesActionHelper(d.folderRename(e.fullNameRaw,t,u.foldersRenaming),s.Notification.CantRenameFolder),a.removeFolderFromCacheList(e.fullNameRaw),e.name(t)),e.edited(!1)},t.prototype.folderEditOnEsc=function(e){e&&e.edited(!1)},t.prototype.onShow=function(){u.folderList.error("")},t.prototype.onBuild=function(e){var t=this;e.on("mouseover",".delete-folder-parent",function(){t.folderListHelp(r.i18n("SETTINGS_FOLDERS/HELP_DELETE_FOLDER"))}).on("mouseover",".subscribe-folder-parent",function(){t.folderListHelp(r.i18n("SETTINGS_FOLDERS/HELP_SHOW_HIDE_FOLDER"))}).on("mouseover",".check-folder-parent",function(){t.folderListHelp(r.i18n("SETTINGS_FOLDERS/HELP_CHECK_FOR_NEW_MESSAGES"))}).on("mouseout",".subscribe-folder-parent, .check-folder-parent, .delete-folder-parent",function(){t.folderListHelp("")})},t.prototype.createFolder=function(){i(5).showScreenPopup(i(95))},t.prototype.systemFolder=function(){i(5).showScreenPopup(i(52))},t.prototype.deleteFolder=function(e){if(e&&e.canBeDeleted()&&e.deleteAccess()&&0===e.privateMessageCountAll()){this.folderForDeletion(null);var t=function(i){return e===i?!0:(i.subFolders.remove(t),!1)};e&&(c.set(s.ClientSideKeyName.FoldersLashHash,""),u.folderList.remove(t),i(7)["default"].foldersPromisesActionHelper(d.folderDelete(e.fullNameRaw,u.foldersDeleting),s.Notification.CantDeleteFolder),a.removeFolderFromCacheList(e.fullNameRaw))}else 0<e.privateMessageCountAll()&&u.folderList.error(r.getNotification(s.Notification.CantDeleteNonEmptyFolder))},t.prototype.subscribeFolder=function(e){c.set(s.ClientSideKeyName.FoldersLashHash,""),p.folderSetSubscribe(n.emptyFunction,e.fullNameRaw,!0),e.subScribed(!0)},t.prototype.unSubscribeFolder=function(e){c.set(s.ClientSideKeyName.FoldersLashHash,""),p.folderSetSubscribe(n.emptyFunction,e.fullNameRaw,!1),e.subScribed(!1)},t.prototype.checkableTrueFolder=function(e){p.folderSetCheckable(n.emptyFunction,e.fullNameRaw,!0),e.checkable(!0)},t.prototype.checkableFalseFolder=function(e){p.folderSetCheckable(n.emptyFunction,e.fullNameRaw,!1),e.checkable(!1)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.language=d.language,this.languages=d.languages,this.messagesPerPage=p.messagesPerPage,this.messagesPerPageArray=r.MESSAGES_PER_PAGE_VALUES,this.editorDefaultType=p.editorDefaultType,this.layout=p.layout,this.usePreviewPane=p.usePreviewPane,this.soundNotificationIsSupported=f.soundNotificationIsSupported,this.enableSoundNotification=f.enableSoundNotification,this.enableDesktopNotification=f.enableDesktopNotification,this.isDesktopNotificationSupported=f.isDesktopNotificationSupported,this.isDesktopNotificationDenied=f.isDesktopNotificationDenied,this.showImages=p.showImages,this.useCheckboxesInList=p.useCheckboxesInList,this.threadsAllowed=u.threadsAllowed,this.useThreads=p.useThreads,this.replySameFolder=p.replySameFolder,this.allowLanguagesOnSettings=u.allowLanguagesOnSettings,this.languageFullName=s.computed(function(){return l.convertLangName(this.language())},this),this.languageTrigger=s.observable(n.SaveSettingsStep.Idle).extend({throttle:100}),this.mppTrigger=s.observable(n.SaveSettingsStep.Idle),this.editorDefaultTypeTrigger=s.observable(n.SaveSettingsStep.Idle),this.layoutTrigger=s.observable(n.SaveSettingsStep.Idle),this.isAnimationSupported=a.bAnimationSupported,this.identities=h.identities,this.identityMain=s.computed(function(){var e=this.identities();return l.isArray(e)?o.find(e,function(e){return!(!e||""!==e.id())}):null},this),this.identityMainDesc=s.computed(function(){var e=this.identityMain();return e?e.formattedName():"---"},this),this.editorDefaultTypes=s.computed(function(){return c.trigger(),[{id:n.EditorDefaultType.Html,name:c.i18n("SETTINGS_GENERAL/LABEL_EDITOR_HTML")},{id:n.EditorDefaultType.Plain,name:c.i18n("SETTINGS_GENERAL/LABEL_EDITOR_PLAIN")},{id:n.EditorDefaultType.HtmlForced,name:c.i18n("SETTINGS_GENERAL/LABEL_EDITOR_HTML_FORCED")},{id:n.EditorDefaultType.PlainForced,name:c.i18n("SETTINGS_GENERAL/LABEL_EDITOR_PLAIN_FORCED")}]},this),this.layoutTypes=s.computed(function(){return c.trigger(),[{id:n.Layout.NoPreview,name:c.i18n("SETTINGS_GENERAL/LABEL_LAYOUT_NO_SPLIT")},{id:n.Layout.SidePreview,name:c.i18n("SETTINGS_GENERAL/LABEL_LAYOUT_VERTICAL_SPLIT")},{id:n.Layout.BottomPreview,name:c.i18n("SETTINGS_GENERAL/LABEL_LAYOUT_HORIZONTAL_SPLIT")}]},this)}var o=i(3),s=i(2),n=i(4),r=i(17),a=i(8),l=i(1),c=i(6),u=i(24),d=i(40),p=i(28),h=i(53),f=i(60),m=i(32),g=i(15);t.prototype.editMainIdentity=function(){var e=this.identityMain();e&&i(5).showScreenPopup(i(63),[e])},t.prototype.testSoundNotification=function(){f.playSoundNotification(!0)},t.prototype.onBuild=function(){var e=this;o.delay(function(){var t=l.settingsSaveHelperSimpleFunction(e.editorDefaultTypeTrigger,e),i=l.settingsSaveHelperSimpleFunction(e.mppTrigger,e),s=l.settingsSaveHelperSimpleFunction(e.layoutTrigger,e),r=function(t){return function(){e.languageTrigger(t),o.delay(function(){e.languageTrigger(n.SaveSettingsStep.Idle)},1e3)}};e.language.subscribe(function(t){e.languageTrigger(n.SaveSettingsStep.Animate),c.reload(!1,t,r(n.SaveSettingsStep.TrueResult),r(n.SaveSettingsStep.FalseResult)),g.saveSettings(null,{Language:t})}),e.editorDefaultType.subscribe(function(e){g.saveSettings(t,{EditorDefaultType:e})}),e.messagesPerPage.subscribe(function(e){g.saveSettings(i,{MPP:e})}),e.showImages.subscribe(function(e){g.saveSettings(null,{ShowImages:e?"1":"0"})}),e.enableDesktopNotification.subscribe(function(e){l.timeOutAction("SaveDesktopNotifications",function(){g.saveSettings(null,{DesktopNotifications:e?"1":"0"})},3e3)}),e.enableSoundNotification.subscribe(function(e){l.timeOutAction("SaveSoundNotification",function(){g.saveSettings(null,{SoundNotification:e?"1":"0"})},3e3)}),e.replySameFolder.subscribe(function(e){l.timeOutAction("SaveReplySameFolder",function(){g.saveSettings(null,{ReplySameFolder:e?"1":"0"})},3e3)}),e.useThreads.subscribe(function(e){m.messageList([]),g.saveSettings(null,{UseThreads:e?"1":"0"})}),e.layout.subscribe(function(e){m.messageList([]),g.saveSettings(s,{Layout:e})}),e.useCheckboxesInList.subscribe(function(e){g.saveSettings(null,{UseCheckboxesInList:e?"1":"0"})})},50)},t.prototype.onShow=function(){this.enableDesktopNotification.valueHasMutated()},t.prototype.selectLanguage=function(){i(5).showScreenPopup(i(44),[this.language,this.languages(),d.userLanguage()])},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.openpgpkeys=l.openpgpkeys,this.openpgpkeysPublic=l.openpgpkeysPublic,this.openpgpkeysPrivate=l.openpgpkeysPrivate,this.openPgpKeyForDeletion=s.observable(null).deleteAccessHelper(),this.isHttps=n.document&&n.document.location?"https:"===n.document.location.protocol:!1}var o=i(3),s=i(2),n=i(11),r=i(1),a=i(5),l=i(33);t.prototype.addOpenPgpKey=function(){a.showScreenPopup(i(143))},t.prototype.generateOpenPgpKey=function(){a.showScreenPopup(i(148))},t.prototype.viewOpenPgpKey=function(e){e&&a.showScreenPopup(i(151),[e])},t.prototype.deleteOpenPgpKey=function(e){if(e&&e.deleteAccess()&&(this.openPgpKeyForDeletion(null),e&&l.openpgpKeyring)){var t=o.find(l.openpgpkeys(),function(t){return e===t});t&&(l.openpgpkeys.remove(t),r.delegateRunOnDestroy(t),l.openpgpKeyring[t.isPrivate?"privateKeys":"publicKeys"].removeForId(t.guid),l.openpgpKeyring.store()),i(7)["default"].reloadOpenPgpKeys()}},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.capaAutoLogout=c.capa(n.Capa.AutoLogout),this.capaTwoFactor=c.capa(n.Capa.TwoFactor),this.autoLogout=l.autoLogout,this.autoLogout.trigger=s.observable(n.SaveSettingsStep.Idle),this.autoLogoutOptions=s.computed(function(){return a.trigger(),[{id:0,name:a.i18n("SETTINGS_SECURITY/AUTOLOGIN_NEVER_OPTION_NAME")},{id:5,name:a.i18n("SETTINGS_SECURITY/AUTOLOGIN_MINUTES_OPTION_NAME",{MINUTES:5})},{id:10,name:a.i18n("SETTINGS_SECURITY/AUTOLOGIN_MINUTES_OPTION_NAME",{MINUTES:10})},{id:30,name:a.i18n("SETTINGS_SECURITY/AUTOLOGIN_MINUTES_OPTION_NAME",{MINUTES:30})},{id:60,name:a.i18n("SETTINGS_SECURITY/AUTOLOGIN_MINUTES_OPTION_NAME",{MINUTES:60})}]})}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(28),c=i(9),u=i(15);t.prototype.configureTwoFactor=function(){i(5).showScreenPopup(i(98))},t.prototype.onBuild=function(){if(this.capaAutoLogout){var e=this;o.delay(function(){var t=r.settingsSaveHelperSimpleFunction(e.autoLogout.trigger,e);e.autoLogout.subscribe(function(e){u.saveSettings(t,{AutoLogout:r.pInt(e)})})})}},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){var e=i(1),t=i(34);this.googleEnable=t.google.enabled,this.googleEnableAuth=t.google.capa.auth,this.googleEnableAuthFast=t.google.capa.authFast,this.googleEnableDrive=t.google.capa.drive,this.googleEnablePreview=t.google.capa.preview,this.googleActions=t.google.loading,this.googleLoggined=t.google.loggined,this.googleUserName=t.google.userName,this.facebookEnable=t.facebook.enabled,this.facebookActions=t.facebook.loading,this.facebookLoggined=t.facebook.loggined,this.facebookUserName=t.facebook.userName,this.twitterEnable=t.twitter.enabled,this.twitterActions=t.twitter.loading,this.twitterLoggined=t.twitter.loggined,this.twitterUserName=t.twitter.userName,this.connectGoogle=e.createCommand(this,function(){this.googleLoggined()||i(7)["default"].googleConnect()},function(){return!this.googleLoggined()&&!this.googleActions()}),this.disconnectGoogle=e.createCommand(this,function(){i(7)["default"].googleDisconnect()}),this.connectFacebook=e.createCommand(this,function(){this.facebookLoggined()||i(7)["default"].facebookConnect()},function(){return!this.facebookLoggined()&&!this.facebookActions()}),this.disconnectFacebook=e.createCommand(this,function(){i(7)["default"].facebookDisconnect()}),this.connectTwitter=e.createCommand(this,function(){this.twitterLoggined()||i(7)["default"].twitterConnect()},function(){return!this.twitterLoggined()&&!this.twitterActions()}),this.disconnectTwitter=e.createCommand(this,function(){i(7)["default"].twitterDisconnect()})}e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.templates=n.templates,this.processText=o.computed(function(){return n.templates.loading()?s.i18n("SETTINGS_TEMPLETS/LOADING_PROCESS"):""},this),this.visibility=o.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.templateForDeletion=o.observable(null).deleteAccessHelper()}var o=i(2),s=i(6),n=i(92),r=i(15);t.prototype.scrollableOptions=function(e){return{handle:".drag-handle",containment:e||"parent",axis:"y"}},t.prototype.addNewTemplate=function(){i(5).showScreenPopup(i(97))},t.prototype.editTemplate=function(e){e&&i(5).showScreenPopup(i(97),[e])},t.prototype.deleteTemplate=function(e){if(e&&e.deleteAccess()){this.templateForDeletion(null);var t=this,i=function(t){return e===t};e&&(this.templates.remove(i),r.templateDelete(function(){t.reloadTemplates()},e.id))}},t.prototype.reloadTemplates=function(){i(7)["default"].templates()},t.prototype.onBuild=function(e){var t=this;e.on("click",".templates-list .template-item .e-action",function(){var e=o.dataFor(this);e&&t.editTemplate(e)}),this.reloadTemplates()},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){this.theme=d.theme,this.themes=d.themes,this.themesObjects=n.observableArray([]),this.background={},this.background.name=d.themeBackgroundName,this.background.hash=d.themeBackgroundHash,this.background.uploaderButton=n.observable(null),this.background.loading=n.observable(!1),this.background.error=n.observable(""),this.capaUserBackground=n.observable(p.capa(a.Capa.UserBackground)),this.themeTrigger=n.observable(a.SaveSettingsStep.Idle).extend({throttle:100}),this.iTimer=0,this.oThemeAjaxRequest=null,this.theme.subscribe(function(e){o.each(this.themesObjects(),function(t){t.selected(e===t.name)}),l.changeTheme(e,this.themeTrigger),h.saveSettings(null,{Theme:e})},this),this.background.hash.subscribe(function(e){var t=s("#rl-bg");e?s("#rl-bg").attr("style","background-image: none !important;").backstretch(c.userBackground(e),{fade:1e3,centeredX:!0,centeredY:!0}).removeAttr("style"):t.data("backstretch")&&t.backstretch("destroy").attr("style","")},this)}var o=i(3),s=i(14),n=i(2),r=i(80),a=i(4),l=i(1),c=i(12),u=i(6),d=i(42),p=i(9),h=i(15);t.prototype.onBuild=function(){var e=this.theme();this.themesObjects(o.map(this.themes(),function(t){return{name:t,nameDisplay:l.convertThemeName(t),selected:n.observable(t===e),themePreviewSrc:c.themePreviewLink(t)}})),this.initUploader()},t.prototype.onShow=function(){this.background.error("")},t.prototype.clearBackground=function(){if(this.capaUserBackground()){var e=this;h.clearUserBackground(function(){e.background.name(""),e.background.hash("")})}},t.prototype.initUploader=function(){if(this.background.uploaderButton()&&this.capaUserBackground()){var e=new r({action:c.uploadBackground(),name:"uploader",queueSize:1,multipleSizeLimit:1,disableDragAndDrop:!0,disableMultiple:!0,clickElement:this.background.uploaderButton()});e.on("onStart",o.bind(function(){return this.background.loading(!0),this.background.error(""),!0},this)).on("onComplete",o.bind(function(e,t,i){if(this.background.loading(!1),t&&e&&i&&i.Result&&i.Result.Name&&i.Result.Hash)this.background.name(i.Result.Name),this.background.hash(i.Result.Hash);else{this.background.name(""),this.background.hash("");var o="";if(i.ErrorCode)switch(i.ErrorCode){case a.UploadErrorCode.FileIsTooBig:o=u.i18n("SETTINGS_THEMES/ERROR_FILE_IS_TOO_BIG");break;case a.UploadErrorCode.FileType:o=u.i18n("SETTINGS_THEMES/ERROR_FILE_TYPE_ERROR")}!o&&i.ErrorMessage&&(o=i.ErrorMessage),this.background.error(o||u.i18n("SETTINGS_THEMES/ERROR_UNKNOWN"))}return!0},this))}},e.exports=t}()},,,,,function(e,t,i){!function(){"use strict";function t(){l.call(this,"Popups","PopupsAddOpenPgpKey"),this.key=s.observable(""),this.key.error=s.observable(!1),this.key.focus=s.observable(!1),this.key.subscribe(function(){this.key.error(!1)},this),this.addOpenPgpKeyCommand=n.createCommand(this,function(){var e=30,t=null,o=n.trim(this.key()),s=/[\-]{3,6}BEGIN[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}[\s\S]+?[\-]{3,6}END[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}/gi,a=r.openpgpKeyring;
if(/[\n]/.test(o)&&(o=o.replace(/[\r]+/g,"").replace(/[\n]{2,}/g,"\n\n")),this.key.error(""===o),!a||this.key.error())return!1;for(;;){if(t=s.exec(o),!t||0>e)break;t[0]&&t[1]&&t[2]&&t[1]===t[2]&&("PRIVATE"===t[1]?a.privateKeys.importKey(t[0]):"PUBLIC"===t[1]&&a.publicKeys.importKey(t[0])),e--}return a.store(),i(7)["default"].reloadOpenPgpKeys(),n.delegateRun(this,"cancelCommand"),!0}),a.constructorEnd(this)}var o=i(3),s=i(2),n=i(1),r=i(33),a=i(5),l=i(10);a.extendAsViewModel(["View/Popup/AddOpenPgpKey","PopupsAddOpenPgpKeyViewModel"],t),o.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){this.key(""),this.key.error(!1)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){this.key.focus(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){c.call(this,"Popups","PopupsAdvancedSearch"),this.fromFocus=s.observable(!1),this.from=s.observable(""),this.to=s.observable(""),this.subject=s.observable(""),this.text=s.observable(""),this.selectedDateValue=s.observable(-1),this.hasAttachment=s.observable(!1),this.starred=s.observable(!1),this.unseen=s.observable(!1),this.searchCommand=n.createCommand(this,function(){var e=this.buildSearchString();""!==e&&a.mainMessageListSearch(e),this.cancelCommand()}),this.selectedDates=s.computed(function(){return r.trigger(),[{id:-1,name:r.i18n("SEARCH/LABEL_ADV_DATE_ALL")},{id:3,name:r.i18n("SEARCH/LABEL_ADV_DATE_3_DAYS")},{id:7,name:r.i18n("SEARCH/LABEL_ADV_DATE_7_DAYS")},{id:30,name:r.i18n("SEARCH/LABEL_ADV_DATE_MONTH")},{id:90,name:r.i18n("SEARCH/LABEL_ADV_DATE_3_MONTHS")},{id:180,name:r.i18n("SEARCH/LABEL_ADV_DATE_6_MONTHS")},{id:365,name:r.i18n("SEARCH/LABEL_ADV_DATE_YEAR")}]},this),l.constructorEnd(this)}var o=i(3),s=i(2),n=i(1),r=i(6),a=i(32),l=i(5),c=i(10);l.extendAsViewModel(["View/Popup/AdvancedSearch","PopupsAdvancedSearchViewModel"],t),o.extend(t.prototype,c.prototype),t.prototype.buildSearchStringValue=function(e){return-1<e.indexOf(" ")&&(e='"'+e+'"'),e},t.prototype.buildSearchString=function(){var e=[],t=n.trim(this.from()),o=n.trim(this.to()),s=n.trim(this.subject()),r=n.trim(this.text()),a=[],l=[];return t&&""!==t&&e.push("from:"+this.buildSearchStringValue(t)),o&&""!==o&&e.push("to:"+this.buildSearchStringValue(o)),s&&""!==s&&e.push("subject:"+this.buildSearchStringValue(s)),this.hasAttachment()&&l.push("attachment"),this.unseen()&&a.push("unseen"),this.starred()&&a.push("flagged"),0<l.length&&e.push("has:"+l.join(",")),0<a.length&&e.push("is:"+a.join(",")),-1<this.selectedDateValue()&&e.push("date:"+i(26).searchSubtractFormatDateHelper(this.selectedDateValue())+"/"),r&&""!==r&&e.push("text:"+this.buildSearchStringValue(r)),n.trim(e.join(" "))},t.prototype.clearPopup=function(){this.from(""),this.to(""),this.subject(""),this.text(""),this.selectedDateValue(-1),this.hasAttachment(!1),this.starred(!1),this.unseen(!1),this.fromFocus(!0)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){this.fromFocus(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){h.call(this,"Popups","PopupsComposeOpenPgp");var e=this;this.publicKeysOptionsCaption=c.i18n("PGP_NOTIFICATIONS/ADD_A_PUBLICK_KEY"),this.privateKeysOptionsCaption=c.i18n("PGP_NOTIFICATIONS/SELECT_A_PRIVATE_KEY"),this.notification=n.observable(""),this.sign=n.observable(!1),this.encrypt=n.observable(!1),this.password=n.observable(""),this.password.focus=n.observable(!1),this.buttonFocus=n.observable(!1),this.text=n.observable(""),this.selectedPrivateKey=n.observable(null),this.selectedPublicKey=n.observable(null),this.signKey=n.observable(null),this.encryptKeys=n.observableArray([]),this.encryptKeysView=n.computed(function(){return o.compact(o.map(this.encryptKeys(),function(e){return e?e.key:null}))},this),this.privateKeysOptions=n.computed(function(){return o.compact(o.flatten(o.map(u.openpgpkeysPrivate(),function(t,i){return e.signKey()&&e.signKey().key.id===t.id?null:o.map(t.users,function(e){return{id:t.guid,name:"("+t.id.substr(-8).toUpperCase()+") "+e,key:t,"class":i%2?"odd":"even"}})}),!0))}),this.publicKeysOptions=n.computed(function(){return o.compact(o.flatten(o.map(u.openpgpkeysPublic(),function(t,i){return-1<a.inArray(t,e.encryptKeysView())?null:o.map(t.users,function(e){return{id:t.guid,name:"("+t.id.substr(-8).toUpperCase()+") "+e,key:t,"class":i%2?"odd":"even"}})}),!0))}),this.submitRequest=n.observable(!1),this.resultCallback=null,this.doCommand=a.createCommand(this,function(){var t=!0,i=null,s=[],n=[];if(this.submitRequest(!0),t&&this.sign()&&(this.signKey()?this.signKey().key||(this.notification(c.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND_FOR",{EMAIL:this.signKey().email})),t=!1):(this.notification(c.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND")),t=!1),t)){s=this.signKey().key.getNativeKeys(),i=s[0]||null;try{i&&i.decrypt(a.pString(this.password()))}catch(r){i=null}i||(this.notification(c.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND")),t=!1)}return t&&this.encrypt()&&(0===this.encryptKeys().length?(this.notification(c.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND")),t=!1):this.encryptKeys()&&(n=[],o.each(this.encryptKeys(),function(i){i&&i.key?n=n.concat(o.compact(o.flatten(i.key.getNativeKeys()))):i&&i.email&&(e.notification(c.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND_FOR",{EMAIL:i.email})),t=!1)}),!t||0!==n.length&&this.encryptKeys().length===n.length||(t=!1))),t&&e.resultCallback?o.delay(function(){var t=null;try{i&&0===n.length?t=u.openpgp.sign({data:e.text(),privateKeys:[i]}):i&&0<n.length?t=u.openpgp.encrypt({data:e.text(),publicKeys:n,privateKeys:[i]}):!i&&0<n.length&&(t=u.openpgp.encrypt({data:e.text(),publicKeys:n}))}catch(o){a.log(o),e.notification(c.i18n("PGP_NOTIFICATIONS/PGP_ERROR",{ERROR:""+o}))}if(t)try{t.then(function(t){e.resultCallback(t.data),e.cancelCommand()})["catch"](function(t){e.notification(c.i18n("PGP_NOTIFICATIONS/PGP_ERROR",{ERROR:""+t}))})}catch(o){e.notification(c.i18n("PGP_NOTIFICATIONS/PGP_ERROR",{ERROR:""+o}))}e.submitRequest(!1)},10):e.submitRequest(!1),t},function(){return!this.submitRequest()&&(this.sign()||this.encrypt())}),this.selectCommand=a.createCommand(this,function(){var e=this.selectedPrivateKey(),t=null,i=e?o.find(this.privateKeysOptions(),function(t){return t&&e===t.id}):null;i&&(t={empty:!i.key,selected:n.observable(!!i.key),users:i.key.users,hash:i.key.id.substr(-8).toUpperCase(),key:i.key},this.signKey(t))}),this.addCommand=a.createCommand(this,function(){var e=this.selectedPublicKey(),t=this.encryptKeys(),i=e?o.find(this.publicKeysOptions(),function(t){return t&&e===t.id}):null;i&&(t.push({empty:!i.key,selected:n.observable(!!i.key),removable:n.observable(!this.sign()||!this.signKey()||this.signKey().key.id!==i.key.id),users:i.key.users,hash:i.key.id.substr(-8).toUpperCase(),key:i.key}),this.encryptKeys(t))}),this.updateCommand=a.createCommand(this,function(){var e=this;o.each(this.encryptKeys(),function(t){t.removable(!e.sign()||!e.signKey()||e.signKey().key.id!==t.key.id)})}),this.selectedPrivateKey.subscribe(function(e){e&&(this.selectCommand(),this.updateCommand())},this),this.selectedPublicKey.subscribe(function(e){e&&this.addCommand()},this),this.sDefaultKeyScope=l.KeyState.PopupComposeOpenPGP,this.defautOptionsAfterRender=a.defautOptionsAfterRender,this.addOptionClass=function(t,i){e.defautOptionsAfterRender(t,i),i&&!a.isUnd(i["class"])&&t&&s(t).addClass(i["class"])},this.deletePublickKey=o.bind(this.deletePublickKey,this),p.constructorEnd(this)}var o=i(3),s=i(14),n=i(2),r=i(18),a=i(1),l=i(4),c=i(6),u=i(33),d=i(30),p=i(5),h=i(10);p.extendAsViewModel(["View/Popup/ComposeOpenPgp","PopupsComposeOpenPgpViewModel"],t),o.extend(t.prototype,h.prototype),t.prototype.deletePublickKey=function(e){this.encryptKeys.remove(e)},t.prototype.clearPopup=function(){this.notification(""),this.sign(!1),this.encrypt(!1),this.password(""),this.password.focus(!1),this.buttonFocus(!1),this.signKey(null),this.encryptKeys([]),this.text(""),this.resultCallback=null},t.prototype.onBuild=function(){r("tab,shift+tab",l.KeyState.PopupComposeOpenPGP,o.bind(function(){switch(!0){case this.password.focus():this.buttonFocus(!0);break;case this.buttonFocus():this.password.focus(!0)}return!1},this))},t.prototype.onHideWithDelay=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){this.sign()?this.password.focus(!0):this.buttonFocus(!0)},t.prototype.onShow=function(e,t,i,s,r,l){this.clearPopup();var c=this,p=[],h="",f=[],m=new d;this.resultCallback=e,""!==s&&p.push(s),""!==r&&p.push(r),""!==l&&p.push(l),p=p.join(", ").split(","),p=o.compact(o.map(p,function(e){return m.clear(),m.mailsoParse(a.trim(e)),""===m.email?!1:m.email})),i&&i.email()&&(h=i.email(),p.unshift(h),f=u.findAllPrivateKeysByEmailNotNative(h),f&&f[0]&&this.signKey({users:f[0].users||[h],hash:f[0].id.substr(-8).toUpperCase(),key:f[0]})),this.signKey()&&this.sign(!0),p&&0<p.length&&(this.encryptKeys(o.uniq(o.compact(o.flatten(o.map(p,function(e){var t=u.findAllPublicKeysByEmailNotNative(e);return t?o.map(t,function(t){return{empty:!t,selected:n.observable(!!t),removable:n.observable(!c.sign()||!c.signKey()||c.signKey().key.id!==t.id),users:t?t.users||[e]:[e],hash:t?t.id.substr(-8).toUpperCase():"",key:t}}):[]}),!0)),function(e){return e.hash})),0<this.encryptKeys().length&&this.encrypt(!0)),this.text(t)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){p.call(this,"Popups","PopupsFolderClear"),this.selectedFolder=s.observable(null),this.clearingProcess=s.observable(!1),this.clearingError=s.observable(""),this.folderFullNameForClear=s.computed(function(){var e=this.selectedFolder();return e?e.printableFullName():""},this),this.folderNameForClear=s.computed(function(){var e=this.selectedFolder();return e?e.localName():""},this),this.dangerDescHtml=s.computed(function(){return a.i18n("POPUPS_CLEAR_FOLDER/DANGER_DESC_HTML_1",{FOLDER:this.folderNameForClear()})},this),this.clearCommand=r.createCommand(this,function(){var e=this,t=this.selectedFolder();t&&(c.message(null),c.messageList([]),this.clearingProcess(!0),t.messageCountAll(0),t.messageCountUnread(0),l.setFolderHash(t.fullNameRaw,""),u.folderClear(function(t,o){e.clearingProcess(!1),n.StorageResultType.Success===t&&o&&o.Result?(i(7)["default"].reloadMessageList(!0),e.cancelCommand()):o&&o.ErrorCode?e.clearingError(a.getNotification(o.ErrorCode)):e.clearingError(a.getNotification(n.Notification.MailServerError))},t.fullNameRaw))},function(){var e=this.selectedFolder(),t=this.clearingProcess();return!t&&null!==e}),d.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(1),a=i(6),l=i(19),c=i(32),u=i(15),d=i(5),p=i(10);d.extendAsViewModel(["View/Popup/FolderClear","PopupsFolderClearViewModel"],t),o.extend(t.prototype,p.prototype),t.prototype.clearPopup=function(){this.clearingProcess(!1),this.selectedFolder(null)},t.prototype.onShow=function(e){this.clearPopup(),e&&this.selectedFolder(e)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){u.call(this,"Popups","PopupsMessageOpenPgp"),this.notification=s.observable(""),this.selectedKey=s.observable(null),this.privateKeys=s.observableArray([]),this.password=s.observable(""),this.password.focus=s.observable(!1),this.buttonFocus=s.observable(!1),this.resultCallback=null,this.submitRequest=s.observable(!1),this.doCommand=a.createCommand(this,function(){this.submitRequest(!0),o.delay(o.bind(function(){var e=[],t=null;try{if(this.resultCallback&&this.selectedKey())if(e=this.selectedKey().getNativeKeys(),t=e&&e[0]?e[0]:null)try{t.decrypt(a.pString(this.password()))||(a.log("Error: Private key cannot be decrypted"),t=null)}catch(i){a.log(i),t=null}else a.log("Error: Private key cannot be found")}catch(i){a.log(i),t=null}this.submitRequest(!1),this.cancelCommand(),this.resultCallback(t)},this),100)},function(){return!this.submitRequest()}),this.sDefaultKeyScope=l.KeyState.PopupMessageOpenPGP,c.constructorEnd(this)}var o=i(3),s=i(2),n=i(18),r=i(14),a=i(1),l=i(4),c=i(5),u=i(10);c.extendAsViewModel(["View/Popup/MessageOpenPgp"],t),o.extend(t.prototype,u.prototype),t.prototype.clearPopup=function(){this.notification(""),this.password(""),this.password.focus(!1),this.buttonFocus(!1),this.selectedKey(!1),this.submitRequest(!1),this.resultCallback=null,this.privateKeys([])},t.prototype.onBuild=function(e){n("tab,shift+tab",l.KeyState.PopupMessageOpenPGP,o.bind(function(){switch(!0){case this.password.focus():this.buttonFocus(!0);break;case this.buttonFocus():this.password.focus(!0)}return!1},this));var t=this;e.on("click",".key-list__item",function(){e.find(".key-list__item .key-list__item__radio").addClass("icon-radio-unchecked").removeClass("icon-radio-checked"),r(this).find(".key-list__item__radio").removeClass("icon-radio-unchecked").addClass("icon-radio-checked"),t.selectedKey(s.dataFor(this)),t.password.focus(!0)})},t.prototype.onHideWithDelay=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){this.password.focus(!0)},t.prototype.onShow=function(e,t){this.clearPopup(),this.resultCallback=e,this.privateKeys(t),this.viewModelDom&&this.viewModelDom.find(".key-list__item").first().click()},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){l.call(this,"Popups","PopupsNewOpenPgpKey"),this.email=s.observable(""),this.email.focus=s.observable(""),this.email.error=s.observable(!1),this.name=s.observable(""),this.password=s.observable(""),this.keyBitLength=s.observable(2048),this.submitRequest=s.observable(!1),this.email.subscribe(function(){this.email.error(!1)},this),this.generateOpenPgpKeyCommand=n.createCommand(this,function(){var e=this,t={},s=r.openpgpKeyring;return this.email.error(""===n.trim(this.email())),!s||this.email.error()?!1:(t.email=this.email(),""!==this.name()&&(t.name=this.name()),this.submitRequest(!0),o.delay(function(){var o=!1;try{o=r.openpgp.generateKeyPair({userId:t,numBits:n.pInt(e.keyBitLength()),passphrase:n.trim(e.password())}),o.then(function(t){e.submitRequest(!1),t&&t.privateKeyArmored&&(s.privateKeys.importKey(t.privateKeyArmored),s.publicKeys.importKey(t.publicKeyArmored),s.store(),i(7)["default"].reloadOpenPgpKeys(),n.delegateRun(e,"cancelCommand"))})["catch"](function(){e.submitRequest(!1)})}catch(a){n.log(a),e.submitRequest(!1)}},100),!0)}),a.constructorEnd(this)}var o=i(3),s=i(2),n=i(1),r=i(33),a=i(5),l=i(10);a.extendAsViewModel(["View/Popup/NewOpenPgpKey","PopupsNewOpenPgpKeyViewModel"],t),o.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){this.name(""),this.password(""),this.email(""),this.email.error(!1),this.keyBitLength(2048)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onShowWithDelay=function(){this.email.focus(!0)},e.exports=t}()},,function(e,t,i){!function(){"use strict";function t(){u.call(this,"Popups","PopupsTwoFactorTest");var e=this;this.code=s.observable(""),this.code.focused=s.observable(!1),this.code.status=s.observable(null),this.koTestedTrigger=null,this.testing=s.observable(!1),this.testCode=a.createCommand(this,function(){this.testing(!0),l.testTwoFactor(function(t,i){e.testing(!1),e.code.status(!(n.StorageResultType.Success!==t||!i||!i.Result)),e.koTestedTrigger&&e.code.status()&&e.koTestedTrigger(!0)},this.code())},function(){return""!==this.code()&&!this.testing()}),c.constructorEnd(this)}var o=i(3),s=i(2),n=i(4),r=i(8),a=i(1),l=i(15),c=i(5),u=i(10);c.extendAsViewModel(["View/Popup/TwoFactorTest","PopupsTwoFactorTestViewModel"],t),o.extend(t.prototype,u.prototype),t.prototype.clearPopup=function(){this.code(""),this.code.focused(!1),this.code.status(null),this.testing(!1),this.koTestedTrigger=null},t.prototype.onShow=function(e){this.clearPopup(),this.koTestedTrigger=e},t.prototype.onShowWithDelay=function(){r.bMobile||this.code.focused(!0)},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){c.call(this,"Popups","PopupsViewOpenPgpKey"),this.key=s.observable(""),this.keyDom=s.observable(null),this.sDefaultKeyScope=r.KeyState.PopupViewOpenPGP,l.constructorEnd(this)}var o=i(3),s=i(2),n=i(18),r=i(4),a=i(1),l=i(5),c=i(10);l.extendAsViewModel(["View/Popup/ViewOpenPgpKey","PopupsViewOpenPgpKeyViewModel"],t),o.extend(t.prototype,c.prototype),t.prototype.clearPopup=function(){this.key("")},t.prototype.selectKey=function(){var e=this.keyDom();e&&a.selectElement(e)},t.prototype.onShow=function(e){this.clearPopup(),e&&this.key(e.armor)},t.prototype.onBuild=function(){n("ctrl+a, command+a",r.KeyState.PopupViewOpenPGP,o.bind(function(){return this.selectKey(),!1},this))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){a.call(this,"Popups","PopupsWelcomePage"),this.welcomePageURL=s.observable(""),this.closeFocused=s.observable(!1),r.constructorEnd(this)}var o=i(3),s=i(2),n=i(41),r=i(5),a=i(10);r.extendAsViewModel(["View/Popup/WelcomePage","WelcomePagePopupViewModel"],t),o.extend(t.prototype,a.prototype),t.prototype.clearPopup=function(){this.welcomePageURL(""),this.closeFocused(!1)},t.prototype.onShow=function(e){this.clearPopup(),this.welcomePageURL(e)},t.prototype.onShowWithDelay=function(){this.closeFocused(!0)},t.prototype.onHide=function(){n.welcomeClose()},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){b.call(this,"Center","Login"),this.welcome=n.observable(!!f.settingsGet("UseLoginWelcomePage")),this.email=n.observable(""),this.password=n.observable(""),this.signMe=n.observable(!1),this.additionalCode=n.observable(""),this.additionalCode.error=n.observable(!1),this.additionalCode.errorAnimation=n.observable(!1).extend({falseTimeout:500}),this.additionalCode.focused=n.observable(!1),this.additionalCode.visibility=n.observable(!1),this.additionalCodeSignMe=n.observable(!1),this.logoImg=a.trim(f.settingsGet("LoginLogo")),this.logoPowered=!!f.settingsGet("LoginPowered"),this.loginDescription=a.trim(f.settingsGet("LoginDescription")),this.mobile=!!f.appSettingsGet("mobile"),this.mobileDevice=!!f.appSettingsGet("mobileDevice"),this.forgotPasswordLinkUrl=f.appSettingsGet("forgotPasswordLinkUrl"),this.registrationLinkUrl=f.appSettingsGet("registrationLinkUrl"),this.emailError=n.observable(!1),this.passwordError=n.observable(!1),this.emailErrorAnimation=n.observable(!1).extend({falseTimeout:500}),this.passwordErrorAnimation=n.observable(!1).extend({falseTimeout:500}),this.formHidden=n.observable(!1),this.formError=n.computed(function(){return this.emailErrorAnimation()||this.passwordErrorAnimation()||this.additionalCode.visibility()&&this.additionalCode.errorAnimation()},this),this.emailFocus=n.observable(!1),this.passwordFocus=n.observable(!1),this.submitFocus=n.observable(!1),this.email.subscribe(function(){this.emailError(!1),this.additionalCode(""),this.additionalCode.visibility(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.additionalCode.subscribe(function(){this.additionalCode.error(!1)},this),this.additionalCode.visibility.subscribe(function(){this.additionalCode.error(!1)},this),this.emailError.subscribe(function(e){this.emailErrorAnimation(!!e)},this),this.passwordError.subscribe(function(e){this.passwordErrorAnimation(!!e)},this),this.additionalCode.error.subscribe(function(e){this.additionalCode.errorAnimation(!!e)},this),this.submitRequest=n.observable(!1),this.submitError=n.observable(""),this.submitErrorAddidional=n.observable(""),this.submitError.subscribe(function(e){""===e&&this.submitErrorAddidional("")},this),this.allowLanguagesOnLogin=p.allowLanguagesOnLogin,this.langRequest=n.observable(!1),this.language=d.language,this.languages=d.languages,this.bSendLanguage=!1,this.languageFullName=n.computed(function(){return a.convertLangName(this.language())},this),this.signMeType=n.observable(r.LoginSignMeType.Unused),this.signMeType.subscribe(function(e){this.signMe(r.LoginSignMeType.DefaultOn===e)},this),this.signMeVisibility=n.computed(function(){return r.LoginSignMeType.Unused!==this.signMeType()},this),this.submitCommand=a.createCommand(this,function(){if(a.triggerAutocompleteInputChange(),this.emailError(!1),this.passwordError(!1),this.emailError(""===a.trim(this.email())),this.passwordError(""===a.trim(this.password())),this.additionalCode.visibility()&&(this.additionalCode.error(!1),this.additionalCode.error(""===a.trim(this.additionalCode()))),this.emailError()||this.passwordError()||this.additionalCode.visibility()&&this.additionalCode.error()){switch(!0){case this.emailError():this.emailFocus(!0);break;case this.passwordError():this.passwordFocus(!0);break;case this.additionalCode.visibility()&&this.additionalCode.error():this.additionalCode.focused(!0)}return!1}var e=0,t="",o=function(i,o){e=i||0,t=o||""};if(u.runHook("user-login-submit",[o]),e>0)return this.submitError(c.getNotification(e)),!1;if(""!==t)return this.submitError(t),!1;this.submitRequest(!0);var n=this,l=this.password(),d=s.bind(function(e){m.login(s.bind(function(e,t){r.StorageResultType.Success===e&&t&&"Login"===t.Action?t.Result?t.TwoFactorAuth?(this.additionalCode(""),this.additionalCode.visibility(!0),this.submitRequest(!1),s.delay(function(){n.additionalCode.focused(!0)},100)):t.Admin?i(7)["default"].redirectToAdminPanel():i(7)["default"].loginAndLogoutReload(!1):t.ErrorCode?(this.submitRequest(!1),-1<a.inArray(t.ErrorCode,[r.Notification.InvalidInputArgument])&&(t.ErrorCode=r.Notification.AuthError),this.submitError(c.getNotificationFromResponse(t)),""===this.submitError()?this.submitError(c.getNotification(r.Notification.UnknownError)):t.ErrorMessageAdditional&&this.submitErrorAddidional(t.ErrorMessageAdditional)):this.submitRequest(!1):(this.submitRequest(!1),this.submitError(c.getNotification(r.Notification.UnknownError)))},this),this.email(),"",e,!!this.signMe(),this.bSendLanguage?this.language():"",this.additionalCode.visibility()?this.additionalCode():"",this.additionalCode.visibility()?!!this.additionalCodeSignMe():!1),h.set(r.ClientSideKeyName.LastSignMe,this.signMe()?"-1-":"-0-")},this);return d(f.appSettingsGet("rsaPublicKey")&&a.rsaEncode.supported?a.rsaEncode(l,f.appSettingsGet("rsaPublicKey")):l),!0},function(){return!this.submitRequest()}),this.facebookLoginEnabled=n.observable(!1),this.facebookCommand=a.createCommand(this,function(){return o.open(l.socialFacebook(),"Facebook","left=200,top=100,width=650,height=450,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.facebookLoginEnabled()}),this.googleLoginEnabled=n.observable(!1),this.googleFastLoginEnabled=n.observable(!1),this.googleCommand=a.createCommand(this,function(){return o.open(l.socialGoogle(),"Google","left=200,top=100,width=650,height=500,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.googleLoginEnabled()}),this.googleFastCommand=a.createCommand(this,function(){return o.open(l.socialGoogle(!0),"Google","left=200,top=100,width=650,height=500,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.googleFastLoginEnabled()}),this.twitterLoginEnabled=n.observable(!1),this.twitterCommand=a.createCommand(this,function(){return o.open(l.socialTwitter(),"Twitter","left=200,top=100,width=650,height=450,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.twitterLoginEnabled()}),this.socialLoginEnabled=n.computed(function(){var e=this.facebookLoginEnabled(),t=this.googleLoginEnabled(),i=this.twitterLoginEnabled();return e||t||i},this),f.settingsGet("AdditionalLoginError")&&!this.submitError()&&this.submitError(f.settingsGet("AdditionalLoginError")),g.constructorEnd(this)}var o=i(11),s=i(3),n=i(2),r=i(4),a=i(1),l=i(12),c=i(6),u=i(23),d=i(40),p=i(24),h=i(47),f=i(9),m=i(15),g=i(5),b=i(10);g.extendAsViewModel(["View/User/Login","View/App/Login","LoginViewModel"],t),s.extend(t.prototype,b.prototype),t.prototype.displayMainForm=function(){this.welcome(!1)},t.prototype.onShow=function(){g.routeOff()},t.prototype.onShowWithDelay=function(){""!==this.email()&&""!==this.password()?this.submitFocus(!0):""===this.email()?this.emailFocus(!0):""===this.password()?this.passwordFocus(!0):this.emailFocus(!0)},t.prototype.onHide=function(){this.submitFocus(!1),this.emailFocus(!1),this.passwordFocus(!1)},t.prototype.onBuild=function(){var e=this,t=h.get(r.ClientSideKeyName.LastSignMe),n=(f.settingsGet("SignMe")||"unused").toLowerCase(),l=f.appSettingsGet("jsHash"),u=function(t){t=a.pInt(t),0===t?(e.submitRequest(!0),i(7)["default"].loginAndLogoutReload(!1)):e.submitError(c.getNotification(t))};switch(this.facebookLoginEnabled(!!f.settingsGet("AllowFacebookSocial")),this.twitterLoginEnabled(!!f.settingsGet("AllowTwitterSocial")),this.googleLoginEnabled(!!f.settingsGet("AllowGoogleSocial")&&!!f.settingsGet("AllowGoogleSocialAuth")),this.googleFastLoginEnabled(!!f.settingsGet("AllowGoogleSocial")&&!!f.settingsGet("AllowGoogleSocialAuthFast")),n){case r.LoginSignMeTypeAsString.DefaultOff:case r.LoginSignMeTypeAsString.DefaultOn:switch(this.signMeType(r.LoginSignMeTypeAsString.DefaultOn===n?r.LoginSignMeType.DefaultOn:r.LoginSignMeType.DefaultOff),t){case"-1-":this.signMeType(r.LoginSignMeType.DefaultOn);break;case"-0-":this.signMeType(r.LoginSignMeType.DefaultOff)}break;default:case r.LoginSignMeTypeAsString.Unused:this.signMeType(r.LoginSignMeType.Unused)}this.email(p.devEmail),this.password(p.devPassword),(this.googleLoginEnabled()||this.googleFastLoginEnabled())&&(o["rl_"+l+"_google_login_service"]=u),this.facebookLoginEnabled()&&(o["rl_"+l+"_facebook_login_service"]=u),this.twitterLoginEnabled()&&(o["rl_"+l+"_twitter_login_service"]=u),s.delay(function(){d.language.subscribe(function(t){e.langRequest(!0),c.reload(!1,t,function(){e.langRequest(!1),e.bSendLanguage=!0},function(){e.langRequest(!1)})})},50),a.triggerAutocompleteInputChange(!0)},t.prototype.submitForm=function(){this.submitCommand()},t.prototype.selectLanguage=function(){g.showScreenPopup(i(44),[this.language,this.languages(),d.userLanguage()])},t.prototype.selectLanguageOnTab=function(e){if(!e){var t=this;return s.delay(function(){t.emailFocus(!0)},5),!1}return!0},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){S.call(this,"Left","MailFolderList"),this.oContentVisible=null,this.oContentScrollable=null,this.composeInEdit=h.composeInEdit,this.messageList=g.messageList,this.folderList=m.folderList,this.folderListSystem=m.folderListSystem,this.foldersChanging=m.foldersChanging,this.foldersListWithSingleInboxRootFolder=m.foldersListWithSingleInboxRootFolder,this.leftPanelDisabled=u.leftPanelDisabled,this.iDropOverTimer=0,this.allowComposer=!!b.capa(c.Capa.Composer),this.allowContacts=!!h.contactsIsAllowed(),this.allowFolders=!!b.capa(c.Capa.Folders),this.folderListFocused=r.computed(function(){return c.Focused.FolderList===h.focusedState()}),this.isInboxStarred=r.computed(function(){return m.currentFolder()&&m.currentFolder().isInbox()&&-1<l.trim(g.messageListSearch()).indexOf("is:flagged")}),y.constructorEnd(this)}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(18),l=i(1),c=i(4),u=i(8),d=i(12),p=i(19),h=i(24),f=i(28),m=i(21),g=i(32),b=i(9),y=i(5),S=i(10);y.extendAsViewModel(["View/User/MailBox/FolderList","View/App/MailBox/FolderList","MailBoxFolderListViewModel"],t),s.extend(t.prototype,S.prototype),t.prototype.onBuild=function(e){this.oContentVisible=n(".b-content",e),this.oContentScrollable=n(".content",this.oContentVisible);var t=this,o=b.appSettingsGet("mobile"),s=function(e,t){o&&u.leftPanelDisabled(!0),e.preventDefault(),t&&e.stopPropagation();var i=r.dataFor(this);i&&(c.Layout.NoPreview===f.layout()&&g.message(null),i.fullNameRaw===m.currentFolderFullNameRaw()&&p.setFolderHash(i.fullNameRaw,""),t?y.setHash(d.mailBox(i.fullNameHash,1,"is:flagged")):y.setHash(d.mailBox(i.fullNameHash)))};e.on("click",".b-folders .e-item .e-link .e-collapsed-sign",function(e){var t=r.dataFor(this),o=!1;t&&e&&(o=t.collapsed(),i(7)["default"].setExpandedFolder(t.fullNameHash,o),t.collapsed(!o),e.preventDefault(),e.stopPropagation())}).on("click",".b-folders .e-item .e-link.selectable .inbox-star-icon",function(e){s.call(this,e,!t.isInboxStarred())}).on("click",".b-folders .e-item .e-link.selectable",function(e){s.call(this,e,!1)}),a("up, down",c.KeyState.FolderList,function(i,o){var s=-1,r=o&&"up"===o.shortcut?38:40,a=n(".b-folders .e-item .e-link:not(.hidden):visible",e);return i&&a.length&&(s=a.index(a.filter(".focused")),s>-1&&a.eq(s).removeClass("focused"),38===r&&s>0?s--:40===r&&s<a.length-1&&s++,a.eq(s).addClass("focused"),t.scrollToFocused()),!1}),a("enter",c.KeyState.FolderList,function(){var t=n(".b-folders .e-item .e-link:not(.hidden).focused",e);return t.length&&t[0]&&(h.focusedState(c.Focused.MessageList),t.click()),!1}),a("space",c.KeyState.FolderList,function(){var t=!0,o=null,s=n(".b-folders .e-item .e-link:not(.hidden).focused",e);return s.length&&s[0]&&(o=r.dataFor(s[0]),o&&(t=o.collapsed(),i(7)["default"].setExpandedFolder(o.fullNameHash,t),o.collapsed(!t))),!1}),a("esc, tab, shift+tab, right",c.KeyState.FolderList,function(){return h.focusedState(c.Focused.MessageList),!1}),h.focusedState.subscribe(function(t){n(".b-folders .e-item .e-link.focused",e).removeClass("focused"),c.Focused.FolderList===t&&n(".b-folders .e-item .e-link.selected",e).addClass("focused")})},t.prototype.messagesDropOver=function(e){o.clearTimeout(this.iDropOverTimer),e&&e.collapsed()&&(this.iDropOverTimer=o.setTimeout(function(){e.collapsed(!1),i(7)["default"].setExpandedFolder(e.fullNameHash,!0),l.windowResize()},500))},t.prototype.messagesDropOut=function(){o.clearTimeout(this.iDropOverTimer)},t.prototype.scrollToFocused=function(){if(!this.oContentVisible||!this.oContentScrollable)return!1;var e=20,t=n(".e-item .e-link.focused",this.oContentScrollable),i=t.position(),o=this.oContentVisible.height(),s=t.outerHeight();return i&&(i.top<0||i.top+s>o)?(i.top<0?this.oContentScrollable.scrollTop(this.oContentScrollable.scrollTop()+i.top-e):this.oContentScrollable.scrollTop(this.oContentScrollable.scrollTop()+i.top-o+s+e),!0):!1},t.prototype.messagesDrop=function(e,t){if(e&&t&&t.helper){var o=t.helper.data("rl-folder"),s=u.$html.hasClass("rl-ctrl-key-pressed"),n=t.helper.data("rl-uids");l.isNormal(o)&&""!==o&&l.isArray(n)&&i(7)["default"].moveMessagesToFolder(o,n,e.fullNameRaw,s)}},t.prototype.composeClick=function(){b.capa(c.Capa.Composer)&&y.showScreenPopup(i(29))},t.prototype.createFolder=function(){y.showScreenPopup(i(95))},t.prototype.configureFolders=function(){y.setHash(d.settings("folders"))},t.prototype.contactsClick=function(){this.allowContacts&&y.showScreenPopup(i(62))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){N.call(this,"Right","MailMessageList"),this.sLastUid=null,this.bPrefetch=!1,this.emptySubjectValue="",this.mobile=!!A.appSettingsGet("mobile"),this.allowReload=!!A.capa(u.Capa.Reload),this.allowSearch=!!A.capa(u.Capa.Search),this.allowSearchAdv=!!A.capa(u.Capa.SearchAdv),this.allowComposer=!!A.capa(u.Capa.Composer),this.allowMessageListActions=!!A.capa(u.Capa.MessageListActions),this.allowDangerousActions=!!A.capa(u.Capa.DangerousActions),this.popupVisibility=p.popupVisibility,this.message=T.message,this.messageList=T.messageList,this.messageListDisableAutoSelect=T.messageListDisableAutoSelect,this.folderList=C.folderList,this.composeInEdit=S.composeInEdit,this.leftPanelDisabled=p.leftPanelDisabled,this.selectorMessageSelected=T.selectorMessageSelected,this.selectorMessageFocused=T.selectorMessageFocused,this.isMessageSelected=T.isMessageSelected,this.messageListSearch=T.messageListSearch,this.messageListThreadUid=T.messageListThreadUid,this.messageListError=T.messageListError,this.folderMenuForMove=C.folderMenuForMove,this.useCheckboxesInList=w.useCheckboxesInList,this.mainMessageListSearch=T.mainMessageListSearch,this.messageListEndFolder=T.messageListEndFolder,this.messageListEndThreadUid=T.messageListEndThreadUid,this.messageListChecked=T.messageListChecked,this.messageListCheckedOrSelected=T.messageListCheckedOrSelected,this.messageListCheckedOrSelectedUidsWithSubMails=T.messageListCheckedOrSelectedUidsWithSubMails,
this.messageListCompleteLoadingThrottle=T.messageListCompleteLoadingThrottle,this.messageListCompleteLoadingThrottleForAnimation=T.messageListCompleteLoadingThrottleForAnimation,b.initOnStartOrLangChange(function(){this.emptySubjectValue=b.i18n("MESSAGE_LIST/EMPTY_SUBJECT_TEXT")},this),this.userQuota=v.quota,this.userUsageSize=v.usage,this.userUsageProc=v.percentage,this.moveDropdownTrigger=r.observable(!1),this.moreDropdownTrigger=r.observable(!1),this.dragOver=r.observable(!1).extend({throttle:1}),this.dragOverEnter=r.observable(!1).extend({throttle:1}),this.dragOverArea=r.observable(null),this.dragOverBodyArea=r.observable(null),this.messageListItemTemplate=r.computed(function(){return this.mobile||u.Layout.SidePreview===w.layout()?"MailMessageListItem":"MailMessageListItemNoPreviewPane"},this),this.messageListSearchDesc=r.computed(function(){var e=T.messageListEndSearch();return""===e?"":b.i18n("MESSAGE_LIST/SEARCH_RESULT_FOR",{SEARCH:e})}),this.messageListPagenator=r.computed(h.computedPagenatorHelper(T.messageListPage,T.messageListPageCount)),this.checkAll=r.computed({read:function(){return 0<T.messageListChecked().length},write:function(e){e=!!e,s.each(T.messageList(),function(t){t.checked(e)})}}),this.inputMessageListSearchFocus=r.observable(!1),this.sLastSearchValue="",this.inputProxyMessageListSearch=r.computed({read:this.mainMessageListSearch,write:function(e){this.sLastSearchValue=e},owner:this}),this.isIncompleteChecked=r.computed(function(){var e=T.messageList().length,t=T.messageListChecked().length;return e>0&&t>0&&e>t},this),this.hasMessages=r.computed(function(){return 0<this.messageList().length},this),this.hasCheckedOrSelectedLines=r.computed(function(){return 0<this.messageListCheckedOrSelected().length},this),this.isSpamFolder=r.computed(function(){return C.spamFolder()===this.messageListEndFolder()&&""!==C.spamFolder()},this),this.isSpamDisabled=r.computed(function(){return d.UNUSED_OPTION_VALUE===C.spamFolder()},this),this.isTrashFolder=r.computed(function(){return C.trashFolder()===this.messageListEndFolder()&&""!==C.trashFolder()},this),this.isDraftFolder=r.computed(function(){return C.draftFolder()===this.messageListEndFolder()&&""!==C.draftFolder()},this),this.isSentFolder=r.computed(function(){return C.sentFolder()===this.messageListEndFolder()&&""!==C.sentFolder()},this),this.isArchiveFolder=r.computed(function(){return C.archiveFolder()===this.messageListEndFolder()&&""!==C.archiveFolder()},this),this.isArchiveDisabled=r.computed(function(){return d.UNUSED_OPTION_VALUE===C.archiveFolder()},this),this.isArchiveVisible=r.computed(function(){return!this.isArchiveFolder()&&!this.isArchiveDisabled()&&!this.isDraftFolder()},this),this.isSpamVisible=r.computed(function(){return!(this.isSpamFolder()||this.isSpamDisabled()||this.isDraftFolder()||this.isSentFolder())},this),this.isUnSpamVisible=r.computed(function(){return this.isSpamFolder()&&!this.isSpamDisabled()&&!this.isDraftFolder()&&!this.isSentFolder()},this),this.messageListFocused=r.computed(function(){return u.Focused.MessageList===S.focusedState()}),this.canBeMoved=this.hasCheckedOrSelectedLines,this.clearCommand=h.createCommand(this,function(){A.capa(u.Capa.DangerousActions)&&F.showScreenPopup(i(146),[C.currentFolder()])}),this.multyForwardCommand=h.createCommand(this,function(){A.capa(u.Capa.Composer)&&F.showScreenPopup(i(29),[u.ComposeType.ForwardAsAttachment,T.messageListCheckedOrSelected()])},this.canBeMoved),this.deleteWithoutMoveCommand=h.createCommand(this,function(){A.capa(u.Capa.DangerousActions)&&i(7)["default"].deleteMessagesFromFolder(u.FolderType.Trash,C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),!1)},this.canBeMoved),this.deleteCommand=h.createCommand(this,function(){i(7)["default"].deleteMessagesFromFolder(u.FolderType.Trash,C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.archiveCommand=h.createCommand(this,function(){i(7)["default"].deleteMessagesFromFolder(u.FolderType.Archive,C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.spamCommand=h.createCommand(this,function(){i(7)["default"].deleteMessagesFromFolder(u.FolderType.Spam,C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.notSpamCommand=h.createCommand(this,function(){i(7)["default"].deleteMessagesFromFolder(u.FolderType.NotSpam,C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.moveCommand=h.createCommand(this,h.emptyFunction,this.canBeMoved),this.reloadCommand=h.createCommand(this,function(){!T.messageListCompleteLoadingThrottleForAnimation()&&this.allowReload&&i(7)["default"].reloadMessageList(!1,!0)}),this.quotaTooltip=s.bind(this.quotaTooltip,this),this.selector=new g(this.messageList,this.selectorMessageSelected,this.selectorMessageFocused,".messageListItem .actionHandle",".messageListItem.selected",".messageListItem .checkboxMessage",".messageListItem.focused"),this.selector.on("onItemSelect",s.bind(function(e){T.selectMessage(e)},this)),this.selector.on("onItemGetUid",function(e){return e?e.generateUid():""}),this.selector.on("onAutoSelect",s.bind(function(){return this.useAutoSelect()},this)),this.selector.on("onUpUpOrDownDown",s.bind(function(e){this.goToUpUpOrDownDown(e)},this)),m.sub("mailbox.message-list.selector.go-down",function(e){this.selector.goDown(e)},this).sub("mailbox.message-list.selector.go-up",function(e){this.selector.goUp(e)},this),m.sub("mailbox.message.show",function(e,t){var i=s.find(this.messageList(),function(i){return i&&e===i.folderFullNameRaw&&t===i.uid});"INBOX"===e&&F.setHash(f.mailBox(e,1)),i?this.selector.selectMessageItem(i):("INBOX"!==e&&F.setHash(f.mailBox(e,1)),T.selectMessageByFolderAndUid(e,t))},this),T.messageListEndHash.subscribe(function(){this.selector.scrollToTop()},this),F.constructorEnd(this)}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(18),l=i(80),c=i(172),u=i(4),d=i(17),p=i(8),h=i(1),f=i(12),m=i(25),g=i(100),b=i(6),y=i(19),S=i(24),v=i(91),w=i(28),C=i(21),T=i(32),A=i(9),E=i(15),F=i(5),N=i(10);F.extendAsViewModel(["View/User/MailBox/MessageList","View/App/MailBox/MessageList","MailBoxMessageListViewModel"],t),s.extend(t.prototype,N.prototype),t.prototype.emptySubjectValue="",t.prototype.iGoToUpUpOrDownDownTimeout=0,t.prototype.hideLeft=function(e,t){t.preventDefault(),t.stopPropagation(),p.leftPanelDisabled(!0)},t.prototype.showLeft=function(e,t){t.preventDefault(),t.stopPropagation(),p.leftPanelDisabled(!1)},t.prototype.composeClick=function(){A.capa(u.Capa.Composer)&&F.showScreenPopup(i(29))},t.prototype.goToUpUpOrDownDown=function(e){var t=this;return 0<this.messageListChecked().length?!1:(o.clearTimeout(this.iGoToUpUpOrDownDownTimeout),void(this.iGoToUpUpOrDownDownTimeout=o.setTimeout(function(){var i=null,o=null,n=null,r=null,a=t.messageListPagenator();s.find(a,function(e){if(e){if(r&&(o=e),e.current&&(r=e,i=n),o)return!0;n=e}return!1}),u.Layout.NoPreview!==w.layout()||t.message()?t.selector.iSelectNextHelper=e?-1:1:t.selector.iFocusedNextHelper=e?-1:1,(e?i:o)&&(t.selector.unselect(),t.gotoPage(e?i:o))},350)))},t.prototype.useAutoSelect=function(){return this.messageListDisableAutoSelect()?!1:/is:unseen/.test(this.mainMessageListSearch())?!1:u.Layout.NoPreview!==w.layout()},t.prototype.searchEnterAction=function(){this.mainMessageListSearch(this.sLastSearchValue),this.inputMessageListSearchFocus(!1)},t.prototype.printableMessageCountForDeletion=function(){var e=this.messageListCheckedOrSelectedUidsWithSubMails().length;return e>1?" ("+(100>e?e:"99+")+")":""},t.prototype.cancelSearch=function(){this.mainMessageListSearch(""),this.inputMessageListSearchFocus(!1)},t.prototype.cancelThreadUid=function(){F.setHash(f.mailBox(C.currentFolderFullNameHash(),T.messageListPageBeforeThread(),T.messageListSearch()))},t.prototype.moveSelectedMessagesToFolder=function(e,t){return this.canBeMoved()&&i(7)["default"].moveMessagesToFolder(C.currentFolderFullNameRaw(),T.messageListCheckedOrSelectedUidsWithSubMails(),e,t),!1},t.prototype.dragAndDronHelper=function(e){e&&e.checked(!0);var t=h.draggablePlace(),i=T.messageListCheckedOrSelectedUidsWithSubMails();return t.data("rl-folder",C.currentFolderFullNameRaw()),t.data("rl-uids",i),t.find(".text").text(""+i.length),s.defer(function(){var e=T.messageListCheckedOrSelectedUidsWithSubMails();t.data("rl-uids",e),t.find(".text").text(""+e.length)}),t},t.prototype.setAction=function(e,t,o,s){i(7)["default"].messageListAction(e,t,o,s)},t.prototype.setActionForAll=function(e,t){var o=null,n=T.messageList();if(""!==e&&(o=y.getFolderFromCacheList(e))){switch(t){case u.MessageSetAction.SetSeen:o=y.getFolderFromCacheList(e),o&&(s.each(n,function(e){e.unseen(!1)}),o.messageCountUnread(0),y.clearMessageFlagsFromCacheByFolder(e)),E.messageSetSeenToAll(h.emptyFunction,e,!0);break;case u.MessageSetAction.UnsetSeen:o=y.getFolderFromCacheList(e),o&&(s.each(n,function(e){e.unseen(!0)}),o.messageCountUnread(o.messageCountAll()),y.clearMessageFlagsFromCacheByFolder(e)),E.messageSetSeenToAll(h.emptyFunction,e,!1)}i(7)["default"].reloadFlagsCurrentMessageListAndMessageFromCache()}},t.prototype.listSetSeen=function(){this.setAction(C.currentFolderFullNameRaw(),!0,u.MessageSetAction.SetSeen,T.messageListCheckedOrSelected())},t.prototype.listSetAllSeen=function(){this.setActionForAll(C.currentFolderFullNameRaw(),u.MessageSetAction.SetSeen)},t.prototype.listUnsetSeen=function(){this.setAction(C.currentFolderFullNameRaw(),!0,u.MessageSetAction.UnsetSeen,T.messageListCheckedOrSelected())},t.prototype.listSetFlags=function(){this.setAction(C.currentFolderFullNameRaw(),!0,u.MessageSetAction.SetFlag,T.messageListCheckedOrSelected())},t.prototype.listUnsetFlags=function(){this.setAction(C.currentFolderFullNameRaw(),!0,u.MessageSetAction.UnsetFlag,T.messageListCheckedOrSelected())},t.prototype.flagMessages=function(e){var t=this.messageListCheckedOrSelected(),i=[];e&&(0<t.length&&(i=s.map(t,function(e){return e.uid})),0<i.length&&-1<h.inArray(e.uid,i)?this.setAction(e.folderFullNameRaw,!0,e.flagged()?u.MessageSetAction.UnsetFlag:u.MessageSetAction.SetFlag,t):this.setAction(e.folderFullNameRaw,!0,e.flagged()?u.MessageSetAction.UnsetFlag:u.MessageSetAction.SetFlag,[e]))},t.prototype.flagMessagesFast=function(e){var t=this.messageListCheckedOrSelected(),i=[];0<t.length&&(i=s.filter(t,function(e){return e.flagged()}),h.isUnd(e)?this.setAction(t[0].folderFullNameRaw,!0,t.length===i.length?u.MessageSetAction.UnsetFlag:u.MessageSetAction.SetFlag,t):this.setAction(t[0].folderFullNameRaw,!0,e?u.MessageSetAction.SetFlag:u.MessageSetAction.UnsetFlag,t))},t.prototype.seenMessagesFast=function(e){var t=this.messageListCheckedOrSelected(),i=[];0<t.length&&(i=s.filter(t,function(e){return e.unseen()}),h.isUnd(e)?this.setAction(t[0].folderFullNameRaw,!0,0<i.length?u.MessageSetAction.SetSeen:u.MessageSetAction.UnsetSeen,t):this.setAction(t[0].folderFullNameRaw,!0,e?u.MessageSetAction.SetSeen:u.MessageSetAction.UnsetSeen,t))},t.prototype.gotoPage=function(e){e&&F.setHash(f.mailBox(C.currentFolderFullNameHash(),e.value,T.messageListSearch(),T.messageListThreadUid()))},t.prototype.gotoThread=function(e){e&&0<e.threadsLen()&&(T.messageListPageBeforeThread(T.messageListPage()),F.setHash(f.mailBox(C.currentFolderFullNameHash(),1,T.messageListSearch(),e.uid)))},t.prototype.clearListIsVisible=function(){return""===this.messageListSearchDesc()&&""===this.messageListError()&&""===T.messageListEndThreadUid()&&0<this.messageList().length&&(this.isSpamFolder()||this.isTrashFolder())},t.prototype.onBuild=function(e){var t=this;this.oContentVisible=n(".b-content",e),this.oContentScrollable=n(".content",this.oContentVisible),this.selector.init(this.oContentVisible,this.oContentScrollable,u.KeyState.MessageList),this.mobile&&e.on("click",function(){p.leftPanelDisabled(!0)}),e.on("click",".messageList .b-message-list-wrapper",function(){u.Focused.MessageView===S.focusedState()&&S.focusedState(u.Focused.MessageList)}).on("click",".e-pagenator .e-page",function(){t.gotoPage(r.dataFor(this))}).on("click",".messageList .checkboxCkeckAll",function(){t.checkAll(!t.checkAll())}).on("click",".messageList .messageListItem .flagParent",function(){t.flagMessages(r.dataFor(this))}).on("click",".messageList .messageListItem .threads-len",function(){t.gotoThread(r.dataFor(this))}).on("dblclick",".messageList .messageListItem .actionHandle",function(){t.gotoThread(r.dataFor(this))}),this.initUploaderForAppend(),this.initShortcuts(),!p.bMobileDevice&&c&&A.capa(u.Capa.Prefetch)&&(c.setIdleDuration(10),c.idle(function(){t.prefetchNextTick()}))},t.prototype.initShortcuts=function(){var e=this;a("ctrl+p, command+p",u.KeyState.MessageList,function(){return!1}),a("enter",u.KeyState.MessageList,function(){return e.message()&&e.useAutoSelect()?(m.pub("mailbox.message-view.toggle-full-screen"),!1):void 0}),A.capa(u.Capa.MessageListActions)&&(a("z",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.archiveCommand(),!1}),a("delete, shift+delete, shift+3",u.KeyState.MessageList,function(t,i){return t?(0<T.messageListCheckedOrSelected().length&&(i&&"shift+delete"===i.shortcut?e.deleteWithoutMoveCommand():e.deleteCommand()),!1):void 0})),A.capa(u.Capa.Reload)&&a("ctrl+r, command+r",[u.KeyState.FolderList,u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.reloadCommand(),!1}),a("ctrl+a, command+a",u.KeyState.MessageList,function(){return e.checkAll(!(e.checkAll()&&!e.isIncompleteChecked())),!1}),A.capa(u.Capa.Composer)&&a("w,c",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return F.showScreenPopup(i(29)),!1}),A.capa(u.Capa.MessageListActions)&&a("i",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.flagMessagesFast(),!1}),a("t",[u.KeyState.MessageList],function(){var t=e.selectorMessageSelected();return t||(t=e.selectorMessageFocused()),t&&0<t.threadsLen()&&e.gotoThread(t),!1}),A.capa(u.Capa.MessageListActions)&&a("m",u.KeyState.MessageList,function(){return e.moveDropdownTrigger(!0),!1}),A.capa(u.Capa.MessageListActions)&&(a("q",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.seenMessagesFast(!0),!1}),a("u",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.seenMessagesFast(!1),!1})),A.capa(u.Capa.Composer)&&a("shift+f",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.multyForwardCommand(),!1}),A.capa(u.Capa.Search)&&a("/",[u.KeyState.MessageList,u.KeyState.MessageView],function(){return e.inputMessageListSearchFocus(!0),!1}),a("esc",u.KeyState.MessageList,function(){return""!==e.messageListSearchDesc()?(e.cancelSearch(),!1):""!==e.messageListEndThreadUid()?(e.cancelThreadUid(),!1):void 0}),a("tab, shift+tab, left, right",u.KeyState.MessageList,function(t,i){return t&&i&&("shift+tab"===i.shortcut||"left"===i.shortcut)?S.focusedState(u.Focused.FolderList):e.message()&&S.focusedState(u.Focused.MessageView),!1}),a("ctrl+left, command+left",u.KeyState.MessageView,function(){return!1}),a("ctrl+right, command+right",u.KeyState.MessageView,function(){return!1})},t.prototype.prefetchNextTick=function(){if(c&&!this.bPrefetch&&!c.now()&&this.viewModelVisibility()){var e=this,t=s.find(this.messageList(),function(e){return e&&!y.hasRequestedMessage(e.folderFullNameRaw,e.uid)});t&&(this.bPrefetch=!0,y.addRequestedMessage(t.folderFullNameRaw,t.uid),E.message(function(t,i){var o=!(u.StorageResultType.Success!==t||!i||!i.Result);s.delay(function(){e.bPrefetch=!1,o&&e.prefetchNextTick()},1e3)},t.folderFullNameRaw,t.uid))}},t.prototype.composeClick=function(){A.capa(u.Capa.Composer)&&F.showScreenPopup(i(29))},t.prototype.advancedSearchClick=function(){A.capa(u.Capa.SearchAdv)&&F.showScreenPopup(i(144))},t.prototype.quotaTooltip=function(){return b.i18n("MESSAGE_LIST/QUOTA_SIZE",{SIZE:h.friendlySize(this.userUsageSize()),PROC:this.userUsageProc(),LIMIT:h.friendlySize(this.userQuota())})},t.prototype.initUploaderForAppend=function(){if(!A.appSettingsGet("allowAppendMessage")||!this.dragOverArea())return!1;var e=new l({action:f.append(),name:"AppendFile",queueSize:1,multipleSizeLimit:1,hidden:{Folder:function(){return C.currentFolderFullNameRaw()}},dragAndDropElement:this.dragOverArea(),dragAndDropBodyElement:this.dragOverBodyArea()});return this.dragOver.subscribe(function(e){e&&this.selector.scrollToTop()},this),e.on("onDragEnter",s.bind(function(){this.dragOverEnter(!0)},this)).on("onDragLeave",s.bind(function(){this.dragOverEnter(!1)},this)).on("onBodyDragEnter",s.bind(function(){this.dragOver(!0)},this)).on("onBodyDragLeave",s.bind(function(){this.dragOver(!1)},this)).on("onSelect",s.bind(function(e,t){return e&&t&&"message/rfc822"===t.Type?(T.messageListLoading(!0),!0):!1},this)).on("onComplete",s.bind(function(){i(7)["default"].reloadMessageList(!0,!0)},this)),!!e},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){_.call(this,"Right","MailMessageView");var e=this,t="",o=function(t){return d.createCommand(e,function(){this.lastReplyAction(t),this.replyOrforward(t)},e.canBeRepliedOrForwarded)};this.oDom=null,this.oHeaderDom=null,this.oMessageScrollerDom=null,this.bodyBackgroundColor=r.observable(""),this.pswp=null,this.allowComposer=!!A.capa(c.Capa.Composer),this.allowMessageActions=!!A.capa(c.Capa.MessageActions),this.allowMessageListActions=!!A.capa(c.Capa.MessageListActions),this.logoImg=d.trim(A.settingsGet("UserLogoMessage")),this.logoIframe=d.trim(A.settingsGet("UserIframeMessage")),this.mobile=!!A.appSettingsGet("mobile"),this.attachmentsActions=y.attachmentsActions,this.message=C.message,this.messageListChecked=C.messageListChecked,this.hasCheckedMessages=C.hasCheckedMessages,this.messageListCheckedOrSelectedUidsWithSubMails=C.messageListCheckedOrSelectedUidsWithSubMails,this.messageLoadingThrottle=C.messageLoadingThrottle,this.messagesBodiesDom=C.messagesBodiesDom,this.useThreads=S.useThreads,this.replySameFolder=S.replySameFolder,this.layout=S.layout,this.usePreviewPane=S.usePreviewPane,this.isMessageSelected=C.isMessageSelected,this.messageActiveDom=C.messageActiveDom,this.messageError=C.messageError,this.fullScreenMode=C.messageFullScreenMode,this.messageListOfThreadsLoading=r.observable(!1).extend({rateLimit:1}),this.highlightUnselectedAttachments=r.observable(!1).extend({falseTimeout:2e3}),this.showAttachmnetControls=r.observable(!1),this.allowAttachmnetControls=r.computed(function(){return 0<this.attachmentsActions().length&&A.capa(c.Capa.AttachmentsActions)},this),this.downloadAsZipAllowed=r.computed(function(){return-1<d.inArray("zip",this.attachmentsActions())&&this.allowAttachmnetControls()},this),this.downloadAsZipLoading=r.observable(!1),this.downloadAsZipError=r.observable(!1).extend({falseTimeout:7e3}),this.saveToOwnCloudAllowed=r.computed(function(){return-1<d.inArray("owncloud",this.attachmentsActions())&&this.allowAttachmnetControls()},this),this.saveToOwnCloudLoading=r.observable(!1),this.saveToOwnCloudSuccess=r.observable(!1).extend({falseTimeout:2e3}),this.saveToOwnCloudError=r.observable(!1).extend({falseTimeout:7e3}),this.saveToOwnCloudSuccess.subscribe(function(e){e&&this.saveToOwnCloudError(!1)},this),this.saveToOwnCloudError.subscribe(function(e){e&&this.saveToOwnCloudSuccess(!1)},this),this.saveToDropboxAllowed=r.computed(function(){return-1<d.inArray("dropbox",this.attachmentsActions())&&this.allowAttachmnetControls()},this),this.saveToDropboxLoading=r.observable(!1),this.saveToDropboxSuccess=r.observable(!1).extend({falseTimeout:2e3}),this.saveToDropboxError=r.observable(!1).extend({falseTimeout:7e3}),this.saveToDropboxSuccess.subscribe(function(e){e&&this.saveToDropboxError(!1)},this),this.saveToDropboxError.subscribe(function(e){e&&this.saveToDropboxSuccess(!1)},this),this.showAttachmnetControls.subscribe(function(e){this.message()&&s.each(this.message().attachments(),function(t){t&&t.checked(!!e)})},this),this.lastReplyAction_=r.observable(""),this.lastReplyAction=r.computed({read:this.lastReplyAction_,write:function(e){e=-1===d.inArray(e,[c.ComposeType.Reply,c.ComposeType.ReplyAll,c.ComposeType.Forward])?c.ComposeType.Reply:e,this.lastReplyAction_(e)},owner:this}),this.lastReplyAction(T.get(c.ClientSideKeyName.LastReplyAction)||c.ComposeType.Reply),this.lastReplyAction_.subscribe(function(e){T.set(c.ClientSideKeyName.LastReplyAction,e)}),this.showFullInfo=r.observable(!1),this.moreDropdownTrigger=r.observable(!1),this.messageDomFocused=r.observable(!1).extend({rateLimit:0}),this.messageVisibility=r.computed(function(){return!this.messageLoadingThrottle()&&!!this.message()},this),this.message.subscribe(function(e){e||C.selectorMessageSelected(null)},this),this.canBeRepliedOrForwarded=r.computed(function(){var e=this.messageVisibility();return!this.isDraftFolder()&&e},this),this.closeMessage=d.createCommand(this,function(){C.message(null)}),this.replyCommand=o(c.ComposeType.Reply),this.replyAllCommand=o(c.ComposeType.ReplyAll),this.forwardCommand=o(c.ComposeType.Forward),this.forwardAsAttachmentCommand=o(c.ComposeType.ForwardAsAttachment),this.editAsNewCommand=o(c.ComposeType.EditAsNew),this.messageVisibilityCommand=d.createCommand(this,d.emptyFunction,this.messageVisibility),this.messageEditCommand=d.createCommand(this,function(){this.editMessage()},this.messageVisibility),this.deleteCommand=d.createCommand(this,function(){var e=this.message();e&&this.allowMessageListActions&&(this.message(null),i(7)["default"].deleteMessagesFromFolder(c.FolderType.Trash,e.folderFullNameRaw,[e.uid],!0))},this.messageVisibility),this.deleteWithoutMoveCommand=d.createCommand(this,function(){var e=this.message();e&&this.allowMessageListActions&&(this.message(null),i(7)["default"].deleteMessagesFromFolder(c.FolderType.Trash,e.folderFullNameRaw,[e.uid],!1))},this.messageVisibility),this.archiveCommand=d.createCommand(this,function(){var e=this.message();e&&this.allowMessageListActions&&(this.message(null),i(7)["default"].deleteMessagesFromFolder(c.FolderType.Archive,e.folderFullNameRaw,[e.uid],!0))},this.messageVisibility),this.spamCommand=d.createCommand(this,function(){var e=this.message();e&&this.allowMessageListActions&&(this.message(null),i(7)["default"].deleteMessagesFromFolder(c.FolderType.Spam,e.folderFullNameRaw,[e.uid],!0))},this.messageVisibility),this.notSpamCommand=d.createCommand(this,function(){var e=this.message();e&&this.allowMessageListActions&&(this.message(null),i(7)["default"].deleteMessagesFromFolder(c.FolderType.NotSpam,e.folderFullNameRaw,[e.uid],!0))},this.messageVisibility),this.dropboxEnabled=b.dropbox.enabled,this.dropboxApiKey=b.dropbox.apiKey,this.viewBodyTopValue=r.observable(0),this.viewFolder="",this.viewUid="",this.viewHash="",this.viewSubject=r.observable(""),this.viewFromShort=r.observable(""),this.viewFromDkimData=r.observable(["none",""]),this.viewToShort=r.observable(""),this.viewFrom=r.observable(""),this.viewTo=r.observable(""),this.viewCc=r.observable(""),this.viewBcc=r.observable(""),this.viewReplyTo=r.observable(""),this.viewTimeStamp=r.observable(0),this.viewSize=r.observable(""),this.viewLineAsCss=r.observable(""),this.viewViewLink=r.observable(""),this.viewDownloadLink=r.observable(""),this.viewUserPic=r.observable(l.DATA_IMAGE_USER_DOT_PIC),this.viewUserPicVisible=r.observable(!1),this.viewIsImportant=r.observable(!1),this.viewIsFlagged=r.observable(!1),this.viewFromDkimStatusIconClass=r.computed(function(){var e="icon-none iconcolor-display-none";switch(this.viewFromDkimData()[0]){case"none":break;case"pass":e="icon-ok iconcolor-green";break;default:e="icon-warning-alt iconcolor-red"}return e},this),this.viewFromDkimStatusTitle=r.computed(function(){var e=this.viewFromDkimData();if(d.isNonEmptyArray(e)){if(e[0]&&e[1])return e[1];if(e[0])return"DKIM: "+e[0]}return""},this),this.messageActiveDom.subscribe(function(e){this.bodyBackgroundColor(e?this.detectDomBackgroundColor(e):"")},this),this.message.subscribe(function(i){this.messageActiveDom(null),i?(this.showAttachmnetControls(!1),this.viewHash!==i.hash&&this.scrollMessageToTop(),this.viewFolder=i.folderFullNameRaw,this.viewUid=i.uid,this.viewHash=i.hash,this.viewSubject(i.subject()),this.viewFromShort(i.fromToLine(!0,!0)),this.viewFromDkimData(i.fromDkimData()),this.viewToShort(i.toToLine(!0,!0)),this.viewFrom(i.fromToLine(!1)),this.viewTo(i.toToLine(!1)),this.viewCc(i.ccToLine(!1)),this.viewBcc(i.bccToLine(!1)),this.viewReplyTo(i.replyToToLine(!1)),this.viewTimeStamp(i.dateTimeStampInUTC()),this.viewSize(i.friendlySize()),this.viewLineAsCss(i.lineAsCss()),this.viewViewLink(i.viewLink()),this.viewDownloadLink(i.downloadLink()),this.viewIsImportant(i.isImportant()),this.viewIsFlagged(i.flagged()),t=i.fromAsSingleEmail(),g.getUserPic(t,function(i,o){i!==e.viewUserPic()&&t===o&&(e.viewUserPicVisible(!1),e.viewUserPic(l.DATA_IMAGE_USER_DOT_PIC),""!==i&&(e.viewUserPicVisible(!0),e.viewUserPic(i)))})):(this.viewFolder="",this.viewUid="",this.viewHash="",this.scrollMessageToTop())},this),this.message.viewTrigger.subscribe(function(){var e=this.message();e?this.viewIsFlagged(e.flagged()):this.viewIsFlagged(!1)},this),this.fullScreenMode.subscribe(function(e){u.$html.toggleClass("rl-message-fullscreen",e),d.windowResize()}),this.messageLoadingThrottle.subscribe(d.windowResizeCallback),this.messageFocused=r.computed(function(){return c.Focused.MessageView===y.focusedState()}),this.messageListAndMessageViewLoading=r.computed(function(){return C.messageListCompleteLoadingThrottle()||C.messageLoadingThrottle()}),this.goUpCommand=d.createCommand(this,function(){p.pub("mailbox.message-list.selector.go-up",[c.Layout.NoPreview===this.layout()?!!this.message():!0])},function(){return!this.messageListAndMessageViewLoading()}),this.goDownCommand=d.createCommand(this,function(){p.pub("mailbox.message-list.selector.go-down",[c.Layout.NoPreview===this.layout()?!!this.message():!0])},function(){return!this.messageListAndMessageViewLoading()}),p.sub("mailbox.message-view.toggle-full-screen",function(){this.toggleFullScreen()},this),this.attachmentPreview=s.bind(this.attachmentPreview,this),N.constructorEnd(this)}var o=i(11),s=i(3),n=i(14),r=i(2),a=i(18),l=i(17),c=i(4),u=i(8),d=i(1),p=i(25),h=i(6),f=i(65),m=i(12),g=i(19),b=i(34),y=i(24),S=i(28),v=i(31),w=i(21),C=i(32),T=i(47),A=i(9),E=i(15),F=i(41),N=i(5),_=i(10);N.extendAsViewModel(["View/User/MailBox/MessageView","View/App/MailBox/MessageView","MailBoxMessageViewViewModel"],t),s.extend(t.prototype,_.prototype),t.prototype.detectDomBackgroundColor=function(e){var t=5,i="",o=null,s=function(e){var t=e?e.children():null;return t&&1===t.length&&t.is("table,div,center")?t:null},n=function(e){var t="";return e&&(t=e.css("background-color")||"",e.is("table")||(t="rgba(0, 0, 0, 0)"===t||"transparent"===t?"":t)),t};if(e&&1===e.length){for(o=e;""===i&&(t--,!(0>=t))&&(o=s(o));)i=n(o);i="rgba(0, 0, 0, 0)"===i||"transparent"===i?"":i}return i},t.prototype.fullScreen=function(){this.fullScreenMode(!0),d.windowResize()},t.prototype.unFullScreen=function(){this.fullScreenMode(!1),d.windowResize()},t.prototype.toggleFullScreen=function(){d.removeSelection(),this.fullScreenMode(!this.fullScreenMode()),d.windowResize()},t.prototype.replyOrforward=function(e){A.capa(c.Capa.Composer)&&N.showScreenPopup(i(29),[e,C.message()])},t.prototype.checkHeaderHeight=function(){this.oHeaderDom&&this.viewBodyTopValue(this.message()?this.oHeaderDom.height()+20+1:0)},t.prototype.attachmentPreview=function(e){if(e&&e.isImage()&&!e.isLinked&&this.message()&&this.message().attachments()){var t=n("<div>"),i=0,o=0,r=s.compact(s.map(this.message().attachments(),function(t){return t&&!t.isLinked&&t.isImage()?(t===e&&(i=o),o++,{src:t.linkPreview(),thumb:t.linkThumbnail(),subHtml:t.fileName,downloadUrl:t.linkPreview()}):null}));return 0<r.length&&(t.on("onBeforeOpen.lg",function(){u.useKeyboardShortcuts(!1),d.removeInFocus(!0)}),t.on("onCloseAfter.lg",function(){u.useKeyboardShortcuts(!0)}),t.lightGallery({dynamic:!0,loadYoutubeThumbnail:!1,loadVimeoThumbnail:!1,thumbWidth:80,thumbContHeight:95,showThumbByDefault:!1,mode:"lg-lollipop",index:i,dynamicEl:r})),!1}return!0},t.prototype.onBuild=function(e){var t=this,a=null,l=s.bind(this.checkHeaderHeight,this);this.oDom=e,this.fullScreenMode.subscribe(function(e){e&&t.message()&&y.focusedState(c.Focused.MessageView)},this),this.showAttachmnetControls.subscribe(l),this.fullScreenMode.subscribe(l),this.showFullInfo.subscribe(l),this.message.subscribe(l),p.sub("window.resize",s.throttle(function(){s.delay(l,1),s.delay(l,200),s.delay(l,500)},50)),this.showFullInfo.subscribe(function(){d.windowResize(),d.windowResize(250)}),this.dropboxEnabled()&&this.dropboxApiKey()&&!o.Dropbox&&(a=o.document.createElement("script"),a.type="text/javascript",a.src="https://www.dropbox.com/static/api/2/dropins.js",n(a).attr("id","dropboxjs").attr("data-app-key",t.dropboxApiKey()),o.document.body.appendChild(a)),this.oHeaderDom=n(".messageItemHeader",e),this.oHeaderDom=this.oHeaderDom[0]?this.oHeaderDom:null,this.mobile&&e.on("click",function(){u.leftPanelDisabled(!0)}),e.on("click","a",function(e){return!(e&&3!==e.which&&d.mailToHelper(n(this).attr("href"),A.capa(c.Capa.Composer)?i(29):null))}).on("click",".attachmentsPlace .attachmentIconParent",function(e){e&&e.stopPropagation&&e.stopPropagation()}).on("click",".attachmentsPlace .showPreplay",function(e){e&&e.stopPropagation&&e.stopPropagation();var t=r.dataFor(this);if(t&&f.supported)switch(!0){case f.supportedMp3&&t.isMp3():f.playMp3(t.linkDownload(),t.fileName);break;case f.supportedOgg&&t.isOgg():f.playOgg(t.linkDownload(),t.fileName);break;case f.supportedWav&&t.isWav():f.playWav(t.linkDownload(),t.fileName)}}).on("click",".attachmentsPlace .attachmentItem .attachmentNameParent",function(){var e=r.dataFor(this);e&&e.download&&i(7)["default"].download(e.linkDownload())}).on("click",".messageItemHeader .subjectParent .flagParent",function(){var e=t.message();e&&i(7)["default"].messageListAction(e.folderFullNameRaw,e.uid,e.flagged()?c.MessageSetAction.UnsetFlag:c.MessageSetAction.SetFlag,[e])}).on("click",".thread-list .flagParent",function(){var e=r.dataFor(this);return e&&e.folder&&e.uid&&i(7)["default"].messageListAction(e.folder,e.uid,e.flagged()?c.MessageSetAction.UnsetFlag:c.MessageSetAction.SetFlag,[e]),t.threadsDropdownTrigger(!0),!1}),y.focusedState.subscribe(function(e){c.Focused.MessageView!==e&&(this.scrollMessageToTop(),this.scrollMessageToLeft())},this),u.keyScopeReal.subscribe(function(e){this.messageDomFocused(c.KeyState.MessageView===e&&!d.inFocus())},this),this.oMessageScrollerDom=e.find(".messageItem .content"),this.oMessageScrollerDom=this.oMessageScrollerDom&&this.oMessageScrollerDom[0]?this.oMessageScrollerDom:null,this.initShortcuts()},t.prototype.escShortcuts=function(){return this.viewModelVisibility()&&this.message()?(this.fullScreenMode()?(this.fullScreenMode(!1),c.Layout.NoPreview!==this.layout()&&y.focusedState(c.Focused.MessageList)):c.Layout.NoPreview===this.layout()?this.message(null):y.focusedState(c.Focused.MessageList),!1):void 0},t.prototype.initShortcuts=function(){var e=this;a("esc, backspace",c.KeyState.MessageView,s.bind(this.escShortcuts,this)),a("enter",c.KeyState.MessageView,function(){return e.toggleFullScreen(),!1}),a("r",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return C.message()?(e.replyCommand(),!1):void 0}),a("a",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return C.message()?(e.replyAllCommand(),!1):void 0}),a("f",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return C.message()?(e.forwardCommand(),!1):void 0}),a("b",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return C.message()&&C.message().body?(C.message().body.find(".rlBlockquoteSwitcher").click(),!1):void 0}),a("ctrl+up, command+up, ctrl+left, command+left",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return e.goUpCommand(),!1}),a("ctrl+down, command+down, ctrl+right, command+right",[c.KeyState.MessageList,c.KeyState.MessageView],function(){
return e.goDownCommand(),!1}),a("ctrl+p, command+p",c.KeyState.MessageView,function(){return e.message()&&e.message().printMessage(),!1}),a("delete, shift+delete",c.KeyState.MessageView,function(t,i){return t?(i&&"shift+delete"===i.shortcut?e.deleteWithoutMoveCommand():e.deleteCommand(),!1):void 0}),a("tab, shift+tab, left",c.KeyState.MessageView,function(t,i){if(!e.fullScreenMode()&&e.message()&&c.Layout.NoPreview!==e.layout())if(t&&i&&"left"===i.shortcut){if(e.oMessageScrollerDom&&0<e.oMessageScrollerDom.scrollLeft())return!0;y.focusedState(c.Focused.MessageList)}else y.focusedState(c.Focused.MessageList);else if(e.message()&&c.Layout.NoPreview===e.layout()&&t&&i&&"left"===i.shortcut)return!0;return!1})},t.prototype.isDraftFolder=function(){return C.message()&&w.draftFolder()===C.message().folderFullNameRaw},t.prototype.isSentFolder=function(){return C.message()&&w.sentFolder()===C.message().folderFullNameRaw},t.prototype.isSpamFolder=function(){return C.message()&&w.spamFolder()===C.message().folderFullNameRaw},t.prototype.isSpamDisabled=function(){return C.message()&&w.spamFolder()===l.UNUSED_OPTION_VALUE},t.prototype.isArchiveFolder=function(){return C.message()&&w.archiveFolder()===C.message().folderFullNameRaw},t.prototype.isArchiveDisabled=function(){return C.message()&&w.archiveFolder()===l.UNUSED_OPTION_VALUE},t.prototype.isDraftOrSentFolder=function(){return this.isDraftFolder()||this.isSentFolder()},t.prototype.composeClick=function(){A.capa(c.Capa.Composer)&&N.showScreenPopup(i(29))},t.prototype.editMessage=function(){A.capa(c.Capa.Composer)&&C.message()&&N.showScreenPopup(i(29),[c.ComposeType.Draft,C.message()])},t.prototype.scrollMessageToTop=function(){this.oMessageScrollerDom&&(50<this.oMessageScrollerDom.scrollTop()?this.oMessageScrollerDom.scrollTop(50).animate({scrollTop:0},200):this.oMessageScrollerDom.scrollTop(0),d.windowResize())},t.prototype.scrollMessageToLeft=function(){this.oMessageScrollerDom&&(this.oMessageScrollerDom.scrollLeft(0),d.windowResize())},t.prototype.getAttachmentsHashes=function(){return s.compact(s.map(this.message()?this.message().attachments():[],function(e){return e&&!e.isLinked&&e.checked()?e.download:""}))},t.prototype.downloadAsZip=function(){var e=this,t=this.getAttachmentsHashes();0<t.length?F.attachmentsActions("Zip",t,this.downloadAsZipLoading).then(function(t){t&&t.Result&&t.Result.Files&&t.Result.Files[0]&&t.Result.Files[0].Hash?i(7)["default"].download(m.attachmentDownload(t.Result.Files[0].Hash)):e.downloadAsZipError(!0)}).fail(function(){e.downloadAsZipError(!0)}):this.highlightUnselectedAttachments(!0)},t.prototype.saveToOwnCloud=function(){var e=this,t=this.getAttachmentsHashes();0<t.length?F.attachmentsActions("OwnCloud",t,this.saveToOwnCloudLoading).then(function(t){t&&t.Result?e.saveToOwnCloudSuccess(!0):e.saveToOwnCloudError(!0)}).fail(function(){e.saveToOwnCloudError(!0)}):this.highlightUnselectedAttachments(!0)},t.prototype.saveToDropbox=function(){var e=this,t=[],i=this.getAttachmentsHashes();0<i.length?o.Dropbox&&F.attachmentsActions("Dropbox",i,this.saveToDropboxLoading).then(function(i){i&&i.Result&&i.Result.Url&&i.Result.ShortLife&&i.Result.Files&&(o.Dropbox&&d.isArray(i.Result.Files)?(s.each(i.Result.Files,function(e){t.push({url:i.Result.Url+m.attachmentDownload(e.Hash,i.Result.ShortLife),filename:e.FileName})}),o.Dropbox.save({files:t,progress:function(){e.saveToDropboxLoading(!0),e.saveToDropboxError(!1),e.saveToDropboxSuccess(!1)},cancel:function(){e.saveToDropboxSuccess(!1),e.saveToDropboxError(!1),e.saveToDropboxLoading(!1)},success:function(){e.saveToDropboxSuccess(!0),e.saveToDropboxLoading(!1)},error:function(){e.saveToDropboxError(!0),e.saveToDropboxLoading(!1)}})):e.saveToDropboxError(!0))}).fail(function(){e.saveToDropboxError(!0)}):this.highlightUnselectedAttachments(!0)},t.prototype.showImages=function(e){e&&e.showExternalImages&&e.showExternalImages(!0),this.checkHeaderHeight()},t.prototype.printableCheckedMessageCount=function(){var e=this.messageListCheckedOrSelectedUidsWithSubMails().length;return e>0?100>e?e:"99+":""},t.prototype.readReceipt=function(e){e&&""!==e.readReceipt()&&(E.sendReadReceiptMessage(d.emptyFunction,e.folderFullNameRaw,e.uid,e.readReceipt(),h.i18n("READ_RECEIPT/SUBJECT",{SUBJECT:e.subject()}),h.i18n("READ_RECEIPT/BODY",{"READ-RECEIPT":v.email()})),e.isReadReceipt(!0),g.storeMessageFlagsToCache(e),i(7)["default"].reloadFlagsCurrentMessageListAndMessageFromCache()),this.checkHeaderHeight()},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){n.call(this),s.constructorEnd(this)}var o=i(3),s=i(5),n=i(99);s.extendAsViewModel(["View/User/MailBox/SystemDropDown","View/App/MailBox/SystemDropDown","MailBoxSystemDropDownViewModel"],t),o.extend(t.prototype,n.prototype),e.exports=t}()},function(e,t,i){!function(){"use strict";function t(e){d.call(this,"Left","SettingsMenu"),this.leftPanelDisabled=r.leftPanelDisabled,this.mobile=c.appSettingsGet("mobile"),this.menu=e.menu,u.constructorEnd(this)}var o=i(3),s=i(18),n=i(4),r=i(8),a=i(12),l=i(19),c=i(9),u=i(5),d=i(10);u.extendAsViewModel(["View/User/Settings/Menu","View/App/Settings/Menu","SettingsMenuViewModel"],t),o.extend(t.prototype,d.prototype),t.prototype.onBuild=function(e){this.mobile&&e.on("click",".b-settings-menu .e-item.selectable",function(){r.leftPanelDisabled(!0)}),s("up, down",n.KeyState.Settings,o.throttle(function(t,i){var o="",s=-1,n=i&&"up"===i.shortcut,r=$(".b-settings-menu .e-item",e);t&&r.length&&(s=r.index(r.filter(".selected")),n&&s>0?s--:!n&&s<r.length-1&&s++,o=r.eq(s).attr("href"),o&&u.setHash(o,!1,!0))},200))},t.prototype.link=function(e){return a.settings(e)},t.prototype.backToMailBoxClick=function(){u.setHash(a.inbox(l.getFolderInboxName()))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){a.call(this,"Right","SettingsPane"),this.mobile=n.appSettingsGet("mobile"),this.leftPanelDisabled=s.leftPanelDisabled,r.constructorEnd(this)}var o=i(3),s=i(8),n=i(9),r=i(5),a=i(10);r.extendAsViewModel(["View/User/Settings/Pane","View/App/Settings/Pane","SettingsPaneViewModel"],t),o.extend(t.prototype,a.prototype),t.prototype.onShow=function(){i(32).message(null)},t.prototype.hideLeft=function(e,t){t.preventDefault(),t.stopPropagation(),s.leftPanelDisabled(!0)},t.prototype.showLeft=function(e,t){t.preventDefault(),t.stopPropagation(),s.leftPanelDisabled(!1)},t.prototype.onBuild=function(e){this.mobile&&e.on("click",function(){s.leftPanelDisabled(!0)})},t.prototype.backToMailBoxClick=function(){r.setHash(i(12).inbox(i(19).getFolderInboxName()))},e.exports=t}()},function(e,t,i){!function(){"use strict";function t(){n.call(this),s.constructorEnd(this)}var o=i(3),s=i(5),n=i(99);s.extendAsViewModel(["View/User/Settings/SystemDropDown","View/App/Settings/SystemDropDown","SettingsSystemDropDownViewModel"],t),o.extend(t.prototype,n.prototype),e.exports=t}()},function(e,t){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o={urlsafe_encode:function(e){return o.encode(e).replace(/[+]/g,"-").replace(/[\/]/g,"_").replace(/[=]/g,".")},encode:function(e){var t="",s=void 0,n=void 0,r=void 0,a=void 0,l=void 0,c=void 0,u=void 0,d=0;for(e=o._utf8_encode(e);d<e.length;)s=e.charCodeAt(d++),n=e.charCodeAt(d++),r=e.charCodeAt(d++),a=s>>2,l=(3&s)<<4|n>>4,c=(15&n)<<2|r>>6,u=63&r,isNaN(n)?c=u=64:isNaN(r)&&(u=64),t=t+i.charAt(a)+i.charAt(l)+i.charAt(c)+i.charAt(u);return t},decode:function(e){var t="",s=void 0,n=void 0,r=void 0,a=void 0,l=void 0,c=void 0,u=void 0,d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)a=i.indexOf(e.charAt(d++)),l=i.indexOf(e.charAt(d++)),c=i.indexOf(e.charAt(d++)),u=i.indexOf(e.charAt(d++)),s=a<<2|l>>4,n=(15&l)<<4|c>>2,r=(3&c)<<6|u,t+=String.fromCharCode(s),64!==c&&(t+=String.fromCharCode(n)),64!==u&&(t+=String.fromCharCode(r));return o._utf8_decode(t)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0,o=e.length,s=0;o>i;i++)s=e.charCodeAt(i),128>s?t+=String.fromCharCode(s):s>127&&2048>s?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128));return t},_utf8_decode:function(e){for(var t="",i=0,o=0,s=0,n=0;i<e.length;)o=e.charCodeAt(i),128>o?(t+=String.fromCharCode(o),i++):o>191&&224>o?(s=e.charCodeAt(i+1),t+=String.fromCharCode((31&o)<<6|63&s),i+=2):(s=e.charCodeAt(i+1),n=e.charCodeAt(i+2),t+=String.fromCharCode((15&o)<<12|(63&s)<<6|63&n),i+=3);return t}};e.exports=o},,function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t["default"]=t.CookieDriver=void 0;var n=i(13),r=i(1),a=o(r),l=i(17),c=function(){function e(){s(this,e)}return e.prototype.set=function(e,t){var i=!1,o=null;try{var s=n.$.cookie(l.CLIENT_SIDE_STORAGE_INDEX_NAME);o=null===s?null:n.JSON.parse(s)}catch(r){}(o||(o={}))[e]=t;try{n.$.cookie(l.CLIENT_SIDE_STORAGE_INDEX_NAME,n.JSON.stringify(o),{expires:30}),i=!0}catch(r){}return i},e.prototype.get=function(e){var t=null;try{var i=n.$.cookie(l.CLIENT_SIDE_STORAGE_INDEX_NAME),o=null===i?null:n.JSON.parse(i);t=o&&!a["default"].isUnd(o[e])?o[e]:null}catch(s){}return t},e.supported=function(){return!(!n.window.navigator||!n.window.navigator.cookieEnabled)},e}();t.CookieDriver=c,t["default"]=c},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t["default"]=t.LocalStorageDriver=void 0;var n=i(13),r=i(1),a=o(r),l=i(17),c=function(){function e(){s(this,e)}return e.prototype.set=function(e,t){var i=!1,o=null;try{var s=n.window.localStorage[l.CLIENT_SIDE_STORAGE_INDEX_NAME]||null;o=null===s?null:n.JSON.parse(s)}catch(r){}(o||(o={}))[e]=t;try{n.window.localStorage[l.CLIENT_SIDE_STORAGE_INDEX_NAME]=n.JSON.stringify(o),i=!0}catch(r){}return i},e.prototype.get=function(e){var t=null;try{var i=n.window.localStorage[l.CLIENT_SIDE_STORAGE_INDEX_NAME]||null,o=null===i?null:n.JSON.parse(i);t=o&&!a["default"].isUnd(o[e])?o[e]:null}catch(s){}return t},e.supported=function(){return!!n.window.localStorage},e}();t.LocalStorageDriver=c,t["default"]=c},,,,,,function(e,t){e.exports=window.$LAB},function(e,t){e.exports=window.Tinycon},function(e,t){e.exports=window.ifvisible}]);
